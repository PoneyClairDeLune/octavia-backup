var Yt=Object.create;var nt=Object.defineProperty;var Zt=Object.getOwnPropertyDescriptor;var Wt=Object.getOwnPropertyNames;var Jt=Object.getPrototypeOf,er=Object.prototype.hasOwnProperty;var tr=(f,e,o)=>e in f?nt(f,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):f[e]=o;var rr=(f,e)=>()=>(e||f((e={exports:{}}).exports,e),e.exports);var ar=(f,e,o,c)=>{if(e&&typeof e=="object"||typeof e=="function")for(let t of Wt(e))!er.call(f,t)&&t!==o&&nt(f,t,{get:()=>e[t],enumerable:!(c=Zt(e,t))||c.enumerable});return f};var ir=(f,e,o)=>(o=f!=null?Yt(Jt(f)):{},ar(e||!f||!f.__esModule?nt(o,"default",{value:f,enumerable:!0}):o,f));var k=(f,e,o)=>(tr(f,typeof e!="symbol"?e+"":e,o),o),wt=(f,e,o)=>{if(!e.has(f))throw TypeError("Cannot "+o)};var r=(f,e,o)=>(wt(f,e,"read from private field"),o?o.call(f):e.get(f)),m=(f,e,o)=>{if(e.has(f))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(f):e.set(f,o)},y=(f,e,o,c)=>(wt(f,e,"write to private field"),c?c.call(f,o):e.set(f,o),o);var Vt=rr((Hr,bt)=>{(function(){"use strict";let f={fatal:!0},e=[new TextDecoder("iso-8859-15",f),new TextDecoder("sjis",f),new TextDecoder("euc-jp",f),new TextDecoder("utf-8",f),new TextDecoder("utf-16",f),new TextDecoder("ascii")],o={debug:!1,parse:function(c,t){if(c instanceof Uint8Array)return o.Uint8(c);if(typeof c=="string")return o.Base64(c);if(c instanceof HTMLElement&&c.type==="file")return o.addListener(c,t);throw new Error("MidiParser.parse() : Invalid input provided")},addListener:function(c,t){if(!File||!FileReader)throw new Error("The File|FileReader APIs are not supported in this browser. Use instead MidiParser.Base64() or MidiParser.Uint8()");if(c===void 0||!(c instanceof HTMLElement)||c.tagName!=="INPUT"||c.type.toLowerCase()!=="file")return console.warn("MidiParser.addListener() : Provided element is not a valid FILE INPUT element"),!1;t=t||function(){},c.addEventListener("change",function(a){if(!a.target.files.length)return!1;console.log("MidiParser.addListener() : File detected in INPUT ELEMENT processing data..");let n=new FileReader;n.readAsArrayBuffer(a.target.files[0]),n.onload=function(i){t(o.Uint8(new Uint8Array(i.target.result)))}})},Base64:function(c){let t=function(i){var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(i=i.replace(/^.*?base64,/,""),i=String(i).replace(/[\t\n\f\r ]+/g,""),!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(i))throw new TypeError("Failed to execute _atob() : The string to be decoded is not correctly encoded.");i+="==".slice(2-(3&i.length));let h,d="",l,p,$=0;for(;$<i.length;)h=s.indexOf(i.charAt($++))<<18|s.indexOf(i.charAt($++))<<12|(l=s.indexOf(i.charAt($++)))<<6|(p=s.indexOf(i.charAt($++))),d+=l===64?String.fromCharCode(h>>16&255):p===64?String.fromCharCode(h>>16&255,h>>8&255):String.fromCharCode(h>>16&255,h>>8&255,255&h);return d}(c=String(c));var a=t.length;let n=new Uint8Array(new ArrayBuffer(a));for(let i=0;i<a;i++)n[i]=t.charCodeAt(i);return o.Uint8(n)},Uint8:function(n){let t={data:null,pointer:0,movePointer:function(l){return this.pointer+=l,this.pointer},readInt:function(l){if((l=Math.min(l,this.data.byteLength-this.pointer))<1)return-1;let p=0;if(1<l)for(let $=1;$<=l-1;$++)p+=this.data.getUint8(this.pointer)*Math.pow(256,l-$),this.pointer++;return p+=this.data.getUint8(this.pointer),this.pointer++,p},readStr:function(l){let p=new Uint8Array(l),$=!1,w;p.forEach((x,D)=>{p[D]=this.readInt(1)});for(let x=0;x<e.length;x++)if(!$)try{if(w=e[x].decode(p),x==0)for(let D=0;D<w.length;D++){let A=w.charCodeAt(D);if(A>191||A>127&&A<160)throw new RangeError(`Invalid code point: ${A}`)}$=!0,console.debug(`String byte sequence in ${e[x].encoding}`)}catch(D){console.debug(`SMF string ${D}`)}return w||"String byte sequence read failed."},backOne:function(){this.pointer--},readIntVLV:function(){let l=0;if(this.pointer>=this.data.byteLength)return-1;if(this.data.getUint8(this.pointer)<128)l=this.readInt(1);else{let $=[];for(;128<=this.data.getUint8(this.pointer);)$.push(this.readInt(1)-128);var p=this.readInt(1);for(let w=1;w<=$.length;w++)l+=$[$.length-w]*Math.pow(128,w);l+=p}return l}};if(t.data=new DataView(n.buffer,n.byteOffset,n.byteLength),t.readInt(4)!==1297377380)return console.warn("Header validation failed (not MIDI standard or file corrupt.)"),!1;t.readInt(4);let a={};a.formatType=t.readInt(2),a.tracks=t.readInt(2),a.track=[];var n=t.readInt(1),i=t.readInt(1);128<=n?(a.timeDivision=[],a.timeDivision[0]=n-128,a.timeDivision[1]=i):a.timeDivision=256*n+i;for(let l=1;l<=a.tracks;l++){a.track[l-1]={event:[]};var s,h=t.readInt(4);if(h===-1)break;if(h!==1297379947)return!1;t.readInt(4);let p=0,$=!1,w,x;for(;!$&&(p++,a.track[l-1].event[p-1]={},a.track[l-1].event[p-1].deltaTime=t.readIntVLV(),(w=t.readInt(1))!==-1);)if(128<=w?x=w:(w=x,t.movePointer(-1)),w===255){a.track[l-1].event[p-1].type=255,a.track[l-1].event[p-1].metaType=t.readInt(1);var d=t.readIntVLV();switch(a.track[l-1].event[p-1].metaType){case 47:case-1:$=!0;break;case 1:case 2:case 3:case 4:case 5:case 7:case 6:a.track[l-1].event[p-1].data=t.readStr(d);break;case 33:case 89:case 81:a.track[l-1].event[p-1].data=t.readInt(d);break;case 84:a.track[l-1].event[p-1].data=[],a.track[l-1].event[p-1].data[0]=t.readInt(1),a.track[l-1].event[p-1].data[1]=t.readInt(1),a.track[l-1].event[p-1].data[2]=t.readInt(1),a.track[l-1].event[p-1].data[3]=t.readInt(1),a.track[l-1].event[p-1].data[4]=t.readInt(1);break;case 88:a.track[l-1].event[p-1].data=[],a.track[l-1].event[p-1].data[0]=t.readInt(1),a.track[l-1].event[p-1].data[1]=t.readInt(1),a.track[l-1].event[p-1].data[2]=t.readInt(1),a.track[l-1].event[p-1].data[3]=t.readInt(1);break;default:this.customInterpreter!==null&&(a.track[l-1].event[p-1].data=this.customInterpreter(a.track[l-1].event[p-1].metaType,t,d)),this.customInterpreter!==null&&a.track[l-1].event[p-1].data!==!1||(t.readInt(d),a.track[l-1].event[p-1].data=t.readInt(d),this.debug&&console.info("Unimplemented 0xFF meta event! data block readed as Integer"))}}else switch((w=w.toString(16).split(""))[1]||w.unshift("0"),a.track[l-1].event[p-1].type=parseInt(w[0],16),a.track[l-1].event[p-1].channel=parseInt(w[1],16),a.track[l-1].event[p-1].type){case 15:this.customInterpreter!==null&&(a.track[l-1].event[p-1].data=this.customInterpreter(a.track[l-1].event[p-1].type,t,!1)),this.customInterpreter!==null&&a.track[l-1].event[p-1].data!==!1||(s=t.readIntVLV(),a.track[l-1].event[p-1].data=t.readInt(s),this.debug&&console.info("Unimplemented 0xF exclusive events! data block readed as Integer"));break;case 10:case 11:case 14:case 8:case 9:a.track[l-1].event[p-1].data=[],a.track[l-1].event[p-1].data[0]=t.readInt(1),a.track[l-1].event[p-1].data[1]=t.readInt(1);break;case 12:case 13:a.track[l-1].event[p-1].data=t.readInt(1);break;case-1:$=!0;break;default:if(this.customInterpreter!==null&&(a.track[l-1].event[p-1].data=this.customInterpreter(a.track[l-1].event[p-1].metaType,t,!1)),this.customInterpreter===null||a.track[l-1].event[p-1].data===!1)return console.log("Unknown EVENT detected... reading cancelled!"),!1}}return a},customInterpreter:null};if(typeof bt<"u")bt.exports=o;else{let c=typeof window=="object"&&window.self===window&&window||typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;c.MidiParser=o}})()});var H,Et,tt=(Et=class{constructor(){m(this,H,{})}addEventListener(f,e){r(this,H)[f]||(r(this,H)[f]=[]),r(this,H)[f].unshift(e)}removeEventListener(f,e){if(r(this,H)[f]){let o=r(this,H)[f].indexOf(e);o>-1&&r(this,H)[f].splice(o,1),r(this,H)[f].length<1&&delete r(this,H)[f]}}dispatchEvent(f,e){var t;let o=new Event(f),c=this;o.data=e,((t=r(this,H)[f])==null?void 0:t.length)>0&&r(this,H)[f].forEach(function(a){try{a==null||a.call(c,o)}catch(n){console.error(n)}}),this[`on${f}`]&&this[`on${f}`](o)}},H=new WeakMap,Et);var kt=function(f,e){let o=Math.min(f.length,e.length),c=f.slice(0,o),t=e.slice(0,o),a=0,n=0;for(;n<o&&a==0;)a=Math.sign(c[n]-t[n]),n++;return a},J=function(){this.pool=[],this.point=function(f,e=!1){if(this.pool.length>0){let o=this.pool.length,c=1<<Math.floor(Math.log2(o)),t=c,a=64;for(;c>=1&&a>=0;){if(a<=0)throw new Error("TTL reached.");if(t==o)t-=c;else{let i=kt(f,this.pool[t]);switch(i){case 0:{a=0;break}case 1:{t+c<=o&&(t+=c);break}case-1:{t!=0&&(t-=c);break}default:console.warn(`Unexpected result ${i}.`)}}c=c>>1,a--}let n=!0;if(t>=this.pool.length)n=!1;else{let i=this;this.pool[t].forEach(function(s,h,d){n&&s!=f[h]&&(n=!1)}),!n&&kt(f,this.pool[t])>0&&t++}return n||e?t:-1}else return e?0:-1},this.add=function(f,e){return f.data=e,this.pool.splice(this.point(f,!0),0,f),this},this.default=function(f){console.warn(`No match for "${f}". Default action not defined.`)},this.get=function(f){let e=this.point(f);if(e>-1)return this.pool[e].data;this.default(f)},this.run=function(f,...e){let o=this.point(f);o>-1?this.pool[o].data(f.slice(this.pool[o].length),...e):this.default(f,...e)}};var sr=["MSB","PRG","LSB"];var ot=function(f){let e=Math.floor(f/10),o=f%10;return`${e.toString(16)}${o}`},_,vt,ct=(vt=class{constructor(...f){m(this,_,void 0);k(this,"strictMode",!1);this.loadFiles(...f)}get(f=0,e=0,o=0,c){let t,a=Array.from(arguments);switch(c){case"xg":{f==32?a[2]+=4:f==33||f==35||f==36?a[2]+=5:f==79?a[0]=95:f==80?a[0]=96:f==81?a[0]=97:f==82?a[0]=98:f==83?a[0]=99:f==84&&(a[0]=100);break}case"gs":{f==0&&o<5?a[2]=0:f>125&&o<5&&o!=2&&(a[2]=f,a[0]=0);break}case"sg":{f==8&&o==0&&(a[2]=5);break}}let n=" ",i="M",s=!1,h=0;switch(a[0]){case 0:{a[2]==127?i="MT-a":a[2]==126?i="MT-b":a[2]==7?i="GM-k":a[2]==5?i="SG-a":a[2]==4?i="SP-l":a[2]==0||c=="gs"&&a[2]<5?i="GM-a":(i="y",s=!0);break}case 8:{c=="sg"?i="GM-s":i="r:";break}case 48:{i=`yM${(a[2]>>3).toString().padStart(2,"0")}`,s=!0;break}case 56:{i="GM-b";break}case 61:case 120:{i="rDrm";break}case 62:{i="kDrm";break}case 63:{let l=a[2];i=l<10?"kP:":"kC:",i+=l%10;break}case 64:{i="ySFX";break}case 67:{i="DX:S";break}case 80:case 81:case 82:case 83:{i=`Prg${"UABC"[a[0]-80]}`;break}case 88:case 89:case 90:case 91:{i=`Cmb${"UABC"[a[0]-88]}`;break}case 95:{i=`${["DR","PC"][a[2]]}-d`;break}case 96:{i=a[2]==106?"AP-a":"PF",a[2]>63&&(h=63),s=!0;break}case 97:{i="VL:",s=!0,h=112;break}case 98:{i="SG-a";break}case 99:{i="DX",a[2]>63&&(h=63),s=!0;break}case 100:{i="AN",a[2]>63&&(h=63),s=!0;break}case 121:{i=`GM-${a[2]?"":"a"}`,s=!0;break}case 122:{i="lDrm";break}case 126:{i="yDrS";break}case 127:{a[2]==127?i="rDrm":i="yDrm";break}default:a[0]<48?i="r:":i="M"}for(i.length<4&&(i+=`${(s?o:f)-h}`.padStart(4-i.length,"0")),c=="xg"&&f==16&&(t=`Voice${(o*128+e+1).toString().padStart(3,"0")}`,n=" ");!((t==null?void 0:t.length)>=0);)t=r(this,_)[a[1]||0][(a[0]<<7)+a[2]],t||(this.strictMode?(t="",n="?"):r(this,_)[a[1]||0][a[0]<<7]?a[0]==0?(a[2]=0,n="^"):a[2]<1?(a[0]=0,n="*"):(a[2]--,n="^"):f==48?(a[0]=0,a[2]=0,n="!"):f==62?(a[1]--,n=" ",a[1]<1&&!(t!=null&&t.length)&&(a[0]=0,n="!")):f<64?a[0]==0?(a[2]=0,n="^"):a[2]<1?(a[0]=0,n="*"):a[2]--:f==80?(t=`PrgU:${e.toString().padStart(3,"0")}`,n="!"):f==88?(t=`CmbU:${e.toString().padStart(3,"0")}`,n="!"):f==121?(t=`GM2Vox0${o}`,n="#"):f==122?(a[1]==32?a[1]==0:a[1]%=7,t=r(this,_)[a[1]||0][(a[0]<<7)+a[2]],t?n=" ":(t="",n="*")):a[1]==0?(t=`${f.toString().padStart(3,"0")} ${e.toString().padStart(3,"0")} ${o.toString().padStart(3,"0")}`,n="!"):a[0]==0?(a[2]=0,n="^"):a[2]>0?a[2]--:a[1]>0?(a[1]=0,n="!"):(a[0]=0,n="?"));(c=="gs"||c=="ns5r")&&n=="^"&&(n=" "),f==127&&n=="^"&&(n=" "),n!=" "&&self.debugMode&&(t="");let d="??";switch(a[0]){case 0:{a[2]==0?d="GM":a[2]==5||a[2]==7?d="KG":a[2]<120?d="XG":a[2]==127&&(d="MT");break}case 48:{d="MU";break}case 56:{d="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{d="AI";break}case 62:case 82:case 90:{d="XD";break}case 63:d="KR";case 64:case 126:{d="XG";break}case 67:case 99:{d="DX";break}case 81:{d="RW";break}case 95:{d=["DR","PC"][a[2]];break}case 96:{d=a[2]==106?"AP":"PF";break}case 97:{d="VL";break}case 98:{d="SG";break}case 100:{d="AN";break}case 120:{d="GS";break}case 121:{d=a[2]?"G2":"GM";break}case 122:{d="KG";break}case 127:{d=a[2]==127?"MT":e==0?"GM":"XG";break}default:a[0]<48&&(a[0]==16&&c=="xg"?d="XG":d="GS")}return{name:t||`${ot(f||0)} ${ot(e||0)} ${ot(o||0)}`,ending:n,sect:i,standard:d}}async load(f,e,o){let c=this,t=[],a=0,n=0;f.split(`
`).forEach(function(i,s){let h=i.split("	"),d=[];s==0?h.forEach(function(l,p){t[sr.indexOf(l)]=p}):h.forEach(async function(l,p){var $;p>2?(r(c,_)[d[t[1]]]=r(c,_)[d[t[1]]]||[],(!(($=r(c,_)[d[t[1]]][(d[t[0]]<<7)+d[t[2]]])!=null&&$.length)||e)&&(r(c,_)[d[t[1]]][(d[t[0]]<<7)+d[t[2]]]=h[3],a++),n++):d.push(parseInt(h[p]))})}),e||console.debug(`Map "${o||"(internal)"}": ${n} total, ${a} loaded.`)}clearRange(f){let e=f.prg!=null?f.prg.constructor==Array?f.prg:[f.prg,f.prg]:[0,127],o=f.msb!=null?f.msb.constructor==Array?f.msb:[f.msb,f.msb]:[0,127],c=f.lsb!=null?f.lsb.constructor==Array?f.lsb:[f.lsb,f.lsb]:[0,127];for(let t=o[0];t<=o[1];t++){let a=t<<7;for(let n=c[0];n<=c[1];n++){let i=a+n;for(let s=e[0];s<=e[1];s++)delete r(this,_)[s][i]}}}init(){y(this,_,[]);for(let f=0;f<128;f++)r(this,_).push([""])}async loadFiles(...f){this.init();let e=this;f.forEach(async function(o,c){try{await fetch(`./data/bank/${o}.tsv`).then(function(t){return t.text()}).then(t=>{e.load(t,!1,o)})}catch(t){console.error(`Failed loading "${o}.tsv".`)}})}},_=new WeakMap,vt);var Ke=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),ze=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],nr=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],Qe=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],xt=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],St=function(f){let e=.1,o=-.3;return f>66?(e=5,o=315):f>56?(e=1,o=47):f>46&&(e=.5,o=18.5),e*f-o},Ct=function(f){return f>105?nr[f-106]:f>100?f*1.1-100:f/10},Tt=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),lt={};`hi*,
ka,か
ki,き
ku,く
ke,け
ko,こ
ky,き!
kw,くl
tsu,つ
ts,つl
sa,さ
si,すぃ
su,す
se,せ
so,そ
shi,し
sh,し!
ta,た
ti,てぃ
tu,とぅ
te,て
to,と
tchy,ち!
tchi,ち
na,な
ni,に
nu,ぬ
ne,ね
no,の
ny,に!
nn,ん
ha,は
hi,ひ
hu,ほぅ
he,へ
ho,ほ
hy,ひ!
fa,ふぁ
fi,ふぃ
fu,ふ
fe,ふぇ
fo,ふぉ
ma,ま
mi,み
mu,む
me,め
mo,も
my,み!
mm,
ra,ら
ri,り
ru,る
re,れ
ro,ろ
ry,り!
wa,わ
wi,うぃ
we,うぇ
wo,を
nga,ガ
ngi,ギ
ngu,グ
nge,ゲ
ngo,ゴ
ngy,ギ!
ng,
ga,が
gi,ぎ
gu,ぐ
ge,げ
go,ご
gy,ぎ!
gw,ぐl
za,ざ
zi,ずぃ
zu,ず
ze,ぜ
zo,ぞ
ja,じゃ
ji,じ
ju,じゅ
je,じぇ
jo,じょ
jy,じ!
da,だ
di,でぃ
du,どぅ
de,で
do,ど
dy,で!
ba,ば
bi,び
bu,ぶ
be,べ
bo,ぼ
by,び!
va,ゔぁ
vi,ゔぃ
vu,ゔ
ve,ゔぇ
vo,ゔぉ
pa,ぱ
pi,ぴ
pu,ぷ
pe,ペ
po,ぽ
py,ぴ!
!ya,ゃ
!yu,ゅ
!ye,ぇ
!yo,ょ
ya,や
yu,ゆ
ye,いぇ
yo,よ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
la,ぁ
li,ぃ
lu,ぅ
le,ぇ
lo,ぉ
a,あ
i,い
u,う
e,え
o,お
*,っ
~,
^,
_,`.split(`
`).forEach(f=>{let e=f.split(",");lt[e[0]]=e[1]});var Mt=function(f){let e=f;f[0]=="*"&&(e=e.slice(1)),["aa","ii","uu","ee","oo"].forEach(c=>{for(;e.indexOf(c)>-1;)e=e.replace(c,c[0])});for(let c in lt)e=e.replaceAll(c,lt[c]);e.indexOf("ん")==0&&e.length>1&&(e=e.slice(1));let o=e.indexOf("!");return o>-1&&e.length>1&&(e=e.slice(o+1)),e},Rt=function(f){return f?f<96?`cc${f}`:["aftertouch","velocity","pitch bend"][f-96]:"off"};var ht=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],Ot=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],At=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var or={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},cr={66307:["drive"],66309:["vowel",f=>"aiueo"[f]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",f=>["off","LPF","HPF"][f]],94984:["noise type",f=>["white","pink"][f]],94987:["disc type",f=>["LP","SP","EP","RND"]],94990:["hum type",f=>`${f+5}0Hz`],94993:["M/S",f=>["mono","stereo"][f]]},dt=function(f){return or[(f[0]-32<<8)+f[1]]||`0x${f[0].toString(16).padStart(2,"0")}${f[1].toString(16).padStart(2,"0")}`},Dt=function(f,e,o){let c=(f[0]-32<<16)+(f[1]<<8)+e,t=cr[c]||{},a=t[0];if(a!=null&&a.length)return a+=`: ${(t[1]||function(){})(o)||o}`,a},ft=[68,48,95,78,41,3,110,122,0];var F=function(f=64){return Math.round(2e3*Math.log10(f/64))/100},It=function(f,e,o){let c=[],t=o==!1?e.readIntVLV():o;f==0||f==127;for(let a=0;a<t;a++){let n=e.readInt(1);if(c.push(n),n!=247){if(n!=240){if(n>127)return console.debug(`Early termination: ${c}`),c.pop(),e.backOne(),e.backOne(),new Uint8Array(c)}}}return new Uint8Array(c)},Pt=function(f){let e=0;return f.forEach(o=>{e+=o,e=e&127}),~e+1&127},ee=function(f,e){let o=0,c=0;for(let t=0;t<f.length;t++){let a=t%8-1,n=(c>>a&1)<<7,i=f[t];i+=n,t%8!=0?(e(i,o,f),o++):c=f[t]}},qe=function(f){let e=Math.floor(f*14.2);return e<128?e:0};var pe=["?","gm","gs","xg","g2","mt32","ns5r","ag10","x5d","05rw","krs","k11","sg"],Ut=[[0,0,0,0,121,0,0,56,82,81,63,0,0],[0,0,4,0,0,127,0,0,0,0,0,0,0]],ve=[120,127,120,127,120,127,61,62,62,62,120,122,122],lr=[0,3,81,84,88],Lt={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},ut={0:0,1:1,2:3,5:4},Nt=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],Bt=[36,37],at=[20,21,22,23,24,25,26,28,29,30,31,36,37,64,65],je=[0,1,2,4,5,6,7,8,10,11,32,38,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,84,91,92,93,94,95,98,99,100,101,128,12,13,16,17,18,19],hr=[12,13,16,17,18,19],dr=[33,99,100,32,102,8,9,10],Gt=[0,16,25,40,32,64,26,48],v={};pe.forEach((f,e)=>{v[f]=e});var b={length:je.length};je.forEach((f,e)=>{b[f]=e});var it={length:at.length};at.forEach((f,e)=>{it[f]=e});var q=function(){return!!self.Bun||self.debugMode||!1},fr=function(f){let e=[],o=0;return f==null||f.forEach(function(c,t){c==247?e.push(f.subarray(o,t)):c==240&&(o=t+1)}),e.length||e.push(f.subarray(0)),q()&&console.debug(e),e},Ht=function(f,e="",o="",c=2){return f?`${e}${f.toString().padStart(c,"0")}${o}`:""},g={ch:128,cc:je.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,ace:8,drm:8,dpn:at.length,dnc:128,efx:7},R,V,te,oe,Q,ne,Ft,X,N,C,u,ce,T,I,re,P,L,be,ae,xe,E,De,Ye,ie,ge,Y,Ie,$e,K,ye,Z,z,le,Pe,Ue,se,me,Le,W,O,Ze,pt,S,he,we,B,Se,U,We,rt,Ne,Be,de,fe,Ee,Ge,He,_e,_t,Lr=(_t=class extends tt{constructor(){super();m(this,Q);k(this,"NOTE_IDLE",0);k(this,"NOTE_ATTACK",1);k(this,"NOTE_DECAY",2);k(this,"NOTE_SUSTAIN",3);k(this,"NOTE_HELD",4);k(this,"NOTE_RELEASE",5);k(this,"NOTE_SOSTENUTO_ATTACK",8);k(this,"NOTE_SOSTENUTO_DECAY",9);k(this,"NOTE_SOSTENUTO_SUSTAIN",10);k(this,"NOTE_SOSTENUTO_HELD",11);k(this,"CH_MELODIC",0);k(this,"CH_DRUMS",1);k(this,"CH_DRUM1",2);k(this,"CH_DRUM2",3);k(this,"CH_DRUM3",4);k(this,"CH_DRUM4",5);k(this,"CH_DRUM5",6);k(this,"CH_DRUM6",7);k(this,"CH_DRUM7",8);k(this,"CH_DRUM8",9);m(this,R,0);m(this,V,0);m(this,te,0);m(this,oe,new Array(11));m(this,X,new Uint8Array(g.ch));m(this,N,new Uint8Array(g.ch));m(this,C,new Uint8Array(g.ch));m(this,u,new Uint8Array(g.ch*g.cc));m(this,ce,new Uint8Array(g.ace));m(this,T,new Uint8Array(g.ch));m(this,I,new Uint8Array(g.ch*g.nn));m(this,re,new Uint8Array(g.ch));m(this,P,new Uint16Array(g.pl));m(this,L,new Uint8Array(g.pl));m(this,be,new Int16Array(g.ch));m(this,ae,new Uint8Array(g.ch));m(this,xe,0);m(this,E,new Uint8Array(g.ch*g.rpn));m(this,De,new Int8Array(g.ch*Bt.length));m(this,Ye,new Uint8Array(g.drm*g.dpn*g.dnc));m(this,ie,new Uint8Array(g.ch));m(this,ge,new Uint8Array(128));m(this,Y,new Uint8Array(g.cmt*8));m(this,Ie,new Uint8Array(1024));m(this,$e,new Uint8Array(g.cmt*64));m(this,K,new Uint8Array(g.efx*3));m(this,ye,0);m(this,Z,0);m(this,z,100);m(this,le,0);m(this,Pe,500);m(this,Ue,0);m(this,se,"");m(this,me,0);m(this,Le,0);m(this,W,!0);m(this,O,!1);m(this,Ze,void 0);m(this,pt,new Uint8Array(2));m(this,S,[]);m(this,he,new Uint8Array(g.ch));m(this,we,new Uint8Array(g.tr));k(this,"baseBank",new ct("gm","gm2","xg","gs","ns5r","gmega","plg-150vl","plg-150pf","plg-150dx","plg-150an","plg-150dr","plg-100sg","kross"));k(this,"userBank",new ct("gm"));k(this,"initOnReset",!1);k(this,"aiEfxName","");m(this,B,[]);m(this,Se,void 0);m(this,U,{nOff:(e,o)=>{let c=e*128+o,t=r(this,P).lastIndexOf(c);t>-1&&(r(this,u)[g.cc*e+b[64]]>63?(r(this,L)[t]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:o,velo:r(this,I)[c],state:this.NOTE_HELD})):r(this,u)[g.cc*e+b[66]]>63&&r(this,L)[t]==this.NOTE_SOSTENUTO_SUSTAIN?(r(this,L)[t]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:o,velo:r(this,I)[c],state:this.NOTE_SOSTENUTO_HELD})):(r(this,P)[t]=0,r(this,I)[c]=0,r(this,L)[t]=this.NOTE_IDLE,this.dispatchEvent("note",{part:e,note:o,velo:0,state:this.NOTE_IDLE})))},nOn:(e,o,c)=>{let t=e*128+o,a=0;for(r(this,re)[e]&&r(this,U).ano(e);r(this,L)[a]>0&&r(this,P)[a]!=t;)a++;a<g.pl?(r(this,P)[a]=t,r(this,I)[t]=c,r(this,L)[a]=this.NOTE_SUSTAIN,r(this,ae)[e]<c&&(r(this,ae)[e]=c),this.dispatchEvent("note",{part:e,note:o,velo:c,state:this.NOTE_SUSTAIN})):console.error("Polyphony exceeded.")},nAt:(e,o,c)=>{},cAt:(e,o)=>{},hoOf:e=>{r(this,L).forEach((o,c)=>{if(o==this.NOTE_HELD){let t=r(this,P)[c],a=t>>7;e==a&&(r(this,L)[c]=this.NOTE_IDLE,r(this,P)[c]=0,r(this,I)[t]=0,this.dispatchEvent("note",{part:e,note:t&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{r(this,L).forEach((o,c)=>{let t;switch(o){case this.NOTE_ATTACK:{t=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{t=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{t=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(t){r(this,L)[c]=t;let a=r(this,P)[c];this.dispatchEvent("note",{part:e,note:a&127,velo:r(this,I)[a],state:t})}})},soOf:e=>{r(this,L).forEach((o,c)=>{if(o==this.NOTE_SOSTENUTO_HELD){let t=r(this,P)[c],a=t>>7;e==a&&(r(this,L)[c]=this.NOTE_IDLE,r(this,P)[c]=0,r(this,I)[t]=0,this.dispatchEvent("note",{part:e,note:t&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{r(this,P).forEach((o,c,t)=>{let a=o>>7,n=o&127;o==0&&r(this,I)[0]==0||a==e&&r(this,U).nOff(a,n)})}});m(this,We,{8:function(e){let o=e.channel,c=e.data[0];r(this,U).nOff(o,c)},9:function(e){let o=e.channel;r(this,X)[o]=1;let c=e.data[0],t=e.data[1];t>0?r(this,U).nOn(o,c,t):r(this,U).nOff(o,c)},10:function(e){let o=e.channel,c=o*128+e.data[0];r(this,P).indexOf(c)>-1&&(r(this,I)[c]=data[1],this.dispatchEvent("note",{part:o,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let o=e.channel;r(this,X)[o]=1;let c=o*g.cc;switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{r(this,U).ano(o),r(this,be)[o]=0;let t=o*g.cc;r(this,u)[t+b[1]]=0,r(this,u)[t+b[5]]=0,r(this,u)[t+b[64]]=0,r(this,u)[t+b[65]]=0,r(this,u)[t+b[66]]=0,r(this,u)[t+b[67]]=0,r(this,u)[t+b[11]]=127,r(this,u)[t+b[101]]=127,r(this,u)[t+b[100]]=127,r(this,u)[t+b[99]]=127,r(this,u)[t+b[98]]=127;return}case 123:{r(this,U).ano(o);return}case 124:{r(this,U).ano(o);return}case 125:{r(this,U).ano(o);return}case 126:{r(this,re)[o]=1,r(this,U).ano(o);return}case 127:{r(this,re)[o]=0,r(this,U).ano(o);return}}if(b[e.data[0]]==null)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(hr.indexOf(e.data[0])>-1&&this.allocateAce(e.data[0]),e.data[0]){case 0:{if(q()&&console.debug(`${pe[r(this,R)]}, CH${o+1}: ${e.data[1]}`),r(this,R)==0)e.data[1]<48?(r(this,C)[o]>0&&(e.data[1]=r(this,u)[c],e.data[1]=120,console.debug(`Forced channel ${o+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),this.switchMode("gs"))):e.data[1]==62?this.switchMode("x5d"):e.data[1]==63?this.switchMode("krs"):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg");else if(r(this,R)==v.gs)e.data[1]<56&&r(this,C)[o]>0&&(e.data[1]=r(this,u)[c],e.data[1]=120,console.debug(`Forced channel ${o+1} to stay drums.`));else if(r(this,R)==v.gm)e.data[1]<48?r(this,C)[o]>0&&(e.data[1]=120,this.switchMode("gs",!0),console.debug(`Forced channel ${o+1} to stay drums.`)):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg",!0);else if(r(this,R)==v.x5d){if(e.data[1]>0&&e.data[1]<8)this.switchMode("05rw",!0);else if(e.data[1]==56){let t=0;for(let a=0;a<16;a++){let n=r(this,u)[g.cc*a];(n==56||n==62)&&t++}t>14&&this.switchMode("ag10",!0)}}switch(r(this,R)){case v.xg:{[126,127].indexOf(e.data[1])>-1?r(this,C)[o]==0&&(this.setChType(o,this.CH_DRUM2),console.debug(`CH${o+1} set to drums by MSB.`)):r(this,C)[o]>0&&(this.setChType(o,this.CH_MELODIC),console.debug(`CH${o+1} set to melodic by MSB.`));break}case v["05rw"]:case v.x5d:case v.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?r(this,C)[o]==0&&(this.setChType(o,this.CH_DRUM2),console.debug(`CH${o+1} set to drums by MSB.`)):r(this,C)[o]>0&&(this.setChType(o,this.CH_MELODIC),console.debug(`CH${o+1} set to melodic by MSB.`));break}case v.g2:{e.data[1]==120?r(this,C)[o]==0&&(this.setChType(o,this.CH_DRUMS),console.debug(`CH${o+1} set to drums by MSB.`)):r(this,C)[o]>0&&(this.setChType(o,this.CH_MELODIC),console.debug(`CH${o+1} set to melodic by MSB.`));break}}this.dispatchEvent("voice",{part:o});break}case 6:{if(r(this,xe)){[v.xg,v.gs,v.ns5r].indexOf(r(this,R))<0&&console.warn(`NRPN commits are not available under "${pe[r(this,R)]}" mode, even when they are supported in Octavia.`);let t=r(this,u)[c+b[99]],a=r(this,u)[c+b[98]];if(t==1){let n=dr.indexOf(a);if(n>-1)r(this,u)[c+b[71+n]]=e.data[1],q()&&console.debug(`Redirected NRPN 1 ${a} to cc${71+n}.`),this.dispatchEvent("cc",{part:o,cc:71+n,data:e.data[1]});else{let i=Bt.indexOf(a);i>-1?r(this,De)[o*10+i]=e.data[1]-64:console.warn(`NRPN 0x01${a.toString(16).padStart(2,"0")} is not supported.`),q()&&console.debug(`CH${o+1} voice NRPN ${a} commit`)}}else{if(at.indexOf(t)<0){let i=`NRPN 0x${t.toString(16).padStart(2,"0")}${a.toString(16).padStart(2,"0")} `;t==127?console.warn(`${i}is not necessary. Consider removing it.`):console.warn(`${i}is not supported.`)}else{let i=r(this,C)[o]-2;i<0?console.warn(`CH${o+1} cannot accept drum NRPN as type ${ze[r(this,C)[o]]}.`):r(this,Ye)[(i*g.dpn+it[t])*g.dnc+a]=e.data[1]-64}q()&&console.debug(`CH${o+1} (${ze[r(this,C)[o]]}) drum NRPN ${t} commit`)}}else{let t=ut[r(this,u)[c+b[100]]];r(this,u)[c+b[101]]==0&&t!=null&&(q()&&console.debug(`CH${o+1} RPN 0 ${r(this,u)[c+b[100]]} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],Nt[t][0]),Nt[t][1]),r(this,E)[o*g.rpn+t]=e.data[1])}break}case 32:{this.dispatchEvent("voice",{part:o});break}case 38:{r(this,xe)||r(this,u)[c+101]==0&&ut[r(this,u)[c+100]]!=null&&(r(this,E)[o*g.rpn+ut[r(this,u)[c+100]]+1]=e.data[1]);break}case 64:{e.data[1]<64&&r(this,U).hoOf(o);break}case 66:{e.data[1]>>6?r(this,U).soOn(o):r(this,U).soOf(o);break}case 98:case 99:{y(this,xe,1);break}case 100:case 101:{y(this,xe,0);break}}r(this,u)[c+b[e.data[0]]]=e.data[1],this.dispatchEvent("cc",{part:o,cc:e.data[0],data:e.data[1]})}},12:function(e){let o=e.channel;r(this,X)[o]=1,r(this,T)[o]=e.data,r(this,ie)[o]=0,q()&&console.debug(`T:${e.track} C:${o} P:${e.data}`),this.dispatchEvent("voice",{part:o})},13:function(e){let o=this,c=e.channel;r(this,P).forEach(function(t){let a=t>>7;c==a&&(r(o,I)[t]=e.data,o.dispatchEvent("note",{part:c,note:t&127,velo:e.data,state:o.NOTE_SUSTAIN}))})},14:function(e){let o=e.channel;r(this,be)[o]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:o,pitch:this.getPitchShift(o)})},15:function(e){fr(e.data).forEach(o=>{let c=o[0],t=o[1];(r(this,rt)[c]||function(){console.debug(`Unknown manufacturer ${c}.`)})(t,o.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(r(this,B)[e.meta]||function(c,t,a){}).call(this,e.data,e.track,e.meta),e.meta!=32&&y(this,le,0);let o=lr.indexOf(e.meta)>-1;if(q()&&console.debug(e),o)return e.reply="meta",e}});m(this,rt,{64:(e,o,c)=>{r(this,Ge).run(o,c,e)},65:(e,o,c)=>{if(o[0]<16)r(this,fe).run(o,c,e),console.warn("Unknown device SysEx!");else{let t=o[o.length-1],a=Pt(o.subarray(2,o.length-1));t==a?r(this,fe).run(o.subarray(0,o.length-1),c,e):console.warn(`Bad GS checksum ${t}. Should be ${a}.`)}},66:(e,o,c)=>{r(this,Ee).run(o,c,e)},67:(e,o,c)=>{r(this,de).run(o,c,e)},68:(e,o,c)=>{r(this,_e).run(o,c,e)},71:(e,o,c)=>{r(this,He).run(o,c,e)},126:(e,o,c)=>{r(this,Ne).run(o,c,e)},127:(e,o,c)=>{this.switchMode("gm"),r(this,Be).run(o,c,e)}});m(this,Ne,void 0);m(this,Be,void 0);m(this,de,void 0);m(this,fe,void 0);m(this,Ee,void 0);m(this,Ge,void 0);m(this,He,void 0);m(this,_e,void 0);let e=this;y(this,Q,new Uint8Array(256),Ft),r(this,oe)[10]=new Uint8Array(512),y(this,Se,new J),this.userBank.strictMode=!0,this.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),r(this,B)[1]=function(t){switch(t.slice(0,2)){case"@I":{y(this,O,!0),r(this,S).unshift(`Kar.Info: ${t.slice(2)}`);break}case"@K":{y(this,O,!0),r(this,S).unshift("Karaoke mode active."),console.debug(`Karaoke mode active: ${t.slice(2)}`);break}case"@L":{y(this,O,!0),r(this,S).unshift(`Language: ${t.slice(2)}`);break}case"@T":{y(this,O,!0),r(this,S).unshift(`Ka.Title: ${t.slice(2)}`);break}case"@V":{y(this,O,!0),r(this,S).unshift(`Kara.Ver: ${t.slice(2)}`);break}case"XF":{let a=t.slice(2).split(":");switch(a[0]){case"hd":{a.slice(1).forEach((n,i)=>{n.length&&r(this,S).unshift(`${["SongDate","SnRegion","SongCat.","SongBeat","SongInst","Sn.Vocal","SongCmp.","SongLrc.","SongArr.","SongPerf","SongPrg.","SongTags"][i]}: ${n}`)});break}case"ln":{a.slice(1).forEach((n,i)=>{n.length&&r(this,S).unshift(`${["Kar.Lang","Kar.Name","Kar.Cmp.","Kar.Lrc.","kar.Arr.","Kar.Perf","Kar.Prg."][i]}: ${n}`)});break}default:r(this,S).unshift(`XGF_Data: ${t}`)}break}default:r(this,O)?t[0]=="\\"?r(this,S).unshift(`@ ${t.slice(1)}`):t[0]=="/"?r(this,S).unshift(t.slice(1)):r(this,S)[0]+=t:(r(this,S)[0]=t,r(this,S).unshift(""))}},r(this,B)[2]=function(t){r(this,S).unshift(`Copyrite: ${t}`)},r(this,B)[3]=function(t,a){a<1&&r(this,le)<1&&r(this,S).unshift(`TrkTitle: ${t}`)},r(this,B)[4]=function(t,a){r(this,S).unshift(`${Ht(r(this,le),""," ")}Instrmnt: ${t}`)},r(this,B)[5]=function(t){t.trim()==""?r(this,S).unshift(""):r(this,S)[0]+=`${t}`},r(this,B)[6]=function(t){r(this,S).unshift(`${Ht(r(this,le),""," ")}C.Marker: ${t}`)},r(this,B)[7]=function(t){r(this,S).unshift(`CuePoint: ${t}`)},r(this,B)[32]=function(t){y(this,le,t[0]+1)},r(this,B)[33]=function(t,a){console.debug(`Track ${a} requests to get assigned to output ${t}.`),r(e,we)[a]=t+1},r(this,B)[81]=function(t,a){y(e,Pe,t/1e3)},r(this,B)[127]=function(t,a){r(e,Se).run(t,a)},r(this,Se).default=function(t){console.warn(`Unrecognized sequencer-specific byte sequence: ${t}`)},r(this,Se).add([67,0,1],function(t,a){r(e,we)[a]=t[0]+1}),y(this,Ne,new J),y(this,Be,new J),y(this,de,new J),y(this,fe,new J),y(this,Ee,new J),y(this,Ge,new J),y(this,He,new J),y(this,_e,new J),r(this,Ne).add([9],t=>{e.switchMode(["gm","?","g2"][t[0]-1],!0),y(e,O,r(e,O)||!1),console.info(`MIDI reset: ${["GM","Init","GM2"][t[0]-1]}`),t[0]==2&&e.init()}),r(this,Be).add([4,1],t=>{y(e,z,((t[1]<<7)+t[0])/16383*100)}).add([4,3],t=>((t[1]<<7)+t[0]-8192)/8192).add([4,4],t=>t[1]-64),r(this,de).add([76,0,0],t=>{switch(t[0]){case 125:{console.info(`XG drum setup reset: ${t}`);break}case 126:{e.switchMode("xg",!0),y(e,O,!1),console.info("MIDI reset: XG");break}default:{let a=[0,0,0,0],n=(i,s)=>{a[s]=i};if(t.subarray(1).forEach((i,s)=>{let h=s+t[0];([n,n,n,n,d=>{y(this,z,d*129/16383*100)},d=>{},d=>{}][h]||(()=>{}))(i,s)}),t[0]<4){let i=0;a.forEach(s=>{i=i<<4,i+=s}),i-=1024}}}}).add([76,2,1],t=>{let a="XG ";t[0]<32?(a+="reverb ",t.subarray(1).forEach((n,i)=>{([s=>{e.setEffectTypeRaw(0,!1,s),console.info(`${a}main type: ${Ke[s]}`)},s=>{e.setEffectTypeRaw(0,!0,s),console.debug(`${a}sub type: ${s+1}`)},s=>{console.debug(`${a}time: ${St(s)}s`)},s=>{console.debug(`${a}diffusion: ${s}`)},s=>{console.debug(`${a}initial delay: ${s}`)},s=>{console.debug(`${a}HPF cutoff: ${Qe[s]}Hz`)},s=>{console.debug(`${a}LPF cutoff: ${Qe[s]}Hz`)},s=>{console.debug(`${a}width: ${s}`)},s=>{console.debug(`${a}height: ${s}`)},s=>{console.debug(`${a}depth: ${s}`)},s=>{console.debug(`${a}wall type: ${s}`)},s=>{console.debug(`${a}dry/wet: ${s}`)},s=>{console.debug(`${a}send: ${F(s)}dB`)},s=>{console.debug(`${a}pan: ${s-64}`)},!1,!1,s=>{console.debug(`${a}delay: ${s}`)},s=>{console.debug(`${a}density: ${s}`)},s=>{console.debug(`${a}balance: ${s}`)},s=>{},s=>{console.debug(`${a}feedback: ${s}`)},s=>{}][t[0]+i]||function(){console.warn(`Unknown XG reverb address: ${t[0]}.`)})(n)})):t[0]<64?(a+="chorus ",t.subarray(1).forEach((n,i)=>{([s=>{e.setEffectTypeRaw(1,!1,s),console.info(`${a}main type: ${Ke[s]}`)},s=>{e.setEffectTypeRaw(1,!0,s),console.debug(`${a}sub type: ${s+1}`)},s=>{console.debug(`${a}LFO: ${xt[s]}Hz`)},s=>{},s=>{console.debug(`${a}feedback: ${s}`)},s=>{console.debug(`${a}delay offset: ${Ct(s)}ms`)},s=>{},s=>{console.debug(`${a}low: ${Qe[s]}Hz`)},s=>{console.debug(`${a}low: ${s-64}dB`)},s=>{console.debug(`${a}high: ${Qe[s]}Hz`)},s=>{console.debug(`${a}high: ${s-64}dB`)},s=>{console.debug(`${a}dry/wet: ${s}`)},s=>{console.debug(`${a}send: ${F(s)}dB`)},s=>{console.debug(`${a}pan: ${s-64}`)},s=>{console.debug(`${a}to reverb: ${F(s)}dB`)},!1,s=>{},s=>{},s=>{},s=>{console.debug(`${a}LFO phase diff: ${(s-64)*3}deg`)},s=>{console.debug(`${a}input mode: ${s?"stereo":"mono"}`)},s=>{}][t[0]-32+i]||function(){console.warn(`Unknown XG chorus address: ${t[0]}.`)})(n)})):t[0]<86?(a+="variation ",t.subarray(1).forEach((n,i)=>{([s=>{e.setEffectTypeRaw(2,!1,s),console.info(`${a}main type: ${Ke[s]}`)},s=>{e.setEffectTypeRaw(2,!0,s),console.debug(`${a}sub type: ${s+1}`)}][t[0]-64+i]||function(){})(n)})):t[0]<97?(a+="variation ",t.subarray(1).forEach((n,i)=>{[s=>{console.debug(`${a}send: ${F(s)}dB`)},s=>{console.debug(`${a}pan: ${s-64}`)},s=>{console.debug(`${a}to reverb: ${F(s)}dB`)},s=>{console.debug(`${a}to chorus: ${F(s)}dB`)},s=>{console.debug(`${a}connection: ${s?"system":"insertion"}`)},s=>{console.debug(`${a}channel: CH${s+1}`)},s=>{console.debug(`${a}mod wheel: ${s-64}`)},s=>{console.debug(`${a}bend wheel: ${s-64}`)},s=>{console.debug(`${a}channel after touch: ${s-64}`)},s=>{console.debug(`${a}AC1: ${s-64}`)},s=>{console.debug(`${a}AC2: ${s-64}`)}][t[0]-86+i](n)})):t[0]>111&&t[0]<118?a+="variation ":console.warn(`Unknown XG variation address: ${t[0]}`)}).add([76,2,64],t=>{t.subarray(1).forEach((a,n)=>{let i=n+t[0];if(i==0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][a]}`);else{let s=i-1>>2,h=i-1&3,d=`XG EQ ${s} ${["gain","freq","Q","shape"][h]}: `;[()=>{console.debug(`${d}${a-64}dB`)},()=>{console.debug(`${d}${a} (raw)`)},()=>{console.debug(`${d}${a/10}`)},()=>{console.debug(`${d}${["shelf","peak"][+!!a]}`)}][h]()}})}).add([76,3],t=>{let a=t[0],n=t[1],i=`XG Insertion ${t[0]+1} `;t.subarray(2).forEach((s,h)=>{([d=>{e.setEffectTypeRaw(3+a,!1,d),console.info(`${i}main type: ${Ke[d]}`)},d=>{e.setEffectTypeRaw(3+a,!0,d),console.debug(`${i}sub type: ${d+1}`)}][n+h]||function(){})(s)})}).add([76,6,0],t=>{let a=t[0];a<64?e.setLetterDisplay(t.subarray(1),"XG letter display",a):y(e,me,Date.now())}).add([76,7,0],t=>{let a=t[0];y(e,V,0),y(e,te,Date.now()+3200),r(e,Q,ne).fill(0);let n=t.subarray(1);for(let i=0;i<a;i++)n.unshift(0);n.forEach(function(i,s){let h=Math.floor(s/16),d=s%16,l=(d*3+h)*7,p=7,$=0;for(l-=d*5,h==2&&(p=2);$<p;)r(e,Q,ne)[l+$]=i>>6-$&1,$++})}).add([76,8],(t,a)=>{let n=e.chRedir(t[0],a,!0),i=t[1],s=g.cc*n,h=`XG CH${n+1} `,d=`Unknown XG part address ${i}.`;t.subarray(2).forEach((l,p)=>{i<1?console.debug(d):i<41?([()=>{r(e,u)[s+b[0]]=l},()=>{r(e,u)[s+b[32]]=l},()=>{r(e,T)[n]=l},()=>{let $=e.chRedir(l,a,!0);r(e,N)[n]=$,n!=$&&(e.buildRchTree(),console.info(`${h}receives from CH${$+1}`))},()=>{r(e,re)[n]=+!l},()=>{},()=>{e.setChType(n,l,v.xg),console.debug(`${h}type: ${ze[l]||l}`)},()=>{r(e,E)[g.rpn*n+3]=l},!1,!1,()=>{r(e,u)[s+b[7]]=l},!1,!1,()=>{r(e,u)[s+b[10]]=l||128},!1,!1,()=>{r(e,u)[s+b[128]]=l},()=>{r(e,u)[s+b[93]]=l},()=>{r(e,u)[s+b[91]]=l},()=>{r(e,u)[s+b[94]]=l},()=>{r(e,u)[s+b[76]]=l},()=>{r(e,u)[s+b[77]]=l},()=>{r(e,u)[s+b[78]]=l},()=>{r(e,u)[s+b[74]]=l},()=>{r(e,u)[s+b[71]]=l},()=>{r(e,u)[s+b[73]]=l},()=>{r(e,u)[s+b[75]]=l},()=>{r(e,u)[s+b[72]]=l}][i+p-1]||(()=>{}))():i<48?console.debug(d):i<111?i>102&&i<105&&(r(e,u)[s+b[[5,65][i&1]]]=l):i<114?console.debug(d):i<116?console.debug(`${h}EQ ${["bass","treble"][i&1]} gain: ${l-64}dB`):i<118?console.debug(d):i<120?console.debug(`${h}EQ ${["bass","treble"][i&1]} freq: ${l}`):console.debug(d)})}).add([76,9],(t,a)=>{let n=e.chRedir(t[0],a,!0),i=t[1],s=`PLG-150VL CH${n+1} `;t.subarray(2).forEach((h,d)=>{let l=d+i;switch(l){case 1:{console.info(`${s}breath mode: ${["system","breath","velocity","touch EG"][h]}`);break}case 0:case 27:case 28:break;default:if(l<27){let p=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][l-3>>1];l&1?l<23?(console.debug(`${s}${p} control source: ${Rt(h)}`),h&&h<96&&e.allocateAce(h)):console.debug(`${s}${p} scale break point: ${h}`):console.debug(`${s}${p} depth: ${h-64}`)}}})}).add([76,10],t=>{}).add([76,16],t=>{}).add([76,17,0,0],t=>{}).add([76,112],t=>{console.debug(`XG enable PLG-1${["50VL","00SG","50DX"][t[0]]} for CH${t[2]+1}.`)}).add([73,0,0],(t,a)=>{let n=t[0];t.subarray(1).forEach((i,s)=>{let h=n+s;h==8?console.debug(`MU1000 set LCD contrast to ${i}.`):h>9&&h<16&&[()=>{e.dispatchEvent("channelactive",i)},()=>{i<8?(e.dispatchEvent("channelmin",i<<4),console.info(`Octavia System: Minimum CH${(i<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{i<8?(e.dispatchEvent("channelmax",(i<<4)+15),console.info(`Octavia System: Maximum CH${(i<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{y(e,W,!!i),console.info(`Octavia System: RS receiving ${["dis","en"][i]}abled.`)}][h-10]()})}).add([73,10,0],(t,a)=>{let n=t[0],i=`MU1000 RS${r(e,W)?"":" (ignored)"}: `;if(n<16)switch(n){case 2:{let s=e.chRedir(0,a,!0);r(e,W)&&(e.dispatchEvent("channelmin",s),e.dispatchEvent("channelmax",s+63)),console.info(`${i}Show CH1~64`);break}case 3:{let s=e.chRedir(t[1]<<5,a,!0);r(e,W)&&e.dispatchEvent("channelmin",s),r(e,W)&&e.dispatchEvent("channelmax",s+31),console.info(`${i}Show CH${s+1}~CH${s+32}`);break}default:console.debug(`${i}unknown switch ${n} invoked.`)}else if(n<32){if(r(e,W)){let s=e.chRedir(n-16+(r(e,Le)<<4),a,!0);e.dispatchEvent("channelactive",s)}}else if(n<36){let s=e.chRedir(n-32<<4,a,!0);r(e,W)&&(e.dispatchEvent("channelmin",s),e.dispatchEvent("channelmax",s+15),y(e,Le,n-32)),console.info(`${i}Show CH${s+1}~CH${s+16}`)}}).add([93,3],(t,a)=>{let n=e.chRedir(t[0],a,!0),i=`PLG-100SG CH${n+1} `,s=Date.now();if(t[1]==0){let h="",d=0;t.subarray(2).forEach((l,p)=>{p%2==0?h+=Tt[l]||l.toString().padStart("0"):d+=l*13}),s>=r(e,Ue)&&r(e,S).unshift("SG Lyric: "),r(e,S)[0]+=`${Mt(h)}`,y(e,Ue,s+Math.ceil(d/2)+r(e,Pe)),q()&&console.debug(`${i}vocals: ${h}`)}else console.warn(`Unknown PLG-100SG data: ${t}`)}),r(this,de).add([76,48],t=>{}).add([76,49],t=>{}).add([76,50],t=>{}).add([76,51],t=>{}),r(this,de).add([89,0],(t,a,n)=>{if(e.eprom){let i=t[0],s=(t[1]<<14)+(t[2]<<7)+t[3]+(e.eprom.offset||0);q()&&console.debug(`MU1000 EPROM trail to 0x${s.toString(16).padStart(6,"0")}, ${i} bytes.`);let h=e.eprom.data;t.subarray(4).forEach((d,l)=>{let p=l>>3,$=l&7;if($==7)for(let w=0;w<7;w++)h[s+7*p+w]+=(d>>6-w&1)<<7;else h[s+7*p+$]=d})}}).add([89,1],(t,a,n)=>{let i=(t[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3];q()&&console.debug(`MU1000 EPROM jump to 0x${i.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=i)}).add([89,2],(t,a,n)=>{if(e.eprom){let i=(t[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3]+(e.eprom.offset||0);q()&&console.debug(`MU1000 EPROM write to 0x${i.toString(16).padStart(6,"0")}.`);let s=e.eprom.data;t.subarray(4).forEach((h,d)=>{let l=d>>3,p=d&7;if(p==7)for(let $=0;$<7;$++)s[i+7*l+$]+=(h>>6-$&1)<<7;else s[i+7*l+p]=h})}}).add([89,3],(t,a,n)=>{}),r(this,de).add([39,48],(t,a,n)=>{}).add([43,0,0],(t,a,n)=>{let i=[0,0,0,0],s=(h,d)=>{i[d]=h};if(t.subarray(1).forEach((h,d)=>{let l=d+t[0];[s,s,s,s,()=>{y(this,z,h*129/16383*100)},()=>h-64,()=>h||128,()=>h,()=>h,()=>{console.debug(`TG300 variation on cc${h}.`)}][l](h,l)}),t[0]<4){let h=0;i.forEach(d=>{h=h<<4,h+=d}),h-=1024}}).add([43,1,0],(t,a,n)=>{}).add([43,2],(t,a,n)=>{let i=e.chRedir(t[0],a,!0),s=t[1],h=g.cc*i,d=`TG300 CH${i+1} `;t.subarray(2).forEach((l,p)=>{p<5?([()=>{},()=>{r(e,u)[h+b[0]]=l},()=>{r(e,u)[h+b[32]]=l},()=>{r(e,T)[i]=l},()=>{let $=e.chRedir(l,a,!0);r(e,N)[i]=$,i!=$&&(e.buildRchTree(),console.info(`${d}receives from CH${$+1}`))}][p+s]||(()=>{}))(l,p+s):p<21||(p<47?([()=>{r(e,re)[i]=+!l},()=>{},()=>{},()=>{r(e,E)[g.rpn*i+3]=l},()=>{},()=>{r(e,u)[h+b[7]]=l},!1,!1,()=>{r(e,u)[h+b[10]]=l||128},!1,!1,()=>{console.debug(`${d} AC1 at cc${l}`)},()=>{console.debug(`${d} AC2 at cc${l}`)},()=>{r(e,u)[h+b[128]]=l},()=>{r(e,u)[h+b[93]]=l},()=>{r(e,u)[h+b[91]]=l},()=>{r(e,u)[h+b[94]]=l},()=>{r(e,u)[h+b[76]]=l},()=>{r(e,u)[h+b[77]]=l},()=>{r(e,u)[h+b[74]]=l},()=>{r(e,u)[h+b[71]]=l},()=>{r(e,u)[h+b[73]]=l},()=>{r(e,u)[h+b[75]]=l},()=>{r(e,u)[h+b[72]]=l},()=>{r(e,u)[h+b[78]]=l}][p+s-21]||(()=>{}))(l,p+s):p<95||([()=>{r(e,u)[h+b[65]]=l},()=>{r(e,u)[h+b[5]]=l}][p+s-95]||(()=>{}))(l,p+s))})}).add([43,7,0],(t,a,n)=>{let i=t[0];e.setLetterDisplay(t.subarray(1),"TG300 letter display",i)}).add([43,7,1],(t,a,n)=>{y(e,V,0),y(e,te,Date.now()+3200),r(e,Q,ne).fill(0),t.forEach(function(i,s){let h=Math.floor(s/16),d=s%16,l=(d*3+h)*7,p=7,$=0;for(l-=d*5,h==2&&(p=2);$<p;)r(e,Q,ne)[l+$]=i>>6-$&1,$++})}),r(this,fe).add([66,18,0,0,127],(t,a,n)=>{e.switchMode("gs",!0),r(e,u)[g.cc*9]=120,r(e,u)[g.cc*25]=120,r(e,u)[g.cc*41]=120,r(e,u)[g.cc*57]=120,y(e,Z,3),y(e,O,!1),r(e,he).fill(0),console.info(`GS system to ${["single","dual"][t[0]]} mode.`)}).add([66,18,64,0],(t,a,n)=>{switch(t[0]){case 127:{e.switchMode("gs",!0),r(e,u)[g.cc*9]=120,r(e,u)[g.cc*25]=120,r(e,u)[g.cc*41]=120,r(e,u)[g.cc*57]=120,y(e,O,!1),r(e,he).fill(0),console.info("MIDI reset: GS");break}default:{let i=[0,0,0,0],s=(h,d)=>{i[d]=h};if(t.subarray(1).forEach((h,d)=>{let l=d+t[0];[s,s,s,s,p=>{y(this,z,p*129/16383*100)},p=>{},p=>{}][l](h,d)}),t[0]<4){let h=0;i.forEach(d=>{h=h<<4,h+=d}),h-=1024}}}}).add([66,18,64,1],t=>{let a=t[0];if(a<16){let n="".padStart(a," ");t.subarray(1).forEach((i,s)=>{n+=String.fromCharCode(Math.max(32,i))}),n=n.padEnd(16," "),console.debug(`GS patch name: ${n}`)}else a<48||(a<65?t.subarray(1).forEach((n,i)=>{let s=`GS ${a+i>55?"chorus":"reverb"} `;([()=>{console.info(`${s}type: ${ht[n]}`),e.setEffectType(0,40,n)},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${s}predelay: ${n}ms`)},()=>{console.info(`${s}type: ${Ot[n]}`),e.setEffectType(1,40,16+n)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${s}to reverb: ${F(n)}`)},()=>{console.debug(`${s}to delay: ${F(n)}`)}][a+i-48]||(()=>{}))()}):a<80?console.debug(`Unknown GS patch address: ${a}`):a<91?t.subarray(1).forEach((n,i)=>{let s="GS delay ";([()=>{console.info(`${s}type: ${At[n]}`),e.setEffectType(2,40,32+n)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${s}to reverb: ${F(n)}`)}][a+i-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${a}`))}).add([66,18,64,2],t=>{let a="GS EQ ";t.subarray(1).forEach((n,i)=>{([()=>{console.debug(`${a}low freq: ${[200,400][n]}Hz`)},()=>{console.debug(`${a}low gain: ${n-64}dB`)},()=>{console.debug(`${a}high freq: ${[3e3,6e3][n]}Hz`)},()=>{console.debug(`${a}high gain: ${n-64}dB`)}][t[0]+i]||function(){console.warn(`Unknown GS EQ address: ${t[0]+i}`)})()})}).add([66,18,64,3],t=>{let a="GS EFX ",n=function(i,s){let h=Dt(r(e,K).subarray(10,12),s,i);h&&console.debug(`${a}${dt(r(e,K).subarray(10,12))} ${h}`)};t.subarray(1).forEach((i,s)=>{([()=>{e.setEffectTypeRaw(3,!1,32+i)},()=>{e.setEffectTypeRaw(3,!0,i),console.info(`${a}type: ${dt(r(e,K).subarray(10,12))}`)},!1,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,()=>{console.debug(`${a}to reverb: ${F(i)}dB`)},()=>{console.debug(`${a}to chorus: ${F(i)}dB`)},()=>{console.debug(`${a}to delay: ${F(i)}dB`)},!1,()=>{console.debug(`${a}1 source: ${i}`),i&&i<96&&e.allocateAce(i)},()=>{console.debug(`${a}1 depth: ${i-64}`)},()=>{console.debug(`${a}2 source: ${i}`),i&&i<96&&e.allocateAce(i)},()=>{console.debug(`${a}2 depth: ${i-64}`)},()=>{console.debug(`${a}to EQ: ${i?"ON":"OFF"}`)}][t[0]+s]||function(h,d){console.warn(`Unknown GS EFX address: ${d}`)})(i,t[0]+s)})}).add([66,18,65],t=>{}).add([69,18,16],t=>{var a;switch(t[0]){case 0:{let n=t[1];e.setLetterDisplay(t.subarray(2),"GS display text",n);break}case 32:{y(e,te,Date.now()+3200),t[1]==0&&y(e,V,Math.max(Math.min(t[2]-1,9),0));break}default:if(t[0]<11){r(e,V)>9&&y(e,V,0),y(e,te,Date.now()+3200),(a=r(e,oe)[t[0]-1])!=null&&a.length||(r(e,oe)[t[0]-1]=new Uint8Array(256));let n=r(e,oe)[t[0]-1],i=t[1];n.fill(0);let s=t.subarray(2);for(let h=0;h<i;h++)s.unshift(0);s.forEach(function(h,d){let l=Math.floor(d/16),p=d%16,$=(p*4+l)*5,w=5,x=0;for($-=p*4,l==3&&(w=1);x<w;)n[$+x]=h>>4-x&1,x++})}else console.warn(`Unknown GS display section: ${t[0]}`)}});let o=function(t,a,n){let i=t[0],s=g.cc*a,h=g.rpn*a,d=`GS CH${a+1} `;i<3?t.subarray(1).forEach((l,p)=>{[()=>{r(e,u)[s+b[0]]=l},()=>{r(e,T)[a]=l},()=>{let $=e.chRedir(l,n,!0);r(e,N)[a]=$,a!=$&&(e.buildRchTree(),console.info(`${d}receives from CH${$+1}`))}][i+p]()}):i<19||(i<44?t.subarray(1).forEach((l,p)=>{([()=>{r(e,re)[a]=+!l},!1,()=>{e.setChType(a,l<<1,v.gs),console.debug(`${d}type: ${l?"drum ":"melodic"}${l||""}`)},()=>{r(e,E)[h+3]=l},!1,()=>{r(e,u)[s+b[7]]=l},!1,!1,()=>{r(e,u)[s+b[10]]=l||128},!1,!1,()=>{console.debug(`${d}CC 1: cc${l}`)},()=>{console.debug(`${d}CC 2: cc${l}`)},()=>{r(e,u)[s+b[93]]=l},()=>{r(e,u)[s+b[91]]=l},!1,!1,()=>{r(e,E)[h+1]=l},()=>{r(e,E)[h+2]=l},()=>{r(e,u)[s+b[94]]=l}][i+p-19]||(()=>{}))()}):i<76||console.debug(`Unknown GS part address: ${i}`))},c=function(t,a){let n=t[0],i=`GS CH${a+1} `;n<2?t.subarray(1).forEach((s,h)=>{[()=>{r(e,u)[g.cc*a+b[32]]=s},()=>{}][n+h]()}):n<32?console.warn(`Unknown GS misc address: ${n}`):n<35?t.subarray(1).forEach((s,h)=>{[()=>{console.debug(`${i}EQ: o${["ff","n"][s]}`)},()=>{},()=>{console.debug(`${i}EFX: o${["ff","n"][s]}`)}][n+h-32]()}):console.warn(`Unknown GS misc address: ${n}`)};r(this,fe).add([66,18,64,16],(t,a)=>{o(t,e.chRedir(9,a,!0),a)}).add([66,18,64,17],(t,a)=>{o(t,e.chRedir(0,a,!0),a)}).add([66,18,64,18],(t,a)=>{o(t,e.chRedir(1,a,!0),a)}).add([66,18,64,19],(t,a)=>{o(t,e.chRedir(2,a,!0),a)}).add([66,18,64,20],(t,a)=>{o(t,e.chRedir(3,a,!0),a)}).add([66,18,64,21],(t,a)=>{o(t,e.chRedir(4,a,!0),a)}).add([66,18,64,22],(t,a)=>{o(t,e.chRedir(5,a,!0),a)}).add([66,18,64,23],(t,a)=>{o(t,e.chRedir(6,a,!0),a)}).add([66,18,64,24],(t,a)=>{o(t,e.chRedir(7,a,!0),a)}).add([66,18,64,25],(t,a)=>{o(t,e.chRedir(8,a,!0),a)}).add([66,18,64,26],(t,a)=>{o(t,e.chRedir(10,a,!0),a)}).add([66,18,64,27],(t,a)=>{o(t,e.chRedir(11,a,!0),a)}).add([66,18,64,28],(t,a)=>{o(t,e.chRedir(12,a,!0),a)}).add([66,18,64,29],(t,a)=>{o(t,e.chRedir(13,a,!0),a)}).add([66,18,64,30],(t,a)=>{o(t,e.chRedir(14,a,!0),a)}).add([66,18,64,31],(t,a)=>{o(t,e.chRedir(15,a,!0),a)}).add([66,18,64,64],(t,a)=>{c(t,e.chRedir(9,a,!0))}).add([66,18,64,65],(t,a)=>{c(t,e.chRedir(0,a,!0))}).add([66,18,64,66],(t,a)=>{c(t,e.chRedir(1,a,!0))}).add([66,18,64,67],(t,a)=>{c(t,e.chRedir(2,a,!0))}).add([66,18,64,68],(t,a)=>{c(t,e.chRedir(3,a,!0))}).add([66,18,64,69],(t,a)=>{c(t,e.chRedir(4,a,!0))}).add([66,18,64,70],(t,a)=>{c(t,e.chRedir(5,a,!0))}).add([66,18,64,71],(t,a)=>{c(t,e.chRedir(6,a,!0))}).add([66,18,64,72],(t,a)=>{c(t,e.chRedir(7,a,!0))}).add([66,18,64,73],(t,a)=>{c(t,e.chRedir(8,a,!0))}).add([66,18,64,74],(t,a)=>{c(t,e.chRedir(10,a,!0))}).add([66,18,64,75],(t,a)=>{c(t,e.chRedir(11,a,!0))}).add([66,18,64,76],(t,a)=>{c(t,e.chRedir(12,a,!0))}).add([66,18,64,77],(t,a)=>{c(t,e.chRedir(13,a,!0))}).add([66,18,64,78],(t,a)=>{c(t,e.chRedir(14,a,!0))}).add([66,18,64,79],(t,a)=>{c(t,e.chRedir(15,a,!0))}),r(this,Ee).add([54,65],(t,a)=>{e.switchMode("x5d");let n=(t[1]<<7)+t[0],i=(t[3]<<7)+t[2],s=e.chRedir(n&15,a,!0),h=g.cc*s;[()=>{i<1||(i<101?(e.setChType(s,e.CH_MELODIC,v.x5d),r(e,T)[s]=i-1,r(e,u)[h+b[0]]=82):i<229?(e.setChType(s,e.CH_MELODIC,v.x5d),r(e,T)[s]=i-101,r(e,u)[h+b[0]]=56):(e.setChType(s,e.CH_DRUMS,v.x5d),r(e,T)[s]=Gt[i-229]||0,r(e,u)[h+b[0]]=62))},()=>{r(e,u)[h+b[7]]=i},()=>{i<31&&(r(e,u)[h+b[10]]=Math.round((i-15)*4.2+64))},()=>{r(e,u)[h+b[93]]=qe(i)},()=>{r(e,u)[h+b[91]]=qe(i)},()=>{r(e,E)[s*g.rpn+3]=i>8191?i-16320:64+i},()=>{r(e,E)[s*g.rpn+1]=i>8191?i-16320:64+i},()=>{i>0&&(r(e,E)[s*g.rpn]=i)},()=>{}][n>>4]()}).add([54,76,0],(t,a)=>{e.switchMode("x5d",!0);let n="",i=82,s=0,h=0,d="MSB	PRG	LSB	NME";ee(t,function(l,p){if(p<16400){let $=p%164;switch(!0){case $<10:{l>31&&(n+=String.fromCharCode(l));break}case $==11:{d+=`
${i}	${s}	${h}	${n.trim().replace("Init Voice","")}`,s++,n="";break}}s>99&&(i=90,s=0)}}),e.userBank.clearRange({msb:82,prg:[0,99],lsb:0}),e.userBank.load(d)}).add([54,77,0],(t,a)=>{e.switchMode("x5d",!0);let n="",i=90,s=0,h=0,d="MSB	PRG	LSB	NME";ee(t,function(l,p){if(p<13600){let $=p%136;switch(!0){case $<10:{l>31&&(n+=String.fromCharCode(l));break}case $==11:{d+=`
${i}	${s}	${h}	${n.trim().replace("Init Combi","")}`,s++,n="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(d)}).add([54,78],(t,a)=>{e.switchMode("x5d",!0),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][t[0]]} mode.`)}).add([54,85],(t,a)=>{e.switchMode("x5d",!0),ee(t,(n,i)=>{i>0&&i<3&&e.setEffectType(i-1,44,n)})}).add([54,104],(t,a)=>{e.switchMode("x5d",!0),ee(t,function(n,i,s,h){if(i<192){let d=e.chRedir(Math.floor(i/12),a,!0),l=d*g.cc;switch(i%12){case 0:{n<128?(e.setChType(d,e.CH_MELODIC,v.x5d),r(e,u)[l+b[0]]=82,r(e,T)[d]=n):(e.setChType(d,e.CH_DRUMS,v.x5d),r(e,u)[l+b[0]]=62,r(e,T)[d]=Gt[n-128]),n>0&&(r(e,X)[d]=1);break}case 1:{r(e,u)[l+b[7]]=n;break}case 2:{r(e,E)[d*g.rpn+3]=n>127?n-192:64+n;break}case 3:{r(e,E)[d*g.rpn+1]=n>127?n-192:64+n;break}case 4:{n<31&&(r(e,u)[l+b[10]]=Math.round((n-15)*4.2+64));break}case 5:{let p=n>>4,$=n&15;r(e,u)[l+b[91]]=qe($),r(e,u)[l+b[93]]=qe(p);break}case 10:break;case 11:{let p=e.chRedir(n&15,a,!0),$=n>>4;r(e,N)[d]=n,(p!=d||$)&&(console.info(`X5D Part CH${d+1} receives from CH${p+1}.`),e.buildRchTree())}}}else{let d=e.chRedir(i-192,a,!0)}})}),r(this,fe).add([22,18,127],t=>{e.switchMode("mt32",!0),y(e,O,!1),e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(t,a,n)=>{e.switchMode("mt32");let i=e.chRedir(n,a,!0),s=t[1];t.subarray(2).forEach((h,d)=>{let l=d+s;r(e,ge)[l+(i-1)*16]=h,([!1,()=>{let p=r(e,ge)[i-1<<4];if(p<3)if(r(e,ie)[i]=1,p==2)for(let $=0;$<name.length;$++)r(e,Y)[(i-1)*g.cmt+$]=r(e,$e)[h*g.cmt+$];else{let $=e.baseBank.get(0,h+(p<<6),127,"mt32").name;for(let w=0;w<$.length;w++)r(e,Y)[(i-1)*g.cmt+w]=$.charCodeAt(w)}},()=>{r(e,E)[i*g.rpn+3]=h+40},()=>{r(e,E)[i*g.rpn+1]=h+14},()=>{r(e,E)[i*g.rpn]=h},!1,()=>{r(e,u)[g.cc*i+b[91]]=h?127:0},!1,()=>{r(e,u)[g.cc*i+b[7]]=h},()=>{r(e,u)[g.cc*i+b[10]]=Math.ceil(h*9.05)}][l]||(()=>{}))()})}).add([22,18,1],(t,a,n)=>{e.switchMode("mt32");let i=e.chRedir(n,a,!0)}).add([22,18,2],(t,a,n)=>{e.switchMode("mt32");let i=e.chRedir(n,a,!0),s=t[1]+(t[0]<<7);s<10&&(r(e,ie)[i]=1),t.subarray(2).forEach((h,d)=>{let l=d+s;l<14&&(r(e,Y)[(i-1)*g.cmt+l]=h)})}).add([22,18,3],(t,a,n)=>{if(e.switchMode("mt32"),t[0]){let i=t[1]-16}else{let i=t[1];t.subarray(2).forEach((s,h)=>{let d=h+i;r(e,ge)[d]=s;let l=e.chRedir(1+d>>4,a,!0),p=d&15;([!1,()=>{let $=r(e,ge)[l-1<<4];if($<3)if(r(e,ie)[l]=1,$==2)for(let w=0;w<name.length;w++)r(e,Y)[(l-1)*g.cmt+w]=r(e,$e)[s*g.cmt+w];else{let w=e.baseBank.get(0,s+($<<6),127,"mt32").name;for(let x=0;x<w.length;x++)r(e,Y)[(l-1)*g.cmt+x]=w.charCodeAt(x)}},()=>{r(e,E)[l*g.rpn+3]=s+40},()=>{r(e,E)[l*g.rpn+1]=s+14},()=>{r(e,E)[l*g.rpn]=s},!1,()=>{r(e,u)[g.cc*l+b[91]]=s?127:0},!1,()=>{r(e,u)[g.cc*l+b[7]]=s},()=>{r(e,u)[g.cc*l+b[10]]=Math.ceil(s*9.05)}][p]||(()=>{}))()})}}).add([22,18,4],(t,a,n)=>{e.switchMode("mt32");let i=t[1]+(t[0]<<7);t.subarray(2).forEach((s,h)=>{let d=h+i,l=e.chRedir(Math.floor(d/246+1),a,!0),p=d%246;p<14&&(r(e,Y)[(l-1)*g.cmt+p]=s),p<10&&(r(e,ie)[l]=1)})}).add([22,18,5],(t,a,n)=>{e.switchMode("mt32");let i=(t[0]<<7)+t[1];t.subarray(2).forEach((s,h)=>{let d=i+h,l=Math.floor(d/8),p=d&7,$=l*8;r(e,Ie)[d]=s,([!1,()=>{let w=r(e,Ie)[$];if(w<3){let x="";if(w==2){let D=g.cmt*l;x=`MT-m:${s.toString().padStart(3,"0")}`}else x=e.baseBank.get(0,s+(w<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:l}),e.userBank.load(`MSB	LSB	PRG	NME
000	127	${l}	${x}`,!0)}}][p]||(()=>{}))()})}).add([22,18,8],(t,a,n)=>{e.switchMode("mt32");let i=((t[0]&1)<<7)+t[1];t.subarray(2).forEach((s,h)=>{let d=i+h;d<g.cmt&&(r(e,$e)[(t[0]>>1)*g.cmt+d]=s)})}).add([22,18,16],(t,a,n)=>{e.switchMode("mt32");let i=t[1],s=!1,h=function(d,l){r(e,N)[l-12]=d,s=!0};t.subarray(2).forEach((d,l)=>{let p=l+i;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,h,h,h,h,h,h,h,h,h,()=>{y(e,z,d)}][p]||(()=>{}))(d,l)}),s&&e.buildRchTree()}).add([22,18,32],t=>{e.switchMode("mt32");let a=t[1],n=" ".repeat(a);t.subarray(2).forEach(i=>{i>31&&(n+=String.fromCharCode(i))}),y(e,se,n.padStart(20," ")),y(e,me,Date.now()+3200)}).add([22,18,82],(t,a)=>{let n=e.chRedir(0,a,!0);for(let i=0;i<16;i++)r(e,U).ano(n+i),i&&i<10&&(r(e,T)[n+i]=ft[i-1]);console.info("MT-32 alt reset complete.")}),r(this,Ee).add([66,0],(t,a)=>{e.switchMode("ns5r",!0),y(e,O,!1),console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][t[0]]} mode.`)}).add([66,1],(t,a)=>{e.switchMode(["ns5r","05rw"][t[0]],!0),y(e,O,!1)}).add([66,18,0,0],(t,a)=>{let n=t[0];switch(n){case 124:case 126:case 127:{e.switchMode("ns5r",!0),y(e,O,!1);break}case 125:{console.info(`NS5R drum setup reset: ${t}`);break}default:if(n<10){let i=[0,0,0,0],s=(h,d)=>{i[d]=h};if(t.subarray(1).forEach((h,d)=>{[s,s,s,s,()=>{y(e,z,h*129/16383*100)},()=>h-64,()=>h-64,()=>{},()=>{},()=>{}][n+d]()}),t[0]<4){let h=0;i.forEach(d=>{h=h<<4,h+=d}),h-=1024}}}}).add([66,18,0,1],(t,a)=>{}).add([66,18,0,2],(t,a)=>{}).add([66,18,1],(t,a)=>{let n=e.chRedir(t[0],a,!0),i=n*g.cc,s=t[1],h=`NS5R CH${n+1} `;t.subarray(2).forEach((d,l)=>{let p=s+l;p<3?[()=>{r(e,u)[i+b[0]]=d||121},()=>{r(e,u)[i+b[32]]=d},()=>{r(e,T)[n]=d}][p]():p<8||(p<14?[()=>{let $=e.chRedir(d,a,!0);r(e,N)[n]=$,n!=$&&(e.buildRchTree(),console.info(`${h}receives from CH${$+1}`))},()=>{r(e,re)[n]=+!d},()=>{e.setChType(n,d,v.ns5r),console.debug(`${h}type: ${ze[d]}`)},()=>{r(e,E)[g.rpn*n+3]=d},()=>{},()=>{}][p-8]():p<16||(p<33?[()=>{r(e,u)[i+b[7]]=d},()=>{r(e,u)[i+b[11]]=d},()=>{},()=>{},()=>{r(e,u)[i+b[10]]=d||128},()=>{},()=>{},()=>{r(e,u)[i+b[93]]=d},()=>{r(e,u)[i+b[91]]=d},()=>{r(e,u)[i+b[76]]=d},()=>{r(e,u)[i+b[77]]=d},()=>{r(e,u)[i+b[78]]=d},()=>{r(e,u)[i+b[74]]=d},()=>{r(e,u)[i+b[71]]=d},()=>{r(e,u)[i+b[73]]=d},()=>{r(e,u)[i+b[75]]=d},()=>{r(e,u)[i+b[72]]=d}][p-16]():p<112||p<114&&[()=>{r(e,u)[i+b[5]]=d},()=>{r(e,u)[i+b[65]]=d}][p-112]()))})}).add([66,18,8,0],(t,a)=>{let n=t[0];if(n<32)e.setLetterDisplay(t.subarray(1,33),"NS5R letter display");else{let i=n-32;y(e,te,Date.now()+3200),y(e,V,10),r(e,Q,ne).fill(0);let s=t.subarray(1),h=4;s.forEach(function(d,l){let p=l+i,$=p>>4,w=p&15;if(p<80){let x=$<h?d:d>>3,D=0,A=$<h?6:3;for(;x>0;)r(e,Q,ne)[w*32+$*7+(A-D)]=x&1,x=x>>1,D++}})}}).add([66,52],(t,a)=>{e.switchMode("ns5r",!0),y(e,O,!1);let n="";ee(t,(i,s)=>{s<8?(i>31&&(n+=String.fromCharCode(i)),s==7&&(e.aiEfxName=n)):s<10&&e.setEffectType(s-8,44,i)})}).add([66,53],(t,a)=>{e.switchMode("ns5r",!0),y(e,O,!1),ee(t,function(n,i){switch(!0){case i<2944:{let s=e.chRedir(Math.floor(i/92),a,!0),h=s*g.cc;switch(i%92){case 0:{r(e,u)[h+b[0]]=n||121;break}case 1:{r(e,u)[h+b[32]]=n;break}case 2:{r(e,T)[s]=n,n>0&&(r(e,X)[s]=1);break}case 3:{let d=e.chRedir(n,a,!0);r(e,N)[s]=d,s!=d&&(console.info(`NS5R CH${s+1} receives from CH${d+1}.`),e.buildRchTree())}case 7:break;case 8:{r(e,E)[s*g.rpn+3]=n<40||n>88?n+(n>63?-192:64):n;break}case 9:case 10:{r(e,u)[h+b[7]]=n;break}case 11:{r(e,u)[h+b[11]]=n;break}case 14:{r(e,u)[h+b[10]]=n||128;break}case 19:{r(e,u)[h+b[93]]=n;break}case 20:{r(e,u)[h+b[91]]=n;break}case 84:{r(e,u)[h+b[65]]=n;break}case 85:{r(e,u)[h+b[5]]=n;break}}break}case i<3096:break;case i<3134:break;case i<8566:break}})}).add([66,54],(t,a)=>{e.switchMode("ns5r",!0);let n="",i=80,s=0,h=0,d="MSB	PRG	LSB	NME";ee(t,function(l,p){let $=p%158;switch(!0){case $<10:{l>31&&(n+=String.fromCharCode(l));break}case $==11:{i=l&127;break}case $==12:{h=l&127;break}case $==13:{d+=`
${i}	${s}	${h}	${n.trim().replace("Init Voice","")}`,s++,n="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(d)}).add([66,55],(t,a)=>{e.switchMode("ns5r",!0);let n="",i=88,s=0,h=0,d="MSB	PRG	LSB	NME";ee(t,function(l,p){let $=p%126;switch(!0){case $<10:{l>31&&(n+=String.fromCharCode(l));break}case $==11:break;case $==12:break;case $==13:{d+=`
${i}	${s}	${h}	${n.trim().replace("Init Combi","")}`,s++,n="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(d)}).add([66,125],t=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][t[0]]||"white")}).add([66,127],t=>{let a=new Uint8Array(5760);ee(t,(n,i,s)=>{if(i<720)for(let h=0;h<8;h++)a[i*8+h]=n>>7-h&1}),e.dispatchEvent("screen",{type:"ns5r",data:a})}).add([76],(t,a,n)=>{r(e,Ee).run([66,...t],a,n)}),r(this,Ge).add([16,0,8,0],(t,a,n)=>{let i=(t[2]<<4)+t[3],s="K11 ";([()=>{e.switchMode("k11",!0),y(e,O,!1),y(e,Z,i?4:0),console.info("MIDI reset: GMega/K11")},()=>{console.debug(`${s}reverb type: ${i}`)},()=>{console.debug(`${s}reverb time: ${i}`)},()=>{console.debug(`${s}reverb time: ${i}`)},()=>{console.debug(`${s}reverb predelay: ${i}`)},()=>{console.debug(`${s}reverb predelay: ${i}`)},()=>{console.debug(`${s}depth high: ${i}`)},()=>{console.debug(`${s}depth high: ${i}`)},()=>{console.debug(`${s}depth low: ${i}`)},()=>{console.debug(`${s}depth low: ${i}`)}][t[0]]||(()=>{}))()}).add([16,0,8,1],(t,a,n)=>{let i=e.chRedir(t[1],a,!0),s=g.cc*i,h=g.rpn*i,d=(t[3]<<4)+t[4],l=`K11 CH${i+1} `;([()=>{d<128?(e.setChType(i,e.CH_MELODIC,v.k11),r(e,u)[s+b[0]]=0,r(e,T)[i]=d):(e.setChType(i,e.CH_DRUMS,v.k11),r(e,T)[i]=d-128)},()=>{let p=e.chRedir(d,a,!0);r(e,N)[i]=p,i!=p&&(e.buildRchTree(),console.info(`${l}receives from CH${p+1}`))},()=>{r(e,u)[s+b[7]]=d},()=>{r(e,X)[i]=d},()=>{r(e,u)[s+b[10]]=d},()=>{r(e,E)[h+3]=d+40},()=>{r(e,E)[h+1]=d>>1,r(e,E)[h+2]=d&1},()=>{r(e,u)[s+b[91]]=d?127:0},()=>{},()=>{r(e,u)[s+b[74]]=d},()=>{r(e,u)[s+b[73]]=d},()=>{r(e,u)[s+b[72]]=d}][t[0]]||(()=>{}))()}).add([16,0,9,0],(t,a,n)=>{let i=(t[2]<<4)+t[3],s="GMLX ";([()=>{console.debug(`${s}reverb type: ${i}`)},()=>{console.debug(`${s}reverb time: ${i}`)},()=>{console.debug(`${s}reverb predelay: ${i}`)},()=>{console.debug(`${s}depth high: ${i}`)},()=>{console.debug(`${s}depth low: ${i}`)}][t[0]]||(()=>{}))()}).add([16,0,9,3],(t,a,n)=>{let i=(t[2]<<4)+t[3],s=e.chRedir(t[1],a,!0),h=s*g.cc;[()=>{i<128?(e.setChType(s,e.CH_MELODIC,v.k11),r(e,u)[h+b[0]]=0,r(e,u)[h+b[32]]=0,r(e,T)[s]=i):i<160?(e.setChType(s,e.CH_MELODIC,v.k11),r(e,u)[h+b[0]]=0,r(e,u)[h+b[32]]=7,r(e,T)[s]=i-100):(e.setChType(s,e.CH_DRUMS,v.k11),r(e,u)[h+b[0]]=122,r(e,u)[h+b[32]]=0,r(e,T)[s]=i-160)},()=>{let d=e.chRedir(i,a,!0);r(e,N)[s]=d,s!=d&&(e.buildRchTree(),console.info(`GMLX CH${s+1} receives from CH${d+1}`))}][t[0]]()}).add([16,0,9,4],(t,a,n)=>{let i=(t[2]<<4)+t[3],s=e.chRedir(t[1],a,!0),h=s*g.cc,d=s*g.rpn,l=`GMLX CH${s+1} `;[()=>{r(e,X)[s]=i},()=>{r(e,u)[h+b[7]]=i},()=>{r(e,u)[h+b[10]]=i},()=>{r(e,u)[h+b[91]]=i?127:0},()=>{r(e,E)[d+3]=i+40},()=>{r(e,E)[d+1]=i},()=>{r(e,E)[d]=i},()=>{}][t[0]]()}),r(this,He).add([66,93,64],(t,a,n)=>{let i=t[2];switch(t[0]){case 0:{switch(t[1]){case 4:{y(e,z,i*129/16383*100);break}case 5:{i-64;break}case 6:{console.debug(`SG global reverb: ${i?"on":"off"}`);break}case 127:{e.switchMode("sg",!0);break}}break}case 1:{switch(t[1]){case 48:{console.debug(`SG reverb type: ${ht[i]}`);break}}break}default:if(t[0]>>4==1){let s=e.chRedir(t[0]&15,a,!0);if(t[1]==2){let h=e.chRedir(i,a,!0);r(e,N)[s]=h,s!=h&&(e.buildRchTree(),console.info(`SG CH${s+1} receives from CH${h+1}`))}else t[1]==19&&(r(e,u)[g.cc*s+b[7]]=i)}else console.warn(`Unknown AKAI SG SysEx: ${t}`)}}),r(this,_e).add([9],(t,a,n)=>{console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremelo","phaser","rotary speaker","enhancer","flanger","EQ"][t[0]]||"off"}`)})}chRedir(e,o,c){if(r(this,we)[o])return(r(this,we)[o]-1)*16+e;if([2,3].indexOf(r(this,Z))>-1){if(c==1)return e;let t=0,a=!0;for(;a;)r(this,he)[e+t]==0?(r(this,he)[e+t]=o,console.debug(`Assign track ${o} to channel ${e+t+1}.`),a=!1):r(this,he)[e+t]==o?a=!1:(t+=16,t>=128&&(t=0,a=!1));return e+t}else return e}buildRchTree(){let e=[];r(this,N).forEach((o,c)=>{var t;(t=e[o])!=null&&t.constructor||(e[o]=[]),e[o].push(c)}),y(this,Ze,e)}getActive(){let e=r(this,X).slice();return r(this,R)==v.mt32,e}getCc(e){let o=e*g.cc,c=r(this,u).subarray(o,o+g.cc);return c[b[0]]=c[b[0]]||r(this,ye),c[b[32]]=c[b[32]]||r(this,Z),c}getCcCh(e,o){if(je.indexOf(o)<0)throw new Error("CC number not accepted");return r(this,u)[g.cc*e+b[o]]}getCcAll(){let e=r(this,u).slice();for(let o=0;o<g.ch;o++){let c=o*g.cc;e[c+b[0]]=e[c+b[0]]||r(this,ye),e[c+b[32]]=e[c+b[32]]||r(this,Z)}return e}getChType(){return r(this,C)}setChType(e,o,c=r(this,R)){o&=15,r(this,C)[e]=o,o>0&&(r(this,u)[e*g.cc+b[0]]=ve[c])}getPitch(){return r(this,be)}getProgram(){return r(this,T)}getTexts(){return r(this,S).slice()}getVel(e){let o=new Map,c=this;return r(c,P).forEach(function(t,a){let n=Math.floor(t/128),i=t%128;e==n&&r(c,I)[t]>0&&o.set(i,{v:r(c,I)[t],s:r(c,L)[a]})}),o}getBitmap(){return{bitmap:r(this,Q,ne),expire:r(this,te)}}getLetter(){return{text:r(this,se),expire:r(this,me)}}getMode(){return pe[r(this,R)]}getMaster(){return{volume:r(this,z)}}getRawStrength(){let e=this;return r(this,P).forEach(function(o){let c=Math.floor(o/128);r(e,I)[o]>r(e,ae)[c]&&(r(e,ae)[c]=r(e,I)[o])}),r(this,ae)}getStrength(){let e=[],o=this;return this.getRawStrength().forEach(function(c,t){e[t]=Math.floor(c*r(o,u)[t*g.cc+b[7]]*r(o,u)[t*g.cc+b[11]]*r(o,z)/803288)}),e}getRpn(){return r(this,E)}getNrpn(){return r(this,De)}getVoice(e,o,c,t){let a=e||r(this,ye),n=o,i=c||r(this,Z);pe[r(this,R)]=="ns5r"&&a>0&&a<56&&(i=3);let s=this.userBank.get(a,n,i,t);if(pe[r(this,R)]=="mt32"&&s.name.indexOf("MT-m:")==0){let h=parseInt(s.name.slice(5)),d=h*g.cmt,l="";r(this,$e).subarray(d,d+10).forEach(p=>{p>31&&(l+=String.fromCharCode(p))}),this.userBank.load(`MSB	LSB	PRG
0	127	${n}	${l}`,!0),s.name=l,s.ending=" "}return(s.ending!=" "||!s.name.length)&&(s=this.baseBank.get(a,n,i,t)),s}getChVoice(e){let o=this.getVoice(r(this,u)[e*g.cc+b[0]],r(this,T)[e],r(this,u)[e*g.cc+b[32]],pe[r(this,R)]);if(r(this,ie)[e])switch(r(this,R)){case v.mt32:o.ending="~",o.name="",r(this,Y).subarray(14*(e-1),14*(e-1)+10).forEach(c=>{c>31&&(o.name+=String.fromCharCode(c))})}return o}getPitchShift(e){let o=e*g.rpn;return r(this,be)[e]/8192*r(this,E)[o]+(r(this,E)[o+3]-64)+((r(this,E)[o+1]<<7)+r(this,E)[o+2]-8192)/8192}getEffectType(e=0){let o=3*e+1;return r(this,K).subarray(o,o+2)}setEffectTypeRaw(e=0,o,c){let t=3*e;r(this,K)[t]=1,r(this,K)[t+1+ +o]=c}setEffectType(e=0,o,c){this.setEffectTypeRaw(e,!1,o),this.setEffectTypeRaw(e,!0,c)}setLetterDisplay(e,o,c=0,t=3200){let a=this,n;y(a,se," ".repeat(c)),e.forEach(i=>{y(a,se,r(a,se)+String.fromCharCode(i>31?i:32)),i<32&&(n=n||new Set,n.add(i))}),y(a,me,Date.now()+3200),y(a,se,r(a,se).padEnd(32," ")),n&&(n=Array.from(n),n.forEach((i,s,h)=>{h[s]=i.toString(16).padStart(2,"0")}),console.warn(`${o}${o?" ":""}invalid code point${n.length>1?"s":""}: 0x${n.join(", 0x")}`))}allocateAce(e){if(!e||e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}let o=!0,c=0;for(;o&&c<g.ace;)r(this,ce)[c]==e?o=!1:r(this,ce)[c]||(o=!1,r(this,ce)[c]=e,console.info(`Allocated cc${e} to ACE slot ${c}.`)),c++;c>=g.ace&&console.warn("ACE slots are full.")}getAce(){return r(this,ce)}getChAce(e,o){if(o<0||o>=g.ace)throw new RangeError("No such ACE slot");let c=r(this,ce)[o];if(c){if(je.indexOf(c)>=0)return r(this,u)[e*g.cc+b[c]];throw new Error(`Invalid ACE source: ${c}`)}else return 0}init(e=0){this.dispatchEvent("mode","?"),y(this,R,0),y(this,ye,0),y(this,Z,0),y(this,le,0),r(this,X).fill(0),r(this,u).fill(0),r(this,ce).fill(0),r(this,T).fill(0),r(this,I).fill(0),r(this,P).fill(0),r(this,ae).fill(0),r(this,be).fill(0),r(this,De).fill(0),r(this,Ye).fill(0),y(this,z,100),y(this,S,[]),y(this,Pe,500),y(this,Ue,0),y(this,me,0),y(this,se,""),y(this,te,0),y(this,V,0),r(this,Q,ne).fill(0),y(this,O,!1),y(this,Le,0),y(this,W,!0),r(this,N).forEach(function(o,c,t){t[c]=c}),this.buildRchTree(),e==0&&(r(this,he).fill(0),r(this,we).fill(0)),r(this,u)[g.cc*9]=ve[0],r(this,u)[g.cc*25]=ve[0],r(this,u)[g.cc*41]=ve[0],r(this,u)[g.cc*57]=ve[0],r(this,C).fill(this.CH_MELODIC),r(this,C)[9]=this.CH_DRUM1,r(this,C)[25]=this.CH_DRUM3,r(this,C)[41]=this.CH_DRUMS,r(this,C)[57]=this.CH_DRUMS,r(this,C)[73]=this.CH_DRUM5,r(this,C)[89]=this.CH_DRUM7,r(this,C)[105]=this.CH_DRUMS,r(this,C)[121]=this.CH_DRUMS,r(this,Ie).fill(0),r(this,$e).fill(0),r(this,ge).fill(0),r(this,Y).fill(0),r(this,ie).fill(0),r(this,K).fill(0),this.aiEfxName="",this.userBank.clearRange({msb:0,lsb:127,prg:[0,127]});for(let o=0;o<g.ch;o++){let c=o*g.cc;r(this,u)[c+b[7]]=100,r(this,u)[c+b[11]]=127,r(this,u)[c+b[10]]=64,r(this,u)[c+b[71]]=64,r(this,u)[c+b[72]]=64,r(this,u)[c+b[73]]=64,r(this,u)[c+b[74]]=64,r(this,u)[c+b[75]]=64,r(this,u)[c+b[76]]=64,r(this,u)[c+b[77]]=64,r(this,u)[c+b[78]]=64,r(this,u)[c+b[91]]=40,r(this,u)[c+b[101]]=127,r(this,u)[c+b[100]]=127,r(this,u)[c+b[99]]=127,r(this,u)[c+b[98]]=127;let t=o*g.rpn;r(this,E)[t]=2,r(this,E)[t+1]=64,r(this,E)[t+2]=0,r(this,E)[t+3]=64,r(this,E)[t+4]=0,r(this,E)[t+5]=0}}switchMode(e,o=!1){let c=pe.indexOf(e);if(c>-1){if(r(this,R)==0||o){let t=r(this,R);y(this,R,c),y(this,V,0),y(this,ye,Ut[0][c]),y(this,Z,Ut[1][c]);for(let n=0;n<g.ch;n++)r(this,C)[n]>0&&r(this,u)[n*g.cc+b[0]]==ve[t]&&(r(this,u)[n*g.cc]=ve[c]);switch(this.initOnReset,c){case v.mt32:{ft.forEach((n,i)=>{let s=i+1;r(this,X)[s]||(r(this,T)[s]=n,r(this,u)[s*g.cc+b[91]]=127)});break}}let a;switch(c){case v.gs:{a=[40,4,40,18,40,32,32,0,0,0,0,0,0,0];break}case v.x5d:case v.ns5r:{a=[44,1,44,19,44,0,44,0,0,0,0,0,0,0];break}default:a=[1,0,65,0,5,0,0,0,0,0,0,0,0,0]}for(let n=0;n<g.efx;n++)r(this,K)[3*n]||(r(this,K)[3*n+1]=a[2*n],r(this,K)[3*n+2]=a[2*n+1]);this.dispatchEvent("mode",e)}}else throw new Error(`Unknown mode ${e}`)}newStrength(){r(this,ae).fill(0)}runJson(e){var o;if(e.type>14)return e.type==15&&e.data.constructor!=Uint8Array&&(e.data=Uint8Array.from(e.data)),r(this,We)[e.type].call(this,e);{let c=this.chRedir(e.part,e.track),t=!1;(o=r(this,Ze)[c])==null||o.forEach(a=>{e.channel=a,t=!0,r(this,We)[e.type].call(this,e)}),t||console.warn(`${Lt[e.type]?Lt[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!=null?e.data[0]:e.data).toString():""} event sent to CH${c+1} without any recipient.`)}r(this,S).length>100&&r(this,S).splice(100,r(this,S).length-99)}runRaw(e){}},R=new WeakMap,V=new WeakMap,te=new WeakMap,oe=new WeakMap,Q=new WeakSet,ne=function(){return r(this,oe)[r(this,V)]},Ft=function(e){r(this,oe)[r(this,V)]=e},X=new WeakMap,N=new WeakMap,C=new WeakMap,u=new WeakMap,ce=new WeakMap,T=new WeakMap,I=new WeakMap,re=new WeakMap,P=new WeakMap,L=new WeakMap,be=new WeakMap,ae=new WeakMap,xe=new WeakMap,E=new WeakMap,De=new WeakMap,Ye=new WeakMap,ie=new WeakMap,ge=new WeakMap,Y=new WeakMap,Ie=new WeakMap,$e=new WeakMap,K=new WeakMap,ye=new WeakMap,Z=new WeakMap,z=new WeakMap,le=new WeakMap,Pe=new WeakMap,Ue=new WeakMap,se=new WeakMap,me=new WeakMap,Le=new WeakMap,W=new WeakMap,O=new WeakMap,Ze=new WeakMap,pt=new WeakMap,S=new WeakMap,he=new WeakMap,we=new WeakMap,B=new WeakMap,Se=new WeakMap,U=new WeakMap,We=new WeakMap,rt=new WeakMap,Ne=new WeakMap,Be=new WeakMap,de=new WeakMap,fe=new WeakMap,Ee=new WeakMap,Ge=new WeakMap,He=new WeakMap,_e=new WeakMap,_t);var yt=ir(Vt(),1);var Je,Xt,zt=(Xt=class{constructor(f,e,o,c){m(this,Je,!1);y(this,Je,f),this.start=e,this.end=o,this.data=c}get duration(){return this.ranged?this.end-this.start:0}get ranged(){return r(this,Je)}},Je=new WeakMap,Xt),gt=class extends zt{constructor(f,e,o){super(!0,f,e,o)}},Qt=class extends zt{constructor(f,e){super(!1,f,f,e)}},Ce,Kt,$t=(Kt=class extends Array{constructor(){super(...arguments);m(this,Ce,-1)}resetIndex(e){y(this,Ce,-1)}fresh(){this.sort(function(e,o){return e.start==o.start?0:(+(e.start>o.start)<<1)-1}),this.forEach(function(e,o){e.index=o})}step(e,o=!1){let c=[];if(o)for(let t=0;t<this.length&&!(this[t].start>e);t++){if(this[t].end<e)continue;c.push(this[t])}else{let t=this.getRange(r(this,Ce)==-1?0:e-1,e),a=this;t.forEach(function(n){n.index>r(a,Ce)&&(c.push(n),y(a,Ce,n.index))})}return c}getRange(e,o){var i;e>o&&([e,o]=[o,e]);let c=[],t=-1,a=Math.ceil(Math.sqrt(this.length)),n=!0;for(let s=0;s<this.length;s+=a)this[s+a]?t<0&&this[s+a].start>=e&&(t=s):t=t<0?s:t;for(;n;)((i=this[t])==null?void 0:i.end)<o?this[t].start>=e&&c.push(this[t]):n=!1,t++;return c}},Ce=new WeakMap,Kt);var ur=0xffffffffffff;{let f=function(e,o){let c=new FileReader;return new Promise((t,a)=>{switch(c.addEventListener("abort",()=>{a(new Error("Blob read aborted"))}),c.addEventListener("error",n=>{a(c.error||n.data||new Error("Blob read error"))}),c.addEventListener("load",()=>{t(c.result)}),o.toLowerCase()){case"arraybuffer":case"buffer":{c.readAsArrayBuffer(e);break}case"string":case"text":{c.readAsText(e);break}default:a(new Error(`Unknown target ${o}`))}})};Blob.prototype.arrayBuffer=Blob.prototype.arrayBuffer||function(){return f(this,"buffer")},Blob.prototype.text=Blob.prototype.text||function(){return f(this,"text")}}var qt=function(f){let e=new $t,o=this,c=f.timeDivision,t=120,a=new $t,n=0,i=0;a.push(new gt(0,ur,[120,0])),f.track.forEach(function(l){n=0,l.event.forEach(function(p){n+=p.deltaTime,p.type==255&&(p==null?void 0:p.metaType)==81&&(t=6e7/p.data,a[a.length-1]&&a.push(new gt(n,0xffffffffffff,[t,0])))})}),a.fresh(),a.forEach(function(l,p,$){p>0&&($[p-1].end=l.start)});let s=120;a.forEach(function(l,p,$){p>0&&(l.end==l.start?$.splice($.indexOf(l),1):s==l.data[0]&&($[p-1].end=l.end,$.splice($.indexOf(l),1)),s=l.data[0])});let h=0,d=120;return a.forEach(function(l){let p=l.start,$=p/d/c*60+h;d=l.data[0],h=$-p/d/c*60,l.data[1]=h}),console.debug("All tempo changes: ",a),t=120,n=0,i=0,f.track.forEach(function(l,p){n=0,i=0;let $=p+1;l.event.forEach(function(w,x){n+=w.deltaTime;let D=a.step(n,!0)[0];D&&(t=D.data[0],i=D.data[1]);let A={type:w.type,data:w.data,track:$,part:0};w.type>14?A.meta=w.metaType:A.part=w.channel,e.push(new Qt(n/t/c*60+i,A))})}),e.fresh(),self.midiEvents=e,console.debug(`Parsed a type ${f.formatType} MIDI sequence.`),e};yt.default.customInterpreter=It;var Fe,Te,Me,Re,et,ke,Ve,G,Oe,ue,Ae,jt,pr=(jt=class extends tt{constructor(e,o=.5,c=.5){super();k(this,"device");m(this,Fe,void 0);m(this,Te,"");m(this,Me,[]);m(this,Re,new Uint8ClampedArray(128));m(this,et,new Uint8ClampedArray(128));m(this,ke,.5);m(this,Ve,120);m(this,G,4);m(this,Oe,4);m(this,ue,0);m(this,Ae,0);k(this,"smoothingAtk",0);k(this,"smoothingDcy",0);let t=this;this.smoothingAtk=o,this.smoothingDcy=c,this.device=e,this.addEventListener("meta",function(a){var n;(n=a==null?void 0:a.data)==null||n.forEach(function(i){(r(t,Me)[i.meta]||console.debug).call(t,i.meta,i.data)})}),this.device.addEventListener("mode",function(a){t.dispatchEvent("mode",a.data)}),this.device.addEventListener("channelactive",function(a){t.dispatchEvent("channelactive",a.data)}),this.device.addEventListener("channelmin",function(a){t.dispatchEvent("channelmin",a.data)}),this.device.addEventListener("channelmax",function(a){t.dispatchEvent("channelmax",a.data)}),this.device.addEventListener("channelreset",function(a){t.dispatchEvent("channelreset")}),this.device.addEventListener("screen",function(a){t.dispatchEvent("screen",a.data)}),r(this,Me)[3]=function(a,n){var i;((i=r(t,Te))==null?void 0:i.length)<1&&y(t,Te,n)},r(this,Me)[81]=function(a,n){let i=t.noteProgress,s=r(t,ke)||.5;y(t,Ve,6e7/n),y(t,ke,n/1e6),y(t,ue,r(t,ue)+(i*(s/r(t,ke))-i))},r(this,Me)[88]=function(a,n){let i=t.noteProgress,s=t.noteOverall,h=t.noteBar,d=t.noteBeat,l=r(t,G),p=r(t,Oe);y(t,G,n[0]),y(t,Oe,1<<n[1]);let $=24*(32/n[3])/n[2];if(l!=r(t,G)){let w=h;y(t,ue,r(t,ue)-w*(r(t,G)-l)),d+1>=l&&(l<r(t,G)?y(t,ue,r(t,ue)-Math.ceil(r(t,G)-d-1)):y(t,ue,r(t,ue)+r(t,G)))}}}reset(){var e;this.dispatchEvent("reset"),(e=r(this,Fe))==null||e.resetIndex(),this.device.init(),y(this,Te,""),y(this,ke,.5),y(this,Ve,120),y(this,G,4),y(this,Oe,4),y(this,ue,0),y(this,Ae,0)}async loadFile(e){y(this,Fe,qt(yt.default.parse(new Uint8Array(await e.arrayBuffer()))))}switchMode(e,o=!1){this.device.switchMode(e,o)}getMode(){return this.device.getMode()}getVoice(){return this.device.getVoice(...arguments)}getChVoice(e){return this.device.getChVoice(e)}get noteProgress(){return r(this,Ae)/r(this,ke)}get noteOverall(){return this.noteProgress-r(this,ue)}get noteBar(){return Math.floor(this.noteOverall/r(this,G))}get noteBeat(){let e=this.noteOverall%r(this,G);return e<0&&(e+=r(this,G)),e}getTimeSig(){return[r(this,G),r(this,Oe)]}getTempo(){return r(this,Ve)}sendCmd(e){this.device.runJson(e)}render(e){var D;e>r(this,Ae)&&y(this,Ae,e);let o=((D=r(this,Fe))==null?void 0:D.step(e))||[],c=0,t=new Set,a=this,n=[];this.device.getStrength().forEach((A,M)=>{r(this,et)[M]=A}),a.device.newStrength(),o.forEach(function(A){let M=A.data;M.type==9&&(M.data[1]>0?t.add(M.part*128+M.data[0]):t.has(M.part*128+M.data[0])&&c++),A.data.type==8&&t.has(M.part*128+M.data[0])&&c++;let j=a.device.runJson(M);switch(j==null?void 0:j.reply){case"meta":{n.push(j);break}}j!=null&&j.reply&&delete j.reply}),(n==null?void 0:n.length)>0&&this.dispatchEvent("meta",n);let i=this.device.getActive(),s=[],h=a.device.getPitch(),d=a.device.getCcAll(),l=a.device.getProgram(),p=a.device.getChType(),$=this.device.getStrength();$.forEach(function(A,M,j){j[M]=Math.max(r(a,et)[M],A);let Xe=j[M]-r(a,Re)[M],mt=b.length*M;if(Xe>=0){let st=4*.25**(d[mt+b[73]]/64);r(a,Re)[M]+=Math.ceil(Xe-Xe*a.smoothingAtk**st)}else{let st=4*.25**(d[mt+b[72]]/64);r(a,Re)[M]+=Math.floor(Xe-Xe*a.smoothingDcy**st)}});let w=0;return i.forEach(function(A,M){A&&(s[M]=a.device.getVel(M),w+=s[M].size)}),{extraPoly:c,curPoly:w,chInUse:i,chKeyPr:s,chPitch:h,chProgr:l,chContr:d,chType:p,eventCount:o.length,title:r(this,Te),bitmap:this.device.getBitmap(),letter:this.device.getLetter(),texts:this.device.getTexts(),master:this.device.getMaster(),mode:this.device.getMode(),strength:r(this,Re).slice(),velo:$,rpn:this.device.getRpn(),tSig:this.getTimeSig(),tempo:this.getTempo(),noteBar:this.noteBar,noteBeat:this.noteBeat,ace:this.device.getAce()}}},Fe=new WeakMap,Te=new WeakMap,Me=new WeakMap,Re=new WeakMap,et=new WeakMap,ke=new WeakMap,Ve=new WeakMap,G=new WeakMap,Oe=new WeakMap,ue=new WeakMap,Ae=new WeakMap,jt);export{pr as RootDisplay,b as ccToPos,it as dnToPos};
