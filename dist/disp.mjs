var Ke=Object.create;var we=Object.defineProperty;var We=Object.getOwnPropertyDescriptor;var _e=Object.getOwnPropertyNames;var Qe=Object.getPrototypeOf,je=Object.prototype.hasOwnProperty;var Ze=(e,a)=>()=>(a||e((a={exports:{}}).exports,a),a.exports);var Je=(e,a,n,t)=>{if(a&&typeof a=="object"||typeof a=="function")for(let r of _e(a))!je.call(e,r)&&r!==n&&we(e,r,{get:()=>a[r],enumerable:!(t=We(a,r))||t.enumerable});return e};var et=(e,a,n)=>(n=e!=null?Ke(Qe(e)):{},Je(a||!e||!e.__esModule?we(n,"default",{value:e,enumerable:!0}):n,e));var Oe=Ze((Ht,he)=>{(function(){"use strict";let e={debug:!1,parse:function(a,n){if(a instanceof Uint8Array)return e.Uint8(a);if(typeof a=="string")return e.Base64(a);if(a instanceof HTMLElement&&a.type==="file")return e.addListener(a,n);throw new Error("MidiParser.parse() : Invalid input provided")},addListener:function(a,n){if(!File||!FileReader)throw new Error("The File|FileReader APIs are not supported in this browser. Use instead MidiParser.Base64() or MidiParser.Uint8()");if(a===void 0||!(a instanceof HTMLElement)||a.tagName!=="INPUT"||a.type.toLowerCase()!=="file")return console.warn("MidiParser.addListener() : Provided element is not a valid FILE INPUT element"),!1;n=n||function(){},a.addEventListener("change",function(t){if(!t.target.files.length)return!1;console.log("MidiParser.addListener() : File detected in INPUT ELEMENT processing data..");let r=new FileReader;r.readAsArrayBuffer(t.target.files[0]),r.onload=function(s){n(e.Uint8(new Uint8Array(s.target.result)))}})},Base64:function(a){let n=function(s){var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(s=s.replace(/^.*?base64,/,""),s=String(s).replace(/[\t\n\f\r ]+/g,""),!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(s))throw new TypeError("Failed to execute _atob() : The string to be decoded is not correctly encoded.");s+="==".slice(2-(3&s.length));let l,f="",h,c,u=0;for(;u<s.length;)l=o.indexOf(s.charAt(u++))<<18|o.indexOf(s.charAt(u++))<<12|(h=o.indexOf(s.charAt(u++)))<<6|(c=o.indexOf(s.charAt(u++))),f+=h===64?String.fromCharCode(l>>16&255):c===64?String.fromCharCode(l>>16&255,l>>8&255):String.fromCharCode(l>>16&255,l>>8&255,255&l);return f}(a=String(a));var t=n.length;let r=new Uint8Array(new ArrayBuffer(t));for(let s=0;s<t;s++)r[s]=n.charCodeAt(s);return e.Uint8(r)},Uint8:function(r){let n={data:null,pointer:0,movePointer:function(h){return this.pointer+=h,this.pointer},readInt:function(h){if((h=Math.min(h,this.data.byteLength-this.pointer))<1)return-1;let c=0;if(1<h)for(let u=1;u<=h-1;u++)c+=this.data.getUint8(this.pointer)*Math.pow(256,h-u),this.pointer++;return c+=this.data.getUint8(this.pointer),this.pointer++,c},readStr:function(h){let c="";for(let u=1;u<=h;u++)c+=String.fromCharCode(this.readInt(1));return c},backOne:function(){this.pointer--},readIntVLV:function(){let h=0;if(this.pointer>=this.data.byteLength)return-1;if(this.data.getUint8(this.pointer)<128)h=this.readInt(1);else{let u=[];for(;128<=this.data.getUint8(this.pointer);)u.push(this.readInt(1)-128);var c=this.readInt(1);for(let g=1;g<=u.length;g++)h+=u[u.length-g]*Math.pow(128,g);h+=c}return h}};if(n.data=new DataView(r.buffer,r.byteOffset,r.byteLength),n.readInt(4)!==1297377380)return console.warn("Header validation failed (not MIDI standard or file corrupt.)"),!1;n.readInt(4);let t={};t.formatType=n.readInt(2),t.tracks=n.readInt(2),t.track=[];var r=n.readInt(1),s=n.readInt(1);128<=r?(t.timeDivision=[],t.timeDivision[0]=r-128,t.timeDivision[1]=s):t.timeDivision=256*r+s;for(let h=1;h<=t.tracks;h++){t.track[h-1]={event:[]};var o,l=n.readInt(4);if(l===-1)break;if(l!==1297379947)return!1;n.readInt(4);let c=0,u=!1,g,k;for(;!u&&(c++,t.track[h-1].event[c-1]={},t.track[h-1].event[c-1].deltaTime=n.readIntVLV(),(g=n.readInt(1))!==-1);)if(128<=g?k=g:(g=k,n.movePointer(-1)),g===255){t.track[h-1].event[c-1].type=255,t.track[h-1].event[c-1].metaType=n.readInt(1);var f=n.readIntVLV();switch(t.track[h-1].event[c-1].metaType){case 47:case-1:u=!0;break;case 1:case 2:case 3:case 4:case 5:case 7:case 6:t.track[h-1].event[c-1].data=n.readStr(f);break;case 33:case 89:case 81:t.track[h-1].event[c-1].data=n.readInt(f);break;case 84:t.track[h-1].event[c-1].data=[],t.track[h-1].event[c-1].data[0]=n.readInt(1),t.track[h-1].event[c-1].data[1]=n.readInt(1),t.track[h-1].event[c-1].data[2]=n.readInt(1),t.track[h-1].event[c-1].data[3]=n.readInt(1),t.track[h-1].event[c-1].data[4]=n.readInt(1);break;case 88:t.track[h-1].event[c-1].data=[],t.track[h-1].event[c-1].data[0]=n.readInt(1),t.track[h-1].event[c-1].data[1]=n.readInt(1),t.track[h-1].event[c-1].data[2]=n.readInt(1),t.track[h-1].event[c-1].data[3]=n.readInt(1);break;default:this.customInterpreter!==null&&(t.track[h-1].event[c-1].data=this.customInterpreter(t.track[h-1].event[c-1].metaType,n,f)),this.customInterpreter!==null&&t.track[h-1].event[c-1].data!==!1||(n.readInt(f),t.track[h-1].event[c-1].data=n.readInt(f),this.debug&&console.info("Unimplemented 0xFF meta event! data block readed as Integer"))}}else switch((g=g.toString(16).split(""))[1]||g.unshift("0"),t.track[h-1].event[c-1].type=parseInt(g[0],16),t.track[h-1].event[c-1].channel=parseInt(g[1],16),t.track[h-1].event[c-1].type){case 15:this.customInterpreter!==null&&(t.track[h-1].event[c-1].data=this.customInterpreter(t.track[h-1].event[c-1].type,n,!1)),this.customInterpreter!==null&&t.track[h-1].event[c-1].data!==!1||(o=n.readIntVLV(),t.track[h-1].event[c-1].data=n.readInt(o),this.debug&&console.info("Unimplemented 0xF exclusive events! data block readed as Integer"));break;case 10:case 11:case 14:case 8:case 9:t.track[h-1].event[c-1].data=[],t.track[h-1].event[c-1].data[0]=n.readInt(1),t.track[h-1].event[c-1].data[1]=n.readInt(1);break;case 12:case 13:t.track[h-1].event[c-1].data=n.readInt(1);break;case-1:u=!0;break;default:if(this.customInterpreter!==null&&(t.track[h-1].event[c-1].data=this.customInterpreter(t.track[h-1].event[c-1].metaType,n,!1)),this.customInterpreter===null||t.track[h-1].event[c-1].data===!1)return console.log("Unknown EVENT detected... reading cancelled!"),!1}}return t},customInterpreter:null};if(typeof he<"u")he.exports=e;else{let a=typeof window=="object"&&window.self===window&&window||typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;a.MidiParser=e}})()});var Se=function(e){let a=Array.from("----");if(e>0)for(let n=0;e>0;n++)a[n]=e<1024?"=":">",e-=2048;else if(e<0)for(let n=3;e<0;n--)a[n]=e>=-1024?"=":"<",e+=2048;return a.join("")},ke=function(e){if(e==128)return"<<>>";let a=Array.from("----");if(e>64)for(let n=0;e>64;n++)a[n]=e<72?"=":">",e-=16;else if(e<64)for(let n=3;e<64;n--)a[n]=e>=56?"=":"<",e+=16;return a.join("")};var _=class{#t={};addEventListener(e,a){this.#t[e]||(this.#t[e]=[]),this.#t[e].unshift(a)}removeEventListener(e,a){if(this.#t[e]){let n=this.#t[e].indexOf(a);n>-1&&this.#t[e].splice(n,1),this.#t[e].length<1&&delete this.#t[e]}}dispatchEvent(e,a){let n=new Event(e),t=this;n.data=a,this.#t[e]?.length>0&&this.#t[e].forEach(function(r){r?.call(t,n)}),this[`on${e}`]&&this[`on${e}`](n)}};var Me=function(e,a){let n=Math.min(e.length,a.length),t=e.slice(0,n),r=a.slice(0,n),s=0,o=0;for(;o<n&&s==0;)s=Math.sign(t[o]-r[o]),o++;return s},I=function(){this.pool=[],this.point=function(e,a=!1){if(this.pool.length>0){let n=this.pool.length,t=1<<Math.floor(Math.log2(n)),r=t,s=64;for(;t>=1&&s>=0;){if(s<=0)throw new Error("TTL reached.");if(r==n)r-=t;else{let l=Me(e,this.pool[r]);switch(l){case 0:{s=0;break}case 1:{r+t<=n&&(r+=t);break}case-1:{r!=0&&(r-=t);break}default:console.warn(`Unexpected result ${l}.`)}}t=t>>1,s--}let o=!0;if(r>=this.pool.length)o=!1;else{let l=this;this.pool[r].forEach(function(f,h,c){o&&f!=e[h]&&(o=!1)}),!o&&Me(e,this.pool[r])>0&&r++}return o||a?r:-1}else return a?0:-1},this.add=function(e,a){return e.data=a,this.pool.splice(this.point(e,!0),0,e),this},this.default=function(e){console.warn(`No match for "${e}". Default action not defined.`)},this.get=function(e){let a=this.point(e);if(a>-1)return this.pool[a].data;this.default(e)},this.run=function(e,...a){let n=this.point(e);n>-1?this.pool[n].data(e.slice(this.pool[n].length),...a):this.default(e,...a)}};var tt=["MSB","PRG","LSB"];var ee=function(e){let a=Math.floor(e/10),n=e%10;return`${a.toString(16)}${n}`},te=class{#t;strictMode=!1;get(e=0,a=0,n=0,t){let r,s=Array.from(arguments);switch(t){case"xg":e==32||e==33?s[2]+=4:e==80?s[0]=96:e==81?s[0]=97:e==82&&(s[0]=98);case"gs":{e==0&&n<5&&(s[2]=0);break}case"sg":{e==8&&n==0&&(s[2]=5);break}}let o=" ",l="M",f=!1,h=0;switch(s[0]){case 0:{s[2]==127?l="MT-a":s[2]==126?l="MT-b":s[2]==7?l="GM-k":s[2]==5?l="SG-a":s[2]==4?l="SP-l":s[2]==0||t=="gs"&&s[2]<5?l="GM-a":(l="y",f=!0);break}case 8:{t=="sg"?l="GM-s":l="r:";break}case 48:{l=`yM${(s[2]>>3).toString().padStart(2,"0")}`,f=!0;break}case 56:{l="GM-b";break}case 61:case 120:{l="rDrm";break}case 62:{l="kDrm";break}case 63:{let u=s[2];l=u<10?"kP:":"kC:",l+=u%10;break}case 64:{l="ySFX";break}case 80:case 81:case 82:case 83:{l=`Prg${"UABC"[s[0]-80]}`;break}case 88:case 89:case 90:case 91:{l=`Cmb${"UABC"[s[0]-88]}`;break}case 96:{l=s[2]==106?"AP-a":"PF",s[2]>63&&(h=63),f=!0;break}case 97:{l="VL:",f=!0,h=112;break}case 98:{l="SG-a";break}case 121:{l="GM-",f=!0;break}case 122:{l="lDrm";break}case 126:{l="yDrS";break}case 127:{s[2]==127?l="rDrm":l="yDrm";break}default:s[0]<48?l="r:":l="M"}for(l.length<4&&(l+=`${(f?n:e)-h}`.padStart(4-l.length,"0"));!(r?.length>=0);)r=this.#t[s[1]||0][(s[0]<<7)+s[2]],r||(this.strictMode?(r="",o="?"):this.#t[s[1]||0][s[0]<<7]?s[0]==0?(s[2]=0,o="^"):s[2]<1?(s[0]=0,o="*"):(s[2]--,o="^"):e==48?(s[0]=0,s[2]=0,o="!"):e==62?(s[1]--,o=" ",s[1]<1&&!r?.length&&(s[0]=0,o="!")):e<64?t=="xg"&&e==16?(r=`Voice${(n*128+a+1).toString().padStart(3,"0")}`,o=" "):s[0]==0?(s[2]=0,o="^"):s[2]<1?(s[0]=0,o="*"):s[2]--:e==80?(r=`PrgU:${a.toString().padStart(3,"0")}`,o="!"):e==88?(r=`CmbU:${a.toString().padStart(3,"0")}`,o="!"):e==121?(r=`GM2Vox0${n}`,o="#"):e==122?(s[1]==32?s[1]==0:s[1]%=7,r=this.#t[s[1]||0][(s[0]<<7)+s[2]],r?o=" ":(r="",o="*")):s[1]==0?(r=`${e.toString().padStart(3,"0")} ${a.toString().padStart(3,"0")} ${n.toString().padStart(3,"0")}`,o="!"):s[0]==0?(s[2]=0,o="^"):s[2]>0?s[2]--:s[1]>0?(s[1]=0,o="!"):(s[0]=0,o="?"));(t=="gs"||t=="ns5r")&&o=="^"&&(o=" "),e==127&&o=="^"&&(o=" "),o!=" "&&self.debugMode&&(r="");let c="??";switch(s[0]){case 0:{s[2]==0?c="GM":s[2]==5||s[2]==7?c="KG":s[2]<120?c="XG":s[2]==127&&(c="MT");break}case 48:{c="MU";break}case 56:{c="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{c="AI";break}case 62:case 82:case 90:{c="XD";break}case 63:c="KR";case 64:case 126:{c="XG";break}case 81:{c="RW";break}case 96:{c=s[2]==106?"AP":"PF";break}case 97:{c="VL";break}case 98:{c="SG";break}case 120:{c="GS";break}case 121:{c="G2";break}case 122:{c="KG";break}case 127:{c=s[2]==127?"MT":a==0?"GM":"XG";break}default:s[0]<48&&(s[0]==16&&t=="xg"?c="XG":c="GS")}return{name:r||`${ee(e||0)} ${ee(a||0)} ${ee(n||0)}`,ending:o,sect:l,standard:c}}async load(e,a,n){let t=this,r=[],s=0,o=0;e.split(`
`).forEach(function(l,f){let h=l.split("	"),c=[];f==0?h.forEach(function(u,g){r[tt.indexOf(u)]=g}):h.forEach(async function(u,g){g>2?(t.#t[c[r[1]]]=t.#t[c[r[1]]]||[],(!t.#t[c[r[1]]][(c[r[0]]<<7)+c[r[2]]]?.length||a)&&(t.#t[c[r[1]]][(c[r[0]]<<7)+c[r[2]]]=h[3],s++),o++):c.push(parseInt(h[g]))})}),a||console.debug(`Map "${n||"(internal)"}": ${o} total, ${s} loaded.`)}clearRange(e){let a=e.prg!=null?e.prg.constructor==Array?e.prg:[e.prg,e.prg]:[0,127],n=e.msb!=null?e.msb.constructor==Array?e.msb:[e.msb,e.msb]:[0,127],t=e.lsb!=null?e.lsb.constructor==Array?e.lsb:[e.lsb,e.lsb]:[0,127];for(let r=n[0];r<=n[1];r++){let s=r<<7;for(let o=t[0];o<=t[1];o++){let l=s+o;for(let f=a[0];f<=a[1];f++)delete this.#t[f][l]}}}init(){this.#t=[];for(let e=0;e<128;e++)this.#t.push([""])}async loadFiles(...e){this.init();let a=this;e.forEach(async function(n,t){await fetch(`./data/bank/${n}.tsv`).then(function(r){return r.text()}).then(r=>{a.load(r,!1,n)})})}constructor(...e){this.loadFiles(...e)}};var Q=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),ie=["melodic","drum","drum set 1","drum set 2","drum set 3","drum set 4"],rt=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],Y=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],Ee=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],ve=function(e){let a=.1,n=-.3;return e>66?(a=5,n=315):e>56?(a=1,n=47):e>46&&(a=.5,n=18.5),a*e-n},Ce=function(e){return e>105?rt[e-106]:e>100?e*1.1-100:e/10},xe=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),re={};`hi*,
ka,\u304B
ki,\u304D
ku,\u304F
ke,\u3051
ko,\u3053
ky,\u304D!
kw,\u304Fl
tsu,\u3064
ts,\u3064l
sa,\u3055
si,\u3059\u3043
su,\u3059
se,\u305B
so,\u305D
shi,\u3057
sh,\u3057!
ta,\u305F
ti,\u3066\u3043
tu,\u3068\u3045
te,\u3066
to,\u3068
tchy,\u3061!
tchi,\u3061
na,\u306A
ni,\u306B
nu,\u306C
ne,\u306D
no,\u306E
ny,\u306B!
nn,\u3093
ha,\u306F
hi,\u3072
hu,\u307B\u3045
he,\u3078
ho,\u307B
hy,\u3072!
fa,\u3075\u3041
fi,\u3075\u3043
fu,\u3075
fe,\u3075\u3047
fo,\u3075\u3049
ma,\u307E
mi,\u307F
mu,\u3080
me,\u3081
mo,\u3082
my,\u307F!
mm,
ra,\u3089
ri,\u308A
ru,\u308B
re,\u308C
ro,\u308D
ry,\u308A!
wa,\u308F
wi,\u3046\u3043
we,\u3046\u3047
wo,\u3092
nga,\u30AC
ngi,\u30AE
ngu,\u30B0
nge,\u30B2
ngo,\u30B4
ngy,\u30AE!
ng,
ga,\u304C
gi,\u304E
gu,\u3050
ge,\u3052
go,\u3054
gy,\u304E!
gw,\u3050l
za,\u3056
zi,\u305A\u3043
zu,\u305A
ze,\u305C
zo,\u305E
ja,\u3058\u3083
ji,\u3058
ju,\u3058\u3085
je,\u3058\u3047
jo,\u3058\u3087
jy,\u3058!
da,\u3060
di,\u3067\u3043
du,\u3069\u3045
de,\u3067
do,\u3069
dy,\u3067!
ba,\u3070
bi,\u3073
bu,\u3076
be,\u3079
bo,\u307C
by,\u3073!
va,\u3094\u3041
vi,\u3094\u3043
vu,\u3094
ve,\u3094\u3047
vo,\u3094\u3049
pa,\u3071
pi,\u3074
pu,\u3077
pe,\u30DA
po,\u307D
py,\u3074!
!ya,\u3083
!yu,\u3085
!ye,\u3047
!yo,\u3087
ya,\u3084
yu,\u3086
ye,\u3044\u3047
yo,\u3088
!a,\u3083
!u,\u3085
!e,\u3047
!o,\u3087
!a,\u3083
!u,\u3085
!e,\u3047
!o,\u3087
la,\u3041
li,\u3043
lu,\u3045
le,\u3047
lo,\u3049
a,\u3042
i,\u3044
u,\u3046
e,\u3048
o,\u304A
*,\u3063
~,
^,
_,`.split(`
`).forEach(e=>{let a=e.split(",");re[a[0]]=a[1]});var Te=function(e){let a=e;e[0]=="*"&&(a=a.slice(1)),["aa","ii","uu","ee","oo"].forEach(t=>{for(;a.indexOf(t)>-1;)a=a.replace(t,t[0])});for(let t in re)a=a.replaceAll(t,re[t]);a.indexOf("\u3093")==0&&a.length>1&&(a=a.slice(1));let n=a.indexOf("!");return n>-1&&a.length>1&&(a=a.slice(n+1)),a};var se=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],Re=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],Pe=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var it={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},st={66307:["drive"],66309:["vowel",e=>"aiueo"[e]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",e=>["off","LPF","HPF"][e]],94984:["noise type",e=>["white","pink"][e]],94987:["disc type",e=>["LP","SP","EP","RND"]],94990:["hum type",e=>`${e+5}0Hz`],94993:["M/S",e=>["mono","stereo"][e]]},ae=function(e){return it[(e[0]<<8)+e[1]]||`0x${e[0].toString(16).padStart(2,"0")}${e[1].toString(16).padStart(2,"0")}`},Be=function(e,a,n){let t=(e[0]<<16)+(e[1]<<8)+a,r=st[t]||{},s=r[0];if(s?.length)return s+=`: ${(r[1]||function(){})(n)||n}`,s};var A=function(e=64){return Math.round(2e3*Math.log10(e/64))/100},Ae=function(e){let a=0;return e.forEach(n=>{a+=n,a>127&&(a%=128)}),a=128-a,a==128?0:a},G=function(e,a){let n=0;for(let t=0;t<e.length;t++)t%8!=0&&(a(e[t],n,e),n++)},ne=function(e){return Math.floor(e*14.2)};var F=["?","gm","gs","xg","g2","mt32","ns5r","ag10","x5d","05rw","krs","k11","sg"],Le=[[0,0,0,0,121,0,0,56,82,81,63,0,0],[0,0,4,0,0,127,0,0,0,0,0,0,0]],H=[120,127,120,127,120,127,61,62,62,62,120,122,122],at=[0,3,81,84,88],Ie={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},le={0:0,1:1,2:3,5:4},Ue=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],De=[36,37];var oe=[0,1,2,4,5,6,7,8,10,11,32,38,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,84,91,92,93,94,95,98,99,100,101,12,13,16,17,18,19],nt=[33,99,100,32,102,8,9,10],O={};F.forEach((e,a)=>{O[e]=a});var d={length:oe.length};oe.forEach((e,a)=>{d[e]=a});var lt=function(e){let a=[[]];return e?.forEach(function(n){n==247||(n==240?a.push([]):a[a.length-1].push(n))}),a},Ge=function(e,a="",n="",t=2){return e?`${a}${e.toString().padStart(t,"0")}${n}`:""},v={ch:128,cc:oe.length,nn:128,pl:512,tr:256,cmt:14,rpn:6},Fe=class extends _{#t=0;#r=0;#h=0;#l=new Array(11);get#i(){return this.#l[this.#r]}set#i(e){this.#l[this.#r]=e}#s=new Uint8Array(v.ch);#o=new Uint8Array(v.ch);#e=new Uint8ClampedArray(v.ch*v.cc);#n=new Uint8ClampedArray(v.ch);#d=new Uint8ClampedArray(v.ch*v.nn);#g=new Uint8Array(v.ch);#a=new Uint16Array(v.pl);#b=new Int16Array(v.ch);#m=new Uint8Array(v.ch);#P=0;#f=new Uint8Array(v.ch*v.rpn);#L=new Int8Array(v.ch*De.length);#I=new Uint8Array(1024);#B=new Uint8Array(v.cmt*64);#C=0;#w=0;#y=100;#S=0;#U=500;#D=0;#$="";#x=0;#u=!1;#H;#k=new Uint8Array(2);#c=[];#M=new Uint8Array(v.ch);#T=new Uint8Array(v.tr);baseBank=new te("gm","gm2","xg","gs","ns5r","gmega","plg-150vl","plg-150pf","plg-100sg","kross");userBank=new te("gm");chRedir(e,a,n){if(this.#T[a])return(this.#T[a]-1)*16+e;if([O.gs,O.ns5r].indexOf(this.#t)>-1){if(n==1)return e;let t=0,r=!0;for(;r;)this.#M[e+t]==0?(this.#M[e+t]=a,console.debug(`Assign track ${a} to channel ${e+t+1}.`),r=!1):this.#M[e+t]==a?r=!1:(t+=16,t>=128&&(t=0,r=!1));return e+t}else return e}#p=[];#G;#E={ano:e=>{this.#a.forEach((a,n,t)=>{let r=a>>7;a==0&&this.#d[0]==0||r==e&&(this.#d[a]=0,t[n]=0)})}};#q={8:function(e){let n=e.channel*128+e.data[0],t=this.#a.indexOf(n);t>-1&&(this.#a[t]=0,this.#d[n]=0)},9:function(e){let a=e.channel;this.#s[a]=1;let n=a*128+e.data[0];if(e.data[1]>0){let t=0;for(;this.#a[t]>0;)t++;t<this.#a.length?(this.#a[t]=n,this.#d[n]=e.data[1],this.#m[a]<e.data[1]&&(this.#m[a]=e.data[1])):console.error("Polyphony exceeded.")}else{let t=this.#a.indexOf(n);t>-1&&(this.#a[t]=0,this.#d[n]=0)}},10:function(e){let n=e.channel*128+e.data[0];this.#a.indexOf(n)>-1&&(this.#d[n]=data[1])},11:function(e){let a=e.channel;this.#s[a]=1;let n=a*v.cc;switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{this.#E.ano(a),this.#b[a]=0;let t=a*v.cc;this.#e[t+d[1]]=0,this.#e[t+d[5]]=0,this.#e[t+d[64]]=0,this.#e[t+d[65]]=0,this.#e[t+d[66]]=0,this.#e[t+d[67]]=0,this.#e[t+d[11]]=127,this.#e[t+d[101]]=127,this.#e[t+d[100]]=127,this.#e[t+d[99]]=127,this.#e[t+d[98]]=127;return}case 123:{this.#E.ano(a);return}case 124:{this.#E.ano(a);return}case 125:{this.#E.ano(a);return}case 126:{this.#g[a]=1,this.#E.ano(a);return}case 127:{this.#g[a]=0,this.#E.ano(a);return}}if(d[e.data[0]]==null)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(e.data[0]){case 0:{if(self.debugMode&&console.debug(`${F[this.#t]}, CH${a+1}: ${e.data[1]}`),this.#t==0)e.data[1]<48?(this.#e[n]>119&&(e.data[1]=this.#e[n],e.data[1]=120,console.debug(`Forced channel ${a+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),this.switchMode("gs"))):e.data[1]==62?this.switchMode("x5d"):e.data[1]==63&&this.switchMode("krs");else if(this.#t==O.gs)e.data[1]<56&&this.#e[n]>119&&(e.data[1]=this.#e[n],e.data[1]=120,console.debug(`Forced channel ${a+1} to stay drums.`));else if(this.#t==O.gm)e.data[1]<48&&this.#e[n]>119&&(e.data[1]=120,this.switchMode("gs",!0),console.debug(`Forced channel ${a+1} to stay drums.`));else if(this.#t==O.x5d){if(e.data[1]>0&&e.data[1]<8)this.switchMode("05rw",!0);else if(e.data[1]==56){let t=0;for(let r=0;r<16;r++){let s=this.#e[v.cc*r];(s==56||s==62)&&t++}t>14&&this.switchMode("ag10",!0)}}break}case 6:{if(this.#P){let t=this.#e[n+d[99]],r=this.#e[n+d[98]];if(t==1){let s=nt.indexOf(r);if(s>-1)this.#e[n+d[71+s]]=e.data[1],console.debug(`Redirected NRPN 1 ${r} to cc${71+s}.`);else{let o=De.indexOf(r);o>-1&&(this.#L[a*10+o]=e.data[1]-64),console.debug(`CH${a+1} voice NRPN ${r} commit`)}}}else{let t=le[this.#e[n+d[100]]];this.#e[n+d[101]]==0&&t!=null&&(console.debug(`CH${a+1} RPN 0 ${this.#e[n+d[100]]} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],Ue[t][0]),Ue[t][1]),this.#f[a*v.rpn+t]=e.data[1])}break}case 38:{this.#P||this.#e[n+101]==0&&le[this.#e[n+100]]!=null&&(this.#f[a*v.rpn+le[this.#e[n+100]]+1]=e.data[1]);break}case 98:case 99:{this.#P=1;break}case 100:case 101:{this.#P=0;break}}this.#e[n+d[e.data[0]]]=e.data[1]}},12:function(e){let a=e.channel;this.#s[a]=1,this.#n[a]=e.data,self.debugMode&&console.debug(`T:${e.track} C:${a} P:${e.data}`)},13:function(e){let a=this,n=e.channel;this.#a.forEach(function(t){let r=t>>7;n==r&&(a.#d[t]=e.data)})},14:function(e){let a=e.channel;this.#b[a]=e.data[1]*128+e.data[0]-8192},15:function(e){lt(e.data).forEach(a=>{let n=a[0],t=a[1];(this.#Y[n]||function(){console.debug(`Unknown manufacturer ${n}.`)})(t,a.slice(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){if((this.#p[e.meta]||function(n,t,r){}).call(this,e.data,e.track,e.meta),e.meta!=32&&(this.#S=0),at.indexOf(e.meta)>-1)return e.reply="meta",e;self.debugMode&&console.debug(e)}};#Y={64:(e,a,n)=>{this.#X.run(a,n,e)},65:(e,a,n)=>{if(a[0]<16)this.#v.run(a,n,e),console.warn("Unknown device SysEx!");else{let t=a.pop(),r=Ae(a.slice(2));t==r?this.#v.run(a,n,e):console.warn(`Bad GS checksum ${t}. Should be ${r}.`)}},66:(e,a,n)=>{this.#R.run(a,n,e)},67:(e,a,n)=>{this.#A.run(a,n,e)},68:(e,a,n)=>{this.#V.run(a,n,e)},71:(e,a,n)=>{this.#N.run(a,n,e)},126:(e,a,n)=>{this.#F.run(a,n,e)},127:(e,a,n)=>{this.switchMode("gm"),this.#O.run(a,n,e)}};#F;#O;#A;#v;#R;#X;#N;#V;buildRchTree(){let e=[];this.#o.forEach((a,n)=>{e[a]?.constructor||(e[a]=[]),e[a].push(n)}),this.#H=e}getActive(){let e=this.#s.slice();return this.#t==O.mt32,e}getCc(e){let a=e*v.cc,n=this.#e.slice(a,a+v.cc);return n[d[0]]=n[d[0]]||this.#C,n[d[32]]=n[d[32]]||this.#w,n}getCcAll(){let e=this.#e.slice();for(let a=0;a<64;a++){let n=a*v.cc;e[n+d[0]]=e[n+d[0]]||this.#C,e[n+d[32]]=e[n+d[32]]||this.#w}return e}getPitch(){return this.#b}getProgram(){return this.#n}getTexts(){return this.#c.slice()}getVel(e){let a=new Map,n=this;return this.#a.forEach(function(t){let r=Math.floor(t/128),s=t%128;e==r&&n.#d[t]>0&&a.set(s,n.#d[t])}),a}getBitmap(){return{bitmap:this.#i,expire:this.#h}}getLetter(){return{text:this.#$,expire:this.#x}}getMode(){return F[this.#t]}getMaster(){return{volume:this.#y}}getRawStrength(){let e=this;return this.#a.forEach(function(a){let n=Math.floor(a/128);e.#d[a]>e.#m[n]&&(e.#m[n]=e.#d[a])}),this.#m}getStrength(){let e=[],a=this;return this.getRawStrength().forEach(function(n,t){e[t]=Math.floor(n*a.#e[t*v.cc+d[7]]*a.#e[t*v.cc+d[11]]*a.#y/803288)}),e}getRpn(){return this.#f}getNrpn(){return this.#L}getVoice(e,a,n,t){let r=e||this.#C,s=a,o=n||this.#w;F[this.#t]=="ns5r"&&r>0&&r<56&&(o=3);let l=this.userBank.get(r,s,o,t);if(F[this.#t]=="mt32"&&l.name.indexOf("MT-m:")==0){let f=parseInt(l.name.slice(5)),h=f*v.cmt,c="";this.#B.slice(h,h+10).forEach(u=>{u>31&&(c+=String.fromCharCode(u))}),this.userBank.load(`MSB	LSB	PRG
0	127	${s}	${c}`,!0),l.name=c}else(l.ending!=" "||!l.name.length)&&(l=this.baseBank.get(r,s,o,t));return l}getChVoice(e){return this.getVoice(this.#e[e*v.cc+d[0]],this.#n[e],this.#e[e*v.cc+d[32]],F[this.#t])}init(e=0){this.dispatchEvent("mode","?"),this.#t=0,this.#C=0,this.#w=0,this.#S=0,this.#s.fill(0),this.#e.fill(0),this.#n.fill(0),this.#d.fill(0),this.#a.fill(0),this.#m.fill(0),this.#b.fill(0),this.#L.fill(0),this.#y=100,this.#c=[],this.#U=500,this.#D=0,this.#x=0,this.#$="",this.#h=0,this.#r=0,this.#i.fill(0),this.#u=!1,this.#o.forEach(function(a,n,t){t[n]=n}),this.buildRchTree(),this.#M.fill(0),this.#T.fill(0),this.#e[v.cc*9]=H[0],this.#e[v.cc*25]=H[0],this.#e[v.cc*41]=H[0],this.#e[v.cc*57]=H[0],this.#k.fill(0),this.#I.fill(0),this.#B.fill(0),this.userBank.clearRange({msb:0,lsb:127,prg:[0,127]});for(let a=0;a<64;a++){let n=a*v.cc;this.#e[n+d[7]]=100,this.#e[n+d[11]]=127,this.#e[n+d[10]]=64,this.#e[n+d[71]]=64,this.#e[n+d[72]]=64,this.#e[n+d[73]]=64,this.#e[n+d[74]]=64,this.#e[n+d[75]]=64,this.#e[n+d[76]]=64,this.#e[n+d[77]]=64,this.#e[n+d[78]]=64,this.#e[n+d[91]]=40,this.#e[n+d[101]]=127,this.#e[n+d[100]]=127,this.#e[n+d[99]]=127,this.#e[n+d[98]]=127;let t=a*v.rpn;this.#f[t]=2,this.#f[t+1]=64,this.#f[t+2]=0,this.#f[t+3]=64,this.#f[t+4]=0,this.#f[t+5]=0}}switchMode(e,a=!1){let n=F.indexOf(e);if(n>-1){if(this.#t==0||a){this.#t=n,this.#r=0,this.#C=Le[0][n],this.#w=Le[1][n];for(let t=0;t<64;t++)H.indexOf(this.#e[t*v.cc])>-1&&(this.#e[t*v.cc]=H[n]);this.dispatchEvent("mode",e)}}else throw new Error(`Unknown mode ${e}`)}newStrength(){this.#m.fill(0)}runJson(e){if(e.type>14)return this.#q[e.type].call(this,e);{let a=this.chRedir(e.part,e.track),n=!1;this.#H[a]?.forEach(t=>{e.channel=t,n=!0,this.#q[e.type].call(this,e)}),n||console.warn(`${Ie[e.type]?Ie[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!=null?e.data[0]:e.data).toString():""} event sent to CH${a+1} without any recipient.`)}this.#c.length>100&&this.#c.splice(100,this.#c.length-99)}runRaw(e){}constructor(){super();let e=this;this.#i=new Uint8Array(256),this.#l[10]=new Uint8Array(512),this.#G=new I,this.userBank.strictMode=!0,this.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),this.#p[1]=function(t){switch(t.slice(0,2)){case"@I":{this.#u=!0,this.#c.unshift(`Kar.Info: ${t.slice(2)}`);break}case"@K":{this.#u=!0,this.#c.unshift("Karaoke mode active."),console.debug(`Karaoke mode active: ${t.slice(2)}`);break}case"@L":{this.#u=!0,this.#c.unshift(`Language: ${t.slice(2)}`);break}case"@T":{this.#u=!0,this.#c.unshift(`Ka.Title: ${t.slice(2)}`);break}case"@V":{this.#u=!0,this.#c.unshift(`Kara.Ver: ${t.slice(2)}`);break}default:this.#u?t[0]=="\\"?this.#c.unshift(`@ ${t.slice(1)}`):t[0]=="/"?this.#c.unshift(t.slice(1)):this.#c[0]+=t:(this.#c[0]=t,this.#c.unshift(""))}},this.#p[2]=function(t){this.#c.unshift(`Copyrite: ${t}`)},this.#p[3]=function(t,r){r<1&&this.#S<1&&this.#c.unshift(`TrkTitle: ${t}`)},this.#p[4]=function(t,r){r<1&&this.#S<1&&this.#c.unshift(`${Ge(this.#S,""," ")}Instrmnt: ${t}`)},this.#p[5]=function(t){t.trim()==""?this.#c.unshift(""):this.#c[0]+=`${t}`},this.#p[6]=function(t){this.#c.unshift(`${Ge(this.#S,""," ")}C.Marker: ${t}`)},this.#p[7]=function(t){this.#c.unshift(`CuePoint: ${t}`)},this.#p[32]=function(t){this.#S=t[0]+1},this.#p[33]=function(t,r){console.debug(`Track ${r} requests to get assigned to output ${t}.`),e.#T[r]=t+1},this.#p[81]=function(t,r){e.#U=t/1e3},this.#p[127]=function(t,r){e.#G.run(t,r)},this.#G.add([67,0,1],function(t,r){e.#T[r]=t[0]+1}),this.#F=new I,this.#O=new I,this.#A=new I,this.#v=new I,this.#R=new I,this.#X=new I,this.#N=new I,this.#V=new I,this.#F.add([9],t=>{e.switchMode(["gm","?","g2"][t[0]-1],!0),e.#u=e.#u||!1,console.info(`MIDI reset: ${["GM","Init","GM2"][t[0]-1]}`),t[0]==2&&e.init()}),this.#O.add([4,1],t=>{e.#y=((t[1]<<7)+t[0])/16383*100}).add([4,3],t=>((t[1]<<7)+t[0]-8192)/8192).add([4,4],t=>t[1]-64),this.#A.add([76,0,0],t=>{switch(t[0]){case 126:{e.switchMode("xg",!0),e.#u=!1,console.info("MIDI reset: XG");break}default:{let r=[0,0,0,0],s=(o,l)=>{r[l]=o};if(t.slice(1).forEach((o,l)=>{let f=l+t[0];[s,s,s,s,h=>{this.#y=h*129/16383*100},h=>{},h=>{}][f](o,l)}),t[0]<4){let o=0;r.forEach(l=>{o=o<<4,o+=l}),o-=1024}}}}).add([76,2,1],t=>{let r="XG ";t[0]<32?(r+="reverb ",t.slice(1).forEach((s,o)=>{([l=>{console.info(`${r}main type: ${Q[l]}`)},l=>{console.debug(`${r}sub type: ${l+1}`)},l=>{console.debug(`${r}time: ${ve(l)}s`)},l=>{console.debug(`${r}diffusion: ${l}`)},l=>{console.debug(`${r}initial delay: ${l}`)},l=>{console.debug(`${r}HPF cutoff: ${Y[l]}Hz`)},l=>{console.debug(`${r}LPF cutoff: ${Y[l]}Hz`)},l=>{console.debug(`${r}width: ${l}`)},l=>{console.debug(`${r}height: ${l}`)},l=>{console.debug(`${r}depth: ${l}`)},l=>{console.debug(`${r}wall type: ${l}`)},l=>{console.debug(`${r}dry/wet: ${l}`)},l=>{console.debug(`${r}send: ${A(l)}dB`)},l=>{console.debug(`${r}pan: ${l-64}`)},!1,!1,l=>{console.debug(`${r}delay: ${l}`)},l=>{console.debug(`${r}density: ${l}`)},l=>{console.debug(`${r}balance: ${l}`)},l=>{},l=>{console.debug(`${r}feedback: ${l}`)},l=>{}][t[0]+o]||function(){console.warn(`Unknown XG reverb address: ${t[0]}.`)})(s)})):t[0]<64?(r+="chorus ",t.slice(1).forEach((s,o)=>{([l=>{console.info(`${r}main type: ${Q[l]}`)},l=>{console.debug(`${r}sub type: ${l+1}`)},l=>{console.debug(`${r}LFO: ${Ee[l]}Hz`)},l=>{},l=>{console.debug(`${r}feedback: ${l}`)},l=>{console.debug(`${r}delay offset: ${Ce(l)}ms`)},l=>{},l=>{console.debug(`${r}low: ${Y[l]}Hz`)},l=>{console.debug(`${r}low: ${l-64}dB`)},l=>{console.debug(`${r}high: ${Y[l]}Hz`)},l=>{console.debug(`${r}high: ${l-64}dB`)},l=>{console.debug(`${r}dry/wet: ${l}`)},l=>{console.debug(`${r}send: ${A(l)}dB`)},l=>{console.debug(`${r}pan: ${l-64}`)},l=>{console.debug(`${r}to reverb: ${A(l)}dB`)},!1,l=>{},l=>{},l=>{},l=>{console.debug(`${r}LFO phase diff: ${(l-64)*3}deg`)},l=>{console.debug(`${r}input mode: ${l?"stereo":"mono"}`)},l=>{}][t[0]-32+o]||function(){console.warn(`Unknown XG chorus address: ${t[0]}.`)})(s)})):t[0]<86?(r+="variation ",t[0]==64&&console.info(`${r}type: ${Q[t[1]]}${t[2]>0?" "+(t[2]+1):""}`)):t[0]<97?(r+="variation ",t.slice(1).forEach((s,o)=>{[l=>{console.debug(`${r}send: ${A(l)}dB`)},l=>{console.debug(`${r}pan: ${l-64}`)},l=>{console.debug(`${r}to reverb: ${A(l)}dB`)},l=>{console.debug(`${r}to chorus: ${A(l)}dB`)},l=>{console.debug(`${r}connection: ${l?"system":"insertion"}`)},l=>{console.debug(`${r}channel: CH${l+1}`)},l=>{console.debug(`${r}mod wheel: ${l-64}`)},l=>{console.debug(`${r}bend wheel: ${l-64}`)},l=>{console.debug(`${r}channel after touch: ${l-64}`)},l=>{console.debug(`${r}AC1: ${l-64}`)},l=>{console.debug(`${r}AC2: ${l-64}`)}][t[0]-86+o](s)})):t[0]>111&&t[0]<118?r+="variation ":console.warn(`Unknown XG variation address: ${t[0]}`)}).add([76,2,64],t=>{t.slice(1).forEach((r,s)=>{let o=s+t[0];if(o==0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][r]}`);else{let l=o-1>>2,f=o-1&3,h=`XG EQ ${l} ${["gain","freq","Q","shape"][f]}: `;[()=>{console.debug(`${h}${r-64}dB`)},()=>{console.debug(`${h}${r} (raw)`)},()=>{console.debug(`${h}${r/10}`)},()=>{console.debug(`${h}${["shelf","peak"][+!!r]}`)}][f]()}})}).add([76,3],t=>{}).add([76,6,0],t=>{let r=t[0];e.#$=" ".repeat(r),e.#x=Date.now()+3200,t.slice(1).forEach(function(s){e.#$+=String.fromCharCode(s)}),e.#$=e.#$.padEnd(32," ")}).add([76,7,0],t=>{let r=t[0];e.#h=Date.now()+3200,e.#i.fill(0);let s=t.slice(1);for(let o=0;o<r;o++)s.unshift(0);s.forEach(function(o,l){let f=Math.floor(l/16),h=l%16,c=(h*3+f)*7,u=7,g=0;for(c-=h*5,f==2&&(u=2);g<u;)e.#i[c+g]=o>>6-g&1,g++})}).add([76,8],(t,r)=>{let s=e.chRedir(t[0],r,!0),o=t[1],l=v.cc*s,f=`XG CH${s+1} `,h=`Unknown XG part address ${o}.`;t.slice(2).forEach((c,u)=>{o<1?console.debug(h):o<41?([()=>{e.#e[l+d[0]]=c},()=>{e.#e[l+d[32]]=c},()=>{e.#n[s]=c},()=>{let g=e.chRedir(c,r,!0);e.#o[s]=g,s!=g&&(e.buildRchTree(),console.info(`${f}receives from CH${g+1}`))},()=>{e.#g[s]=+!c},()=>{},()=>{e.#e[l+d[0]]=c>1?127:0,console.debug(`${f}type: ${ie[c]}`)},()=>{e.#f[v.rpn*s+3]=c},!1,!1,()=>{e.#e[l+d[7]]=c},!1,!1,()=>{e.#e[l+d[10]]=c||128},!1,!1,()=>{e.#e[l+d[11]]=c},()=>{e.#e[l+d[93]]=c},()=>{e.#e[l+d[91]]=c},()=>{e.#e[l+d[94]]=c},()=>{e.#e[l+d[76]]=c},()=>{e.#e[l+d[77]]=c},()=>{e.#e[l+d[78]]=c},()=>{e.#e[l+d[74]]=c},()=>{e.#e[l+d[71]]=c},()=>{e.#e[l+d[73]]=c},()=>{e.#e[l+d[75]]=c},()=>{e.#e[l+d[72]]=c}][o+u-1]||function(){})():o<48?console.debug(h):o<111?o>102&&o<105&&(e.#e[l+d[[5,65][o&1]]]=c):o<114?console.debug(h):o<116?console.debug(`${f}EQ ${["bass","treble"][o&1]} gain: ${c-64}dB`):o<118?console.debug(h):o<120?console.debug(`${f}EQ ${["bass","treble"][o&1]} freq: ${c}`):console.debug(h)})}).add([76,10],t=>{}).add([76,16],t=>{}).add([76,17,0,0],t=>{}).add([73,0,0],(t,r)=>{let s=t[0];t.slice(1).forEach((o,l)=>{let f=s+l;f==8?console.debug(`MU1000 set LCD contrast to ${o}.`):f>9&&f<15&&[()=>{e.dispatchEvent("channelactive",o)},()=>{o<8?e.dispatchEvent("channelmin",o<<4):e.dispatchEvent("channelreset")},()=>{o<8?e.dispatchEvent("channelmax",(o<<4)+15):e.dispatchEvent("channelreset")},()=>{e.dispatchEvent("channelreset")}][f-10]()})}).add([93,3],(t,r)=>{let s=e.chRedir(t[0],r,!0),o=`PLG-100SG CH${s+1} `,l=Date.now();if(t[1]==0){let f="",h=0;t.slice(2).forEach((c,u)=>{u%2==0?f+=xe[c]||c.toString().padStart("0"):h+=c*13}),l>=e.#D&&e.#c.unshift("SG Lyric: "),e.#c[0]+=`${Te(f)}`,e.#D=l+Math.ceil(h/2)+e.#U,self.debugMode&&console.debug(`${o}vocals: ${f}`)}else console.warn(`Unknown PLG-100SG data: ${t}`)}).add([112],t=>{console.debug(`XG plugin PLG1-${["00VL","00SG","00DX"][t[0]]} enabled for channel ${t[2]+1}.`)}),this.#A.add([76,48],t=>{}).add([76,49],t=>{}).add([76,50],t=>{}).add([76,51],t=>{}),this.#v.add([66,18,0,0,127],t=>{e.switchMode("gs",!0),e.#e[v.cc*9]=120,e.#e[v.cc*25]=120,e.#e[v.cc*41]=120,e.#e[v.cc*57]=120,e.#w=3,e.#u=!1,e.#M.fill(0),console.info(`GS system to ${["single","dual"][t[0]]} mode.`)}).add([66,18,64,0],t=>{switch(t[0]){case 127:{e.switchMode("gs",!0),e.#e[v.cc*9]=120,e.#e[v.cc*25]=120,e.#e[v.cc*41]=120,e.#e[v.cc*57]=120,e.#u=!1,e.#M.fill(0),console.info("MIDI reset: GS");break}default:{let r=[0,0,0,0],s=(o,l)=>{r[l]=o};if(t.slice(1).forEach((o,l)=>{let f=l+t[0];[s,s,s,s,h=>{this.#y=h*129/16383*100},h=>{},h=>{}][f](o,l)}),t[0]<4){let o=0;r.forEach(l=>{o=o<<4,o+=l}),o-=1024}}}}).add([66,18,64,1],t=>{let r=t[0];if(r<16){let s="".padStart(r," ");t.slice(1).forEach((o,l)=>{s+=String.fromCharCode(Math.max(32,o))}),s=s.padEnd(16," "),console.debug(`GS patch name: ${s}`)}else r<48||(r<65?t.slice(1).forEach((s,o)=>{let l=`GS ${r+o>55?"chorus":"reverb"} `;([()=>{console.info(`${l}type: ${se[s]}`)},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${l}predelay: ${s}ms`)},()=>{console.info(`${l}type: ${Re[s]}`)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${l}to reverb: ${A(s)}`)},()=>{console.debug(`${l}to delay: ${A(s)}`)}][r+o-48]||function(){})()}):r<80?console.debug(`Unknown GS patch address: ${r}`):r<91?t.slice(1).forEach((s,o)=>{let l="GS delay ";([()=>{console.info(`${l}type: ${Pe[s]}`)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${l}to reverb: ${A(s)}`)}][r+o-80]||function(){})()}):console.debug(`Unknown GS patch address: ${r}`))}).add([66,18,64,2],t=>{let r="GS EQ ";t.slice(1).forEach((s,o)=>{([()=>{console.debug(`${r}low freq: ${[200,400][s]}Hz`)},()=>{console.debug(`${r}low gain: ${s-64}dB`)},()=>{console.debug(`${r}high freq: ${[3e3,6e3][s]}Hz`)},()=>{console.debug(`${r}high gain: ${s-64}dB`)}][t[0]+o]||function(){console.warn(`Unknown GS EQ address: ${t[0]+o}`)})()})}).add([66,18,64,3],t=>{let r="GS EFX ",s=function(o,l){let f=Be(e.#k,l,o);f&&console.debug(`${r}${ae(e.#k)} ${f}`)};t.slice(1).forEach((o,l)=>{([()=>{e.#k[0]=o},()=>{e.#k[1]=o,console.info(`${r}type: ${ae(e.#k)}`)},!1,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,()=>{console.debug(`${r}to reverb: ${A(o)}dB`)},()=>{console.debug(`${r}to chorus: ${A(o)}dB`)},()=>{console.debug(`${r}to delay: ${A(o)}dB`)},!1,()=>{console.debug(`${r}1 source: ${o}`)},()=>{console.debug(`${r}1 depth: ${o-64}`)},()=>{console.debug(`${r}2 source: ${o}`)},()=>{console.debug(`${r}2 depth: ${o-64}`)},()=>{console.debug(`${r}to EQ: ${o?"ON":"OFF"}`)}][t[0]+l]||function(f,h){console.warn(`Unknown GS EFX address: ${h}`)})(o,t[0]+l)})}).add([66,18,65],t=>{}).add([69,18,16],t=>{switch(t[0]){case 0:{e.#x=Date.now()+3200;let r=t[1];e.#$=" ".repeat(r),t.slice(2).forEach(function(s){s<128&&(e.#$+=String.fromCharCode(s))});break}case 32:{e.#h=Date.now()+3200,t[1]==0&&(e.#r=Math.max(Math.min(t[2]-1,9),0));break}default:if(t[0]<11){e.#h=Date.now()+3200,e.#l[t[0]-1]?.length||(e.#l[t[0]-1]=new Uint8Array(256));let r=e.#l[t[0]-1],s=t[1];r.fill(0);let o=t.slice(2);for(let l=0;l<s;l++)o.unshift(0);o.forEach(function(l,f){let h=Math.floor(f/16),c=f%16,u=(c*4+h)*5,g=5,k=0;for(u-=c*4,h==3&&(g=1);k<g;)r[u+k]=l>>4-k&1,k++})}else console.warn(`Unknown GS display section: ${t[0]}`)}});let a=function(t,r,s){let o=t[0],l=v.cc*r,f=v.rpn*r,h=`GS CH${r+1} `;o<3?t.slice(1).forEach((c,u)=>{[()=>{e.#e[l+d[0]]=c},()=>{e.#n[r]=c},()=>{let g=e.chRedir(c,s,!0);e.#o[r]=g,r!=g&&(e.buildRchTree(),console.info(`${h}receives from CH${g+1}`))}][o+u]()}):o<19||(o<44?t.slice(1).forEach((c,u)=>{([()=>{e.#g[r]=+!c},!1,()=>{e.#e[l+d[0]]=c?120:0,console.debug(`${h}type: ${c?"drum ":"melodic"}${c||""}`)},()=>{e.#f[f+3]=c},!1,()=>{e.#e[l+d[7]]=c},!1,!1,()=>{e.#e[l+d[10]]=c||128},!1,!1,()=>{console.debug(`${h}CC 1: cc${c}`)},()=>{console.debug(`${h}CC 2: cc${c}`)},()=>{e.#e[l+d[93]]=c},()=>{e.#e[l+d[91]]=c},!1,!1,()=>{e.#f[f+1]=c},()=>{e.#f[f+2]=c},()=>{e.#e[l+d[94]]=c}][o+u-19]||function(){})()}):o<76||console.debug(`Unknown GS part address: ${o}`))},n=function(t,r){let s=t[0],o=`GS CH${r+1} `;s<2?t.slice(1).forEach((l,f)=>{[()=>{e.#e[v.cc*r+d[32]]=l},()=>{}][s+f]()}):s<32?console.warn(`Unknown GS misc address: ${s}`):s<35?t.slice(1).forEach((l,f)=>{[()=>{console.debug(`${o}EQ: o${["ff","n"][l]}`)},()=>{},()=>{console.debug(`${o}EFX: o${["ff","n"][l]}`)}][s+f-32]()}):console.warn(`Unknown GS misc address: ${s}`)};this.#v.add([66,18,64,16],(t,r)=>{a(t,e.chRedir(9,r,!0),r)}).add([66,18,64,17],(t,r)=>{a(t,e.chRedir(0,r,!0),r)}).add([66,18,64,18],(t,r)=>{a(t,e.chRedir(1,r,!0),r)}).add([66,18,64,19],(t,r)=>{a(t,e.chRedir(2,r,!0),r)}).add([66,18,64,20],(t,r)=>{a(t,e.chRedir(3,r,!0),r)}).add([66,18,64,21],(t,r)=>{a(t,e.chRedir(4,r,!0),r)}).add([66,18,64,22],(t,r)=>{a(t,e.chRedir(5,r,!0),r)}).add([66,18,64,23],(t,r)=>{a(t,e.chRedir(6,r,!0),r)}).add([66,18,64,24],(t,r)=>{a(t,e.chRedir(7,r,!0),r)}).add([66,18,64,25],(t,r)=>{a(t,e.chRedir(8,r,!0),r)}).add([66,18,64,26],(t,r)=>{a(t,e.chRedir(10,r,!0),r)}).add([66,18,64,27],(t,r)=>{a(t,e.chRedir(11,r,!0),r)}).add([66,18,64,28],(t,r)=>{a(t,e.chRedir(12,r,!0),r)}).add([66,18,64,29],(t,r)=>{a(t,e.chRedir(13,r,!0),r)}).add([66,18,64,30],(t,r)=>{a(t,e.chRedir(14,r,!0),r)}).add([66,18,64,31],(t,r)=>{a(t,e.chRedir(15,r,!0),r)}).add([66,18,64,64],(t,r)=>{n(t,e.chRedir(9,r,!0))}).add([66,18,64,65],(t,r)=>{n(t,e.chRedir(0,r,!0))}).add([66,18,64,66],(t,r)=>{n(t,e.chRedir(1,r,!0))}).add([66,18,64,67],(t,r)=>{n(t,e.chRedir(2,r,!0))}).add([66,18,64,68],(t,r)=>{n(t,e.chRedir(3,r,!0))}).add([66,18,64,69],(t,r)=>{n(t,e.chRedir(4,r,!0))}).add([66,18,64,70],(t,r)=>{n(t,e.chRedir(5,r,!0))}).add([66,18,64,71],(t,r)=>{n(t,e.chRedir(6,r,!0))}).add([66,18,64,72],(t,r)=>{n(t,e.chRedir(7,r,!0))}).add([66,18,64,73],(t,r)=>{n(t,e.chRedir(8,r,!0))}).add([66,18,64,74],(t,r)=>{n(t,e.chRedir(10,r,!0))}).add([66,18,64,75],(t,r)=>{n(t,e.chRedir(11,r,!0))}).add([66,18,64,76],(t,r)=>{n(t,e.chRedir(12,r,!0))}).add([66,18,64,77],(t,r)=>{n(t,e.chRedir(13,r,!0))}).add([66,18,64,78],(t,r)=>{n(t,e.chRedir(14,r,!0))}).add([66,18,64,79],(t,r)=>{n(t,e.chRedir(15,r,!0))}),this.#R.add([54,76,0],(t,r)=>{e.switchMode("x5d",!0);let s="",o=82,l=0,f=0,h="MSB	PRG	LSB	NME";G(t,function(c,u){if(u<16400){let g=u%164;switch(!0){case g<10:{c>31&&(s+=String.fromCharCode(c));break}case g==11:{h+=`
${o}	${l}	${f}	${s.trim().replace("Init Voice","")}`,l++,s="";break}}l>99&&(o=90,l=0)}}),e.userBank.clearRange({msb:82,prg:[0,99],lsb:0}),e.userBank.load(h)}).add([54,77,0],(t,r)=>{e.switchMode("x5d",!0);let s="",o=90,l=0,f=0,h="MSB	PRG	LSB	NME";G(t,function(c,u){if(u<13600){let g=u%136;switch(!0){case g<10:{c>31&&(s+=String.fromCharCode(c));break}case g==11:{h+=`
${o}	${l}	${f}	${s.trim().replace("Init Combi","")}`,l++,s="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(h)}).add([54,104],(t,r)=>{e.switchMode("x5d",!0),G(t,function(s,o){if(o<192){let l=e.chRedir(Math.floor(o/12),r,!0),f=l*v.cc;switch(o%12){case 0:{e.#n[l]=s,s>0&&(e.#s[l]=1);break}case 1:{e.#e[f+d[7]]=s;break}case 2:{e.#f[l*v.rpn+3]=s>127?256-s:64+s;break}case 3:{e.#f[l*v.rpn+1]=s>127?256-s:64+s;break}case 4:{s<31&&(e.#e[f+d[10]]=Math.round((s-15)*4.2+64));break}case 5:{let h=s>>4,c=s&15;e.#e[f+d[91]]=ne(c),e.#e[f+d[93]]=ne(h);break}case 10:{e.#e[f]=s&3?82:56;break}case 11:{let h=e.chRedir(s&15,r,!0),c=s>>4;e.#o[l]=s,(h!=l||c)&&(console.info(`X5D Part CH${l+1} receives from CH${h+1}.`),e.buildRchTree())}}}else{let l=e.chRedir(o-192,r,!0)}})}),this.#v.add([22,18,127],t=>{e.switchMode("mt32",!0),e.#u=!1,console.info("MIDI reset: MT-32")}).add([22,18,0],(t,r,s)=>{e.switchMode("mt32");let o=e.chRedir(s,r,!0);console.debug(`MT-32 CH${o+1} Patch: ${t}`)}).add([22,18,1],(t,r,s)=>{e.switchMode("mt32");let o=e.chRedir(s,r,!0);console.debug(`MT-32 CH${o+1} Drum: ${t}`)}).add([22,18,2],(t,r,s)=>{e.switchMode("mt32");let o=e.chRedir(s,r,!0);console.debug(`MT-32 CH${o+1} (${customName}) Timbre: ${t}`)}).add([22,18,3],(t,r,s)=>{e.switchMode("mt32"),console.debug(`MT-32 Part Patch: ${t}`)}).add([22,18,4],(t,r,s)=>{e.switchMode("mt32"),console.debug(`MT-32 Part Timbre: ${t}`)}).add([22,18,5],(t,r,s)=>{e.switchMode("mt32");let o=(t[0]<<7)+t[1];t.slice(2).forEach((l,f)=>{let h=o+f,c=Math.floor(h/8),u=h&7,g=c*8;e.#I[h]=l,([!1,()=>{let k=e.#I[g];if(k<3){let b="";if(k==2){let m=v.cmt*c;e.#B.slice(m,m+10).forEach(p=>{p>31&&(b+=String.fromCharCode(p))}),b.length||(b=`MT-m:${l.toString().padStart(3,"0")}`)}else b=e.baseBank.get(0,l+(k<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:c}),e.userBank.load(`MSB	LSB	PRG	NME
000	127	${c}	${b}`,!0)}}][u]||function(){})()})}).add([22,18,8],(t,r,s)=>{e.switchMode("mt32"),t.slice(2,16).forEach((o,l)=>{e.#B[(t[0]>>1)*v.cmt+l]=o})}).add([22,18,16],(t,r,s)=>{e.switchMode("mt32"),console.debug(`MT-32 System Setup: ${t}`)}).add([22,18,32],t=>{e.switchMode("mt32");let r=t[1],s=" ".repeat(r);t.slice(2).forEach(o=>{o>31&&(s+=String.fromCharCode(o))}),e.#$=s.padStart(20," "),e.#x=Date.now()+3200}),this.#R.add([66,0],(t,r)=>{e.switchMode("ns5r",!0),e.#u=!1,console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][t[0]]} mode.`)}).add([66,1],(t,r)=>{e.switchMode(["ns5r","05rw"][t[0]],!0),e.#u=!1}).add([66,18,0,0],(t,r)=>{let s=t[0];switch(s){case 124:case 126:case 127:{e.switchMode("ns5r",!0),e.#u=!1;break}case 125:break;default:if(s<10){let o=[0,0,0,0],l=(f,h)=>{o[h]=f};if(t.slice(1).forEach((f,h)=>{[l,l,l,l,()=>{e.#y=f*129/16383*100},()=>f-64,()=>f-64,()=>{},()=>{},()=>{}][s+h]()}),t[0]<4){let f=0;o.forEach(h=>{f=f<<4,f+=h}),f-=1024}}}}).add([66,18,0,1],(t,r)=>{}).add([66,18,0,2],(t,r)=>{}).add([66,18,1],(t,r)=>{let s=e.chRedir(t[0],r,!0),o=s*v.cc,l=t[1],f=`NS5R CH${s+1}`;t.slice(2).forEach((h,c)=>{let u=l+c;u<3?[()=>{e.#e[o+d[0]]=h},()=>{e.#e[o+d[32]]=h},()=>{e.#n[s]=h}][u]():u<8||(u<14?[()=>{let g=e.chRedir(h,r,!0);e.#o[s]=g,s!=g&&(e.buildRchTree(),console.info(`${f}receives from CH${g+1}`))},()=>{e.#g[s]=+!h},()=>{console.debug(`${f}type: ${ie[h]}`)},()=>{e.#f[v.rpn*s+3]=h},()=>{},()=>{}][u-8]():u<16||(u<33?[()=>{e.#e[o+d[7]]=h},()=>{e.#e[o+d[11]]=h},()=>{},()=>{},()=>{e.#e[o+d[10]]=h||128},()=>{},()=>{},()=>{e.#e[o+d[93]]=h},()=>{e.#e[o+d[91]]=h},()=>{e.#e[o+d[76]]=h},()=>{e.#e[o+d[77]]=h},()=>{e.#e[o+d[78]]=h},()=>{e.#e[o+d[74]]=h},()=>{e.#e[o+d[71]]=h},()=>{e.#e[o+d[73]]=h},()=>{e.#e[o+d[75]]=h},()=>{e.#e[o+d[72]]=h}][u-16]():u<112||u<114&&[()=>{e.#e[o+d[5]]=h},()=>{e.#e[o+d[65]]=h}][u-112]()))})}).add([66,18,8,0],(t,r)=>{}).add([66,52],(t,r)=>{e.switchMode("ns5r",!0),e.#u=!1}).add([66,53],(t,r)=>{e.switchMode("ns5r",!0),e.#u=!1,G(t,function(s,o){switch(!0){case o<2944:{let l=e.chRedir(Math.floor(o/92),r,!0),f=l*v.cc;switch(o%92){case 0:{e.#e[f+d[0]]=s;break}case 1:{e.#e[f+d[32]]=s;break}case 2:{e.#n[l]=s,s>0&&(e.#s[l]=1);break}case 3:{let h=e.chRedir(s,r,!0);e.#o[l]=h,l!=h&&(console.info(`NS5R CH${l+1} receives from CH${h+1}.`),e.buildRchTree())}case 7:break;case 8:{e.#f[l*v.rpn+3]=s<40||s>88?s+(s>63?-192:64):s;break}case 9:case 10:{e.#e[f+d[7]]=s;break}case 11:{e.#e[f+d[11]]=s;break}case 14:{e.#e[f+d[10]]=s||128;break}case 19:{e.#e[f+d[93]]=s;break}case 20:{e.#e[f+d[91]]=s;break}case 84:{e.#e[f+d[65]]=s;break}case 85:{e.#e[f+d[5]]=s;break}}break}case o<3096:break;case o<3134:break;case o<8566:break}})}).add([66,54],(t,r)=>{e.switchMode("ns5r",!0);let s="",o=80,l=0,f=0,h="MSB	PRG	LSB	NME";G(t,function(c,u){let g=u%158;switch(!0){case g<10:{c>31&&(s+=String.fromCharCode(c));break}case g==11:{o=c;break}case g==12:{f=c;break}case g==13:{h+=`
${o}	${l}	${f}	${s.trim().replace("Init Voice","")}`,l++,s="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(h)}).add([66,55],(t,r)=>{e.switchMode("ns5r",!0);let s="",o=88,l=0,f=0,h="MSB	PRG	LSB	NME";G(t,function(c,u){let g=u%126;switch(!0){case g<10:{c>31&&(s+=String.fromCharCode(c));break}case g==11:break;case g==12:break;case g==13:{h+=`
${o}	${l}	${f}	${s.trim().replace("Init Combi","")}`,l++,s="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(h)}).add([66,125],t=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][t[0]]||"white")}).add([76],(t,r,s)=>{e.#R.run([66,...t],r,s)}),this.#X.add([16,0,8,0],(t,r,s)=>{let o=(t[2]<<4)+t[3],l="K11 ";([()=>{e.switchMode("k11",!0),e.#u=!1,e.#w=o?4:0,console.info("MIDI reset: GMega/K11")},()=>{console.debug(`${l}reverb type: ${o}`)},()=>{console.debug(`${l}reverb time: ${o}`)},()=>{console.debug(`${l}reverb time: ${o}`)},()=>{console.debug(`${l}reverb predelay: ${o}`)},()=>{console.debug(`${l}reverb predelay: ${o}`)},()=>{console.debug(`${l}depth high: ${o}`)},()=>{console.debug(`${l}depth high: ${o}`)},()=>{console.debug(`${l}depth low: ${o}`)},()=>{console.debug(`${l}depth low: ${o}`)}][t[0]]||function(){})()}).add([16,0,8,1],(t,r,s)=>{let o=e.chRedir(t[1],r,!0),l=v.cc*o,f=v.rpn*o,h=(t[3]<<4)+t[4],c=`K11 CH${o+1} `;([()=>{h<128?(e.#e[l+d[0]]=0,e.#n[o]=h):(e.#e[l+d[0]]=122,e.#n[o]=h-128)},()=>{let u=e.chRedir(h,r,!0);e.#o[o]=u,o!=u&&(e.buildRchTree(),console.info(`${c}receives from CH${u+1}`))},()=>{e.#e[l+d[7]]=h},()=>{e.#s[o]=h},()=>{e.#e[l+d[10]]=h},()=>{e.#f[f+3]=h+40},()=>{e.#f[f+1]=h>>1,e.#f[f+2]=h&1},()=>{e.#e[l+d[91]]=h?127:0},()=>{},()=>{e.#e[l+d[74]]=h},()=>{e.#e[l+d[73]]=h},()=>{e.#e[l+d[72]]=h}][t[0]]||function(){})()}).add([16,0,9,0],(t,r,s)=>{let o=(t[2]<<4)+t[3],l="GMLX ";([()=>{console.debug(`${l}reverb type: ${o}`)},()=>{console.debug(`${l}reverb time: ${o}`)},()=>{console.debug(`${l}reverb predelay: ${o}`)},()=>{console.debug(`${l}depth high: ${o}`)},()=>{console.debug(`${l}depth low: ${o}`)}][t[0]]||function(){})()}).add([16,0,9,3],(t,r,s)=>{let o=(t[2]<<4)+t[3],l=e.chRedir(t[1],r,!0),f=l*v.cc;[()=>{o<128?(e.#e[f+d[0]]=0,e.#e[f+d[32]]=0,e.#n[l]=o):o<160?(e.#e[f+d[0]]=0,e.#e[f+d[32]]=7,e.#n[l]=o-100):(e.#e[f+d[0]]=122,e.#e[f+d[32]]=0,e.#n[l]=o-160)},()=>{let h=e.chRedir(o,r,!0);e.#o[l]=h,l!=h&&(e.buildRchTree(),console.info(`GMLX CH${l+1} receives from CH${h+1}`))}][t[0]]()}).add([16,0,9,4],(t,r,s)=>{let o=(t[2]<<4)+t[3],l=e.chRedir(t[1],r,!0),f=l*v.cc,h=l*v.rpn,c=`GMLX CH${l+1} `;[()=>{e.#s[l]=o},()=>{e.#e[f+d[7]]=o},()=>{e.#e[f+d[10]]=o},()=>{e.#e[f+d[91]]=o?127:0},()=>{e.#f[h+3]=o+40},()=>{e.#f[h+1]=o},()=>{e.#f[h]=o},()=>{}][t[0]]()}),this.#N.add([66,93,64],(t,r,s)=>{let o=t[2];switch(t[0]){case 0:{switch(t[1]){case 4:{e.#y=o*129/16383*100;break}case 5:{o-64;break}case 6:{console.debug(`SG global reverb: ${o?"on":"off"}`);break}case 127:{e.switchMode("sg",!0);break}}break}case 1:{switch(t[1]){case 48:{console.debug(`SG reverb type: ${se[o]}`);break}}break}default:if(t[0]>>4==1){let l=e.chRedir(t[0]&15,r,!0);if(t[1]==2){let f=e.chRedir(o,r,!0);e.#o[l]=f,l!=f&&(e.buildRchTree(),console.info(`SG CH${l+1} receives from CH${f+1}`))}else t[1]==19&&(e.#e[v.cc*l+d[7]]=o)}else console.warn(`Unknown AKAI SG SysEx: ${t}`)}}),this.#V.add([9],(t,r,s)=>{console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremelo","phaser","rotary speaker","enhancer","flanger","EQ"][t[0]]||"off"}`)})}};var de=et(Oe(),1);var Xe=class{#t=!1;constructor(e,a,n,t){this.#t=e,this.start=a,this.end=n,this.data=t}get duration(){return this.ranged?this.end-this.start:0}get ranged(){return this.#t}},ce=class extends Xe{constructor(e,a,n){super(!0,e,a,n)}},Ne=class extends Xe{constructor(e,a){super(!1,e,e,a)}},fe=class extends Array{#t=-1;constructor(){super(...arguments)}resetIndex(e){this.#t=-1}fresh(){this.sort(function(e,a){return e.start==a.start?0:(+(e.start>a.start)<<1)-1}),this.forEach(function(e,a){e.index=a})}step(e,a=!1){let n=[];if(a)for(let t=0;t<this.length&&!(this[t].start>e);t++){if(this[t].end<e)continue;n.push(this[t])}else{let t=this.getRange(this.#t==-1?0:e-1,e),r=this;t.forEach(function(s){s.index>r.#t&&(n.push(s),r.#t=s.index)})}return n}getRange(e,a){e>a&&([e,a]=[a,e]);let n=[],t=-1,r=Math.ceil(Math.sqrt(this.length)),s=!0;for(let o=0;o<this.length;o+=r)this[o+r]?t<0&&this[o+r].start>=e&&(t=o):t=t<0?o:t;for(;s;)this[t]?.end<a?this[t].start>=e&&n.push(this[t]):s=!1,t++;return n}};var ot=0xffffffffffff,Ve=function(e){let a=new fe,n=this,t=e.timeDivision,r=120,s=new fe,o=0,l=0;s.push(new ce(0,ot,[120,0])),e.track.forEach(function(u){o=0,u.event.forEach(function(g){o+=g.deltaTime,g.type==255&&g?.metaType==81&&(r=6e7/g.data,s[s.length-1]&&s.push(new ce(o,0xffffffffffff,[r,0])))})}),s.fresh(),s.forEach(function(u,g,k){g>0&&(k[g-1].end=u.start)});let f=120;s.forEach(function(u,g,k){g>0&&(u.end==u.start?k.splice(k.indexOf(u),1):f==u.data[0]&&(k[g-1].end=u.end,k.splice(k.indexOf(u),1)),f=u.data[0])});let h=0,c=120;return s.forEach(function(u){let g=u.start,k=g/c/t*60+h;c=u.data[0],h=k-g/c/t*60,u.data[1]=h}),console.debug("All tempo changes: ",s),r=120,o=0,l=0,e.track.forEach(function(u,g){o=0,l=0;let k=g+1;u.event.forEach(function(b,m){o+=b.deltaTime;let p=s.step(o,!0)[0];p&&(r=p.data[0],l=p.data[1]);let y={type:b.type,data:b.data,track:k,part:0};b.type>14?y.meta=b.metaType:y.part=b.channel,a.push(new Ne(o/r/t*60+l,y))})}),a.fresh(),self.midiEvents=a,console.debug(`Parsed a type ${e.formatType} MIDI sequence.`),a};de.default.customInterpreter=function(e,a,n){let t=[],r=n==!1?a.readIntVLV():n;e==0||e==127;for(let s=0;s<r;s++){let o=a.readInt(1);if(t.push(o),o!=247){if(o!=240){if(o>127)return console.debug(`Early termination: ${t}`),t.pop(),a.backOne(),a.backOne(),t}}}return t};var X=class extends _{#t=new Fe;#r;#h="";#l=[];#i=new Uint8ClampedArray(64);#s=.5;#o=120;#e=4;#n=4;#d=0;#g=0;smoothingAtk=0;smoothingDcy=0;reset(){this.dispatchEvent("reset"),this.#r?.resetIndex(),this.#t.init(),this.#h="",this.#s=.5,this.#o=120,this.#e=4,this.#n=4,this.#d=0,this.#g=0}async loadFile(e){this.#r=Ve(de.default.parse(new Uint8Array(await e.arrayBuffer())))}switchMode(e,a=!1){this.#t.switchMode(e,a)}getMode(){return this.#t.getMode()}getVoice(){return this.#t.getVoice(...arguments)}getChVoice(e){return this.#t.getChVoice(e)}get noteProgress(){return this.#g/this.#s}get noteOverall(){return this.noteProgress-this.#d}get noteBar(){return Math.floor(this.noteOverall/this.#e)}get noteBeat(){let e=this.noteOverall%this.#e;return e<0&&(e+=this.#e),e}getTimeSig(){return[this.#e,this.#n]}getTempo(){return this.#o}sendCmd(e){this.#t.runJson(e)}render(e){e>this.#g&&(this.#g=e);let a=this.#r?.step(e)||[],n=0,t=new Set,r=this,s=[];r.#t.newStrength(),a.forEach(function(b){let m=b.data;m.type==9&&(m.data[1]>0?t.add(m.part*128+m.data[0]):t.has(m.part*128+m.data[0])&&n++),b.data.type==8&&t.has(m.part*128+m.data[0])&&n++;let p=r.#t.runJson(m);switch(p?.reply){case"meta":{s.push(p);break}}p?.reply&&delete p.reply});let o=this.#t.getStrength();o.forEach(function(b,m){let p=b-r.#i[m];p>=0?r.#i[m]+=Math.ceil(p-p*r.smoothingAtk):r.#i[m]+=Math.ceil(p-p*r.smoothingDcy)}),s?.length>0&&this.dispatchEvent("meta",s);let l=this.#t.getActive(),f=[],h=r.#t.getPitch(),c=r.#t.getCcAll(),u=r.#t.getProgram(),g=0;return l.forEach(function(b,m){b&&(f[m]=r.#t.getVel(m),g+=f[m].size)}),{extraPoly:n,curPoly:g,chInUse:l,chKeyPr:f,chPitch:h,chProgr:u,chContr:c,eventCount:a.length,title:this.#h,bitmap:this.#t.getBitmap(),letter:this.#t.getLetter(),texts:this.#t.getTexts(),master:this.#t.getMaster(),mode:this.#t.getMode(),strength:this.#i.slice(),velo:o,rpn:this.#t.getRpn(),tSig:this.getTimeSig(),tempo:this.getTempo(),noteBar:this.noteBar,noteBeat:this.noteBeat}}constructor(e=.5,a=.5){super();let n=this;this.smoothingAtk=e,this.smoothingDcy=a,this.addEventListener("meta",function(t){t?.data?.forEach(function(r){(n.#l[r.meta]||console.debug).call(n,r.meta,r.data)})}),this.#t.addEventListener("mode",function(t){n.dispatchEvent("mode",t.data)}),this.#t.addEventListener("channelactive",function(t){n.dispatchEvent("channelactive",t.data)}),this.#t.addEventListener("channelmin",function(t){n.dispatchEvent("channelmin",t.data)}),this.#t.addEventListener("channelmax",function(t){n.dispatchEvent("channelmax",t.data)}),this.#t.addEventListener("channelreset",function(t){n.dispatchEvent("channelreset")}),this.#l[3]=function(t,r){n.#h?.length<1&&(n.#h=r)},this.#l[81]=function(t,r){let s=n.noteProgress,o=n.#s||.5;n.#o=6e7/r,n.#s=r/1e6,n.#d+=s*(o/n.#s)-s},this.#l[88]=function(t,r){let s=n.noteProgress,o=n.noteOverall,l=n.noteBar,f=n.noteBeat,h=n.#e,c=n.#n;n.#e=r[0],n.#n=1<<r[1];let u=24*(32/r[3])/r[2];if(h!=n.#e){let g=l;n.#d-=g*(n.#e-h),f+1>=h&&(h<n.#e?n.#d-=Math.ceil(n.#e-f-1):n.#d+=n.#e)}}}};var ue=new Uint8Array(40),z=0,ge,rr=setInterval(()=>{ge&&(ue[z]=!ue[z],z++,z>34&&(z=0))},1e3/50);Uint8Array.prototype.render=function(e){let a=0,n=0,t=this.width||5,r=this.height||8;for(let s=0;s<this.length;s++)e(this[s],a,n,this),a++,a>=t&&(a=0,n++)};var U=class{#t=[];async loadFile(e){let a=this;console.debug(`Requested font file from "${e}".`),(await(await fetch(e)).text()).split(`
`).forEach(async function(n,t){if(t>0&&n?.length>0){let r=n.split("	"),s=new Uint8Array(40);Array.from(r[1]).forEach(function(o,l){let f=l%2?4:0,h=Math.floor(l/2),c=parseInt(o,16),u=3;for(;c>0||u>=0;){let g=(f+u)*5+h;s[g]=c&1,c=c>>1,u--}}),a.#t[parseInt(r[0],16)]=s}}),ge=!1}constructor(e){ge=!0,this.loadFile(e)}getCP(e){return this.#t[e]}getStr(e){let a=[],n=this;return Array.from(e).forEach(function(t){a.push(n.#t[t.charCodeAt(0)]||n.#t[32]||ue)}),a}},K=class{#t={};async loadFile(e){let a=this;console.debug(`Requested fixed 256 bitmap file from "${e}".`),(await(await fetch(e)).text()).split(`
`).forEach(function(n,t){if(t>0&&n?.length>0){let r=n.split("	");if(r[1][0]!="@"){let s=new Uint8Array(256);Array.from(r[1]).forEach(function(o,l){let f=l*4,h=parseInt(o,16),c=3;for(;h>0||c>=0;){let u=f+c;s[u]=h&1,h=h>>1,c--}}),a.#t[r[0]]=s}else a.#t[r[0]]=a.#t[r[1].slice(1)]}})}constructor(e){this.loadFile(e)}getBm(e){return this.#t[e]?.slice()}},He=class{#t={};async loadFile(e){let a=this;console.debug(`Requested pre-defined bitmap file from "${e}".`),(await(await fetch(e)).text()).split(`
`).forEach(function(n,t){if(t>0&&n?.length>0){let r=n.split("	");if(r[1][0]!="@"){let s=parseInt(r[1].slice(0,4),16),o=parseInt(r[1].slice(4,8),16),l=new Uint8Array(s*o);Array.from(r[1]).slice(8).forEach(function(f,h){let c=h*4,u=parseInt(f,16),g=3;for(;u>0||g>=0;){let k=c+g;k<=l.length&&(l[k]=u&1,u=u>>1),g--}}),l.width=s,l.height=o,a.#t[r[0]]=l}else a.#t[r[0]]=a.#t[r[1].slice(1)]}}),self.mxDef=a}constructor(e){this.loadFile(e)}getBm(e){return this.#t[e]}};var ht=["C~","C#","D~","Eb","E~","F~","F#","G~","Ab","A~","Bb","B~"],ct="!0123456789";var N="0123456789_aAbBcCdDeEfFgGhHiIjJ-kKlLmMnNoOpPqQrRsStTuUvVwWxXyYzZ",ft=["-","~","+","|"],dt={"?":"UnkwnStd",gm:"GnrlMIDI",g2:"GrlMIDI2",xg:"YamahaXG",gs:"RolandGS",mt32:"RlndMT32",ag10:"KorgAG10",x5d:"Korg X5D","05rw":"Korg05RW",ns5r:"KorgNS5R",krs:"KorgKros",k11:"KawaiK11",sg:"AkaiPrSG"},be="#ffaa2264",V="#aaff2264",$e="#b3d8de64",qe="#ff798664";var cr=class extends X{#t=0;constructor(){super(),this.addEventListener("reset",()=>{this.#t=0})}render(e,a){let n=new Array(24),t=super.render(e),r=this,s=Date.now(),o=Math.round(t.tempo*100)/100,l=t.curPoly+t.extraPoly;this.#t<l&&(this.#t=l),n[0]=`${t.eventCount.toString().padStart(3,"0")} ${l.toString().padStart(3,"0")}:${this.#t.toString().padStart(3,"0")}/512 TSig:${t.tSig[0]}/${t.tSig[1]} Bar:${(t.noteBar+1).toString().padStart(3,"0")}/${Math.floor(t.noteBeat)+1} Tempo:${Math.floor(o)}.${Math.floor(o%1*100).toString().padStart(2,"0")} Vol:${Math.floor(t.master.volume)}.${Math.round(t.master.volume%1*100).toString().padStart(2,"0")}%`,n[1]=`Mode:${dt[t.mode]} Title:${t.title||"N/A"}`,n[2]="Ch:VoiceNme#St VEM RCDB PP PiBd Pan : Note";let f=3,h=0;if(t.chInUse.forEach(function(c,u){if(c){h=u;let g=u*d.length;if(f<n.length-5&&u>=(self.minCh||0)){let k=r.getChVoice(u);n[f]=`${(u+1).toString().padStart(2,"0")}:${k.name.slice(0,8).padEnd(8," ")}${k.ending}${k.standard} ${N[t.chContr[g+d[7]]>>1]}${N[t.chContr[g+d[11]]>>1]}${ft[t.chContr[g+d[1]]>>5]} ${N[t.chContr[g+d[91]]>>1]}${N[t.chContr[g+d[93]]>>1]}${N[t.chContr[g+d[94]]>>1]}${N[t.chContr[g+d[74]]>>1]} ${t.chContr[g+d[65]]>63?"O":"X"}${N[t.chContr[g+d[5]]>>1]} ${Se(t.chPitch[u])} ${ke(t.chContr[g+d[10]])}:`,t.chKeyPr[u].forEach(function(b,m){b>0&&(n[f]+=` <span style="opacity:${Math.round(b/1.27)/100}">${ht[m%12]}${ct[Math.floor(m/12)]}</span>`)}),f++}}}),t.texts.length>0){let c=0,u=n.length-1;for(;u>=f;)t.texts[c]?.length&&(n[u]=(t.texts[c]||"").padEnd(100," ")),(t.texts[c]?.length>0||t.texts[c]?.length==null)&&u--,c++}if(s<=t.letter.expire){let c=t.letter.text.padEnd(32," "),u=n.length-2;for(let g=0;g<2;g++)n[g+u]=`${(n[g+u]||"").slice(0,82).padEnd(81," ")} <span class="letter"> ${c.slice(g*16,g*16+16).padEnd(" ",16)} </span>`}if(a){a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="#202020";let c;s<=t.bitmap.expire?c=t.bitmap.bitmap:(c=new Array(256),h<16?t.strength.forEach(function(u,g){if(g<16){let k=u>>4;for(let b=0;b<=k;b++)c[g+(15-b)*16]=1}}):t.strength.forEach(function(u,g){if(g<32){let k=u>>5;for(let b=0;b<=k;b++)c[g+((g>15?6:15)-b)*16]=1}})),c.forEach(function(u,g){u&&a.fillRect((g&15)*12,(g>>4)*6,11,5)})}return n.join("<br/>")}},B="#0000000b",P="#00000068",D=8,W=7,Z=4,ut=3,pe=function(e,a,n){let t=D*4-1,r=Z*1.5-1,s=e>>4;for(let o=0;o<8;o++){s>=0?n.fillStyle=P:n.fillStyle=B,s--;let l=7-o;n.fillRect(a,181+l*D,t,r)}},gt=Math.PI*255/180,pt=Math.PI*285/180,me=function(e,a,n){let t=D*4-1,r=Z*1.5-1,s=e>>4;for(let o=0;o<8;o++){s>=0?n.strokeStyle=P:n.strokeStyle=B,s--;let l=7-o;n.beginPath(),n.arc(a,256,(9-l)*D,gt,pt),n.lineWidth=r,n.stroke()}};CanvasRenderingContext2D.prototype.radial=function(e,a,n,t,r){let s=n-1.5707963267948966,o=Math.sin(s),l=Math.cos(s);this.beginPath(),this.moveTo(e+o*t,a+l*t),this.lineTo(e+o*r,a+l*r),this.stroke()};var fr=class extends X{#t=new Uint8Array(1360);#r=new Uint8Array(200);#h=new Uint8Array(256);#l=0;#i=0;#s=0;#o=0;#e=0;#n=new Uint8Array(7);xgFont=new U("./data/bitmaps/xg/font.tsv");sysBm=new K("./data/bitmaps/xg/system.tsv");voxBm=new K("./data/bitmaps/xg/voices.tsv");constructor(){super();let e=this;this.addEventListener("mode",function(a){(e.sysBm.getBm(`st_${{gm:"gm1",g2:"gm2","?":"gm1",ns5r:"korg",ag10:"korg",x5d:"korg","05rw":"korg",krs:"korg",sg:"gm1",k11:"gm1"}[a.data]||a.data}`)||[]).forEach(function(n,t){e.#h[t]=n}),e.#l=2,e.#i=Date.now()+1600}),this.addEventListener("channelactive",a=>{this.#s=a.data}),this.addEventListener("channelmin",a=>{a.data>=0&&(this.#o=a.data+1)}),this.addEventListener("channelmax",a=>{a.data>this.#o-1?this.#e=a.data+1:(this.#o=0,this.#e=0)}),this.addEventListener("channelreset",()=>{this.#o=0,this.#e=0})}setCh(e){this.#s=e}getCh(){return this.#s}reset(){super.reset(),this.#o=0,this.#e=0}render(e,a){let n=super.render(e),t=this,r=Date.now();a.fillStyle=V,a.fillRect(0,0,a.canvas.width,a.canvas.height),this.#t.forEach((m,p,y)=>{y[p]=0}),this.#r.forEach((m,p,y)=>{y[p]=0});let s=!1,o=0,l=0;n.chInUse.forEach(function(m,p){m&&(s||(s=!0,o=p),l=p)}),o=o>>4<<4,l=(l>>4<<4)+15,this.#s>l&&(this.#s=o+this.#s&15),this.#s<o&&(this.#s=l-15+(this.#s&15)),this.#o&&this.#o>0&&(o=this.#o-1),this.#e&&this.#e<=128&&(l=this.#e-1);let h=this.#s*d.length,c=Math.ceil(Math.log2(l-o+1)-4),u=0,g=!n.chContr[h+d[0]];if(r<=n.letter.expire&&n.letter.text.length>0)t.xgFont.getStr(n.letter.text.padEnd(32," ")).forEach(function(m,p){let y=p%16*5+5,$=Math.floor(p/16)*8;m.forEach(function(w,E){let S=E%5,M=Math.floor(E/5);t.#t[($+M)*85+y+S]=w})});else{t.#t[1275]=1,t.#t[1276]=1,t.#t[1278]=1,t.#t[1279]=1;for(let m=o;m<=l;m++){let p=n.strength[m];if(c?p=p>>5:p=p>>4,c==0||c==1)for(let y=0;y<=p;y++){let $=5+u*3+(15-y)*85-Math.floor(u/2);t.#t[$]=1,t.#t[$+1]=1}else for(let y=0;y<=p;y++){let $=5+u*3+(15-y)*85-Math.floor(u/2);u>31&&($-=760),t.#t[$]=1,t.#t[$+1]=1}u++}if(c<2){let m=t.getChVoice(this.#s).name.slice(0,8).padEnd(8," "),p=(n.chContr[h+d[0]]==64?"SFX":n.chContr[h+d[0]]||n.chContr[h+d[32]]||0).toString().padStart(3,"0");t.getMode()=="xg"&&[80,81,82,83,96,97,98,99].indexOf(n.chContr[h+d[0]])>-1&&(p=`${n.chContr[h+d[32]]||0}`.padStart(3,"0"),g=!0);let y=`\x80${p}\x81${((n.chProgr[this.#s]||0)+1).toString().padStart(3,"0")}`;t.xgFont.getStr(y+m).forEach(function(w,E){let S=0,M=0;c==1?S=E*5:c||(S=E%8*5+45,M=8-Math.floor(E/8)*8),w.forEach(function(C,x){let T=x%5,R=Math.floor(x/5);c==1&&E>7&&(T=T+5),t.#t[(M+R)*85+S+T]=C})})}}for(let m=0;m<1360;m++){let p=m%85,y=Math.floor(m/85);a.fillStyle=B,t.#t[m]&&(a.fillStyle=P),a.fillRect(16+(p+Math.floor(p/5))*D,12+y*D,W,W)}a.textAlign="center",a.font='12px "Arial Web"';{let m=71.5;for(let p=-2;p<32;p++){a.fillStyle=P,p+o==this.#s&&(a.fillStyle=B);let y="";p>=0?y=(p+1).toString().padStart(2,"0"):y=`A${p+3}`,a.fillText(y,m+24*p,150)}}a.fillStyle=g?B:P,a.fillText("MSB",515,164),a.fillStyle=g?P:B,a.fillText("LSB",564,164),a.fillStyle=P,a.fillText("BANK",467.5,164),a.fillText("PRG#",660,164),a.fillText("CHANNEL     SEC     PART",118,254),a.fillText("VOL",420,254),a.fillText("EXP",468,254),a.fillText("BRT",516,254),a.fillText("REV",648,254),a.fillText("CHO",696.5,254),a.fillText("VAR",745,254),a.fillText("KEY",801,254),a.fillText("PAN",583,254),t.xgFont.getStr(`${(this.#s+1).toString().padStart(2,"0")}${"ABCD"[this.#s>>4]}${(this.#s%16+1).toString().padStart(2,"0")}`).forEach(function(m,p){let y=p*5;m.forEach(function($,w){let E=w%5,S=Math.floor(w/5);t.#r[S*25+y+E]=$})});for(let m=0;m<200;m++){let p=m%25,y=Math.floor(m/25);a.fillStyle=B,t.#r[m]&&(a.fillStyle=P),a.fillRect(16+(p+Math.floor(p/5))*D,180+y*D,W,W)}let k;if(r<=n.bitmap.expire)k=n.bitmap.bitmap;else if(k=this.#h.slice(),r>=this.#i){this.#l=0;let m=t.getChVoice(this.#s).standard.toLowerCase();k=this.voxBm.getBm(t.getChVoice(this.#s).name)||this.voxBm.getBm(t.getVoice(n.chContr[h]+d[0],n.chProgr[this.#s],0,n.mode).name),["an","ap","dr","dx","pc","pf","sg","vl"].indexOf(m)>-1&&(k=this.sysBm.getBm(`plg_${m}`)),!k&&(n.chContr[h+d[0]]<48||n.chContr[h+d[0]]==56)&&(k=this.voxBm.getBm(t.getVoice(0,n.chProgr[this.#s],0,n.mode).name)),!k&&n.chContr[h]+d[0]==126&&(k=this.sysBm.getBm("cat_smpl")),!k&&n.chContr[h]+d[0]==64&&(k=this.sysBm.getBm("cat_sfx")),k||(k=this.sysBm.getBm("no_abm"))}else this.#l==2&&k.forEach((m,p,y)=>{let $=Math.floor((this.#i-r)/400);y[p]=$%2==m});for(let m=0;m<256;m++){let p=m%16,y=Math.floor(m/16);a.fillStyle=B,k[m]&&(a.fillStyle=P),a.fillRect(260+p*D,180+y*Z,W,ut)}pe(n.chContr[h+d[7]],404,a),pe(n.chContr[h+d[11]],452,a),pe(n.chContr[h+d[74]],500,a),me(n.chContr[h+d[91]],648,a),me(n.chContr[h+d[93]],696,a),me(n.chContr[h+d[94]],744,a),a.beginPath(),a.arc(582,216,34,2.356194490192345,7.068583470577034),a.lineWidth=2,a.strokeStyle="#000f",a.stroke();let b=n.chContr[h+d[10]];this.#n.forEach((m,p,y)=>{y[p]=0}),b==0?this.#n[0]=1:b==64?this.#n[3]=1:b==128?(this.#n[1]=1,this.#n[5]=1):b<64?this.#n[Math.floor(b/21)]=1:this.#n[4+Math.floor((b-65)/21)]=1,a.lineWidth=Z;for(let m=0;m<7;m++)a.strokeStyle=B,this.#n[m]&&(a.strokeStyle=P),a.radial(582,216,[7.068583470577034,6.283185307179586,5.497787143782138,4.71238898038469,3.9269908169872414,3.141592653589793,2.356194490192345][m],8,26)}},q=7,j=6,Ye=31,mt=12,bt=29,$t=10,yt=q*(17+2),wt=q*(7+3)+1,dr=class extends X{#t=new Uint8Array(665);#r=new Uint8Array(735);#h=new Uint8Array(256);#l=new Uint8Array(64);#i=new Uint8Array(64);#s=0;xgFont=new U("./data/bitmaps/korg/font.tsv");constructor(){super()}setCh(e){this.#s=e}getCh(){return this.#s}render(e,a){let n=super.render(e),t=this,r=Date.now();a.fillStyle=be,a.fillRect(0,0,a.canvas.width,a.canvas.height);let s=22,o=24,l=!1,f=0,h=0;n.chInUse.forEach(function(S,M){S&&(l||(l=!0,f=M),h=M)}),f=f>>4<<4,h=(h>>4<<4)+15,this.#s>h&&(this.#s=f+this.#s&15),this.#s<f&&(this.#s=h-15+(this.#s&15));let u=this.#s*d.length;this.#t.forEach((S,M,C)=>{C[M]=0});let g,k=n.letter.text.trim();for(;k.indexOf("  ")>-1;)k=k.replaceAll("  "," ");if(r<=n.letter.expire){g=k;let S=n.letter.text,M=S.length-S.trimLeft().length,C=S.length-S.trimRight().length;if(S.length>g.length&&g.length<16&&M>0){for(;g.length<15;)g=` ${g} `;g.length<16&&(M<C?g=` ${g}`:g=`${g} `)}let x=0;if(g.length>16){x=Math.floor((n.letter.expire-r)/33)-96;let T=(g.length-16)*-6;x<T?x=T:x>0&&(x=0)}this.xgFont.getStr(g).forEach(function(T,R){T.forEach(function(L,ye){let J=R*6+ye%5+x,ze=Math.floor(ye/5);J>=0&&J<95&&(t.#t[ze*95+J]=L)})})}else g=`${n.chProgr[this.#s]+1}`.padStart(3,"0"),g+=" ",g+=t.getChVoice(this.#s).name.slice(0,12).padEnd(12," "),this.xgFont.getStr(g).forEach(function(S,M){S.forEach(function(C,x){let T=M*6+x%5,R=Math.floor(x/5);t.#t[R*95+T]=C})});this.#t.forEach(function(S,M){a.fillStyle=B,S&&(a.fillStyle=P);let C=M%95,x=Math.floor(M/95);a.fillRect(s+133+C*q,o+x*q,j,j)}),this.#r.forEach((S,M,C)=>{C[M]=0});let b="";b+=`${"ABCD"[this.#s>>4]}${(this.#s%16+1).toString().padStart(2,"0")}`,b+=n.chContr[u+d[7]].toString().padStart(3," "),b+=n.chContr[u+d[91]].toString().padStart(3," ");let m=n.chPitch[this.#s]/8192*n.rpn[this.#s*6]+(n.rpn[this.#s*6+3]-64);m<0?b+="-":b+="+",b+=Math.round(m<0?Math.abs(m):m).toString().padStart(2,"0");let p=n.chContr[u+d[10]];p==64?b+="C  ":p==128?b+="RND":(p>64?b+="R":b+="L",b+=Math.abs(p-64).toString().padStart(2," ")),b+=n.chContr[u+d[93]].toString().padStart(3," "),b+=(n.chContr[u+d[0]]||n.chContr[u+d[32]]).toString().padStart(3,"0"),this.xgFont.getStr(b).forEach(function(S,M){S.forEach(function(C,x){let T=Math.floor(M/3)*90+M*5+x%5,R=Math.floor(x/5);R<7&&(t.#r[R*15+T]=C)})}),this.#r.forEach(function(S,M){a.fillStyle=B,S&&(a.fillStyle=P);let C=M>419?1:0,x=0,T=M%15+Math.floor(M%15/5),R=Math.floor(M%105/15);C?x=Math.floor((M-315)/105):x=Math.floor(M/105),a.fillRect(s+yt*C+T*q,o+wt*x+R*q,j,j)}),this.#h.forEach((S,M,C)=>{C[M]=0});let y=Math.ceil(Math.log2(h-f+1)-4),$=0;n.velo.forEach(function(S,M){if(S>=t.#l[M])t.#l[M]=S;else{let C=t.#l[M]-S;t.#l[M]-=C/8}if(S>=t.#i[M])t.#i[M]=S;else{let C=t.#i[M]-2;C<0&&(C=0),t.#i[M]=C}});let w=this.#h;if(r<=n.bitmap.expire)w=n.bitmap.bitmap;else{let S=0;for(let M=f;M<=h;M++){let C=S>>4,x=this.#l[M]>>4+y,T=this.#i[M]>>4+y;if(y==2){let R=4*(3-C);for(let L=3-x;L<4;L++)this.#h[S%16+(L+R)*16]=1}else if(y==1){let R=8*(1-C);for(let L=7-x;L<8;L++)this.#h[S%16+(L+R)*16]=1;this.#h[S%16+(7-T+R)*16]=1}else{for(let R=15-x;R<16;R++)this.#h[S%16+R*16]=1;this.#h[S+(15-T)*16]=1}S++}}w.forEach(function(S,M){a.fillStyle=B,S&&(a.fillStyle=P);let C=M%16,x=Math.floor(M/16);a.fillRect(s+302+C*Ye,o+71+x*mt,bt,$t)}),a.fillStyle="#000c",a.textAlign="left",a.font='16px "Arial Web"',a.fillText("PART",21,20),a.fillText("INSTRUMENT",154,20),a.fillText("LEVEL",21,91),a.fillText("PAN",154,91),a.fillText("REVERB",21,162),a.fillText("CHORUS",154,162),a.fillText("KEY SHIFT",21,233),a.fillText("BANK",154,233),a.textAlign="right",a.fillText("SB",274,233),a.textAlign="center";for(let S=1;S<=16;S++)a.fillText(`${S}`.padStart(2,"0"),308+Ye*S,300);a.lineWidth=1,a.strokeStyle="#000c";let E=2*Math.PI;for(let S=0;S<16;S++){let M=S%8;a.beginPath(),M?M==4?(a.ellipse(316,(15-S)*12+100,3,3,0,0,E),a.fill()):(a.ellipse(316,(15-S)*12+100,2,2,0,0,E),a.stroke()):(a.ellipse(316,(15-S)*12+100,4,4,0,0,E),a.fill())}n.chContr[u+d[0]]?a.fillStyle=P:a.fillStyle=B,a.fillText("M",236,233),n.chContr[u+d[0]]?a.fillStyle=B:a.fillStyle=P,a.fillText("L",248,233)}},ur=class extends X{#t=new Uint8Array(5760);#r=new Uint8Array(5760);#h="?";#l=new Uint8Array(64);#i=0;#s;#o=!0;xgFont=new U("./data/bitmaps/xg/font.tsv");trueFont=new U("./data/bitmaps/korg/font.tsv");constructor(){super(),this.#s=$e,this.addEventListener("mode",e=>{this.#s={gs:be,mt32:be,xg:V,ns5r:V,x5d:V,ag10:qe,"05rw":V,k11:V,gmlx:V,sg01:qe}[e.data]||$e,this.#h=e.data,this.#o=!0})}setCh(e){this.#i=e}getCh(){return this.#i}#e(e,a){for(let t=0;t<180;t++){let r=t%12,s=Math.floor(t/12);s==0&&r<11||s==14&&r>0||s==13?this.#r[s*144+r+e]=1:s>0&&s<13&&(r==0||r>9||r==5&&s>1&&s<12)&&(this.#r[s*144+r+e]=1)}let n=a>>4;for(let t=0;t<21;t++){let r=t%7,s=Math.floor(t/7),o=s+(9-n);s!=1||r==0||r==6?this.#r[o*144+r+e+2]=1:this.#r[o*144+r+e+2]=0}}#n(e,a,n){let t=7,r=40;for(let s=0;s<r;s++){let o=Math.PI*s*2/r,l=t*Math.sin(o),f=Math.sign(l)*Math.round(Math.abs(l)),h=t*Math.cos(o),c=Math.sign(h)*Math.round(Math.abs(h));this.#r[(c+a)*144+f+e]=1}if(n<128){let s=Math.floor(n/9.85)*22.5,o=5,l=Math.PI*(315-s)/180,f=Math.sin(l),h=Math.cos(l);for(let c=0;c<=o;c++){let u=Math.round(c*f),g=Math.round(c*h);this.#r[(g+a)*144+u+e]=1}}else this.#r[a*144+e]=1}render(e,a,n){let t=super.render(e),r=this,s=Date.now(),o=!1,l=0,f=0;t.chInUse.forEach(function($,w){$&&(o||(o=!0,l=w),f=w)}),l=l>>4<<4,f=(f>>4<<4)+15,this.#i>f&&(this.#i=l+this.#i&15),this.#i<l&&(this.#i=f-15+(this.#i&15));let c=this.#i*d.length;this.#r.forEach(($,w,E)=>{E[w]=0});let u=n?this.trueFont:this.xgFont;u.getStr(`${"ABCD"[this.#i>>4]}${((this.#i&15)+1).toString().padStart(2,"0")}`).forEach(($,w)=>{let E=w*6+1;$.forEach((S,M)=>{let C=M%5,x=Math.floor(M/5);this.#r[x*144+E+C]=S})});let g=t.chPitch[this.#i]/8192*t.rpn[this.#i*6]+(t.rpn[this.#i*6+3]-64);u.getStr(`${"+-"[+(g<0)]}${Math.round(Math.abs(g)).toString().padStart(2,"0")}`).forEach(($,w)=>{let E=w*6+1;$.forEach((S,M)=>{let C=M%5,x=Math.floor(M/5)+8;this.#r[x*144+E+C]=S})});let k=r.getChVoice(this.#i),b=k.sect;for(let $=0;$<225;$++){let w=$%25,E=Math.floor($/25)+15;this.#r[E*144+w]=1}u.getStr(b).forEach(($,w)=>{let E=w*6+1;$.forEach((S,M)=>{let C=M%5,x=Math.floor(M/5)+16;S&&(this.#r[x*144+E+C]=0)})});let m=k.name.slice(0,10).padEnd(10," ");u.getStr(`:${(t.chProgr[this.#i]+1).toString().padStart(3,"0")} ${m}`).forEach(($,w)=>{let E=w*6+25;$.forEach((S,M)=>{let C=M%5,x=Math.floor(M/5)+16;this.#r[x*144+E+C]=S})}),u.getStr(`${this.#i+1}`.padStart(2,"0")).forEach(($,w)=>{let E=w*6;$.forEach((S,M)=>{let C=M%5,x=Math.floor(M/5)+32;this.#r[x*144+E+C]=S})}),t.velo.forEach(($,w)=>{if($>=this.#l[w]){let E=$-this.#l[w];this.#l[w]+=Math.ceil(E*.8)}else{let E=this.#l[w]-$;this.#l[w]-=Math.ceil(E/10)}});let p=22;if(f>31&&(p=43),this.#l.forEach(($,w)=>{if(!(f<32&&w>31))for(let E=Math.floor($/p);E>=0;E--){let S=w%32*4+12,M=(w>31?32:39)-E;this.#r[M*144+S]=1,this.#r[M*144+S+1]=1,this.#r[M*144+S+2]=1}}),u.getStr(n?"Fx A:001Rev/Cho":"FxA:001Rev/Cho").forEach(($,w)=>{let E=n?8:7,S=w%E*6+(n?95:102),M=Math.floor(w/E)*8;$.forEach((C,x)=>{let T=x%5,R=Math.floor(x/5)+M;this.#r[R*144+S+T]=C})}),s<t.letter.expire){let $=19+ +n*3;for(let w=0;w<2e3;w++){let E=w%100,S=Math.floor(w/100);(S==0&&E<99||S==18||S==19&&E>0)&&(this.#r[S*144+E+$]=1),S>0&&S<18&&(this.#r[S*144+E+$]=+(E<1||E>97))}u.getStr(t.letter.text).forEach((w,E)=>{let S=E%16*6+$+2,M=Math.floor(E/16)*8+2;w.forEach((C,x)=>{let T=x%5,R=Math.floor(x/5)+M;this.#r[R*144+S+T]=C})})}else{let $=n?2:0;this.#e(20+$,t.chContr[c+d[7]]),this.#e(33+$,t.chContr[c+d[11]]),this.#n(53+ +n+$,7,t.chContr[c+d[10]]),this.#e(62+2*+n+$,t.chContr[c+d[91]]),this.#e(75+2*+n+$,t.chContr[c+d[93]]),n||this.#e(88,t.chContr[c+d[74]])}if(s<t.bitmap.expire){for(let w=0;w<777;w++){let E=w%37,S=Math.floor(w/37),M=E+77+ +n,C=S+19;(S==0&&E<36||S==19||S==20&&E>0)&&(this.#r[C*144+M]=1),S>0&&S<19&&(this.#r[C*144+M]=+(E<1||E>34))}let $=t.bitmap.bitmap.length==512?1:2;for(let w=0;w<512;w+=$){let E=w&31,S=w>>5,M=E+79+ +n,C=S+21;this.#r[C*144+M]=t.bitmap.bitmap[w/$],$==2&&(this.#r[C*144+M+1]=t.bitmap.bitmap[w/$])}}let y=!1;if(this.#o){a.fillStyle=this.#s.replace("64",""),a.fillRect(0,0,a.canvas.width,a.canvas.height),a.textAlign="center",a.font='11px "Arial Web"',a.fillStyle="#000e",a.fillText("MIDI. CH",58,10),a.fillText("VOL",153.5,10),a.fillText("EXP",231.5,10),a.fillText("PAN",322.5,10),a.fillText("REV",405,10),a.fillText("CHO",484,10),a.fillText("BRT",561.5,10),a.fillText("EFFECT TYPE",738,10),a.fillText("PART",34,262);let $=2*Math.PI;for(let w=1;w<33;w++)w==1||w==32||w%5==0?a.fillText(`${w}`,24*w+58,262):(a.beginPath(),a.ellipse(24*w+58,258,2,2,0,0,$),a.fill());y=!0,this.#o=!1}this.#r.forEach(($,w)=>{let E=w%144,S=Math.floor(w/144),M=this.#t[w]!=$;!y&&M&&(a.fillStyle=this.#s.slice(0,7),a.fillRect(6*E+1,12+6*S,6,6)),(y||M)&&(a.fillStyle=["#0000001a","#0000009f"][$],y&&(a.fillStyle=a.fillStyle.slice(0,7)),a.fillRect(6*E+1,12+6*S,5.5,5.5))}),this.#r.forEach(($,w)=>{this.#t[w]!=$&&(this.#t[w]=$)})}},gr=class extends X{#t=new Uint8Array(8192);#r=new Uint8Array(8192);#h="?";#l=new Uint8Array(64);#i=0;#s=!0;#o=$e;#e=0;#n=0;#d=new Uint8Array(256);songTitle="";xgFont=new U("./data/bitmaps/xg/font.tsv");sqrFont=new U("./data/bitmaps/xg/qySqr.tsv");qy35Font=new U("./data/bitmaps/xg/qyCh35.tsv");qy55Font=new U("./data/bitmaps/xg/qyCh55.tsv");qyRsrc=new He("./data/bitmaps/xg/qyRsrc.tsv");sysBm=new K("./data/bitmaps/xg/system.tsv");voxBm=new K("./data/bitmaps/xg/voices.tsv");constructor(){super(0,.95);let e=this;this.addEventListener("mode",function(a){(e.sysBm.getBm(`st_${{gm:"gm1",g2:"gm2","?":"gm1",ns5r:"korg",ag10:"korg",x5d:"korg","05rw":"korg",krs:"korg",sg:"gm1",k11:"gm1"}[a.data]||a.data}`)||[]).forEach(function(n,t){e.#d[t]=n}),e.#e=2,e.#n=Date.now()+1600})}setCh(e){this.#i=e}getCh(){return this.#i}#g(e,a,n,t){let r=n*t,s=e+a*128;for(let o=0;o<r;o++){let l=o%n,f=Math.floor(o/n);(l==0&&f<t-1||f==0&&l<n-1||l==n-1&&f>0||f==t-1&&l>0||l==n-2)&&(this.#r[s+l+f*128]=1)}}#a(e,a,n,t,r=1){let s=n*t,o=e+a*128;for(let l=0;l<s;l++){let f=l%n,h=Math.floor(l/n);this.#r[o+f+h*128]=r}}#b(e,a,n,t,r=1){let s=!r,o=e+a*128,l=n*t;for(let f=0;f<l;f++){let h=f%n,c=Math.floor(f/n);h==0&&c>0&&n%2==0||(s=!s),this.#r[o+h+c*128]=+s}}#m(e,a,n){let t=this.getChVoice(e),r;if(["GM","AG","XG","GS","G2"].indexOf(t.standard)>-1)switch(a){case 64:{r="sfx";break}case 120:case 122:case 126:case 127:{r="dr";break}default:r=(n>>3).toString(16)}else r=t.standard,r=`${r[0]}${r[1].toLowerCase()}`;return r}render(e,a,n,t=0){let r=super.render(e),s=this,o=Date.now(),l=!1,f=0,h=0;r.chInUse.forEach(function(k,b){k&&(l||(l=!0,f=b),h=b)}),f=f>>4<<4,h=(h>>4<<4)+15,this.#i>h&&(this.#i=f+this.#i&15),this.#i<f&&(this.#i=h-15+(this.#i&15));let u=this.#i*d.length;if(this.#r.forEach((k,b,m)=>{m[b]=0}),n){s.qyRsrc.getBm("MixPill")?.render((y,$,w)=>{y&&(s.#r[$+w*128]=1)}),s.qyRsrc.getBm("MixIcon")?.render((y,$,w)=>{y&&(s.#r[10+$+w*128]=1)}),s.qyRsrc.getBm("MsVoice")?.render((y,$,w)=>{s.#r[2176+$+w*128]=y}),s.qyRsrc.getBm("ElPan")?.render((y,$,w)=>{s.#r[4096+$+w*128]=y}),s.qyRsrc.getBm("ElVol")?.render((y,$,w)=>{s.#r[4864+$+w*128]=y}),s.qyRsrc.getBm("ElMsPa")?.render((y,$,w)=>{s.#r[5634+$+w*128]=y}),s.#b(0,50,5,14,1),s.#a(5,50,1,14),s.#b(7,50,10,14,0),s.#a(10,52,1,10),s.#a(11,52,1,10,0),s.#a(17,50,1,14),s.#b(19,50,10,14,0),s.#a(22,52,1,10),s.#a(23,52,1,10,0);let k=9-Math.floor(r.master.volume/10.1);s.qyRsrc.getBm("VolSlid")?.render((y,$,w)=>{s.#r[7+$+(50+k+w)*128]=y}),s.#a(8,53+k,8,1),s.qyRsrc.getBm("VolSlid")?.render((y,$,w)=>{s.#r[6419+$+w*128]=y}),s.#a(20,53,8,1),s.#a(29,24,1,40);let b=s.getChVoice(this.#i);s.xgFont.getStr(`${(r.chProgr[this.#i]+1).toString().padStart(3,"0")}${"+ "[+(["GM","MT","AG"].indexOf(b.standard)>-1||r.chContr[u]>=120)]}${b.name.slice(0,8)}`).forEach((y,$)=>{y.render((w,E,S)=>{s.#r[55+E+$*6+S*128]=w})});let m=s.#m(this.#i,r.chContr[this.#i*d.length],r.chProgr[this.#i]),p=s.qyRsrc.getBm(`Vox_${m}`);p?p.render((y,$,w)=>{s.#r[37+$+w*128]=y}):s.xgFont.getStr(m).forEach((y,$)=>{y.render((w,E,S)=>{s.#r[37+E+$*6+S*128]=w})})}else{if(s.qyRsrc.getBm("NorPill")?.render((b,m,p)=>{b&&(s.#r[m+p*128]=1)}),s.xgFont.getStr("SONG").forEach((b,m)=>{b.render((p,y,$)=>{p&&(s.#r[5+y+m*6+$*128]=0)})}),s.#g(34,6,65,11),s.#a(35,7,13,9),s.#g(100,6,28,11),r.letter.expire<o){if(s.xgFont.getStr(`${t+1}`.padStart(2,"0")).forEach((b,m)=>{b.render((p,y,$)=>{p&&(s.#r[1060+y+m*6+$*128]=0)})}),s.songTitle.length<9)s.xgFont.getStr(s.songTitle||"Unknown").forEach((b,m)=>{b.render((p,y,$)=>{s.#r[1073+y+m*6+$*128]=p})});else{let b=s.songTitle;for(;b.indexOf("  ")>-1;)b=b.replaceAll("  "," ");let m=Math.floor(e*25)%(6*(10+b.length))-47;s.xgFont.getStr(`${b}  ${b.slice(0,8)}`).forEach((p,y)=>{p.render(($,w,E)=>{let S=w+y*6,M=m;m<0&&(M=m>=-48?0:m+48),S>=M&&S<M+47&&(s.#r[1073-M+S+E*128]=$)})})}{let b=r.noteBeat%1;s.sqrFont.getStr(`${"$%"[+(b>0&&b<=.25)]}${(r.noteBar+1).toString().padStart(3,"0")}`).forEach((m,p)=>{m.render((y,$,w)=>{s.#r[1126+$+p*6+w*128]=y})})}}s.sqrFont.getStr(`&=${Math.round(r.tempo).toString().padStart(3,"0")}`).forEach((b,m)=>{b.render((p,y,$)=>{s.#r[2048+y+m*6+$*128]=p})}),s.xgFont.getStr(`${r.tSig[0].toString().padStart(2," ")}/${r.tSig[1].toString().padEnd(2," ")}`).forEach((b,m)=>{b.render((p,y,$)=>{s.#r[3072+y+m*6+$*128]=p})}),s.qyRsrc.getBm("Vtfj")?.render((b,m,p)=>{s.#r[2338+m+p*128]=b});{let b=r.chPitch[this.#i]/8192*r.rpn[this.#i*6]+(r.rpn[this.#i*6+3]-64),m=b<0?"-":"+";m+=`${Math.round(Math.abs(b))}`.padStart(2,"0"),s.xgFont.getStr(m).forEach((p,y)=>{p.render(($,w,E)=>{s.#r[3127+w+y*6+E*128]=$})})}s.xgFont.getStr("001").forEach((b,m)=>{b.render((p,y,$)=>{s.#r[3181+y+m*6+$*128]=p})}),s.#a(71,48,1,16),s.qyRsrc.getBm("Mod_Usr")?.render((b,m,p)=>{s.#r[6253+m+p*128]=b});{let b=s.getChVoice(this.#i);s.xgFont.getStr(`${r.chContr[u+d[0]].toString().padStart(3,"0")} ${r.chProgr[this.#i].toString().padStart(3,"0")} ${r.chContr[u+d[32]].toString().padStart(3,"0")}`).forEach((m,p)=>{m.render((y,$,w)=>{s.#r[6145+6*p+$+w*128]=y})}),s.xgFont.getStr(`${b.standard}:${b.name.slice(0,8)}`).forEach((m,p)=>{m.render((y,$,w)=>{s.#r[7169+6*p+$+w*128]=y})})}let k;if(o<=r.bitmap.expire)k=r.bitmap.bitmap;else if(k=this.#d.slice(),o>=this.#n){this.#e=0;let b=s.getChVoice(this.#i).standard.toLowerCase();k=this.voxBm.getBm(s.getChVoice(this.#i).name)||this.voxBm.getBm(s.getVoice(r.chContr[u]+d[0],r.chProgr[this.#i],0,r.mode).name),["an","ap","dr","dx","pc","pf","sg","vl"].indexOf(b)>-1&&(k=this.sysBm.getBm(`plg_${b}`)),!k&&(r.chContr[u+d[0]]<48||r.chContr[u+d[0]]==56)&&(k=this.voxBm.getBm(s.getVoice(0,r.chProgr[this.#i],0,r.mode).name)),!k&&r.chContr[u]+d[0]==126&&(k=this.sysBm.getBm("cat_smpl")),!k&&r.chContr[u]+d[0]==64&&(k=this.sysBm.getBm("cat_sfx")),k||(k=this.sysBm.getBm("no_abm"))}else this.#e==2&&k.forEach((b,m,p)=>{let y=Math.floor((this.#n-o)/400);p[m]=y%2==b});k.width=k.length/16,k?.render((b,m,p)=>{k.width<32?(s.#r[6217+2*m+p*128]=b,s.#r[6218+2*m+p*128]=b):s.#r[6217+m+p*128]=b})}{let k=this.#i>>3,b=n?1310:4254,m=n?10:33;n?(s.#a(28,m-1,99,15),s.#a(29,m,97,13,0)):s.#g(0,m-1,128,15),k<h>>3&&s.qyRsrc.getBm(`ArrowR${+n+1}`)?.render((p,y,$)=>{s.#r[b+735+y+$*128]=p}),k>f>>3&&s.qyRsrc.getBm(`ArrowL${+n+1}`)?.render((p,y,$)=>{s.#r[b+610+ +n*27+y+$*128]=p}),n||(s.qyRsrc.getBm("PtCdTm")?.render((p,y,$)=>{s.#r[4227+y+$*128]=p}),r.tempo!=120&&s.qyRsrc.getBm("ActPill")?.render((p,y,$)=>{s.#r[5141+y+$*128]=p}));for(let p=0;p<8;p++){let y=k*8+p,$=1;s.qyRsrc.getBm("CTabOff")?.render((E,S,M)=>{s.#r[b+12*p+S+M*128]=E});let w=Math.floor(r.strength[y]/51);if(s.#a(31+12*p,m+11-w,9,w+1),this.#i==y&&($=0,s.#a(31+12*p,m,9,5),n&&s.#a(30+12*p,m+14,13,8)),y<19?s.qy55Font.getStr(String.fromCharCode(48+y))[0].render((E,S,M)=>{E&&(s.#r[b+3+12*p+S+M*128]=$)}):s.qy35Font.getStr((y+1).toString()).forEach((E,S)=>{E.render((M,C,x)=>{M&&(s.#r[b+2+4*S+12*p+C+x*128]=$)})}),n){s.#b(31+p*12,32,10,32,0),s.#a(41+p*12,32,1,32),s.#a(34+p*12,43,1,18),s.#a(35+p*12,45,1,16,0),s.#a(31+p*12,63,10,1),s.qyRsrc.getBm("PanIcon")?.render((C,x,T)=>{s.#r[4255+p*12+x+T*128]=C});let E=15-(r.chContr[y*d.length+d[7]]>>3);s.qyRsrc.getBm("VolSlid")?.render((C,x,T)=>{s.#r[5535+p*12+x+(E+T)*128]=C}),s.#a(32+p*12,46+E,8,1);let S=s.#m(y,r.chContr[y*d.length],r.chProgr[y]),M=s.qyRsrc.getBm(`Vox_${S}`);M?M.render((C,x,T)=>{C&&(s.#r[3103+p*12+x+T*128]=$)}):s.xgFont.getStr(S).forEach((C,x)=>{C.render((T,R,L)=>{T&&(s.#r[3103+p*12+R+x*6+L*128]=$)})})}}}o<=r.letter.expire&&(s.qyRsrc.getBm("TxtDisp")?.render((k,b,m)=>{s.#r[(n?655:1036)+b+m*128]=k}),s.xgFont.getStr(r.letter.text).forEach((k,b)=>{let m=b%16*6,p=b>>4;k.render((y,$,w)=>{s.#r[(n?1686:2067)+m+$+(w+p*8)*128]=y})}));let g=!1;this.#s&&(a.fillStyle=this.#o.replace("64",""),a.fillRect(0,0,a.canvas.width,a.canvas.height),g=!0,this.#s=!1),this.#r.forEach((k,b)=>{let m=b%128,p=Math.floor(b/128),y=this.#t[b]!=k;!g&&y&&(a.fillStyle=this.#o.slice(0,7),a.fillRect(6*m+7,7+8*p,6,8)),(g||y)&&(a.fillStyle=["#0000001a","#0000009f"][k],g&&(a.fillStyle=a.fillStyle.slice(0,7)),a.fillRect(6*m+7,7+8*p,5.5,7.5))}),this.#r.forEach((k,b)=>{this.#t[b]!=k&&(this.#t[b]=k)})}},pr=class extends X{#t=0;#r="#b7bfaf64";xgFont=new U("./data/bitmaps/korg/font.tsv");constructor(){super()}setCh(e){this.#t=e}getCh(){return this.#t}#h(e,a,n,t,r=1,s=1,o=-.15){let l=[new Path2D,new Path2D("M36 160 L48 148 L144 148 L156 160 L144 172 L48 172 Z"),new Path2D("M32 156 L20 144 L20 48 L32 36 L44 48 L44 144 Z"),new Path2D("M32 284 L20 272 L20 176 L32 164 L44 176 L44 272 Z"),new Path2D("M156 288 L144 300 L48 300 L36 288 L48 276 L144 276 Z"),new Path2D("M160 164 L172 176 L172 272 L160 284 L148 272 L148 176 Z"),new Path2D("M160 36 L172 48 L172 144 L160 156 L148 144 L148 48 Z"),new Path2D("M36 32 L48 20 L144 20 L156 32 L144 44 L48 44 Z")],f={0:new Uint8Array([0,0,1,1,1,1,1,1]),1:new Uint8Array([0,0,0,0,0,1,1,0]),2:new Uint8Array([0,1,0,1,1,0,1,1]),3:new Uint8Array([0,1,0,0,1,1,1,1]),4:new Uint8Array([0,1,1,0,0,1,1,0]),5:new Uint8Array([0,1,1,0,1,1,0,1]),6:new Uint8Array([0,1,1,1,1,1,0,1]),7:new Uint8Array([0,0,1,0,0,1,1,1]),8:new Uint8Array([0,1,1,1,1,1,1,1]),9:new Uint8Array([0,1,1,0,1,1,1,1])," ":new Uint8Array(8),A:new Uint8Array([0,1,1,1,0,1,1,1]),B:new Uint8Array([0,1,1,1,1,1,0,0]),C:new Uint8Array([0,0,1,1,1,0,0,1]),D:new Uint8Array([0,1,0,1,1,1,1,0]),"-":new Uint8Array([0,1,0,0,0,0,0,0])};a.setTransform(r,0,o,s,190*i+n,t),Array.from(e).forEach((h,c)=>{for(let u=0;u<8;u++)a.fillStyle=f[h][u]?P:B,a.fill(l[u])}),a.resetTransform()}#l(e,a,n,t,r=8,s=8,o=-.15){a.setTransform(r,0,o,s,0,0),upthis.xgFont.getStr(e).forEach((l,f)=>{l.render((h,c,u)=>{a.fillStyle=h?P:B,a.fillRect(offestX+c,t+u,r-1,s-1)})}),a.resetTransform()}render(e,a,n="white",t,r=0){let s=super.render(e),o=this,l=Date.now();a.fillStyle=this.#r,a.fillRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="#000c",a.textAlign="left",a.font='23px "Arial Web"',a.fillText("MEASURE",664,296);let f=new Path2D("M83 23 L49 23 L49 86 L83 86 M264 23 L297 23 L297 86 L264 86"),h=new Path2D("M30 110 L344 110 M356 110 L1074 110 M30 146 L344 146 M356 146 L1074 146 M30 182 L344 182 M356 182 L1074 182 M30 218 L344 218 M356 218 L1074 218 M30 254 L344 254 M356 254 L775 254 M894 254 L1074 254");a.strokeStyle="#000c",a.stroke(f),a.stroke(h),a.setTransform(.14,0,0,-.14,356,218),a.fill(new Path2D("M376 262c4 0 9 1 13 1c155 0 256 -128 256 -261c0 -76 -33 -154 -107 -210c-22 -17 -47 -28 -73 -36c3 -35 5 -70 5 -105c0 -19 -1 -39 -2 -58c-7 -120 -90 -228 -208 -228c-108 0 -195 88 -195 197c0 58 53 103 112 103c54 0 95 -47 95 -103c0 -52 -43 -95 -95 -95 c-11 0 -21 2 -31 6c26 -39 68 -65 117 -65c96 0 157 92 163 191c1 18 2 37 2 55c0 31 -1 61 -4 92c-29 -5 -58 -8 -89 -8c-188 0 -333 172 -333 374c0 177 131 306 248 441c-19 62 -37 125 -45 190c-6 52 -7 104 -7 156c0 115 55 224 149 292c3 2 7 3 10 3c4 0 7 0 10 -3 c71 -84 133 -245 133 -358c0 -143 -86 -255 -180 -364c21 -68 39 -138 56 -207zM461 -203c68 24 113 95 113 164c0 90 -66 179 -173 190c24 -116 46 -231 60 -354zM74 28c0 -135 129 -247 264 -247c28 0 55 2 82 6c-14 127 -37 245 -63 364c-79 -8 -124 -61 -124 -119 c0 -44 25 -91 81 -123c5 -5 7 -10 7 -15c0 -11 -10 -22 -22 -22c-3 0 -6 1 -9 2c-80 43 -117 115 -117 185c0 88 58 174 160 197c-14 58 -29 117 -46 175c-107 -121 -213 -243 -213 -403zM408 1045c-99 -48 -162 -149 -162 -259c0 -74 18 -133 36 -194 c80 97 146 198 146 324c0 55 -4 79 -20 129z")),a.setTransform(.14,0,0,-.14,32,146),a.fill(new Path2D("M557 -125c0 28 23 51 51 51s51 -23 51 -51s-23 -51 -51 -51s-51 23 -51 51zM557 125c0 28 23 51 51 51s51 -23 51 -51s-23 -51 -51 -51s-51 23 -51 51zM232 263c172 0 293 -88 293 -251c0 -263 -263 -414 -516 -521c-3 -3 -6 -4 -9 -4c-7 0 -13 6 -13 13c0 3 1 6 4 9 c202 118 412 265 412 493c0 120 -63 235 -171 235c-74 0 -129 -54 -154 -126c11 5 22 8 34 8c55 0 100 -45 100 -100c0 -58 -44 -106 -100 -106c-60 0 -112 47 -112 106c0 133 102 244 232 244z")),a.resetTransform(),this.#h(`${r+1}`.padStart(3,"0"),a,112,15,.24),this.#h(s.noteBar,a,821,245,.17),this.#l(o.songTitle||"Unknown",a,441,32)}};export{fr as MuDisplay,ur as Ns5rDisplay,pr as PsrDisplay,gr as QyDisplay,dr as ScDisplay,cr as TuiDisplay};
