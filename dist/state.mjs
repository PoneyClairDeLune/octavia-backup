var x=function(t,e){let i=Math.min(t.length,e.length),n=t.slice(0,i),h=e.slice(0,i),s=0,a=0;for(;a<i&&s==0;)s=Math.sign(n[a]-h[a]),a++;return s},f=function(){this.pool=[],this.point=function(t,e=!1){if(this.pool.length>0){let i=this.pool.length,n=1<<Math.floor(Math.log2(i)),h=n,s=64;for(;n>=1&&s>=0;){if(s<=0)throw new Error("TTL reached.");if(h==i)h-=n;else{let l=x(t,this.pool[h]);switch(l){case 0:{s=0;break}case 1:{h+n<=i&&(h+=n);break}case-1:{h!=0&&(h-=n);break}default:console.warn(`Unexpected result ${l}.`)}}n=n>>1,s--}let a=!0;if(h>=this.pool.length)a=!1;else{let l=this;this.pool[h].forEach(function(d,g,u){a&&d!=t[g]&&(a=!1)}),!a&&x(t,this.pool[h])>0&&h++}return a||e?h:-1}else return e?0:-1},this.add=function(t,e){return t.data=e,this.pool.splice(this.point(t,!0),0,t),this},this.default=function(t){console.warn(`No match for "${t}". Default action not defined.`)},this.get=function(t){let e=this.point(t);if(e>-1)return this.pool[e].data;this.default(t)},this.run=function(t,...e){let i=this.point(t);i>-1?this.pool[i].data(t.slice(this.pool[i].length),...e):this.default(t,...e)}};var v=class{#t={};addEventListener(t,e){this.#t[t]||(this.#t[t]=[]),this.#t[t].unshift(e)}removeEventListener(t,e){if(this.#t[t]){let i=this.#t[t].indexOf(e);i>-1&&this.#t[t].splice(i,1),this.#t[t].length<1&&delete this.#t[t]}}dispatchEvent(t,e){let i=new Event(t),n=this;i.data=e,this.#t[t]?.length>0&&this.#t[t].forEach(function(h){h?.call(n,i)}),this[`on${t}`]&&this[`on${t}`](i)}};var y=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]);var U=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],w=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],C=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],A=function(t){let e=.1,i=-.3;return t>66?(e=5,i=315):t>56?(e=1,i=47):t>46&&(e=.5,i=18.5),e*t-i},T=function(t){return t>105?U[t-106]:t>100?t*1.1-100:t/10};var p=function(t=64){return Math.round(2e3*Math.log10(t/64))/100},I=function(t){let e=0;return t.forEach(i=>{e+=i,e>127&&(e%=128)}),128-e};var k=["?","gm","gs","xg","g2","mt32","ns5r","ag10","x5d","05rw","krs","k11","sg"],O=[[0,0,0,0,121,0,0,56,82,81,63,0,0],[0,0,1,0,0,127,0,0,0,0,0,0,0]],b=[120,127,120,127,120,127,61,62,62,62,120,122,127],P=[0,3,81,84,88],S={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},E={0:0,1:1,2:3,5:4},R=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],D=[36,37];var M=[0,1,2,4,5,6,7,8,10,11,32,38,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,84,91,92,93,94,95,98,99,100,101,12,13,16,17,18,19],N=[33,99,100,32,102,8,9,10],$={};k.forEach((t,e)=>{$[t]=e});var o={length:M.length};M.forEach((t,e)=>{o[t]=e});var c=function(t,e,i){i[e]=0},G=function(t){let e=[[]];return t?.forEach(function(i){i==247||(i==240?e.push([]):e[e.length-1].push(i))}),e},L=function(t,e="",i="",n=2){return t?`${e}${t.toString().padStart(n,"0")}${i}`:""},r={ch:128,cc:M.length,nn:128,pl:512,tr:256,rpn:6},se=class extends v{#t=0;#d=0;#g=0;#p=new Array(10);get#f(){return this.#p[this.#d]}set#f(t){this.#p[this.#d]=t}#$=new Uint8Array(r.ch);#L=new Uint8Array(r.ch);#e=new Uint8ClampedArray(r.ch*r.cc);#A=new Uint8ClampedArray(r.ch);#h=new Uint8ClampedArray(r.ch*r.nn);#U=new Uint8Array(r.ch);#s=new Uint16Array(r.pl);#E=new Int16Array(r.ch);#T=new Array(r.ch);#c=new Uint8Array(r.ch);#k=0;#r=new Uint8Array(r.ch*r.rpn);#I=new Int8Array(r.ch*D.length);#M=0;#x=0;#b=100;#l=0;#a="";#v=0;#n=!1;#P;#i=[];#w=new Uint8Array(r.ch);#m=new Uint8Array(r.tr);chRedir(t,e,i){if(this.#m[e])return(this.#m[e]-1)*16+t;if([$.gs,$.ns5r].indexOf(this.#t)>-1){if(i==1)return t;let n=0,h=!0;for(;h;)this.#w[t+n]==0?(this.#w[t+n]=e,console.debug(`Assign track ${e} to channel ${t+n+1}.`),h=!1):this.#w[t+n]==e?h=!1:(n+=16,n>=128&&(n=0,h=!1));return t+n}else return t}#o=[];#O;#u={ano:t=>{this.#s.forEach((e,i,n)=>{let h=e>>7;e==0&&this.#h[0]==0||h==t&&(this.#h[e]=0,n[i]=0)})}};#N={8:function(t){let i=t.channel*128+t.data[0],n=this.#s.indexOf(i);n>-1&&(this.#s[n]=0,this.#h[i]=0)},9:function(t){let e=t.channel;this.#$[e]=1;let i=e*128+t.data[0];if(t.data[1]>0){let n=0;for(;this.#s[n]>0;)n++;n<this.#s.length?(this.#s[n]=i,this.#h[i]=t.data[1],this.#c[e]<t.data[1]&&(this.#c[e]=t.data[1])):console.error("Polyphony exceeded.")}else{let n=this.#s.indexOf(i);n>-1&&(this.#s[n]=0,this.#h[i]=0)}},10:function(t){let i=t.channel*128+t.data[0];this.#s.indexOf(i)>-1&&(this.#h[i]=data[1])},11:function(t){let e=t.channel;this.#$[e]=1;let i=e*r.cc;switch(t.data[0]){case 96:return;case 97:return;case 120:return;case 121:{this.#u.ano(e),this.#E[e]=0;let n=e*r.cc;this.#e[n+o[1]]=0,this.#e[n+o[5]]=0,this.#e[n+o[64]]=0,this.#e[n+o[65]]=0,this.#e[n+o[66]]=0,this.#e[n+o[67]]=0,this.#e[n+o[11]]=127,this.#e[n+o[101]]=127,this.#e[n+o[100]]=127,this.#e[n+o[99]]=127,this.#e[n+o[98]]=127;return}case 123:{this.#u.ano(e);return}case 124:{this.#u.ano(e);return}case 125:{this.#u.ano(e);return}case 126:{this.#U[e]=1,this.#u.ano(e);return}case 127:{this.#U[e]=0,this.#u.ano(e);return}}if(o[t.data[0]]==null)console.warn(`cc${t.data[0]} is not accepted.`);else{switch(t.data[0]){case 0:{if(this.#t==0)t.data[1]<48?(this.#e[i]>119&&(t.data[1]=this.#e[i],t.data[1]=120,console.debug(`Forced channel ${e+1} to stay drums.`)),t.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${t.data[1]}`),this.switchMode("gs"))):t.data[1]==62?this.switchMode("x5d"):t.data[1]==63&&this.switchMode("krs");else if(this.#t==$.gs)t.data[1]<56&&this.#e[i]>119&&(t.data[1]=this.#e[i],t.data[1]=120,console.debug(`Forced channel ${e+1} to stay drums.`));else if(this.#t==$.gm)t.data[1]<48&&this.#e[i]>119&&(t.data[1]=120,this.switchMode("gs",!0),console.debug(`Forced channel ${e+1} to stay drums.`));else if(this.#t==$.x5d){if(t.data[1]>0&&t.data[1]<8)this.switchMode("05rw",!0);else if(t.data[1]==56){let n=0;for(let h=0;h<16;h++){let s=this.#e[r.cc*h];(s==56||s==62)&&n++}n>14&&this.switchMode("ag10",!0)}}break}case 6:{if(this.#k){let n=this.#e[i+o[99]],h=this.#e[i+o[98]];if(n==1){let s=N.indexOf(h);if(s>-1)this.#e[i+o[71+s]]=t.data[1];else{let a=D.indexOf(h);a>-1&&(this.#I[e*10+a]=t.data[1]-64),console.debug(`CH${e+1} voice NRPN ${h} commit`)}}}else{let n=E[this.#e[i+o[100]]];this.#e[i+o[101]]==0&&n!=null&&(console.debug(`CH${e+1} RPN 0 ${this.#e[i+o[100]]} commit: ${t.data[1]}`),t.data[1]=Math.min(Math.max(t.data[1],R[n][0]),R[n][1]),this.#r[e*r.rpn+n]=t.data[1])}break}case 38:{this.#k||this.#e[i+101]==0&&E[this.#e[i+100]]!=null&&(this.#r[e*r.rpn+E[this.#e[i+100]]+1]=t.data[1]);break}case 98:case 99:{this.#k=1;break}case 100:case 101:{this.#k=0;break}}this.#e[i+o[t.data[0]]]=t.data[1]}},12:function(t){let e=t.channel;this.#$[e]=1,this.#A[e]=t.data,this.#T[e]=0},13:function(t){let e=this,i=t.channel;this.#s.forEach(function(n){let h=n>>7;i==h&&(e.#h[n]=t.data)})},14:function(t){let e=t.channel;this.#E[e]=t.data[1]*128+t.data[0]-8192},15:function(t){G(t.data).forEach(e=>{let i=e[0],n=e[1];(this.#X[i]||function(){console.debug(`Unknown manufacturer ${i}.`)})(n,e.slice(2),t.track)})},255:function(t){if((this.#o[t.meta]||function(i,n,h){}).call(this,t.data,t.track,t.meta),t.meta!=32&&(this.#l=0),P.indexOf(t.meta)>-1)return t.reply="meta",t;self.debugMode&&console.debug(t)}};#X={64:(t,e,i)=>{this.#D.run(e,i,t)},65:(t,e,i)=>{if(e[0]<64)this.#y.run(e,i,t);else{let n=e.pop(),h=I(e.slice(2));n==h?this.#y.run(e,i,t):console.warn(`Bad GS checksum ${n}. Should be ${h}.`)}},66:(t,e,i)=>{this.#G.run(e,i,t)},67:(t,e,i)=>{this.#C.run(e,i,t)},68:(t,e,i)=>{this.#B.run(e,i,t)},71:(t,e,i)=>{this.#F.run(e,i,t)},126:(t,e,i)=>{this.#S.run(e,i,t)},127:(t,e,i)=>{this.switchMode("gm"),this.#R.run(e,i,t)}};#S;#R;#C;#y;#G;#D;#F;#B;buildRchTree(){let t=[];this.#L.forEach((e,i)=>{t[e]?.constructor||(t[e]=[]),t[e].push(i)}),this.#P=t}getActive(){let t=this.#$.slice();return this.#t==$.mt32,t}getCc(t){let e=t*r.cc,i=this.#e.slice(e,e+r.cc);return i[o[0]]=i[o[0]]||this.#M,i[o[32]]=i[o[32]]||this.#x,i}getCcAll(){let t=this.#e.slice();for(let e=0;e<64;e++){let i=e*r.cc;t[i+o[0]]=t[i+o[0]]||this.#M,t[i+o[32]]=t[i+o[32]]||this.#x}return t}getPitch(){return this.#E}getProgram(){return this.#A}getTexts(){return this.#i.slice()}getVel(t){let e=new Map,i=this;return this.#s.forEach(function(n){let h=Math.floor(n/128),s=n%128;t==h&&i.#h[n]>0&&e.set(s,i.#h[n])}),e}getBitmap(){return{bitmap:this.#f,expire:this.#g}}getCustomNames(){return this.#T.slice()}getLetter(){return{text:this.#a,expire:this.#v}}getMode(){return k[this.#t]}getMaster(){return{volume:this.#b}}getRawStrength(){let t=this;return this.#s.forEach(function(e){let i=Math.floor(e/128);t.#h[e]>t.#c[i]&&(t.#c[i]=t.#h[e])}),this.#c}getStrength(){let t=[],e=this;return this.getRawStrength().forEach(function(i,n){t[n]=Math.floor(i*e.#e[n*r.cc+o[7]]*e.#e[n*r.cc+o[11]]*e.#b/803288)}),t}getRpn(){return this.#r}getNrpn(){return this.#I}init(t=0){this.dispatchEvent("mode","?"),this.#t=0,this.#M=0,this.#x=0,this.#l=0,this.#$.forEach(c),this.#e.forEach(c),this.#A.forEach(c),this.#h.forEach(c),this.#s.forEach(c),this.#c.forEach(c),this.#E.forEach(c),this.#I.forEach(c),this.#b=100,this.#i=[],this.#v=0,this.#a="",this.#g=0,this.#d=0,this.#f.forEach(c),this.#T.forEach(c),this.#n=!1,this.#L.forEach(function(e,i,n){n[i]=i}),this.buildRchTree(),this.#w.forEach(c),this.#m.forEach(c),this.#e[r.cc*9]=b[0],this.#e[r.cc*25]=b[0],this.#e[r.cc*41]=b[0],this.#e[r.cc*57]=b[0];for(let e=0;e<64;e++){let i=e*r.cc;this.#e[i+o[7]]=100,this.#e[i+o[11]]=127,this.#e[i+o[10]]=64,this.#e[i+o[71]]=64,this.#e[i+o[72]]=64,this.#e[i+o[73]]=64,this.#e[i+o[74]]=64,this.#e[i+o[75]]=64,this.#e[i+o[76]]=64,this.#e[i+o[77]]=64,this.#e[i+o[78]]=64,this.#e[i+o[91]]=40,this.#e[i+o[101]]=127,this.#e[i+o[100]]=127,this.#e[i+o[99]]=127,this.#e[i+o[98]]=127;let n=e*r.rpn;this.#r[n]=2,this.#r[n+1]=64,this.#r[n+2]=0,this.#r[n+3]=64,this.#r[n+4]=0,this.#r[n+5]=0}}switchMode(t,e=!1){let i=k.indexOf(t);if(i>-1){if(this.#t==0||e){this.#t=i,this.#d=0,this.#M=O[0][i],this.#x=O[1][i];for(let n=0;n<64;n++)b.indexOf(this.#e[n*r.cc])>-1&&(this.#e[n*r.cc]=b[i]);this.dispatchEvent("mode",t)}}else throw new Error(`Unknown mode ${t}`)}newStrength(){this.#c.forEach(c)}runJson(t){if(t.type>14)return this.#N[t.type].call(this,t);{let e=this.chRedir(t.part,t.track),i=!1;this.#P[e]?.forEach(n=>{t.channel=n,i=!0,this.#N[t.type].call(this,t)}),i||console.warn(`${S[t.type]?S[t.type]:t.type}${[11,12].includes(t.type)?(t.data[0]!=null?t.data[0]:t.data).toString():""} event sent to CH${e+1} without any recipient.`)}}runRaw(t){}constructor(){super();let t=this;this.#f=new Uint8Array(256),this.#O=new f,this.#o[1]=function(e){switch(e.slice(0,2)){case"@I":{this.#n=!0,this.#i.unshift(`Kar.Info: ${e.slice(2)}`);break}case"@K":{this.#n=!0,this.#i.unshift("Karaoke mode active."),console.debug(`Karaoke mode active: ${e.slice(2)}`);break}case"@L":{this.#n=!0,this.#i.unshift(`Language: ${e.slice(2)}`);break}case"@T":{this.#n=!0,this.#i.unshift(`Ka.Title: ${e.slice(2)}`);break}case"@V":{this.#n=!0,this.#i.unshift(`Kara.Ver: ${e.slice(2)}`);break}default:this.#n?e[0]=="\\"?this.#i.unshift(`@ ${e.slice(1)}`):e[0]=="/"?this.#i.unshift(e.slice(1)):this.#i[0]+=e:(this.#i[0]=e,this.#i.unshift(""))}},this.#o[2]=function(e){this.#i.unshift(`Copyrite: ${e}`)},this.#o[3]=function(e,i){i<1&&this.#l<1&&this.#i.unshift(`TrkTitle: ${e}`)},this.#o[4]=function(e,i){i<1&&this.#l<1&&this.#i.unshift(`${L(this.#l,""," ")}Instrmnt: ${e}`)},this.#o[5]=function(e){e.trim()==""?this.#i.unshift(""):this.#i[0]+=`${e}`},this.#o[6]=function(e){this.#i.unshift(`${L(this.#l,""," ")}C.Marker: ${e}`)},this.#o[7]=function(e){this.#i.unshift(`CuePoint: ${e}`)},this.#o[32]=function(e){this.#l=e[0]+1},this.#o[33]=function(e,i){console.debug(`Track ${i} requests to get assigned to output ${e}.`),t.#m[i]=e+1},this.#o[127]=function(e,i){t.#O.run(e,i)},this.#O.add([67,0,1],function(e,i){t.#m[i]=e[0]+1}),this.#S=new f,this.#R=new f,this.#C=new f,this.#y=new f,this.#G=new f,this.#D=new f,this.#F=new f,this.#B=new f,this.#S.add([9],e=>{t.switchMode(["gm","?","g2"][e[0]-1],!0),t.#n=t.#n||!1,console.info(`MIDI reset: ${["GM","Init","GM2"][e[0]-1]}`),e[0]==2&&t.init()}),this.#y.add([22,18,127,0,0,1],()=>{t.switchMode("mt32",!0),t.#n=!1,console.info("MIDI reset: MT-32")}).add([66,18,64,0,127,0],()=>{t.switchMode("gs",!0),t.#e[r.cc*9]=120,t.#e[r.cc*25]=120,t.#e[r.cc*41]=120,t.#e[r.cc*57]=120,t.#n=!1,t.#w.forEach(c),console.info("MIDI reset: GS")}),this.#D.add([16,0,8,0,0,0,0],()=>{t.switchMode("k11",!0),t.#n=!1,console.info("MIDI reset: KAWAI GMega/K11")}),this.#R.add([4,1],e=>{t.#b=((e[1]<<7)+e[0])/16383*100}).add([4,3],e=>((e[1]<<7)+e[0]-8192)/8192).add([4,4],e=>e[1]-64),this.#C.add([76,0,0],e=>{switch(e[0]){case 126:{t.switchMode("xg",!0),t.#n=!1,console.info("MIDI reset: XG");break}default:{let i=[0,0,0,0],n=(h,s)=>{i[s]=h};if(e.slice(1).forEach((h,s)=>{let a=s+e[0];[n,n,n,n,l=>{this.#b=l*129/16383*100},l=>{},l=>{}][a](h,s)}),e[0]<4){let h=0;i.forEach(s=>{h=h<<4,h+=s}),h-=1024}}}}).add([76,2,1],e=>{let i="XG ";e[0]<32?(i+="reverb ",e.slice(1).forEach((n,h)=>{([s=>{console.debug(`${i}main type: ${y[s]}`)},s=>{console.debug(`${i}sub type: ${s+1}`)},s=>{console.debug(`${i}time: ${A(s)}s`)},s=>{console.debug(`${i}diffusion: ${s}`)},s=>{console.debug(`${i}initial delay: ${s}`)},s=>{console.debug(`${i}HPF cutoff: ${w[s]}Hz`)},s=>{console.debug(`${i}LPF cutoff: ${w[s]}Hz`)},s=>{console.debug(`${i}width: ${s}`)},s=>{console.debug(`${i}height: ${s}`)},s=>{console.debug(`${i}depth: ${s}`)},s=>{console.debug(`${i}wall type: ${s}`)},s=>{console.debug(`${i}dry/wet: ${s}`)},s=>{console.debug(`${i}send: ${p(s)}dB`)},s=>{console.debug(`${i}pan: ${s-64}`)},!1,!1,s=>{console.debug(`${i}delay: ${s}`)},s=>{console.debug(`${i}density: ${s}`)},s=>{console.debug(`${i}balance: ${s}`)},s=>{},s=>{console.debug(`${i}feedback: ${s}`)},s=>{}][e[0]+h]||function(){console.warn(`Unknown XG reverb address: ${e[0]}.`)})(n)})):e[0]<64?(i+="chorus ",e.slice(1).forEach((n,h)=>{([s=>{console.debug(`${i}main type: ${y[s]}`)},s=>{console.debug(`${i}sub type: ${s+1}`)},s=>{console.debug(`${i}LFO: ${C[s]}Hz`)},s=>{},s=>{console.debug(`${i}feedback: ${s}`)},s=>{console.debug(`${i}delay offset: ${T(s)}ms`)},s=>{},s=>{console.debug(`${i}low: ${w[s]}Hz`)},s=>{console.debug(`${i}low: ${s-64}dB`)},s=>{console.debug(`${i}high: ${w[s]}Hz`)},s=>{console.debug(`${i}high: ${s-64}dB`)},s=>{console.debug(`${i}dry/wet: ${s}`)},s=>{console.debug(`${i}send: ${p(s)}dB`)},s=>{console.debug(`${i}pan: ${s-64}`)},s=>{console.debug(`${i}to reverb: ${p(s)}dB`)},!1,s=>{},s=>{},s=>{},s=>{console.debug(`${i}LFO phase diff: ${(s-64)*3}deg`)},s=>{console.debug(`${i}input mode: ${s?"stereo":"mono"}`)},s=>{}][e[0]-32+h]||function(){console.warn(`Unknown XG chorus address: ${e[0]}.`)})(n)})):e[0]<86?(i+="variation ",e[0]==64&&console.debug(`${i}type: ${y[e[1]]}${e[2]>0?" "+(e[2]+1):""}`)):e[0]<97?(i+="variation ",e.slice(1).forEach((n,h)=>{[s=>{console.debug(`${i}return: ${p(s)}dB`)},s=>{console.debug(`${i}pan: ${s-64}`)},s=>{console.debug(`${i}to reverb: ${p(s)}dB`)},s=>{console.debug(`${i}to chorus: ${p(s)}dB`)},s=>{console.debug(`${i}connection: ${s?"system":"insertion"}`)},s=>{console.debug(`${i}channel: CH${s+1}`)},s=>{console.debug(`${i}mod wheel: ${s-64}`)},s=>{console.debug(`${i}bend wheel: ${s-64}`)},s=>{console.debug(`${i}channel after touch: ${s-64}`)},s=>{console.debug(`${i}AC1: ${s-64}`)},s=>{console.debug(`${i}AC2: ${s-64}`)}][e[0]-86+h](n)})):e[0]>111&&e[0]<118?i+="variation ":console.warn(`Unknown XG variation address: ${e[0]}`)}).add([76,2,64],e=>{}).add([76,3],e=>{}).add([76,6,0],e=>{let i=e[0];t.#a=" ".repeat(i),t.#v=Date.now()+3200,e.slice(1).forEach(function(n){t.#a+=String.fromCharCode(n)}),t.#a=t.#a.padEnd(32," ")}).add([76,7,0],e=>{let i=e[0];t.#g=Date.now()+3200,t.#f.fill(0);let n=e.slice(1);for(let h=0;h<i;h++)n.unshift(0);n.forEach(function(h,s){let a=Math.floor(s/16),l=s%16,d=(l*3+a)*7,g=7,u=0;for(d-=l*5,a==2&&(g=2);u<g;)t.#f[d+u]=h>>6-u&1,u++})}).add([76,8],(e,i)=>{}).add([76,10],e=>{}).add([76,16],e=>{}).add([76,17,0,0],e=>{}).add([112],e=>{console.debug(`XG plugin PLG100-${["VL","SG","DX"][e[0]]} enabled for channel ${e[2]+1}.`)}),this.#C.add([76,48],e=>{}).add([76,49],e=>{}).add([76,50],e=>{}).add([76,51],e=>{}),this.#y.add([69,18,16],e=>{switch(e[0]){case 0:{t.#v=Date.now()+3200;let i=e[1];t.#a=" ".repeat(i),e.slice(2).forEach(function(n){n<128&&(t.#a+=String.fromCharCode(n))});break}case 32:{t.#g=Date.now()+3200,e[1]==0&&(t.#d=Math.max(Math.min(e[2]-1,9),0));break}default:if(e[0]<11){t.#g=Date.now()+3200,t.#p[e[0]-1]?.length||(t.#p[e[0]-1]=new Uint8Array(256));let i=t.#p[e[0]-1],n=e[1];i.fill(0);let h=e.slice(2);for(let s=0;s<n;s++)h.unshift(0);h.forEach(function(s,a){let l=Math.floor(a/16),d=a%16,g=(d*4+l)*5,u=5,m=0;for(g-=d*4,l==3&&(u=1);m<u;)i[g+m]=s>>4-m&1,m++})}else console.warn(`Unknown GS display section: ${e[0]}`)}})}};export{se as OctaviaDevice,r as allocated,o as ccToPos};
