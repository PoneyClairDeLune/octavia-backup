var v=function(s,t){let i=Math.min(s.length,t.length),o=s.slice(0,i),a=t.slice(0,i),n=0,h=0;for(;h<i&&n==0;)n=Math.sign(o[h]-a[h]),h++;return n},$=function(){this.pool=[],this.point=function(s,t=!1){if(this.pool.length>0){let i=this.pool.length,o=1<<Math.floor(Math.log2(i)),a=o,n=64;for(;o>=1&&n>=0;){if(n<=0)throw new Error("TTL reached.");if(a==i)a-=o;else{let f=v(s,this.pool[a]);switch(f){case 0:{n=0;break}case 1:{a+o<=i&&(a+=o);break}case-1:{a!=0&&(a-=o);break}default:console.warn(`Unexpected result ${f}.`)}}o=o>>1,n--}let h=!0;if(a>=this.pool.length)h=!1;else{let f=this;this.pool[a].forEach(function(c,g,b){h&&c!=s[g]&&(h=!1)}),!h&&v(s,this.pool[a])>0&&a++}return h||t?a:-1}else return t?0:-1},this.add=function(s,t){return s.data=t,this.pool.splice(this.point(s,!0),0,s),this},this.default=function(s){console.warn(`No match for "${s}". Default action not defined.`)},this.get=function(s){let t=this.point(s);if(t>-1)return this.pool[t].data;this.default(s)},this.run=function(s,...t){let i=this.point(s);i>-1?this.pool[i].data(s.slice(this.pool[i].length),...t):this.default(s,...t)}};var C=class{#t={};addEventListener(s,t){this.#t[s]||(this.#t[s]=[]),this.#t[s].unshift(t)}removeEventListener(s,t){if(this.#t[s]){let i=this.#t[s].indexOf(t);i>-1&&this.#t[s].splice(i,1),this.#t[s].length<1&&delete this.#t[s]}}dispatchEvent(s,t){let i=new Event(s),o=this;i.data=t,this.#t[s]?.length>0&&this.#t[s].forEach(function(a){a?.call(o,i)}),this[`on${s}`]&&this[`on${s}`](i)}};var m=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),T=["melodic","drum","drum set 1","drum set 2","drum set 3","drum set 4"],F=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],y=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],S=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],A=function(s){let t=.1,i=-.3;return s>66?(t=5,i=315):s>56?(t=1,i=47):s>46&&(t=.5,i=18.5),t*s-i},G=function(s){return s>105?F[s-106]:s>100?s*1.1-100:s/10};var O=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],I=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],R=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var u=function(s=64){return Math.round(2e3*Math.log10(s/64))/100},U=function(s){let t=0;return s.forEach(i=>{t+=i,t>127&&(t%=128)}),128-t};var M=["?","gm","gs","xg","g2","mt32","ns5r","ag10","x5d","05rw","krs","k11","sg"],D=[[0,0,0,0,121,0,0,56,82,81,63,0,0],[0,0,1,0,0,127,0,0,0,0,0,0,0]],w=[120,127,120,127,120,127,61,62,62,62,120,122,127],X=[0,3,81,84,88],P={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},k={0:0,1:1,2:3,5:4},L=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],B=[36,37];var x=[0,1,2,4,5,6,7,8,10,11,32,38,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,84,91,92,93,94,95,98,99,100,101,12,13,16,17,18,19],H=[33,99,100,32,102,8,9,10],p={};M.forEach((s,t)=>{p[s]=t});var l={length:x.length};x.forEach((s,t)=>{l[s]=t});var d=function(s,t,i){i[t]=0},q=function(s){let t=[[]];return s?.forEach(function(i){i==247||(i==240?t.push([]):t[t.length-1].push(i))}),t},N=function(s,t="",i="",o=2){return s?`${t}${s.toString().padStart(o,"0")}${i}`:""},r={ch:128,cc:x.length,nn:128,pl:512,tr:256,rpn:6},oe=class extends C{#t=0;#g=0;#b=0;#p=new Array(10);get#f(){return this.#p[this.#g]}set#f(s){this.#p[this.#g]=s}#w=new Uint8Array(r.ch);#S=new Uint8Array(r.ch);#e=new Uint8ClampedArray(r.ch*r.cc);#k=new Uint8ClampedArray(r.ch);#o=new Uint8ClampedArray(r.ch*r.nn);#A=new Uint8Array(r.ch);#n=new Uint16Array(r.pl);#M=new Int16Array(r.ch);#G=new Array(r.ch);#h=new Uint8Array(r.ch);#x=0;#l=new Uint8Array(r.ch*r.rpn);#O=new Int8Array(r.ch*B.length);#v=0;#y=0;#d=100;#c=0;#r="";#C=0;#i=!1;#P;#s=[];#u=new Uint8Array(r.ch);#E=new Uint8Array(r.tr);chRedir(s,t,i){if(this.#E[t])return(this.#E[t]-1)*16+s;if([p.gs,p.ns5r].indexOf(this.#t)>-1){if(i==1)return s;let o=0,a=!0;for(;a;)this.#u[s+o]==0?(this.#u[s+o]=t,console.debug(`Assign track ${t} to channel ${s+o+1}.`),a=!1):this.#u[s+o]==t?a=!1:(o+=16,o>=128&&(o=0,a=!1));return s+o}else return s}#a=[];#I;#$={ano:s=>{this.#n.forEach((t,i,o)=>{let a=t>>7;t==0&&this.#o[0]==0||a==s&&(this.#o[t]=0,o[i]=0)})}};#L={8:function(s){let i=s.channel*128+s.data[0],o=this.#n.indexOf(i);o>-1&&(this.#n[o]=0,this.#o[i]=0)},9:function(s){let t=s.channel;this.#w[t]=1;let i=t*128+s.data[0];if(s.data[1]>0){let o=0;for(;this.#n[o]>0;)o++;o<this.#n.length?(this.#n[o]=i,this.#o[i]=s.data[1],this.#h[t]<s.data[1]&&(this.#h[t]=s.data[1])):console.error("Polyphony exceeded.")}else{let o=this.#n.indexOf(i);o>-1&&(this.#n[o]=0,this.#o[i]=0)}},10:function(s){let i=s.channel*128+s.data[0];this.#n.indexOf(i)>-1&&(this.#o[i]=data[1])},11:function(s){let t=s.channel;this.#w[t]=1;let i=t*r.cc;switch(s.data[0]){case 96:return;case 97:return;case 120:return;case 121:{this.#$.ano(t),this.#M[t]=0;let o=t*r.cc;this.#e[o+l[1]]=0,this.#e[o+l[5]]=0,this.#e[o+l[64]]=0,this.#e[o+l[65]]=0,this.#e[o+l[66]]=0,this.#e[o+l[67]]=0,this.#e[o+l[11]]=127,this.#e[o+l[101]]=127,this.#e[o+l[100]]=127,this.#e[o+l[99]]=127,this.#e[o+l[98]]=127;return}case 123:{this.#$.ano(t);return}case 124:{this.#$.ano(t);return}case 125:{this.#$.ano(t);return}case 126:{this.#A[t]=1,this.#$.ano(t);return}case 127:{this.#A[t]=0,this.#$.ano(t);return}}if(l[s.data[0]]==null)console.warn(`cc${s.data[0]} is not accepted.`);else{switch(s.data[0]){case 0:{if(this.#t==0)s.data[1]<48?(this.#e[i]>119&&(s.data[1]=this.#e[i],s.data[1]=120,console.debug(`Forced channel ${t+1} to stay drums.`)),s.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${s.data[1]}`),this.switchMode("gs"))):s.data[1]==62?this.switchMode("x5d"):s.data[1]==63&&this.switchMode("krs");else if(this.#t==p.gs)s.data[1]<56&&this.#e[i]>119&&(s.data[1]=this.#e[i],s.data[1]=120,console.debug(`Forced channel ${t+1} to stay drums.`));else if(this.#t==p.gm)s.data[1]<48&&this.#e[i]>119&&(s.data[1]=120,this.switchMode("gs",!0),console.debug(`Forced channel ${t+1} to stay drums.`));else if(this.#t==p.x5d){if(s.data[1]>0&&s.data[1]<8)this.switchMode("05rw",!0);else if(s.data[1]==56){let o=0;for(let a=0;a<16;a++){let n=this.#e[r.cc*a];(n==56||n==62)&&o++}o>14&&this.switchMode("ag10",!0)}}break}case 6:{if(this.#x){let o=this.#e[i+l[99]],a=this.#e[i+l[98]];if(o==1){let n=H.indexOf(a);if(n>-1)this.#e[i+l[71+n]]=s.data[1];else{let h=B.indexOf(a);h>-1&&(this.#O[t*10+h]=s.data[1]-64),console.debug(`CH${t+1} voice NRPN ${a} commit`)}}}else{let o=k[this.#e[i+l[100]]];this.#e[i+l[101]]==0&&o!=null&&(console.debug(`CH${t+1} RPN 0 ${this.#e[i+l[100]]} commit: ${s.data[1]}`),s.data[1]=Math.min(Math.max(s.data[1],L[o][0]),L[o][1]),this.#l[t*r.rpn+o]=s.data[1])}break}case 38:{this.#x||this.#e[i+101]==0&&k[this.#e[i+100]]!=null&&(this.#l[t*r.rpn+k[this.#e[i+100]]+1]=s.data[1]);break}case 98:case 99:{this.#x=1;break}case 100:case 101:{this.#x=0;break}}this.#e[i+l[s.data[0]]]=s.data[1]}},12:function(s){let t=s.channel;this.#w[t]=1,this.#k[t]=s.data,this.#G[t]=0},13:function(s){let t=this,i=s.channel;this.#n.forEach(function(o){let a=o>>7;i==a&&(t.#o[o]=s.data)})},14:function(s){let t=s.channel;this.#M[t]=s.data[1]*128+s.data[0]-8192},15:function(s){q(s.data).forEach(t=>{let i=t[0],o=t[1];(this.#X[i]||function(){console.debug(`Unknown manufacturer ${i}.`)})(o,t.slice(2),s.track)})},255:function(s){if((this.#a[s.meta]||function(i,o,a){}).call(this,s.data,s.track,s.meta),s.meta!=32&&(this.#c=0),X.indexOf(s.meta)>-1)return s.reply="meta",s;self.debugMode&&console.debug(s)}};#X={64:(s,t,i)=>{this.#D.run(t,i,s)},65:(s,t,i)=>{if(t[0]<64)this.#m.run(t,i,s);else{let o=t.pop(),a=U(t.slice(2));o==a?this.#m.run(t,i,s):console.warn(`Bad GS checksum ${o}. Should be ${a}.`)}},66:(s,t,i)=>{this.#B.run(t,i,s)},67:(s,t,i)=>{this.#T.run(t,i,s)},68:(s,t,i)=>{this.#F.run(t,i,s)},71:(s,t,i)=>{this.#N.run(t,i,s)},126:(s,t,i)=>{this.#R.run(t,i,s)},127:(s,t,i)=>{this.switchMode("gm"),this.#U.run(t,i,s)}};#R;#U;#T;#m;#B;#D;#N;#F;buildRchTree(){let s=[];this.#S.forEach((t,i)=>{s[t]?.constructor||(s[t]=[]),s[t].push(i)}),this.#P=s}getActive(){let s=this.#w.slice();return this.#t==p.mt32,s}getCc(s){let t=s*r.cc,i=this.#e.slice(t,t+r.cc);return i[l[0]]=i[l[0]]||this.#v,i[l[32]]=i[l[32]]||this.#y,i}getCcAll(){let s=this.#e.slice();for(let t=0;t<64;t++){let i=t*r.cc;s[i+l[0]]=s[i+l[0]]||this.#v,s[i+l[32]]=s[i+l[32]]||this.#y}return s}getPitch(){return this.#M}getProgram(){return this.#k}getTexts(){return this.#s.slice()}getVel(s){let t=new Map,i=this;return this.#n.forEach(function(o){let a=Math.floor(o/128),n=o%128;s==a&&i.#o[o]>0&&t.set(n,i.#o[o])}),t}getBitmap(){return{bitmap:this.#f,expire:this.#b}}getCustomNames(){return this.#G.slice()}getLetter(){return{text:this.#r,expire:this.#C}}getMode(){return M[this.#t]}getMaster(){return{volume:this.#d}}getRawStrength(){let s=this;return this.#n.forEach(function(t){let i=Math.floor(t/128);s.#o[t]>s.#h[i]&&(s.#h[i]=s.#o[t])}),this.#h}getStrength(){let s=[],t=this;return this.getRawStrength().forEach(function(i,o){s[o]=Math.floor(i*t.#e[o*r.cc+l[7]]*t.#e[o*r.cc+l[11]]*t.#d/803288)}),s}getRpn(){return this.#l}getNrpn(){return this.#O}init(s=0){this.dispatchEvent("mode","?"),this.#t=0,this.#v=0,this.#y=0,this.#c=0,this.#w.forEach(d),this.#e.forEach(d),this.#k.forEach(d),this.#o.forEach(d),this.#n.forEach(d),this.#h.forEach(d),this.#M.forEach(d),this.#O.forEach(d),this.#d=100,this.#s=[],this.#C=0,this.#r="",this.#b=0,this.#g=0,this.#f.forEach(d),this.#G.forEach(d),this.#i=!1,this.#S.forEach(function(t,i,o){o[i]=i}),this.buildRchTree(),this.#u.forEach(d),this.#E.forEach(d),this.#e[r.cc*9]=w[0],this.#e[r.cc*25]=w[0],this.#e[r.cc*41]=w[0],this.#e[r.cc*57]=w[0];for(let t=0;t<64;t++){let i=t*r.cc;this.#e[i+l[7]]=100,this.#e[i+l[11]]=127,this.#e[i+l[10]]=64,this.#e[i+l[71]]=64,this.#e[i+l[72]]=64,this.#e[i+l[73]]=64,this.#e[i+l[74]]=64,this.#e[i+l[75]]=64,this.#e[i+l[76]]=64,this.#e[i+l[77]]=64,this.#e[i+l[78]]=64,this.#e[i+l[91]]=40,this.#e[i+l[101]]=127,this.#e[i+l[100]]=127,this.#e[i+l[99]]=127,this.#e[i+l[98]]=127;let o=t*r.rpn;this.#l[o]=2,this.#l[o+1]=64,this.#l[o+2]=0,this.#l[o+3]=64,this.#l[o+4]=0,this.#l[o+5]=0}}switchMode(s,t=!1){let i=M.indexOf(s);if(i>-1){if(this.#t==0||t){this.#t=i,this.#g=0,this.#v=D[0][i],this.#y=D[1][i];for(let o=0;o<64;o++)w.indexOf(this.#e[o*r.cc])>-1&&(this.#e[o*r.cc]=w[i]);this.dispatchEvent("mode",s)}}else throw new Error(`Unknown mode ${s}`)}newStrength(){this.#h.forEach(d)}runJson(s){if(s.type>14)return this.#L[s.type].call(this,s);{let t=this.chRedir(s.part,s.track),i=!1;this.#P[t]?.forEach(o=>{s.channel=o,i=!0,this.#L[s.type].call(this,s)}),i||console.warn(`${P[s.type]?P[s.type]:s.type}${[11,12].includes(s.type)?(s.data[0]!=null?s.data[0]:s.data).toString():""} event sent to CH${t+1} without any recipient.`)}}runRaw(s){}constructor(){super();let s=this;this.#f=new Uint8Array(256),this.#I=new $,this.#a[1]=function(t){switch(t.slice(0,2)){case"@I":{this.#i=!0,this.#s.unshift(`Kar.Info: ${t.slice(2)}`);break}case"@K":{this.#i=!0,this.#s.unshift("Karaoke mode active."),console.debug(`Karaoke mode active: ${t.slice(2)}`);break}case"@L":{this.#i=!0,this.#s.unshift(`Language: ${t.slice(2)}`);break}case"@T":{this.#i=!0,this.#s.unshift(`Ka.Title: ${t.slice(2)}`);break}case"@V":{this.#i=!0,this.#s.unshift(`Kara.Ver: ${t.slice(2)}`);break}default:this.#i?t[0]=="\\"?this.#s.unshift(`@ ${t.slice(1)}`):t[0]=="/"?this.#s.unshift(t.slice(1)):this.#s[0]+=t:(this.#s[0]=t,this.#s.unshift(""))}},this.#a[2]=function(t){this.#s.unshift(`Copyrite: ${t}`)},this.#a[3]=function(t,i){i<1&&this.#c<1&&this.#s.unshift(`TrkTitle: ${t}`)},this.#a[4]=function(t,i){i<1&&this.#c<1&&this.#s.unshift(`${N(this.#c,""," ")}Instrmnt: ${t}`)},this.#a[5]=function(t){t.trim()==""?this.#s.unshift(""):this.#s[0]+=`${t}`},this.#a[6]=function(t){this.#s.unshift(`${N(this.#c,""," ")}C.Marker: ${t}`)},this.#a[7]=function(t){this.#s.unshift(`CuePoint: ${t}`)},this.#a[32]=function(t){this.#c=t[0]+1},this.#a[33]=function(t,i){console.debug(`Track ${i} requests to get assigned to output ${t}.`),s.#E[i]=t+1},this.#a[127]=function(t,i){s.#I.run(t,i)},this.#I.add([67,0,1],function(t,i){s.#E[i]=t[0]+1}),this.#R=new $,this.#U=new $,this.#T=new $,this.#m=new $,this.#B=new $,this.#D=new $,this.#N=new $,this.#F=new $,this.#R.add([9],t=>{s.switchMode(["gm","?","g2"][t[0]-1],!0),s.#i=s.#i||!1,console.info(`MIDI reset: ${["GM","Init","GM2"][t[0]-1]}`),t[0]==2&&s.init()}),this.#m.add([22,18,127,0,0,1],()=>{s.switchMode("mt32",!0),s.#i=!1,console.info("MIDI reset: MT-32")}),this.#D.add([16,0,8,0,0,0,0],()=>{s.switchMode("k11",!0),s.#i=!1,console.info("MIDI reset: KAWAI GMega/K11")}),this.#U.add([4,1],t=>{s.#d=((t[1]<<7)+t[0])/16383*100}).add([4,3],t=>((t[1]<<7)+t[0]-8192)/8192).add([4,4],t=>t[1]-64),this.#T.add([76,0,0],t=>{switch(t[0]){case 126:{s.switchMode("xg",!0),s.#i=!1,console.info("MIDI reset: XG");break}default:{let i=[0,0,0,0],o=(a,n)=>{i[n]=a};if(t.slice(1).forEach((a,n)=>{let h=n+t[0];[o,o,o,o,f=>{this.#d=f*129/16383*100},f=>{},f=>{}][h](a,n)}),t[0]<4){let a=0;i.forEach(n=>{a=a<<4,a+=n}),a-=1024}}}}).add([76,2,1],t=>{let i="XG ";t[0]<32?(i+="reverb ",t.slice(1).forEach((o,a)=>{([n=>{console.debug(`${i}main type: ${m[n]}`)},n=>{console.debug(`${i}sub type: ${n+1}`)},n=>{console.debug(`${i}time: ${A(n)}s`)},n=>{console.debug(`${i}diffusion: ${n}`)},n=>{console.debug(`${i}initial delay: ${n}`)},n=>{console.debug(`${i}HPF cutoff: ${y[n]}Hz`)},n=>{console.debug(`${i}LPF cutoff: ${y[n]}Hz`)},n=>{console.debug(`${i}width: ${n}`)},n=>{console.debug(`${i}height: ${n}`)},n=>{console.debug(`${i}depth: ${n}`)},n=>{console.debug(`${i}wall type: ${n}`)},n=>{console.debug(`${i}dry/wet: ${n}`)},n=>{console.debug(`${i}send: ${u(n)}dB`)},n=>{console.debug(`${i}pan: ${n-64}`)},!1,!1,n=>{console.debug(`${i}delay: ${n}`)},n=>{console.debug(`${i}density: ${n}`)},n=>{console.debug(`${i}balance: ${n}`)},n=>{},n=>{console.debug(`${i}feedback: ${n}`)},n=>{}][t[0]+a]||function(){console.warn(`Unknown XG reverb address: ${t[0]}.`)})(o)})):t[0]<64?(i+="chorus ",t.slice(1).forEach((o,a)=>{([n=>{console.debug(`${i}main type: ${m[n]}`)},n=>{console.debug(`${i}sub type: ${n+1}`)},n=>{console.debug(`${i}LFO: ${S[n]}Hz`)},n=>{},n=>{console.debug(`${i}feedback: ${n}`)},n=>{console.debug(`${i}delay offset: ${G(n)}ms`)},n=>{},n=>{console.debug(`${i}low: ${y[n]}Hz`)},n=>{console.debug(`${i}low: ${n-64}dB`)},n=>{console.debug(`${i}high: ${y[n]}Hz`)},n=>{console.debug(`${i}high: ${n-64}dB`)},n=>{console.debug(`${i}dry/wet: ${n}`)},n=>{console.debug(`${i}send: ${u(n)}dB`)},n=>{console.debug(`${i}pan: ${n-64}`)},n=>{console.debug(`${i}to reverb: ${u(n)}dB`)},!1,n=>{},n=>{},n=>{},n=>{console.debug(`${i}LFO phase diff: ${(n-64)*3}deg`)},n=>{console.debug(`${i}input mode: ${n?"stereo":"mono"}`)},n=>{}][t[0]-32+a]||function(){console.warn(`Unknown XG chorus address: ${t[0]}.`)})(o)})):t[0]<86?(i+="variation ",t[0]==64&&console.debug(`${i}type: ${m[t[1]]}${t[2]>0?" "+(t[2]+1):""}`)):t[0]<97?(i+="variation ",t.slice(1).forEach((o,a)=>{[n=>{console.debug(`${i}send: ${u(n)}dB`)},n=>{console.debug(`${i}pan: ${n-64}`)},n=>{console.debug(`${i}to reverb: ${u(n)}dB`)},n=>{console.debug(`${i}to chorus: ${u(n)}dB`)},n=>{console.debug(`${i}connection: ${n?"system":"insertion"}`)},n=>{console.debug(`${i}channel: CH${n+1}`)},n=>{console.debug(`${i}mod wheel: ${n-64}`)},n=>{console.debug(`${i}bend wheel: ${n-64}`)},n=>{console.debug(`${i}channel after touch: ${n-64}`)},n=>{console.debug(`${i}AC1: ${n-64}`)},n=>{console.debug(`${i}AC2: ${n-64}`)}][t[0]-86+a](o)})):t[0]>111&&t[0]<118?i+="variation ":console.warn(`Unknown XG variation address: ${t[0]}`)}).add([76,2,64],t=>{t.slice(1).forEach((i,o)=>{let a=o+t[0];if(a==0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][i]}`);else{let n=a-1>>2,h=a-1&3,f=`XG EQ ${n} ${["gain","freq","Q","shape"][h]}: `;[()=>{console.debug(`${f}${i-64}dB`)},()=>{console.debug(`${f}${i} (raw)`)},()=>{console.debug(`${f}${i/10}`)},()=>{console.debug(`${f}${["shelf","peak"][+!!i]}`)}][h]()}})}).add([76,3],t=>{}).add([76,6,0],t=>{let i=t[0];s.#r=" ".repeat(i),s.#C=Date.now()+3200,t.slice(1).forEach(function(o){s.#r+=String.fromCharCode(o)}),s.#r=s.#r.padEnd(32," ")}).add([76,7,0],t=>{let i=t[0];s.#b=Date.now()+3200,s.#f.fill(0);let o=t.slice(1);for(let a=0;a<i;a++)o.unshift(0);o.forEach(function(a,n){let h=Math.floor(n/16),f=n%16,c=(f*3+h)*7,g=7,b=0;for(c-=f*5,h==2&&(g=2);b<g;)s.#f[c+b]=a>>6-b&1,b++})}).add([76,8],(t,i)=>{let o=s.chRedir(t[0],i,!0),a=t[1],n=r.cc*o,h=`XG CH${o+1} `,f=`Unknown XG part address ${a}.`;a<1?console.debug(f):a<41?t.slice(2).forEach((c,g)=>{([()=>{s.#e[n+l[0]]=c},()=>{s.#e[n+l[32]]=c},()=>{s.#k[o]=c},()=>{s.#S[o]=c,o!=c&&(s.buildRchTree(),console.info(`${h}receives from CH${c+1}`))},()=>{s.#A[o]=+!c},()=>{},()=>{s.#e[n+l[0]]=c>1?127:0,console.debug(`${h}set to type ${T[c]}`)},()=>{},!1,!1,()=>{s.#e[n+l[7]]=c},!1,!1,()=>{s.#e[n+l[10]]=c||128},!1,!1,()=>{s.#e[n+l[11]]=c},()=>{s.#e[n+l[93]]=c},()=>{s.#e[n+l[91]]=c},()=>{s.#e[n+l[94]]=c},()=>{s.#e[n+l[76]]=c},()=>{s.#e[n+l[77]]=c},()=>{s.#e[n+l[78]]=c},()=>{s.#e[n+l[74]]=c},()=>{s.#e[n+l[71]]=c},()=>{s.#e[n+l[73]]=c},()=>{s.#e[n+l[75]]=c},()=>{s.#e[n+l[72]]=c}][a+g-1]||function(){})()}):a<48?console.debug(f):a<111?a>102&&a<105&&(s.#e[n+l[[5,65][a&1]]]=e):a<114?console.debug(f):a<116?console.debug(`${h}EQ ${["bass","treble"][a&1]} gain: ${e-64}dB`):a<118?console.debug(f):a<120?console.debug(`${h}EQ ${["bass","treble"][a&1]} freq: ${e}`):console.debug(f)}).add([76,10],t=>{}).add([76,16],t=>{}).add([76,17,0,0],t=>{}).add([112],t=>{console.debug(`XG plugin PLG100-${["VL","SG","DX"][t[0]]} enabled for channel ${t[2]+1}.`)}),this.#T.add([76,48],t=>{}).add([76,49],t=>{}).add([76,50],t=>{}).add([76,51],t=>{}),this.#m.add([66,18,0,0,127],t=>{s.switchMode("gs",!0),s.#e[r.cc*9]=120,s.#e[r.cc*25]=120,s.#e[r.cc*41]=120,s.#e[r.cc*57]=120,s.#y=3,s.#i=!1,s.#u.forEach(d),console.info(`GS system to ${["single","dual"][t[0]]} mode.`)}).add([66,18,64,0],t=>{switch(t[0]){case 127:{s.switchMode("gs",!0),s.#e[r.cc*9]=120,s.#e[r.cc*25]=120,s.#e[r.cc*41]=120,s.#e[r.cc*57]=120,s.#i=!1,s.#u.forEach(d),console.info("MIDI reset: GS");break}default:{let i=[0,0,0,0],o=(a,n)=>{i[n]=a};if(t.slice(1).forEach((a,n)=>{let h=n+t[0];[o,o,o,o,f=>{this.#d=f*129/16383*100},f=>{},f=>{}][h](a,n)}),t[0]<4){let a=0;i.forEach(n=>{a=a<<4,a+=n}),a-=1024}}}}).add([66,18,64,1],t=>{let i=t[0];if(i<16){let o="".padStart(i," ");t.slice(1).forEach((a,n)=>{o+=String.fromCharCode(Math.max(32,a))}),o=o.padEnd(16," "),console.debug(`GS patch name: ${o}`)}else i<48||(i<65?t.slice(1).forEach((o,a)=>{let n=`GS ${["reverb","chorus"][+(i+a>37)]} `;([()=>{console.debug(`${n}type: ${O[o]}`)},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${n}predelay: ${o}ms`)},()=>{console.debug(`${n}type: ${I[o]}`)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${n}to reverb: ${u(o)}`)},()=>{console.debug(`${n}to delay: ${u(o)}`)}][i+a-48]||function(){})()}):i<80?console.debug(`Unknown GS patch address: ${i}`):i<91?t.slice(1).forEach((o,a)=>{let n="GS delay ";([()=>{console.debug(`${n}type: ${R[o]}`)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${n}to reverb: ${u(o)}`)}][i+a-80]||function(){})()}):console.debug(`Unknown GS patch address: ${i}`))}).add([66,18,64,2],t=>{let i="GS EQ ";t.slice(1).forEach((o,a)=>{([()=>{console.debug(`${i}low freq: ${[200,400][o]}Hz`)},()=>{console.debug(`${i}low gain: ${o-64}dB`)},()=>{console.debug(`${i}high freq: ${[3e3,6e3][o]}Hz`)},()=>{console.debug(`${i}high gain: ${o-64}dB`)}][t[0]+a]||function(){console.warn(`Unknown GS EQ address: ${t[0]+a}`)})()})}).add([66,18,64,3],t=>{let i="GS EFX ";t.slice(1).forEach((o,a)=>{([()=>{console.debug(`${i}type MSB: ${o}`)},()=>{console.debug(`${i}type LSB: ${o}`)},!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,()=>{console.debug(`${i}to reverb: ${u(o)}dB`)},()=>{console.debug(`${i}to chorus: ${u(o)}dB`)},()=>{console.debug(`${i}to delay: ${u(o)}dB`)},!1,()=>{console.debug(`${i}1 source: ${o}`)},()=>{console.debug(`${i}1 depth: ${o-64}`)},()=>{console.debug(`${i}2 source: ${o}`)},()=>{console.debug(`${i}2 depth: ${o-64}`)},()=>{console.debug(`${i}to EQ: ${o?"ON":"OFF"}`)}][t[0]+a]||function(){})()})}).add([66,18,65],t=>{}).add([69,18,16],t=>{switch(t[0]){case 0:{s.#C=Date.now()+3200;let i=t[1];s.#r=" ".repeat(i),t.slice(2).forEach(function(o){o<128&&(s.#r+=String.fromCharCode(o))});break}case 32:{s.#b=Date.now()+3200,t[1]==0&&(s.#g=Math.max(Math.min(t[2]-1,9),0));break}default:if(t[0]<11){s.#b=Date.now()+3200,s.#p[t[0]-1]?.length||(s.#p[t[0]-1]=new Uint8Array(256));let i=s.#p[t[0]-1],o=t[1];i.fill(0);let a=t.slice(2);for(let n=0;n<o;n++)a.unshift(0);a.forEach(function(n,h){let f=Math.floor(h/16),c=h%16,g=(c*4+f)*5,b=5,E=0;for(g-=c*4,f==3&&(b=1);E<b;)i[g+E]=n>>4-E&1,E++})}else console.warn(`Unknown GS display section: ${t[0]}`)}})}};export{oe as OctaviaDevice,r as allocated,l as ccToPos};
