var G=function(t,o){let a=Math.min(t.length,o.length),s=t.slice(0,a),i=o.slice(0,a),n=0,c=0;for(;c<a&&n==0;)n=Math.sign(s[c]-i[c]),c++;return n},g=function(){this.pool=[],this.point=function(t,o=!1){if(this.pool.length>0){let a=this.pool.length,s=1<<Math.floor(Math.log2(a)),i=s,n=64;for(;s>=1&&n>=0;){if(n<=0)throw new Error("TTL reached.");if(i==a)i-=s;else{let r=G(t,this.pool[i]);switch(r){case 0:{n=0;break}case 1:{i+s<=a&&(i+=s);break}case-1:{i!=0&&(i-=s);break}default:console.warn(`Unexpected result ${r}.`)}}s=s>>1,n--}let c=!0;if(i>=this.pool.length)c=!1;else{let r=this;this.pool[i].forEach(function(d,h,f){c&&d!=t[h]&&(c=!1)}),!c&&G(t,this.pool[i])>0&&i++}return c||o?i:-1}else return o?0:-1},this.add=function(t,o){return t.data=o,this.pool.splice(this.point(t,!0),0,t),this},this.default=function(t){console.warn(`No match for "${t}". Default action not defined.`)},this.get=function(t){let o=this.point(t);if(o>-1)return this.pool[o].data;this.default(t)},this.run=function(t,...o){let a=this.point(t);a>-1?this.pool[a].data(t.slice(this.pool[a].length),...o):this.default(t,...o)}};var P=class{#t={};addEventListener(t,o){this.#t[t]||(this.#t[t]=[]),this.#t[t].unshift(o)}removeEventListener(t,o){if(this.#t[t]){let a=this.#t[t].indexOf(o);a>-1&&this.#t[t].splice(a,1),this.#t[t].length<1&&delete this.#t[t]}}dispatchEvent(t,o){let a=new Event(t),s=this;a.data=o,this.#t[t]?.length>0&&this.#t[t].forEach(function(i){i?.call(s,a)}),this[`on${t}`]&&this[`on${t}`](a)}};var k=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),v=["melodic","drum","drum set 1","drum set 2","drum set 3","drum set 4"],z=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],y=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],A=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],D=function(t){let o=.1,a=-.3;return t>66?(o=5,a=315):t>56?(o=1,a=47):t>46&&(o=.5,a=18.5),o*t-a},O=function(t){return t>105?z[t-106]:t>100?t*1.1-100:t/10};var L=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],U=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],I=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var K={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},V={66307:["drive"],66309:["vowel",t=>"aiueo"[t]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",t=>["off","LPF","HPF"][t]],94984:["noise type",t=>["white","pink"][t]],94987:["disc type",t=>["LP","SP","EP","RND"]],94990:["hum type",t=>`${t+5}0Hz`],94993:["M/S",t=>["mono","stereo"][t]]},M=function(t){return K[(t[0]<<8)+t[1]]||`0x${t[0].toString(16).padStart(2,"0")}${t[1].toString(16).padStart(2,"0")}`},B=function(t,o,a){let s=(t[0]<<16)+(t[1]<<8)+o,i=V[s]||{},n=i[0];if(n?.length)return n+=`: ${(i[1]||function(){})(a)||a}`,n};var p=function(t=64){return Math.round(2e3*Math.log10(t/64))/100},N=function(t){let o=0;return t.forEach(a=>{o+=a,o>127&&(o%=128)}),128-o},w=function(t,o){let a=0;for(let s=0;s<t.length;s++)s%8!=0&&(o(t[s],a,t),a++)},R=function(t){return Math.floor(t*14.2)};var S=["?","gm","gs","xg","g2","mt32","ns5r","ag10","x5d","05rw","krs","k11","sg"],F=[[0,0,0,0,121,0,0,56,82,81,63,0,0],[0,0,1,0,0,127,0,0,0,0,0,0,0]],x=[120,127,120,127,120,127,61,62,62,62,120,122,127],J=[0,3,81,84,88],H={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},C={0:0,1:1,2:3,5:4},X=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],Q=[36,37];var T=[0,1,2,4,5,6,7,8,10,11,32,38,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,84,91,92,93,94,95,98,99,100,101,12,13,16,17,18,19],W=[33,99,100,32,102,8,9,10],m={};S.forEach((t,o)=>{m[t]=o});var l={length:T.length};T.forEach((t,o)=>{l[t]=o});var Z=function(t){let o=[[]];return t?.forEach(function(a){a==247||(a==240?o.push([]):o[o.length-1].push(a))}),o},q=function(t,o="",a="",s=2){return t?`${o}${t.toString().padStart(s,"0")}${a}`:""},u={ch:128,cc:T.length,nn:128,pl:512,tr:256,rpn:6},he=class extends P{#t=0;#x=0;#y=0;#E=new Array(10);get#b(){return this.#E[this.#x]}set#b(t){this.#E[this.#x]=t}#h=new Uint8Array(u.ch);#d=new Uint8Array(u.ch);#e=new Uint8ClampedArray(u.ch*u.cc);#c=new Uint8ClampedArray(u.ch);#o=new Uint8ClampedArray(u.ch*u.nn);#k=new Uint8Array(u.ch);#n=new Uint16Array(u.pl);#C=new Int16Array(u.ch);#A=new Array(u.ch);#f=new Uint8Array(u.ch);#S=0;#r=new Uint8Array(u.ch*u.rpn);#D=new Int8Array(u.ch*Q.length);#T=0;#v=0;#u=100;#$=0;#l="";#G=0;#s=!1;#B;#p=new Uint8Array(2);#i=[];#g=new Uint8Array(u.ch);#M=new Uint8Array(u.tr);chRedir(t,o,a){if(this.#M[o])return(this.#M[o]-1)*16+t;if([m.gs,m.ns5r].indexOf(this.#t)>-1){if(a==1)return t;let s=0,i=!0;for(;i;)this.#g[t+s]==0?(this.#g[t+s]=o,console.debug(`Assign track ${o} to channel ${t+s+1}.`),i=!1):this.#g[t+s]==o?i=!1:(s+=16,s>=128&&(s=0,i=!1));return t+s}else return t}#a=[];#O;#w={ano:t=>{this.#n.forEach((o,a,s)=>{let i=o>>7;o==0&&this.#o[0]==0||i==t&&(this.#o[o]=0,s[a]=0)})}};#N={8:function(t){let a=t.channel*128+t.data[0],s=this.#n.indexOf(a);s>-1&&(this.#n[s]=0,this.#o[a]=0)},9:function(t){let o=t.channel;this.#h[o]=1;let a=o*128+t.data[0];if(t.data[1]>0){let s=0;for(;this.#n[s]>0;)s++;s<this.#n.length?(this.#n[s]=a,this.#o[a]=t.data[1],this.#f[o]<t.data[1]&&(this.#f[o]=t.data[1])):console.error("Polyphony exceeded.")}else{let s=this.#n.indexOf(a);s>-1&&(this.#n[s]=0,this.#o[a]=0)}},10:function(t){let a=t.channel*128+t.data[0];this.#n.indexOf(a)>-1&&(this.#o[a]=data[1])},11:function(t){let o=t.channel;this.#h[o]=1;let a=o*u.cc;switch(t.data[0]){case 96:return;case 97:return;case 120:return;case 121:{this.#w.ano(o),this.#C[o]=0;let s=o*u.cc;this.#e[s+l[1]]=0,this.#e[s+l[5]]=0,this.#e[s+l[64]]=0,this.#e[s+l[65]]=0,this.#e[s+l[66]]=0,this.#e[s+l[67]]=0,this.#e[s+l[11]]=127,this.#e[s+l[101]]=127,this.#e[s+l[100]]=127,this.#e[s+l[99]]=127,this.#e[s+l[98]]=127;return}case 123:{this.#w.ano(o);return}case 124:{this.#w.ano(o);return}case 125:{this.#w.ano(o);return}case 126:{this.#k[o]=1,this.#w.ano(o);return}case 127:{this.#k[o]=0,this.#w.ano(o);return}}if(l[t.data[0]]==null)console.warn(`cc${t.data[0]} is not accepted.`);else{switch(t.data[0]){case 0:{if(this.#t==0)t.data[1]<48?(this.#e[a]>119&&(t.data[1]=this.#e[a],t.data[1]=120,console.debug(`Forced channel ${o+1} to stay drums.`)),t.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${t.data[1]}`),this.switchMode("gs"))):t.data[1]==62?this.switchMode("x5d"):t.data[1]==63&&this.switchMode("krs");else if(this.#t==m.gs)t.data[1]<56&&this.#e[a]>119&&(t.data[1]=this.#e[a],t.data[1]=120,console.debug(`Forced channel ${o+1} to stay drums.`));else if(this.#t==m.gm)t.data[1]<48&&this.#e[a]>119&&(t.data[1]=120,this.switchMode("gs",!0),console.debug(`Forced channel ${o+1} to stay drums.`));else if(this.#t==m.x5d){if(t.data[1]>0&&t.data[1]<8)this.switchMode("05rw",!0);else if(t.data[1]==56){let s=0;for(let i=0;i<16;i++){let n=this.#e[u.cc*i];(n==56||n==62)&&s++}s>14&&this.switchMode("ag10",!0)}}break}case 6:{if(this.#S){let s=this.#e[a+l[99]],i=this.#e[a+l[98]];if(s==1){let n=W.indexOf(i);if(n>-1)this.#e[a+l[71+n]]=t.data[1],console.debug(`Redirected NRPN 1 ${i} to cc${71+n}.`);else{let c=Q.indexOf(i);c>-1&&(this.#D[o*10+c]=t.data[1]-64),console.debug(`CH${o+1} voice NRPN ${i} commit`)}}}else{let s=C[this.#e[a+l[100]]];this.#e[a+l[101]]==0&&s!=null&&(console.debug(`CH${o+1} RPN 0 ${this.#e[a+l[100]]} commit: ${t.data[1]}`),t.data[1]=Math.min(Math.max(t.data[1],X[s][0]),X[s][1]),this.#r[o*u.rpn+s]=t.data[1])}break}case 38:{this.#S||this.#e[a+101]==0&&C[this.#e[a+100]]!=null&&(this.#r[o*u.rpn+C[this.#e[a+100]]+1]=t.data[1]);break}case 98:case 99:{this.#S=1;break}case 100:case 101:{this.#S=0;break}}this.#e[a+l[t.data[0]]]=t.data[1]}},12:function(t){let o=t.channel;this.#h[o]=1,this.#c[o]=t.data,this.#A[o]=0},13:function(t){let o=this,a=t.channel;this.#n.forEach(function(s){let i=s>>7;a==i&&(o.#o[s]=t.data)})},14:function(t){let o=t.channel;this.#C[o]=t.data[1]*128+t.data[0]-8192},15:function(t){Z(t.data).forEach(o=>{let a=o[0],s=o[1];(this.#X[a]||function(){console.debug(`Unknown manufacturer ${a}.`)})(s,o.slice(2),t.track)})},248:function(t){},250:function(t){},251:function(t){},252:function(t){},254:function(t){},255:function(t){if((this.#a[t.meta]||function(a,s,i){}).call(this,t.data,t.track,t.meta),t.meta!=32&&(this.#$=0),J.indexOf(t.meta)>-1)return t.reply="meta",t;self.debugMode&&console.debug(t)}};#X={64:(t,o,a)=>{this.#I.run(o,a,t)},65:(t,o,a)=>{if(o[0]<64)this.#m.run(o,a,t);else{let s=o.pop(),i=N(o.slice(2));s==i?this.#m.run(o,a,t):console.warn(`Bad GS checksum ${s}. Should be ${i}.`)}},66:(t,o,a)=>{this.#R.run(o,a,t)},67:(t,o,a)=>{this.#P.run(o,a,t)},68:(t,o,a)=>{this.#H.run(o,a,t)},71:(t,o,a)=>{this.#F.run(o,a,t)},126:(t,o,a)=>{this.#L.run(o,a,t)},127:(t,o,a)=>{this.switchMode("gm"),this.#U.run(o,a,t)}};#L;#U;#P;#m;#R;#I;#F;#H;buildRchTree(){let t=[];this.#d.forEach((o,a)=>{t[o]?.constructor||(t[o]=[]),t[o].push(a)}),this.#B=t}getActive(){let t=this.#h.slice();return this.#t==m.mt32,t}getCc(t){let o=t*u.cc,a=this.#e.slice(o,o+u.cc);return a[l[0]]=a[l[0]]||this.#T,a[l[32]]=a[l[32]]||this.#v,a}getCcAll(){let t=this.#e.slice();for(let o=0;o<64;o++){let a=o*u.cc;t[a+l[0]]=t[a+l[0]]||this.#T,t[a+l[32]]=t[a+l[32]]||this.#v}return t}getPitch(){return this.#C}getProgram(){return this.#c}getTexts(){return this.#i.slice()}getVel(t){let o=new Map,a=this;return this.#n.forEach(function(s){let i=Math.floor(s/128),n=s%128;t==i&&a.#o[s]>0&&o.set(n,a.#o[s])}),o}getBitmap(){return{bitmap:this.#b,expire:this.#y}}getCustomNames(){return this.#A.slice()}getLetter(){return{text:this.#l,expire:this.#G}}getMode(){return S[this.#t]}getMaster(){return{volume:this.#u}}getRawStrength(){let t=this;return this.#n.forEach(function(o){let a=Math.floor(o/128);t.#o[o]>t.#f[a]&&(t.#f[a]=t.#o[o])}),this.#f}getStrength(){let t=[],o=this;return this.getRawStrength().forEach(function(a,s){t[s]=Math.floor(a*o.#e[s*u.cc+l[7]]*o.#e[s*u.cc+l[11]]*o.#u/803288)}),t}getRpn(){return this.#r}getNrpn(){return this.#D}init(t=0){this.dispatchEvent("mode","?"),this.#t=0,this.#T=0,this.#v=0,this.#$=0,this.#h.fill(0),this.#e.fill(0),this.#c.fill(0),this.#o.fill(0),this.#n.fill(0),this.#f.fill(0),this.#C.fill(0),this.#D.fill(0),this.#u=100,this.#i=[],this.#G=0,this.#l="",this.#y=0,this.#x=0,this.#b.fill(0),this.#A.fill(0),this.#s=!1,this.#d.forEach(function(o,a,s){s[a]=a}),this.buildRchTree(),this.#g.fill(0),this.#M.fill(0),this.#e[u.cc*9]=x[0],this.#e[u.cc*25]=x[0],this.#e[u.cc*41]=x[0],this.#e[u.cc*57]=x[0],this.#p.fill(0);for(let o=0;o<64;o++){let a=o*u.cc;this.#e[a+l[7]]=100,this.#e[a+l[11]]=127,this.#e[a+l[10]]=64,this.#e[a+l[71]]=64,this.#e[a+l[72]]=64,this.#e[a+l[73]]=64,this.#e[a+l[74]]=64,this.#e[a+l[75]]=64,this.#e[a+l[76]]=64,this.#e[a+l[77]]=64,this.#e[a+l[78]]=64,this.#e[a+l[91]]=40,this.#e[a+l[101]]=127,this.#e[a+l[100]]=127,this.#e[a+l[99]]=127,this.#e[a+l[98]]=127;let s=o*u.rpn;this.#r[s]=2,this.#r[s+1]=64,this.#r[s+2]=0,this.#r[s+3]=64,this.#r[s+4]=0,this.#r[s+5]=0}}switchMode(t,o=!1){let a=S.indexOf(t);if(a>-1){if(this.#t==0||o){this.#t=a,this.#x=0,this.#T=F[0][a],this.#v=F[1][a];for(let s=0;s<64;s++)x.indexOf(this.#e[s*u.cc])>-1&&(this.#e[s*u.cc]=x[a]);this.dispatchEvent("mode",t)}}else throw new Error(`Unknown mode ${t}`)}newStrength(){this.#f.fill(0)}runJson(t){if(t.type>14)return this.#N[t.type].call(this,t);{let o=this.chRedir(t.part,t.track),a=!1;this.#B[o]?.forEach(s=>{t.channel=s,a=!0,this.#N[t.type].call(this,t)}),a||console.warn(`${H[t.type]?H[t.type]:t.type}${[11,12].includes(t.type)?(t.data[0]!=null?t.data[0]:t.data).toString():""} event sent to CH${o+1} without any recipient.`)}}runRaw(t){}constructor(){super();let t=this;this.#b=new Uint8Array(256),this.#O=new g,this.#a[1]=function(s){switch(s.slice(0,2)){case"@I":{this.#s=!0,this.#i.unshift(`Kar.Info: ${s.slice(2)}`);break}case"@K":{this.#s=!0,this.#i.unshift("Karaoke mode active."),console.debug(`Karaoke mode active: ${s.slice(2)}`);break}case"@L":{this.#s=!0,this.#i.unshift(`Language: ${s.slice(2)}`);break}case"@T":{this.#s=!0,this.#i.unshift(`Ka.Title: ${s.slice(2)}`);break}case"@V":{this.#s=!0,this.#i.unshift(`Kara.Ver: ${s.slice(2)}`);break}default:this.#s?s[0]=="\\"?this.#i.unshift(`@ ${s.slice(1)}`):s[0]=="/"?this.#i.unshift(s.slice(1)):this.#i[0]+=s:(this.#i[0]=s,this.#i.unshift(""))}},this.#a[2]=function(s){this.#i.unshift(`Copyrite: ${s}`)},this.#a[3]=function(s,i){i<1&&this.#$<1&&this.#i.unshift(`TrkTitle: ${s}`)},this.#a[4]=function(s,i){i<1&&this.#$<1&&this.#i.unshift(`${q(this.#$,""," ")}Instrmnt: ${s}`)},this.#a[5]=function(s){s.trim()==""?this.#i.unshift(""):this.#i[0]+=`${s}`},this.#a[6]=function(s){this.#i.unshift(`${q(this.#$,""," ")}C.Marker: ${s}`)},this.#a[7]=function(s){this.#i.unshift(`CuePoint: ${s}`)},this.#a[32]=function(s){this.#$=s[0]+1},this.#a[33]=function(s,i){console.debug(`Track ${i} requests to get assigned to output ${s}.`),t.#M[i]=s+1},this.#a[127]=function(s,i){t.#O.run(s,i)},this.#O.add([67,0,1],function(s,i){t.#M[i]=s[0]+1}),this.#L=new g,this.#U=new g,this.#P=new g,this.#m=new g,this.#R=new g,this.#I=new g,this.#F=new g,this.#H=new g,this.#L.add([9],s=>{t.switchMode(["gm","?","g2"][s[0]-1],!0),t.#s=t.#s||!1,console.info(`MIDI reset: ${["GM","Init","GM2"][s[0]-1]}`),s[0]==2&&t.init()}),this.#m.add([22,18,127,0,0,1],()=>{t.switchMode("mt32",!0),t.#s=!1,console.info("MIDI reset: MT-32")}),this.#I.add([16,0,8,0,0,0,0],()=>{t.switchMode("k11",!0),t.#s=!1,console.info("MIDI reset: KAWAI GMega/K11")}),this.#U.add([4,1],s=>{t.#u=((s[1]<<7)+s[0])/16383*100}).add([4,3],s=>((s[1]<<7)+s[0]-8192)/8192).add([4,4],s=>s[1]-64),this.#P.add([76,0,0],s=>{switch(s[0]){case 126:{t.switchMode("xg",!0),t.#s=!1,console.info("MIDI reset: XG");break}default:{let i=[0,0,0,0],n=(c,r)=>{i[r]=c};if(s.slice(1).forEach((c,r)=>{let d=r+s[0];[n,n,n,n,h=>{this.#u=h*129/16383*100},h=>{},h=>{}][d](c,r)}),s[0]<4){let c=0;i.forEach(r=>{c=c<<4,c+=r}),c-=1024}}}}).add([76,2,1],s=>{let i="XG ";s[0]<32?(i+="reverb ",s.slice(1).forEach((n,c)=>{([r=>{console.info(`${i}main type: ${k[r]}`)},r=>{console.debug(`${i}sub type: ${r+1}`)},r=>{console.debug(`${i}time: ${D(r)}s`)},r=>{console.debug(`${i}diffusion: ${r}`)},r=>{console.debug(`${i}initial delay: ${r}`)},r=>{console.debug(`${i}HPF cutoff: ${y[r]}Hz`)},r=>{console.debug(`${i}LPF cutoff: ${y[r]}Hz`)},r=>{console.debug(`${i}width: ${r}`)},r=>{console.debug(`${i}height: ${r}`)},r=>{console.debug(`${i}depth: ${r}`)},r=>{console.debug(`${i}wall type: ${r}`)},r=>{console.debug(`${i}dry/wet: ${r}`)},r=>{console.debug(`${i}send: ${p(r)}dB`)},r=>{console.debug(`${i}pan: ${r-64}`)},!1,!1,r=>{console.debug(`${i}delay: ${r}`)},r=>{console.debug(`${i}density: ${r}`)},r=>{console.debug(`${i}balance: ${r}`)},r=>{},r=>{console.debug(`${i}feedback: ${r}`)},r=>{}][s[0]+c]||function(){console.warn(`Unknown XG reverb address: ${s[0]}.`)})(n)})):s[0]<64?(i+="chorus ",s.slice(1).forEach((n,c)=>{([r=>{console.info(`${i}main type: ${k[r]}`)},r=>{console.debug(`${i}sub type: ${r+1}`)},r=>{console.debug(`${i}LFO: ${A[r]}Hz`)},r=>{},r=>{console.debug(`${i}feedback: ${r}`)},r=>{console.debug(`${i}delay offset: ${O(r)}ms`)},r=>{},r=>{console.debug(`${i}low: ${y[r]}Hz`)},r=>{console.debug(`${i}low: ${r-64}dB`)},r=>{console.debug(`${i}high: ${y[r]}Hz`)},r=>{console.debug(`${i}high: ${r-64}dB`)},r=>{console.debug(`${i}dry/wet: ${r}`)},r=>{console.debug(`${i}send: ${p(r)}dB`)},r=>{console.debug(`${i}pan: ${r-64}`)},r=>{console.debug(`${i}to reverb: ${p(r)}dB`)},!1,r=>{},r=>{},r=>{},r=>{console.debug(`${i}LFO phase diff: ${(r-64)*3}deg`)},r=>{console.debug(`${i}input mode: ${r?"stereo":"mono"}`)},r=>{}][s[0]-32+c]||function(){console.warn(`Unknown XG chorus address: ${s[0]}.`)})(n)})):s[0]<86?(i+="variation ",s[0]==64&&console.info(`${i}type: ${k[s[1]]}${s[2]>0?" "+(s[2]+1):""}`)):s[0]<97?(i+="variation ",s.slice(1).forEach((n,c)=>{[r=>{console.debug(`${i}send: ${p(r)}dB`)},r=>{console.debug(`${i}pan: ${r-64}`)},r=>{console.debug(`${i}to reverb: ${p(r)}dB`)},r=>{console.debug(`${i}to chorus: ${p(r)}dB`)},r=>{console.debug(`${i}connection: ${r?"system":"insertion"}`)},r=>{console.debug(`${i}channel: CH${r+1}`)},r=>{console.debug(`${i}mod wheel: ${r-64}`)},r=>{console.debug(`${i}bend wheel: ${r-64}`)},r=>{console.debug(`${i}channel after touch: ${r-64}`)},r=>{console.debug(`${i}AC1: ${r-64}`)},r=>{console.debug(`${i}AC2: ${r-64}`)}][s[0]-86+c](n)})):s[0]>111&&s[0]<118?i+="variation ":console.warn(`Unknown XG variation address: ${s[0]}`)}).add([76,2,64],s=>{s.slice(1).forEach((i,n)=>{let c=n+s[0];if(c==0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][i]}`);else{let r=c-1>>2,d=c-1&3,h=`XG EQ ${r} ${["gain","freq","Q","shape"][d]}: `;[()=>{console.debug(`${h}${i-64}dB`)},()=>{console.debug(`${h}${i} (raw)`)},()=>{console.debug(`${h}${i/10}`)},()=>{console.debug(`${h}${["shelf","peak"][+!!i]}`)}][d]()}})}).add([76,3],s=>{}).add([76,6,0],s=>{let i=s[0];t.#l=" ".repeat(i),t.#G=Date.now()+3200,s.slice(1).forEach(function(n){t.#l+=String.fromCharCode(n)}),t.#l=t.#l.padEnd(32," ")}).add([76,7,0],s=>{let i=s[0];t.#y=Date.now()+3200,t.#b.fill(0);let n=s.slice(1);for(let c=0;c<i;c++)n.unshift(0);n.forEach(function(c,r){let d=Math.floor(r/16),h=r%16,f=(h*3+d)*7,b=7,$=0;for(f-=h*5,d==2&&(b=2);$<b;)t.#b[f+$]=c>>6-$&1,$++})}).add([76,8],(s,i)=>{let n=t.chRedir(s[0],i,!0),c=s[1],r=u.cc*n,d=`XG CH${n+1} `,h=`Unknown XG part address ${c}.`;c<1?console.debug(h):c<41?s.slice(2).forEach((f,b)=>{([()=>{t.#e[r+l[0]]=f},()=>{t.#e[r+l[32]]=f},()=>{t.#c[n]=f},()=>{let $=t.chRedir(f,i,!0);t.#d[n]=$,n!=$&&(t.buildRchTree(),console.info(`${d}receives from CH${$+1}`))},()=>{t.#k[n]=+!f},()=>{},()=>{t.#e[r+l[0]]=f>1?127:0,console.debug(`${d}type: ${v[f]}`)},()=>{t.#r[u.rpn*n+3]=f},!1,!1,()=>{t.#e[r+l[7]]=f},!1,!1,()=>{t.#e[r+l[10]]=f||128},!1,!1,()=>{t.#e[r+l[11]]=f},()=>{t.#e[r+l[93]]=f},()=>{t.#e[r+l[91]]=f},()=>{t.#e[r+l[94]]=f},()=>{t.#e[r+l[76]]=f},()=>{t.#e[r+l[77]]=f},()=>{t.#e[r+l[78]]=f},()=>{t.#e[r+l[74]]=f},()=>{t.#e[r+l[71]]=f},()=>{t.#e[r+l[73]]=f},()=>{t.#e[r+l[75]]=f},()=>{t.#e[r+l[72]]=f}][c+b-1]||function(){})()}):c<48?console.debug(h):c<111?c>102&&c<105&&(t.#e[r+l[[5,65][c&1]]]=e):c<114?console.debug(h):c<116?console.debug(`${d}EQ ${["bass","treble"][c&1]} gain: ${e-64}dB`):c<118?console.debug(h):c<120?console.debug(`${d}EQ ${["bass","treble"][c&1]} freq: ${e}`):console.debug(h)}).add([76,10],s=>{}).add([76,16],s=>{}).add([76,17,0,0],s=>{}).add([112],s=>{console.debug(`XG plugin PLG100-${["VL","SG","DX"][s[0]]} enabled for channel ${s[2]+1}.`)}),this.#P.add([76,48],s=>{}).add([76,49],s=>{}).add([76,50],s=>{}).add([76,51],s=>{}),this.#m.add([66,18,0,0,127],s=>{t.switchMode("gs",!0),t.#e[u.cc*9]=120,t.#e[u.cc*25]=120,t.#e[u.cc*41]=120,t.#e[u.cc*57]=120,t.#v=3,t.#s=!1,t.#g.fill(0),console.info(`GS system to ${["single","dual"][s[0]]} mode.`)}).add([66,18,64,0],s=>{switch(s[0]){case 127:{t.switchMode("gs",!0),t.#e[u.cc*9]=120,t.#e[u.cc*25]=120,t.#e[u.cc*41]=120,t.#e[u.cc*57]=120,t.#s=!1,t.#g.fill(0),console.info("MIDI reset: GS");break}default:{let i=[0,0,0,0],n=(c,r)=>{i[r]=c};if(s.slice(1).forEach((c,r)=>{let d=r+s[0];[n,n,n,n,h=>{this.#u=h*129/16383*100},h=>{},h=>{}][d](c,r)}),s[0]<4){let c=0;i.forEach(r=>{c=c<<4,c+=r}),c-=1024}}}}).add([66,18,64,1],s=>{let i=s[0];if(i<16){let n="".padStart(i," ");s.slice(1).forEach((c,r)=>{n+=String.fromCharCode(Math.max(32,c))}),n=n.padEnd(16," "),console.debug(`GS patch name: ${n}`)}else i<48||(i<65?s.slice(1).forEach((n,c)=>{let r=`GS ${i+c>55?"chorus":"reverb"} `;([()=>{console.info(`${r}type: ${L[n]}`)},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${r}predelay: ${n}ms`)},()=>{console.info(`${r}type: ${U[n]}`)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${r}to reverb: ${p(n)}`)},()=>{console.debug(`${r}to delay: ${p(n)}`)}][i+c-48]||function(){})()}):i<80?console.debug(`Unknown GS patch address: ${i}`):i<91?s.slice(1).forEach((n,c)=>{let r="GS delay ";([()=>{console.info(`${r}type: ${I[n]}`)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${r}to reverb: ${p(n)}`)}][i+c-80]||function(){})()}):console.debug(`Unknown GS patch address: ${i}`))}).add([66,18,64,2],s=>{let i="GS EQ ";s.slice(1).forEach((n,c)=>{([()=>{console.debug(`${i}low freq: ${[200,400][n]}Hz`)},()=>{console.debug(`${i}low gain: ${n-64}dB`)},()=>{console.debug(`${i}high freq: ${[3e3,6e3][n]}Hz`)},()=>{console.debug(`${i}high gain: ${n-64}dB`)}][s[0]+c]||function(){console.warn(`Unknown GS EQ address: ${s[0]+c}`)})()})}).add([66,18,64,3],s=>{let i="GS EFX ",n=function(c,r){let d=B(t.#p,r,c);d&&console.debug(`${i}${M(t.#p)} ${d}`)};s.slice(1).forEach((c,r)=>{([()=>{t.#p[0]=c},()=>{t.#p[1]=c,console.info(`${i}type: ${M(t.#p)}`)},!1,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,()=>{console.debug(`${i}to reverb: ${p(c)}dB`)},()=>{console.debug(`${i}to chorus: ${p(c)}dB`)},()=>{console.debug(`${i}to delay: ${p(c)}dB`)},!1,()=>{console.debug(`${i}1 source: ${c}`)},()=>{console.debug(`${i}1 depth: ${c-64}`)},()=>{console.debug(`${i}2 source: ${c}`)},()=>{console.debug(`${i}2 depth: ${c-64}`)},()=>{console.debug(`${i}to EQ: ${c?"ON":"OFF"}`)}][s[0]+r]||function(d,h){console.warn(`Unknown GS EFX address: ${h}`)})(c,s[0]+r)})}).add([66,18,65],s=>{}).add([69,18,16],s=>{switch(s[0]){case 0:{t.#G=Date.now()+3200;let i=s[1];t.#l=" ".repeat(i),s.slice(2).forEach(function(n){n<128&&(t.#l+=String.fromCharCode(n))});break}case 32:{t.#y=Date.now()+3200,s[1]==0&&(t.#x=Math.max(Math.min(s[2]-1,9),0));break}default:if(s[0]<11){t.#y=Date.now()+3200,t.#E[s[0]-1]?.length||(t.#E[s[0]-1]=new Uint8Array(256));let i=t.#E[s[0]-1],n=s[1];i.fill(0);let c=s.slice(2);for(let r=0;r<n;r++)c.unshift(0);c.forEach(function(r,d){let h=Math.floor(d/16),f=d%16,b=(f*4+h)*5,$=5,E=0;for(b-=f*4,h==3&&($=1);E<$;)i[b+E]=r>>4-E&1,E++})}else console.warn(`Unknown GS display section: ${s[0]}`)}});let o=function(s,i,n){let c=s[0],r=u.cc*i,d=u.rpn*i,h=`GS CH${i+1} `;c<3?s.slice(1).forEach((f,b)=>{[()=>{t.#e[r+l[0]]=f},()=>{t.#c[i]=f},()=>{let $=t.chRedir(f,n,!0);t.#d[i]=$,i!=$&&(t.buildRchTree(),console.info(`${h}receives from CH${$+1}`))}][c+b]()}):c<19||(c<44?s.slice(1).forEach((f,b)=>{([()=>{t.#k[i]=+!f},!1,()=>{t.#e[r+l[0]]=f?120:0,console.debug(`${h}type: ${f?"drum ":"melodic"}${f||""}`)},()=>{t.#r[d+3]=f},!1,()=>{t.#e[r+l[7]]=f},!1,!1,()=>{t.#e[r+l[10]]=f||128},!1,!1,()=>{console.debug(`${h}CC 1: cc${f}`)},()=>{console.debug(`${h}CC 2: cc${f}`)},()=>{t.#e[r+l[93]]=f},()=>{t.#e[r+l[91]]=f},!1,!1,()=>{t.#r[d+1]=f},()=>{t.#r[d+2]=f},()=>{t.#e[r+l[94]]=f}][c+b-19]||function(){})()}):c<76||console.debug(`Unknown GS part address: ${c}`))},a=function(s,i){let n=s[0],c=`GS CH${i+1} `;n<2?s.slice(1).forEach((r,d)=>{[()=>{t.#e[u.cc*i+l[32]]=r},()=>{}][n+d]()}):n<32?console.warn(`Unknown GS misc address: ${n}`):n<35?s.slice(1).forEach((r,d)=>{[()=>{console.debug(`${c}EQ: o${["ff","n"][r]}`)},()=>{},()=>{console.debug(`${c}EFX: o${["ff","n"][r]}`)}][n+d-32]()}):console.warn(`Unknown GS misc address: ${n}`)};this.#m.add([66,18,64,16],(s,i)=>{o(s,t.chRedir(9,i,!0),i)}).add([66,18,64,17],(s,i)=>{o(s,t.chRedir(0,i,!0),i)}).add([66,18,64,18],(s,i)=>{o(s,t.chRedir(1,i,!0),i)}).add([66,18,64,19],(s,i)=>{o(s,t.chRedir(2,i,!0),i)}).add([66,18,64,20],(s,i)=>{o(s,t.chRedir(3,i,!0),i)}).add([66,18,64,21],(s,i)=>{o(s,t.chRedir(4,i,!0),i)}).add([66,18,64,22],(s,i)=>{o(s,t.chRedir(5,i,!0),i)}).add([66,18,64,23],(s,i)=>{o(s,t.chRedir(6,i,!0),i)}).add([66,18,64,24],(s,i)=>{o(s,t.chRedir(7,i,!0),i)}).add([66,18,64,25],(s,i)=>{o(s,t.chRedir(8,i,!0),i)}).add([66,18,64,26],(s,i)=>{o(s,t.chRedir(10,i,!0),i)}).add([66,18,64,27],(s,i)=>{o(s,t.chRedir(11,i,!0),i)}).add([66,18,64,28],(s,i)=>{o(s,t.chRedir(12,i,!0),i)}).add([66,18,64,29],(s,i)=>{o(s,t.chRedir(13,i,!0),i)}).add([66,18,64,30],(s,i)=>{o(s,t.chRedir(14,i,!0),i)}).add([66,18,64,31],(s,i)=>{o(s,t.chRedir(15,i,!0),i)}).add([66,18,64,64],(s,i)=>{a(s,t.chRedir(9,i,!0))}).add([66,18,64,65],(s,i)=>{a(s,t.chRedir(0,i,!0))}).add([66,18,64,66],(s,i)=>{a(s,t.chRedir(1,i,!0))}).add([66,18,64,67],(s,i)=>{a(s,t.chRedir(2,i,!0))}).add([66,18,64,68],(s,i)=>{a(s,t.chRedir(3,i,!0))}).add([66,18,64,69],(s,i)=>{a(s,t.chRedir(4,i,!0))}).add([66,18,64,70],(s,i)=>{a(s,t.chRedir(5,i,!0))}).add([66,18,64,71],(s,i)=>{a(s,t.chRedir(6,i,!0))}).add([66,18,64,72],(s,i)=>{a(s,t.chRedir(7,i,!0))}).add([66,18,64,73],(s,i)=>{a(s,t.chRedir(8,i,!0))}).add([66,18,64,74],(s,i)=>{a(s,t.chRedir(10,i,!0))}).add([66,18,64,75],(s,i)=>{a(s,t.chRedir(11,i,!0))}).add([66,18,64,76],(s,i)=>{a(s,t.chRedir(12,i,!0))}).add([66,18,64,77],(s,i)=>{a(s,t.chRedir(13,i,!0))}).add([66,18,64,78],(s,i)=>{a(s,t.chRedir(14,i,!0))}).add([66,18,64,79],(s,i)=>{a(s,t.chRedir(15,i,!0))}),this.#R.add([54,76,0],(s,i)=>{t.switchMode("x5d",!0);let n="",c=82,r=0,d=0,h="MSB	PRG	LSB	NME";w(s,function(f,b){if(b<16400){let $=b%164;switch(!0){case $<10:{f>31&&(n+=String.fromCharCode(f));break}case $==11:{h+=`
${c}	${r}	${d}	${n.trim().replace("Init Voice","")}`,r++,n="";break}}r>99&&(c=90,r=0)}}),t.dispatchEvent("mapupdate",{clearRange:{msb:82,prg:[0,99],lsb:0},voiceMap:h})}).add([54,77,0],(s,i)=>{t.switchMode("x5d",!0);let n="",c=90,r=0,d=0,h="MSB	PRG	LSB	NME";w(s,function(f,b){if(b<13600){let $=b%136;switch(!0){case $<10:{f>31&&(n+=String.fromCharCode(f));break}case $==11:{h+=`
${c}	${r}	${d}	${n.trim().replace("Init Combi","")}`,r++,n="";break}}}}),t.dispatchEvent("mapupdate",{clearRange:{msb:90,prg:[0,99],lsb:0},voiceMap:h})}).add([54,104],(s,i)=>{t.switchMode("x5d",!0),w(s,function(n,c){if(c<192){let r=t.chRedir(Math.floor(c/12),i,!0),d=r*u.cc;switch(c%12){case 0:{t.#c[r]=n,n>0&&(t.#h[r]=1);break}case 1:{t.#e[d+l[7]]=n;break}case 2:{t.#r[r*u.rpn+3]=n>127?256-n:64+n;break}case 3:{t.#r[r*u.rpn+1]=n>127?256-n:64+n;break}case 4:{n<31&&(t.#e[d+l[10]]=Math.round((n-15)*4.2+64));break}case 5:{let h=n>>4,f=n&15;t.#e[d+l[91]]=R(f),t.#e[d+l[93]]=R(h);break}case 10:{t.#e[d]=n&3?82:56;break}case 11:{let h=t.chRedir(n&15,i,!0),f=n>>4;t.#d[r]=n,(h!=r||f)&&(console.info(`X5D Part CH${r+1} receives from CH${h+1}.`),t.buildRchTree())}}}else{let r=t.chRedir(c-192,i,!0)}})}),this.#R.add([66,0],(s,i)=>{t.switchMode("ns5r",!0),t.#s=!1,console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][s[0]]} mode.`)}).add([66,1],(s,i)=>{t.switchMode(["ns5r","05rw"][s[0]],!0),t.#s=!1}).add([66,18,0,0],(s,i)=>{let n=s[0];switch(n){case 124:case 126:case 127:{t.switchMode("ns5r",!0),t.#s=!1;break}case 125:break;default:if(n<10){let c=[0,0,0,0],r=(d,h)=>{c[h]=d};if(s.slice(1).forEach((d,h)=>{[r,r,r,r,()=>{t.#u=d*129/16383*100},()=>d-64,()=>d-64,()=>{},()=>{},()=>{}][n+h]()}),s[0]<4){let d=0;c.forEach(h=>{d=d<<4,d+=h}),d-=1024}}}}).add([66,18,0,1],(s,i)=>{}).add([66,18,0,2],(s,i)=>{}).add([66,18,1],(s,i)=>{let n=t.chRedir(s[0],i,!0),c=n*u.cc,r=s[1],d=`NS5R CH${n+1}`;s.slice(2).forEach((h,f)=>{let b=r+f;b<3?[()=>{t.#e[c+l[0]]=h},()=>{t.#e[c+l[32]]=h},()=>{t.#c[n]=h}][b]():b<8||(b<14?[()=>{let $=t.chRedir(h,i,!0);t.#d[n]=$,n!=$&&(t.buildRchTree(),console.info(`${d}receives from CH${$+1}`))},()=>{t.#k[n]=+!h},()=>{console.debug(`${d}type: ${v[h]}`)},()=>{t.#r[u.rpn*n+3]=h},()=>{},()=>{}][b-8]():b<16||(b<33?[()=>{t.#e[c+l[7]]=h},()=>{t.#e[c+l[11]]=h},()=>{},()=>{},()=>{t.#e[c+l[10]]=h||128},()=>{},()=>{},()=>{t.#e[c+l[93]]=h},()=>{t.#e[c+l[91]]=h},()=>{t.#e[c+l[76]]=h},()=>{t.#e[c+l[77]]=h},()=>{t.#e[c+l[78]]=h},()=>{t.#e[c+l[74]]=h},()=>{t.#e[c+l[71]]=h},()=>{t.#e[c+l[73]]=h},()=>{t.#e[c+l[75]]=h},()=>{t.#e[c+l[72]]=h}][b-16]():b<112||b<114&&[()=>{t.#e[c+l[5]]=h},()=>{t.#e[c+l[65]]=h}][b-112]()))})}).add([66,18,8,0],(s,i)=>{}).add([66,52],(s,i)=>{t.switchMode("ns5r",!0),t.#s=!1}).add([66,53],(s,i)=>{t.switchMode("ns5r",!0),t.#s=!1,w(s,function(n,c){switch(!0){case c<2944:{let r=t.chRedir(Math.floor(c/92),i,!0),d=r*u.cc;switch(c%92){case 0:{t.#e[d+l[0]]=n;break}case 1:{t.#e[d+l[32]]=n;break}case 2:{t.#c[r]=n,n>0&&(t.#h[r]=1);break}case 3:{let h=t.chRedir(n,i,!0);t.#d[r]=h,r!=h&&(console.info(`NS5R CH${r+1} receives from CH${h+1}.`),t.buildRchTree())}case 7:break;case 8:{t.#r[r*u.rpn+3]=n<40||n>88?n+(n>63?-192:64):n;break}case 9:case 10:{t.#e[d+l[7]]=n;break}case 11:{t.#e[d+l[11]]=n;break}case 14:{t.#e[d+l[10]]=n||128;break}case 19:{t.#e[d+l[93]]=n;break}case 20:{t.#e[d+l[91]]=n;break}case 84:{t.#e[d+l[65]]=n;break}case 85:{t.#e[d+l[5]]=n;break}}break}case c<3096:break;case c<3134:break;case c<8566:break}})}).add([66,54],(s,i)=>{t.switchMode("ns5r",!0);let n="",c=80,r=0,d=0,h="MSB	PRG	LSB	NME";w(s,function(f,b){let $=b%158;switch(!0){case $<10:{f>31&&(n+=String.fromCharCode(f));break}case $==11:{c=f;break}case $==12:{d=f;break}case $==13:{h+=`
${c}	${r}	${d}	${n.trim().replace("Init Voice","")}`,r++,n="";break}}}),t.dispatchEvent("mapupdate",{clearRange:{msb:80,lsb:0},voiceMap:h})}).add([66,55],(s,i)=>{t.switchMode("ns5r",!0);let n="",c=88,r=0,d=0,h="MSB	PRG	LSB	NME";w(s,function(f,b){let $=b%126;switch(!0){case $<10:{f>31&&(n+=String.fromCharCode(f));break}case $==11:break;case $==12:break;case $==13:{h+=`
${c}	${r}	${d}	${n.trim().replace("Init Combi","")}`,r++,n="";break}}}),t.dispatchEvent("mapupdate",{clearRange:{msb:88,lsb:0},voiceMap:h})}).add([66,125],s=>{t.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][s[0]]||"white")}).add([76],(s,i,n)=>{t.#R.run([66,...s],i,n)})}};export{he as OctaviaDevice,u as allocated,l as ccToPos};
