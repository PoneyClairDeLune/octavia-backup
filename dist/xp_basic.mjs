var Jt=Object.create;var ot=Object.defineProperty;var er=Object.getOwnPropertyDescriptor;var tr=Object.getOwnPropertyNames;var rr=Object.getPrototypeOf,ar=Object.prototype.hasOwnProperty;var ir=(u,e,o)=>e in u?ot(u,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):u[e]=o;var Et=(u,e)=>()=>(u&&(e=u(u=0)),e);var sr=(u,e)=>()=>(e||u((e={exports:{}}).exports,e),e.exports);var nr=(u,e,o,h)=>{if(e&&typeof e=="object"||typeof e=="function")for(let c of tr(e))!ar.call(u,c)&&c!==o&&ot(u,c,{get:()=>e[c],enumerable:!(h=er(e,c))||h.enumerable});return u};var or=(u,e,o)=>(o=u!=null?Jt(rr(u)):{},nr(e||!u||!u.__esModule?ot(o,"default",{value:u,enumerable:!0}):o,u));var M=(u,e,o)=>(ir(u,typeof e!="symbol"?e+"":e,o),o),mt=(u,e,o)=>{if(!e.has(u))throw TypeError("Cannot "+o)};var t=(u,e,o)=>(mt(u,e,"read from private field"),o?o.call(u):e.get(u)),v=(u,e,o)=>{if(e.has(u))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(u):e.set(u,o)},w=(u,e,o,h)=>(mt(u,e,"write to private field"),h?h.call(u,o):e.set(u,o),o);var kt=Et(()=>{"use strict";O();(function(){var u=function(n,s,i){var f,l;if(self.MessageEvent)switch(n){case"message":{l=new MessageEvent(n,{data:s,ports:i==null?void 0:i.ports}),Object.defineProperty(l,"source",{value:i==null?void 0:i.source});break}default:l=new Event(n)}else l=document.createEvent("Event"),l.initEvent(n,!1,!1),i&&n=="message"&&(l.data=s,i.source&&Object.defineProperty(l,"source",{value:i.source}),(f=i.ports)!=null&&f.length&&Object.defineProperty(l,"ports",{value:i.ports}));return l};self.BroadcastChannel?console.info("[Snowy] Snowy is disabled."):(console.info("[Snowy] Snowy is enabled. Path: ".concat(self.SNOWY_PATH||"/snowy.js")),o=[],h={},c=function(n){var s,i=this;if((this==null?void 0:this.constructor)!=c)throw new TypeError("Illegal constructor");o.push(this),(s=h[n])!=null&&s.constructor||(h[n]=[]),h[n].push(this);var f=Math.floor(Math.random()*281474976710656),l=[],d=0,b=[],y=!0,k=!1;Object.defineProperty(this,"id",{get:function(){return f}}),Object.defineProperty(this,"name",{value:n}),this.close=function(){var E,x=o.indexOf(i);x>-1?(e.postMessage({t:"d",c:n,i:f}),o.splice(x,1),(E=h[n])!=null&&E.constructor&&(x=h[n].indexOf(i),x>-1&&h[n].splice(x,1)),h[n].length||delete h[n],console.debug("[Snowy] BroadcastChannel closed."),k=!0):console.debug("[Snowy] BroadcastChannel already closed.")},this.postMessage=function(E){if(e){if(k)throw new Error("Channel already closed");e.postMessage({t:"m",c:n,i:f,m:d,d:E}),d++,d>4294967295&&(d=0)}else b.push(E),console.debug("[Snowy] Message is cached.")},this.flush=function(){if(e){if(y){for(e.postMessage({t:"r",c:n,i:f}),console.debug("[Snowy] ".concat(b.length," message(s) in cache."));b.length;){var E=b.shift();i.postMessage(E)}y=!1,console.debug("[Snowy] All cached messages are flushed away.")}}else throw new Error("Tried to flush when the ports are not ready")},this.receiveMessage=function(E){E.c==n?E.i!=f&&i.dispatchEvent(u("message",E.d,{source:i})):console.debug("[Snowy] Channel ID mismatch. Instance ".concat(f," receives from ").concat(n,", not ").concat(E.c,"."))};var m={};this.dispatchEvent=function(E){var x,P;if(Object.defineProperty(E,"target",{value:i}),Object.defineProperty(E,"currentTarget",{value:i}),(x=m[E.type])!=null&&x.length)for(var F=m[E.type],ae=0;ae<F.length;ae++)((P=F[ae])==null?void 0:P.constructor)==Function&&F[ae].call(i,E);i["on".concat(E.type)]&&i["on".concat(E.type)].constructor==Function&&i["on".concat(E.type)].call(i,E)},this.addEventListener=function(E,x){var P;(P=m[E])!=null&&P.constructor||(m[E]=[]);var F=m[E].indexOf(x);F==-1&&m[E].push(x)},this.removeEventListener=function(E,x){var P,F;if((P=m[E])!=null&&P.length){var ae=m[E].indexOf(x);ae>-1&&m[E].splice(ae,1)}!((F=m[E])!=null&&F.length)&&m[E].constructor&&delete m[E]}},self.BroadcastChannel=c,r=function(){if(e){e.addEventListener("message",function(s){var i=s.data,f=!1;switch(i.t){case"k":{f=!1,e.postMessage({t:"k"});break}case"m":{var l=h[i.c];if(l!=null&&l.length)for(var d=0;d<l.length;d++)l[d].receiveMessage(i);break}case"c":{for(var b=[],y=0;y<o.length;y++){var k=o[y].name;b.indexOf(k)<0&&b.push(k)}e.postMessage({t:"k",c:b});break}default:f=!0}f&&console.info("ReceiveBroadcast",i)});for(var n=0;n<o.length;n++)o[n].flush()}else throw new Error("Message port isn't yet ready");console.info("[Snowy] Snowy is active.")},a=function(){if(!e){var n=new SharedWorker(self.SNOWY_PATH||"/snowy.js");n.port.start();var s=function(i){i.data.t=="swc"&&(n.port.removeEventListener("message",s),e=n.port,e.postMessage({t:"k"}),r())};n.port.addEventListener("message",s)}},a());var e,o,h,c,r,a})()});var O=Et(()=>{"use strict";kt();{let u=function(e,o){let h=new FileReader;return new Promise((c,r)=>{switch(h.addEventListener("abort",()=>{r(new Error("Blob read aborted"))}),h.addEventListener("error",a=>{r(h.error||a.data||new Error("Blob read error"))}),h.addEventListener("load",()=>{c(h.result)}),o.toLowerCase()){case"arraybuffer":case"buffer":{h.readAsArrayBuffer(e);break}case"string":case"text":{h.readAsText(e);break}default:r(new Error(`Unknown target ${o}`))}})};Blob.prototype.arrayBuffer=Blob.prototype.arrayBuffer||function(){return u(this,"buffer")},Blob.prototype.text=Blob.prototype.text||function(){return u(this,"text")}}String.prototype.replaceAll=String.prototype.replaceAll||function(u,e){let o=0,h=16,c=this,r=[];for(;o<h&&c.lastIndexOf(u)>-1;){let a=c.lastIndexOf(u);r.unshift(c.slice(a+u.length)),c=c.slice(0,a),a==0&&r.unshift(""),o++}return c.length&&r.unshift(c),r.join(e)||""},String.prototype.padStart=String.prototype.padStart||function(u,e){if(e){let o=this;for(;o.length<u;)o=`${e}${o}`;return o}},String.prototype.padEnd=String.prototype.padEnd||function(u,e){if(e){let o=this;for(;o.length<u;)o+=e;return o}}});var zt=sr((Wr,yt)=>{O();(function(){"use strict";let u={fatal:!0},e=[new TextDecoder("iso-8859-15",u),new TextDecoder("sjis",u),new TextDecoder("euc-jp",u),new TextDecoder("utf-8",u),new TextDecoder("utf-16",u),new TextDecoder("ascii")],o={debug:!1,parse:function(h,c){if(h instanceof Uint8Array)return o.Uint8(h);if(typeof h=="string")return o.Base64(h);if(h instanceof HTMLElement&&h.type==="file")return o.addListener(h,c);throw new Error("MidiParser.parse() : Invalid input provided")},addListener:function(h,c){if(!File||!FileReader)throw new Error("The File|FileReader APIs are not supported in this browser. Use instead MidiParser.Base64() or MidiParser.Uint8()");if(h===void 0||!(h instanceof HTMLElement)||h.tagName!=="INPUT"||h.type.toLowerCase()!=="file")return console.warn("MidiParser.addListener() : Provided element is not a valid FILE INPUT element"),!1;c=c||function(){},h.addEventListener("change",function(r){if(!r.target.files.length)return!1;console.log("MidiParser.addListener() : File detected in INPUT ELEMENT processing data..");let a=new FileReader;a.readAsArrayBuffer(r.target.files[0]),a.onload=function(n){c(o.Uint8(new Uint8Array(n.target.result)))}})},Base64:function(h){let c=function(n){var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(n=n.replace(/^.*?base64,/,""),n=String(n).replace(/[\t\n\f\r ]+/g,""),!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(n))throw new TypeError("Failed to execute _atob() : The string to be decoded is not correctly encoded.");n+="==".slice(2-(3&n.length));let i,f="",l,d,b=0;for(;b<n.length;)i=s.indexOf(n.charAt(b++))<<18|s.indexOf(n.charAt(b++))<<12|(l=s.indexOf(n.charAt(b++)))<<6|(d=s.indexOf(n.charAt(b++))),f+=l===64?String.fromCharCode(i>>16&255):d===64?String.fromCharCode(i>>16&255,i>>8&255):String.fromCharCode(i>>16&255,i>>8&255,255&i);return f}(h=String(h));var r=c.length;let a=new Uint8Array(new ArrayBuffer(r));for(let n=0;n<r;n++)a[n]=c.charCodeAt(n);return o.Uint8(a)},Uint8:function(a){let c={data:null,pointer:0,movePointer:function(l){return this.pointer+=l,this.pointer},readInt:function(l){if((l=Math.min(l,this.data.byteLength-this.pointer))<1)return-1;let d=0;if(1<l)for(let b=1;b<=l-1;b++)d+=this.data.getUint8(this.pointer)*Math.pow(256,l-b),this.pointer++;return d+=this.data.getUint8(this.pointer),this.pointer++,d},readStr:function(l){let d=new Uint8Array(l),b=!1,y;d.forEach((k,m)=>{d[m]=this.readInt(1)});for(let k=0;k<e.length;k++)if(!b)try{if(y=e[k].decode(d),k==0)for(let m=0;m<y.length;m++){let E=y.charCodeAt(m);if(E>191||E>127&&E<160)throw new RangeError(`Invalid code point: ${E}`)}b=!0,console.debug(`String byte sequence in ${e[k].encoding}`)}catch(m){console.debug(`SMF string ${m}`)}return y||"String byte sequence read failed."},backOne:function(){this.pointer--},readIntVLV:function(){let l=0;if(this.pointer>=this.data.byteLength)return-1;if(this.data.getUint8(this.pointer)<128)l=this.readInt(1);else{let b=[];for(;128<=this.data.getUint8(this.pointer);)b.push(this.readInt(1)-128);var d=this.readInt(1);for(let y=1;y<=b.length;y++)l+=b[b.length-y]*Math.pow(128,y);l+=d}return l}};if(c.data=new DataView(a.buffer,a.byteOffset,a.byteLength),c.readInt(4)!==1297377380)return console.warn("Header validation failed (not MIDI standard or file corrupt.)"),!1;c.readInt(4);let r={};r.formatType=c.readInt(2),r.tracks=c.readInt(2),r.track=[];var a=c.readInt(1),n=c.readInt(1);128<=a?(r.timeDivision=[],r.timeDivision[0]=a-128,r.timeDivision[1]=n):r.timeDivision=256*a+n;for(let l=1;l<=r.tracks;l++){r.track[l-1]={event:[]};var s,i=c.readInt(4);if(i===-1)break;if(i!==1297379947)return!1;c.readInt(4);let d=0,b=!1,y,k;for(;!b&&(d++,r.track[l-1].event[d-1]={},r.track[l-1].event[d-1].deltaTime=c.readIntVLV(),(y=c.readInt(1))!==-1);)if(128<=y?k=y:(y=k,c.movePointer(-1)),y===255){r.track[l-1].event[d-1].type=255,r.track[l-1].event[d-1].metaType=c.readInt(1);var f=c.readIntVLV();switch(r.track[l-1].event[d-1].metaType){case 47:case-1:b=!0;break;case 1:case 2:case 3:case 4:case 5:case 7:case 6:r.track[l-1].event[d-1].data=c.readStr(f);break;case 33:case 89:case 81:r.track[l-1].event[d-1].data=c.readInt(f);break;case 84:r.track[l-1].event[d-1].data=[],r.track[l-1].event[d-1].data[0]=c.readInt(1),r.track[l-1].event[d-1].data[1]=c.readInt(1),r.track[l-1].event[d-1].data[2]=c.readInt(1),r.track[l-1].event[d-1].data[3]=c.readInt(1),r.track[l-1].event[d-1].data[4]=c.readInt(1);break;case 88:r.track[l-1].event[d-1].data=[],r.track[l-1].event[d-1].data[0]=c.readInt(1),r.track[l-1].event[d-1].data[1]=c.readInt(1),r.track[l-1].event[d-1].data[2]=c.readInt(1),r.track[l-1].event[d-1].data[3]=c.readInt(1);break;default:this.customInterpreter!==null&&(r.track[l-1].event[d-1].data=this.customInterpreter(r.track[l-1].event[d-1].metaType,c,f)),this.customInterpreter!==null&&r.track[l-1].event[d-1].data!==!1||(c.readInt(f),r.track[l-1].event[d-1].data=c.readInt(f),this.debug&&console.info("Unimplemented 0xFF meta event! data block readed as Integer"))}}else switch((y=y.toString(16).split(""))[1]||y.unshift("0"),r.track[l-1].event[d-1].type=parseInt(y[0],16),r.track[l-1].event[d-1].channel=parseInt(y[1],16),r.track[l-1].event[d-1].type){case 15:this.customInterpreter!==null&&(r.track[l-1].event[d-1].data=this.customInterpreter(r.track[l-1].event[d-1].type,c,!1)),this.customInterpreter!==null&&r.track[l-1].event[d-1].data!==!1||(s=c.readIntVLV(),r.track[l-1].event[d-1].data=c.readInt(s),this.debug&&console.info("Unimplemented 0xF exclusive events! data block readed as Integer"));break;case 10:case 11:case 14:case 8:case 9:r.track[l-1].event[d-1].data=[],r.track[l-1].event[d-1].data[0]=c.readInt(1),r.track[l-1].event[d-1].data[1]=c.readInt(1);break;case 12:case 13:r.track[l-1].event[d-1].data=c.readInt(1);break;case-1:b=!0;break;default:if(this.customInterpreter!==null&&(r.track[l-1].event[d-1].data=this.customInterpreter(r.track[l-1].event[d-1].metaType,c,!1)),this.customInterpreter===null||r.track[l-1].event[d-1].data===!1)return console.log("Unknown EVENT detected... reading cancelled!"),!1}}return r},customInterpreter:null};if(typeof yt<"u")yt.exports=o;else{let h=typeof window=="object"&&window.self===window&&window||typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;h.MidiParser=o}})()});O();O();var X,St,at=(St=class{constructor(){v(this,X,{})}addEventListener(u,e){t(this,X)[u]||(t(this,X)[u]=[]),t(this,X)[u].unshift(e)}removeEventListener(u,e){if(t(this,X)[u]){let o=t(this,X)[u].indexOf(e);o>-1&&t(this,X)[u].splice(o,1),t(this,X)[u].length<1&&delete t(this,X)[u]}}dispatchEvent(u,e){var c;let o=new Event(u),h=this;o.data=e,((c=t(this,X)[u])==null?void 0:c.length)>0&&t(this,X)[u].forEach(function(r){try{r==null||r.call(h,o)}catch(a){console.error(a)}}),this[`on${u}`]&&this[`on${u}`](o)}},X=new WeakMap,St);O();O();var xt=function(u,e){let o=Math.min(u.length,e.length),h=u.slice(0,o),c=e.slice(0,o),r=0,a=0;for(;a<o&&r==0;)r=Math.sign(h[a]-c[a]),a++;return r},ie=function(u=""){this.name=u,this.pool=[],this.point=function(e,o=!1){if(this.pool.length>0){let h=this.pool.length,c=1<<Math.floor(Math.log2(h)),r=c,a=64;for(;c>=1&&a>=0;){if(a<=0)throw new Error("TTL reached.");if(r==h)r-=c;else{let s=xt(e,this.pool[r]);switch(s){case 0:{a=0;break}case 1:{r+c<=h&&(r+=c);break}case-1:{r!=0&&(r-=c);break}default:console.warn(`Unexpected result ${s}.`)}}c=c>>1,a--}let n=!0;if(r>=this.pool.length)n=!1;else{let s=this;this.pool[r].forEach(function(i,f,l){n&&i!=e[f]&&(n=!1)}),!n&&xt(e,this.pool[r])>0&&r++}return n||o?r:-1}else return o?0:-1},this.add=function(e,o){return e.data=o,this.pool.splice(this.point(e,!0),0,e),this},this.default=function(e){console.warn(`No match in "${this.name||"(unknown)"}" for "${e}". Default action not defined.`)},this.get=function(e){let o=this.point(e);if(o>-1)return this.pool[o].data;this.default(e)},this.run=function(e,...o){let h=this.point(e);h>-1?this.pool[h].data(e.slice(this.pool[h].length),...o):this.default(e,...o)}};O();var cr=["MSB","PRG","LSB"],ct=function(u){let e=Math.floor(u/10),o=u%10;return`${e.toString(16)}${o}`},K,Mt,lt=(Mt=class{constructor(...u){v(this,K,void 0);M(this,"strictMode",!1);this.loadFiles(...u)}get(u=0,e=0,o=0,h){let c=[u,e,o],r,a=Array.from(arguments);switch(h){case"xg":{u==32?a[2]+=4:u==33||u==35||u==36?a[2]+=5:u==79?a[0]=95:u==80?a[0]=96:u==81?a[0]=97:u==82?a[0]=98:u==83?a[0]=99:u==84&&(a[0]=100);break}case"gs":{u==0&&o<5?a[2]=0:u>125&&o<5&&o!=2&&(a[2]=u,a[0]=0);break}case"sg":{u==8&&o==0&&(a[2]=5);break}case"s90es":{o<8?a[2]+=17:o<32?a[2]+=13:a[2]=(a[2]>>3)+19;break}}let n=" ",s="M",i=!1,f=0;switch(a[0]){case 0:{a[2]==127?s="MT-a":a[2]==126?s="MT-b":a[2]==7?s="GM-k":a[2]==5?s="SG-a":a[2]==4?s="SP-l":a[2]==0||h=="gs"&&a[2]<5?s="GM-a":(s="y",i=!0);break}case 8:{h=="sg"?s="GM-s":s="r:";break}case 48:{s=`yM${(a[2]>>3).toString().padStart(2,"0")}`,i=!0;break}case 56:{s="GM-b";break}case 61:case 120:{s="rDrm";break}case 62:{s="kDrm";break}case 63:{let y=a[2];s=y<10?"kP:":"kC:",s+=y%10;break}case 64:{s="ySFX";break}case 67:{s="DX:S";break}case 80:case 81:case 82:case 83:{s=`Prg${"UABC"[a[0]-80]}`;break}case 88:case 89:case 90:case 91:{s=`Cmb${"UABC"[a[0]-88]}`;break}case 95:{s=`${["DR","PC"][a[2]]}-d`;break}case 96:{s=a[2]==106?"AP-a":"PF",a[2]>63&&(f=63),i=!0;break}case 97:{s="VL:",i=!0,f=112;break}case 98:{s="SG-a";break}case 99:{s="DX",a[2]>63&&(f=63),i=!0;break}case 100:{s="AN",a[2]>63&&(f=63),i=!0;break}case 121:{s=`GM-${a[2]?"":"a"}`,i=!0;break}case 122:{s="lDrm";break}case 126:{s="yDrS";break}case 127:{a[2]==127?s="rDrm":s="yDrm";break}default:a[0]<48?s="r:":s="M"}s.length<4&&(s+=`${(i?o:u)-f}`.padStart(4-s.length,"0")),h=="xg"&&u==16&&(r=`Voice${(o*128+e+1).toString().padStart(3,"0")}`,n=" ");let l=[a[0],a[1],a[2]];for(;!((r==null?void 0:r.length)>=0);)r=t(this,K)[a[1]||0][(a[0]<<7)+a[2]],r||(this.strictMode?(r="",n="?"):t(this,K)[a[1]||0][a[0]<<7]?a[0]==0?(a[2]=0,n="^"):a[2]<1?(a[0]=0,n="*"):(a[2]--,n="^"):u==48?(a[0]=0,a[2]=0,n="!"):u==62?(a[1]--,n=" ",a[1]<1&&!(r!=null&&r.length)&&(a[0]=0,n="!")):u<63?a[0]==0?(a[2]=0,n="^"):a[2]<1?(a[0]=0,n="*"):a[2]--:u==80?(r=`PrgU:${e.toString().padStart(3,"0")}`,n="!"):u==88?(r=`CmbU:${e.toString().padStart(3,"0")}`,n="!"):u==121?(r=`GM2Vox0${o}`,n="#"):u==122?(a[1]==32?a[1]==0:a[1]%=7,r=t(this,K)[a[1]||0][(a[0]<<7)+a[2]],r?n=" ":(r="",n="*")):a[1]==0?(r=`${u.toString().padStart(3,"0")} ${e.toString().padStart(3,"0")} ${o.toString().padStart(3,"0")}`,n="!"):a[0]==0?(a[2]=0,n="^"):a[2]>0?a[2]--:a[1]>0?(a[1]=0,n="!"):(a[0]=0,n="?"));let d=[a[0],a[1],a[2]];(h=="gs"||h=="ns5r")&&n=="^"&&(n=" "),u==127&&n=="^"&&(n=" "),n!=" "&&self.debugMode&&(r="");let b="??";switch(a[0]){case 0:{a[2]==0?b="GM":a[2]==5||a[2]==7?b="KG":a[2]<120?b="XG":a[2]==127&&(b="MT");break}case 48:{b="MU";break}case 56:{b="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{b="AI";break}case 62:case 82:case 90:{b="XD";break}case 63:{a[2]<17?b="KR":a[2]<28?b="ES":b="DS";break}case 64:case 126:{b="XG";break}case 67:case 99:{b="DX";break}case 81:{b="RW";break}case 95:{b=["DR","PC"][a[2]];break}case 96:{b=a[2]==106?"AP":"PF";break}case 97:{b="VL";break}case 98:{b="SG";break}case 100:{b="AN";break}case 120:{b="GS";break}case 121:{b=a[2]?"G2":"GM";break}case 122:{b="KG";break}case 127:{b=a[2]==127?"MT":e==0?"GM":"XG";break}default:a[0]<48&&(a[0]==16&&h=="xg"?b="XG":b="GS")}return{name:r||`${ct(u||0)} ${ct(e||0)} ${ct(o||0)}`,iid:l,eid:d,sid:c,ending:n,sect:s,standard:b}}async load(u,e,o){let h=this,c=[],r=0,a=0;u.split(`
`).forEach(function(n,s){let i=n.split("	"),f=[];s==0?i.forEach(function(l,d){c[cr.indexOf(l)]=d}):i.forEach(async function(l,d){var b;d>2?(t(h,K)[f[c[1]]]=t(h,K)[f[c[1]]]||[],(!((b=t(h,K)[f[c[1]]][(f[c[0]]<<7)+f[c[2]]])!=null&&b.length)||e)&&(t(h,K)[f[c[1]]][(f[c[0]]<<7)+f[c[2]]]=i[3],r++),a++):f.push(parseInt(i[d]))})}),e||console.debug(`Map "${o||"(internal)"}": ${a} total, ${r} loaded.`)}clearRange(u){let e=u.prg!=null?u.prg.constructor==Array?u.prg:[u.prg,u.prg]:[0,127],o=u.msb!=null?u.msb.constructor==Array?u.msb:[u.msb,u.msb]:[0,127],h=u.lsb!=null?u.lsb.constructor==Array?u.lsb:[u.lsb,u.lsb]:[0,127];for(let c=o[0];c<=o[1];c++){let r=c<<7;for(let a=h[0];a<=h[1];a++){let n=r+a;for(let s=e[0];s<=e[1];s++)delete t(this,K)[s][n]}}}init(){w(this,K,[]);for(let u=0;u<128;u++)t(this,K).push([""])}async loadFiles(...u){this.init();let e=this;u.forEach(async function(o,h){try{await fetch(`./data/bank/${o}.tsv`).then(function(c){return c.text()}).then(c=>{e.load(c,!1,o)})}catch(c){console.error(`Failed loading "${o}.tsv".`)}})}},K=new WeakMap,Mt);O();var je=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),Qe=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],lr=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],qe=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],Ct=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],Tt=function(u){let e=.1,o=-.3;return u>66?(e=5,o=315):u>56?(e=1,o=47):u>46&&(e=.5,o=18.5),e*u-o},Rt=function(u){return u>105?lr[u-106]:u>100?u*1.1-100:u/10},Ot=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),ht={};`hi*,
ka,か
ki,き
ku,く
ke,け
ko,こ
ky,き!
kw,くl
tsu,つ
ts,つl
sa,さ
si,すぃ
su,す
se,せ
so,そ
shi,し
sh,し!
ta,た
ti,てぃ
tu,とぅ
te,て
to,と
tchy,ち!
tchi,ち
na,な
ni,に
nu,ぬ
ne,ね
no,の
ny,に!
nn,ん
ha,は
hi,ひ
hu,ほぅ
he,へ
ho,ほ
hy,ひ!
fa,ふぁ
fi,ふぃ
fu,ふ
fe,ふぇ
fo,ふぉ
ma,ま
mi,み
mu,む
me,め
mo,も
my,み!
mm,
ra,ら
ri,り
ru,る
re,れ
ro,ろ
ry,り!
wa,わ
wi,うぃ
we,うぇ
wo,を
nga,ガ
ngi,ギ
ngu,グ
nge,ゲ
ngo,ゴ
ngy,ギ!
ng,
ga,が
gi,ぎ
gu,ぐ
ge,げ
go,ご
gy,ぎ!
gw,ぐl
za,ざ
zi,ずぃ
zu,ず
ze,ぜ
zo,ぞ
ja,じゃ
ji,じ
ju,じゅ
je,じぇ
jo,じょ
jy,じ!
da,だ
di,でぃ
du,どぅ
de,で
do,ど
dy,で!
ba,ば
bi,び
bu,ぶ
be,べ
bo,ぼ
by,び!
va,ゔぁ
vi,ゔぃ
vu,ゔ
ve,ゔぇ
vo,ゔぉ
pa,ぱ
pi,ぴ
pu,ぷ
pe,ペ
po,ぽ
py,ぴ!
!ya,ゃ
!yu,ゅ
!ye,ぇ
!yo,ょ
ya,や
yu,ゆ
ye,いぇ
yo,よ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
la,ぁ
li,ぃ
lu,ぅ
le,ぇ
lo,ぉ
a,あ
i,い
u,う
e,え
o,お
*,っ
~,
^,
_,`.split(`
`).forEach(u=>{let e=u.split(",");ht[e[0]]=e[1]});var At=function(u){let e=u;u[0]=="*"&&(e=e.slice(1)),["aa","ii","uu","ee","oo"].forEach(h=>{for(;e.indexOf(h)>-1;)e=e.replace(h,h[0])});for(let h in ht)e=e.replaceAll(h,ht[h]);e.indexOf("ん")==0&&e.length>1&&(e=e.slice(1));let o=e.indexOf("!");return o>-1&&e.length>1&&(e=e.slice(o+1)),e},It=function(u){return u?u<96?`cc${u}`:["aftertouch","velocity","pitch bend"][u-96]:"off"};O();var dt=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],Dt=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],Pt=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var hr={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},dr={66307:["drive"],66309:["vowel",u=>"aiueo"[u]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",u=>["off","LPF","HPF"][u]],94984:["noise type",u=>["white","pink"][u]],94987:["disc type",u=>["LP","SP","EP","RND"]],94990:["hum type",u=>`${u+5}0Hz`],94993:["M/S",u=>["mono","stereo"][u]]},ft=function(u){return hr[(u[0]-32<<8)+u[1]]||`0x${u[0].toString(16).padStart(2,"0")}${u[1].toString(16).padStart(2,"0")}`},Ut=function(u,e,o){let h=(u[0]-32<<16)+(u[1]<<8)+e,c=dr[h]||{},r=c[0];if(r!=null&&r.length)return r+=`: ${(c[1]||function(){})(o)||o}`,r},ut=[68,48,95,78,41,3,110,122,0];O();var z=function(u=64){return Math.round(2e3*Math.log10(u/64))/100},Lt=function(u,e,o){let h=[],c=o==!1?e.readIntVLV():o;u==0||u==127;for(let r=0;r<c;r++){let a=e.readInt(1);if(h.push(a),a!=247){if(a!=240){if(a>127)return console.debug(`Early termination: ${h}`),h.pop(),e.backOne(),e.backOne(),new Uint8Array(h)}}}return new Uint8Array(h)},Bt=function(u){let e=0;return u.forEach(o=>{e+=o,e=e&127}),~e+1&127},se=function(u,e){let o=0,h=0;for(let c=0;c<u.length;c++){let r=c%8-1,a=(h>>r&1)<<7,n=u[c];n+=a,c%8!=0?(e(n,o,u),o++):h=u[c]}},Ye=function(u){let e=Math.floor(u*14.2);return e<128?e:0};var $e=["?","gm","gs","xg","g2","mt32","ns5r","ag10","x5d","05rw","k11","sg","krs","s90es"],Nt=[[0,0,0,0,121,0,0,56,82,81,63,0,0,63],[0,0,4,0,0,127,0,0,0,0,0,0,0,0]],Me=[120,127,120,127,120,127,61,62,62,62,120,122,122,127],fr=[0,3,81,84,88],Ht={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},pt={0:0,1:1,2:3,5:4},Gt=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],_t=[36,37],st=[20,21,22,23,24,25,26,28,29,30,31,36,37,64,65],We=[0,1,2,4,5,6,7,8,10,11,32,38,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,84,91,92,93,94,95,98,99,100,101,128,12,13,16,17,18,19],ur=[12,13,16,17,18,19],pr=[33,99,100,32,102,8,9,10],Ft=[0,16,25,40,32,64,26,48],C={};$e.forEach((u,e)=>{C[u]=e});var g={length:We.length};We.forEach((u,e)=>{g[u]=e});var bt={length:st.length};st.forEach((u,e)=>{bt[u]=e});var W=function(){return!!self.Bun||self.debugMode||!1},gr=function(u){let e=[],o=0;return u==null||u.forEach(function(h,c){h==247?e.push(u.subarray(o,c)):h==240&&(o=c+1)}),e.length||e.push(u.subarray(0)),W()&&console.debug(e),e},Vt=function(u,e="",o="",h=2){return u?`${e}${u.toString().padStart(h,"0")}${o}`:""},$={ch:128,cc:We.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,ace:8,drm:8,dpn:st.length,dnc:128,efx:7},I,j,ne,ue,Y,fe,Kt,V,N,R,p,pe,A,U,Z,L,H,we,oe,Ce,S,Ge,Ze,ce,ve,J,_e,Ee,Q,me,ee,q,ge,Fe,Ve,le,ke,Xe,te,D,Je,gt,T,be,Se,G,Te,B,et,it,Re,Oe,re,he,de,Ae,Ie,De,Xt,zr=(Xt=class extends at{constructor(){super();v(this,Y);M(this,"NOTE_IDLE",0);M(this,"NOTE_ATTACK",1);M(this,"NOTE_DECAY",2);M(this,"NOTE_SUSTAIN",3);M(this,"NOTE_HELD",4);M(this,"NOTE_RELEASE",5);M(this,"NOTE_SOSTENUTO_ATTACK",8);M(this,"NOTE_SOSTENUTO_DECAY",9);M(this,"NOTE_SOSTENUTO_SUSTAIN",10);M(this,"NOTE_SOSTENUTO_HELD",11);M(this,"CH_MELODIC",0);M(this,"CH_DRUMS",1);M(this,"CH_DRUM1",2);M(this,"CH_DRUM2",3);M(this,"CH_DRUM3",4);M(this,"CH_DRUM4",5);M(this,"CH_DRUM5",6);M(this,"CH_DRUM6",7);M(this,"CH_DRUM7",8);M(this,"CH_DRUM8",9);v(this,I,0);v(this,j,0);v(this,ne,0);v(this,ue,new Array(11));v(this,V,new Uint8Array($.ch));v(this,N,new Uint8Array($.ch));v(this,R,new Uint8Array($.ch));v(this,p,new Uint8Array($.ch*$.cc));v(this,pe,new Uint8Array($.ace));v(this,A,new Uint8Array($.ch));v(this,U,new Uint8Array($.ch*$.nn));v(this,Z,new Uint8Array($.ch));v(this,L,new Uint16Array($.pl));v(this,H,new Uint8Array($.pl));v(this,we,new Int16Array($.ch));v(this,oe,new Uint8Array($.ch));v(this,Ce,0);v(this,S,new Uint8Array($.ch*$.rpn));v(this,Ge,new Int8Array($.ch*_t.length));v(this,Ze,new Uint8Array($.drm*$.dpn*$.dnc));v(this,ce,new Uint8Array($.ch));v(this,ve,new Uint8Array(128));v(this,J,new Uint8Array($.cmt*8));v(this,_e,new Uint8Array(1024));v(this,Ee,new Uint8Array($.cmt*64));v(this,Q,new Uint8Array($.efx*3));v(this,me,0);v(this,ee,0);v(this,q,100);v(this,ge,0);v(this,Fe,500);v(this,Ve,0);v(this,le,"");v(this,ke,0);v(this,Xe,0);v(this,te,!0);v(this,D,!1);v(this,Je,void 0);v(this,gt,new Uint8Array(2));v(this,T,[]);v(this,be,new Uint8Array($.ch));v(this,Se,new Uint8Array($.tr));M(this,"baseBank",new lt("gm","gm2","xg","gs","ns5r","gmega","plg-150vl","plg-150pf","plg-150dx","plg-150an","plg-150dr","plg-100sg","kross","s90es"));M(this,"userBank",new lt("gm"));M(this,"initOnReset",!1);M(this,"aiEfxName","");v(this,G,[]);v(this,Te,void 0);v(this,B,{nOff:(e,o)=>{let h=e*128+o,c=t(this,L).lastIndexOf(h);c>-1&&(t(this,p)[$.cc*e+g[64]]>63?(t(this,H)[c]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:o,velo:t(this,U)[h],state:this.NOTE_HELD})):t(this,p)[$.cc*e+g[66]]>63&&t(this,H)[c]==this.NOTE_SOSTENUTO_SUSTAIN?(t(this,H)[c]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:o,velo:t(this,U)[h],state:this.NOTE_SOSTENUTO_HELD})):(t(this,L)[c]=0,t(this,U)[h]=0,t(this,H)[c]=this.NOTE_IDLE,this.dispatchEvent("note",{part:e,note:o,velo:0,state:this.NOTE_IDLE})))},nOn:(e,o,h)=>{let c=e*128+o,r=0;for(t(this,Z)[e]&&t(this,B).ano(e);t(this,H)[r]>0&&t(this,L)[r]!=c;)r++;r<$.pl?(t(this,L)[r]=c,t(this,U)[c]=h,t(this,H)[r]=this.NOTE_SUSTAIN,t(this,oe)[e]<h&&(t(this,oe)[e]=h),this.dispatchEvent("note",{part:e,note:o,velo:h,state:this.NOTE_SUSTAIN})):console.error("Polyphony exceeded.")},nAt:(e,o,h)=>{},cAt:(e,o)=>{},hoOf:e=>{t(this,H).forEach((o,h)=>{if(o==this.NOTE_HELD){let c=t(this,L)[h],r=c>>7;e==r&&(t(this,H)[h]=this.NOTE_IDLE,t(this,L)[h]=0,t(this,U)[c]=0,this.dispatchEvent("note",{part:e,note:c&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{t(this,H).forEach((o,h)=>{let c;switch(o){case this.NOTE_ATTACK:{c=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{c=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{c=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(c){t(this,H)[h]=c;let r=t(this,L)[h];this.dispatchEvent("note",{part:e,note:r&127,velo:t(this,U)[r],state:c})}})},soOf:e=>{t(this,H).forEach((o,h)=>{if(o==this.NOTE_SOSTENUTO_HELD){let c=t(this,L)[h],r=c>>7;e==r&&(t(this,H)[h]=this.NOTE_IDLE,t(this,L)[h]=0,t(this,U)[c]=0,this.dispatchEvent("note",{part:e,note:c&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{t(this,L).forEach((o,h,c)=>{let r=o>>7,a=o&127;o==0&&t(this,U)[0]==0||r==e&&t(this,B).nOff(r,a)})}});v(this,et,{8:function(e){let o=e.channel,h=e.data[0];t(this,B).nOff(o,h)},9:function(e){let o=e.channel;t(this,V)[o]=1;let h=e.data[0],c=e.data[1];c>0?t(this,B).nOn(o,h,c):t(this,B).nOff(o,h)},10:function(e){let o=e.channel,h=o*128+e.data[0];t(this,L).indexOf(h)>-1&&(t(this,U)[h]=data[1],this.dispatchEvent("note",{part:o,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let o=e.channel;t(this,V)[o]=1;let h=o*$.cc;switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{t(this,B).ano(o),t(this,we)[o]=0;let c=o*$.cc;t(this,p)[c+g[1]]=0,t(this,p)[c+g[5]]=0,t(this,p)[c+g[64]]=0,t(this,p)[c+g[65]]=0,t(this,p)[c+g[66]]=0,t(this,p)[c+g[67]]=0,t(this,p)[c+g[11]]=127,t(this,p)[c+g[101]]=127,t(this,p)[c+g[100]]=127,t(this,p)[c+g[99]]=127,t(this,p)[c+g[98]]=127;return}case 123:{t(this,B).ano(o);return}case 124:{t(this,B).ano(o);return}case 125:{t(this,B).ano(o);return}case 126:{t(this,Z)[o]=1,t(this,B).ano(o);return}case 127:{t(this,Z)[o]=0,t(this,B).ano(o);return}}if(g[e.data[0]]==null)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(ur.indexOf(e.data[0])>-1&&this.allocateAce(e.data[0]),e.data[0]){case 0:{if(W()&&console.debug(`${$e[t(this,I)]}, CH${o+1}: ${e.data[1]}`),t(this,I)==0)e.data[1]<48?(t(this,R)[o]>0&&(e.data[1]=t(this,p)[h],e.data[1]=120,console.debug(`Forced channel ${o+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),this.switchMode("gs"))):e.data[1]==62?this.switchMode("x5d"):e.data[1]==63?this.switchMode("krs"):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg");else if(t(this,I)==C.gs)e.data[1]<56&&t(this,R)[o]>0&&(e.data[1]=t(this,p)[h],e.data[1]=120,console.debug(`Forced channel ${o+1} to stay drums.`));else if(t(this,I)==C.gm)e.data[1]<48?t(this,R)[o]>0&&(e.data[1]=120,this.switchMode("gs",!0),console.debug(`Forced channel ${o+1} to stay drums.`)):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg",!0);else if(t(this,I)==C.x5d){if(e.data[1]>0&&e.data[1]<8)this.switchMode("05rw",!0);else if(e.data[1]==56){let c=0;for(let r=0;r<16;r++){let a=t(this,p)[$.cc*r];(a==56||a==62)&&c++}c>14&&this.switchMode("ag10",!0)}}switch(t(this,I)){case C.xg:{[126,127].indexOf(e.data[1])>-1?t(this,R)[o]==0&&(this.setChType(o,this.CH_DRUM2),console.debug(`CH${o+1} set to drums by MSB.`)):t(this,R)[o]>0&&(this.setChType(o,this.CH_MELODIC),console.debug(`CH${o+1} set to melodic by MSB.`));break}case C["05rw"]:case C.x5d:case C.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?t(this,R)[o]==0&&(this.setChType(o,this.CH_DRUM2),console.debug(`CH${o+1} set to drums by MSB.`)):t(this,R)[o]>0&&(this.setChType(o,this.CH_MELODIC),console.debug(`CH${o+1} set to melodic by MSB.`));break}case C.g2:{e.data[1]==120?t(this,R)[o]==0&&(this.setChType(o,this.CH_DRUMS),console.debug(`CH${o+1} set to drums by MSB.`)):t(this,R)[o]>0&&(this.setChType(o,this.CH_MELODIC),console.debug(`CH${o+1} set to melodic by MSB.`));break}}this.dispatchEvent("voice",{part:o});break}case 6:{if(t(this,Ce)){[C.xg,C.gs,C.ns5r].indexOf(t(this,I))<0&&console.warn(`NRPN commits are not available under "${$e[t(this,I)]}" mode, even when they are supported in Octavia.`);let c=t(this,p)[h+g[99]],r=t(this,p)[h+g[98]];if(c==1){let a=pr.indexOf(r);if(a>-1)t(this,p)[h+g[71+a]]=e.data[1],W()&&console.debug(`Redirected NRPN 1 ${r} to cc${71+a}.`),this.dispatchEvent("cc",{part:o,cc:71+a,data:e.data[1]});else{let n=_t.indexOf(r);n>-1?t(this,Ge)[o*10+n]=e.data[1]-64:console.warn(`NRPN 0x01${r.toString(16).padStart(2,"0")} is not supported.`),W()&&console.debug(`CH${o+1} voice NRPN ${r} commit`)}}else{if(st.indexOf(c)<0){let n=`NRPN 0x${c.toString(16).padStart(2,"0")}${r.toString(16).padStart(2,"0")} `;c==127?console.warn(`${n}is not necessary. Consider removing it.`):console.warn(`${n}is not supported.`)}else{let n=t(this,R)[o]-2;n<0?console.warn(`CH${o+1} cannot accept drum NRPN as type ${Qe[t(this,R)[o]]}.`):t(this,Ze)[(n*$.dpn+bt[c])*$.dnc+r]=e.data[1]-64}W()&&console.debug(`CH${o+1} (${Qe[t(this,R)[o]]}) drum NRPN ${c} commit`)}}else{let c=pt[t(this,p)[h+g[100]]];t(this,p)[h+g[101]]==0&&c!=null&&(W()&&console.debug(`CH${o+1} RPN 0 ${t(this,p)[h+g[100]]} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],Gt[c][0]),Gt[c][1]),t(this,S)[o*$.rpn+c]=e.data[1])}break}case 32:{this.dispatchEvent("voice",{part:o});break}case 38:{t(this,Ce)||t(this,p)[h+101]==0&&pt[t(this,p)[h+100]]!=null&&(t(this,S)[o*$.rpn+pt[t(this,p)[h+100]]+1]=e.data[1]);break}case 64:{e.data[1]<64&&t(this,B).hoOf(o);break}case 66:{e.data[1]>>6?t(this,B).soOn(o):t(this,B).soOf(o);break}case 98:case 99:{w(this,Ce,1);break}case 100:case 101:{w(this,Ce,0);break}}t(this,p)[h+g[e.data[0]]]=e.data[1],this.dispatchEvent("cc",{part:o,cc:e.data[0],data:e.data[1]})}},12:function(e){let o=e.channel;t(this,V)[o]=1,t(this,A)[o]=e.data,t(this,ce)[o]=0,W()&&console.debug(`T:${e.track} C:${o} P:${e.data}`),this.dispatchEvent("voice",{part:o})},13:function(e){let o=this,h=e.channel;t(this,L).forEach(function(c){let r=c>>7;h==r&&(t(o,U)[c]=e.data,o.dispatchEvent("note",{part:h,note:c&127,velo:e.data,state:o.NOTE_SUSTAIN}))})},14:function(e){let o=e.channel;t(this,we)[o]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:o,pitch:this.getPitchShift(o)})},15:function(e){gr(e.data).forEach(o=>{let h=o[0],c=o[1];(t(this,it)[h]||function(){console.debug(`Unknown manufacturer ${h}.`)})(c,o.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(t(this,G)[e.meta]||function(h,c,r){}).call(this,e.data,e.track,e.meta),e.meta!=32&&w(this,ge,0);let o=fr.indexOf(e.meta)>-1;if(W()&&console.debug(e),o)return e.reply="meta",e}});v(this,it,{64:(e,o,h)=>{t(this,Ae).run(o,h,e)},65:(e,o,h)=>{if(o[0]<16)t(this,he).run(o,h,e),console.warn("Unknown device SysEx!");else{let c=o[o.length-1],r=Bt(o.subarray(2,o.length-1));c==r?t(this,he).run(o.subarray(0,o.length-1),h,e):console.warn(`Bad GS checksum ${c}. Should be ${r}.`)}},66:(e,o,h)=>{t(this,de).run(o,h,e)},67:(e,o,h)=>{t(this,re).run(o,h,e)},68:(e,o,h)=>{t(this,De).run(o,h,e)},71:(e,o,h)=>{t(this,Ie).run(o,h,e)},126:(e,o,h)=>{t(this,Re).run(o,h,e)},127:(e,o,h)=>{this.switchMode("gm"),t(this,Oe).run(o,h,e)}});v(this,Re,void 0);v(this,Oe,void 0);v(this,re,void 0);v(this,he,void 0);v(this,de,void 0);v(this,Ae,void 0);v(this,Ie,void 0);v(this,De,void 0);let e=this;w(this,Y,new Uint8Array(256),Kt),t(this,ue)[10]=new Uint8Array(512),w(this,Te,new ie),this.userBank.strictMode=!0,this.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),t(this,G)[1]=function(r){switch(r.slice(0,2)){case"@I":{w(this,D,!0),t(this,T).unshift(`Kar.Info: ${r.slice(2)}`);break}case"@K":{w(this,D,!0),t(this,T).unshift("Karaoke mode active."),console.debug(`Karaoke mode active: ${r.slice(2)}`);break}case"@L":{w(this,D,!0),t(this,T).unshift(`Language: ${r.slice(2)}`);break}case"@T":{w(this,D,!0),t(this,T).unshift(`Ka.Title: ${r.slice(2)}`);break}case"@V":{w(this,D,!0),t(this,T).unshift(`Kara.Ver: ${r.slice(2)}`);break}case"XF":{let a=r.slice(2).split(":");switch(a[0]){case"hd":{a.slice(1).forEach((n,s)=>{n.length&&t(this,T).unshift(`${["SongDate","SnRegion","SongCat.","SongBeat","SongInst","Sn.Vocal","SongCmp.","SongLrc.","SongArr.","SongPerf","SongPrg.","SongTags"][s]}: ${n}`)});break}case"ln":{a.slice(1).forEach((n,s)=>{n.length&&t(this,T).unshift(`${["Kar.Lang","Kar.Name","Kar.Cmp.","Kar.Lrc.","kar.Arr.","Kar.Perf","Kar.Prg."][s]}: ${n}`)});break}default:t(this,T).unshift(`XGF_Data: ${r}`)}break}default:t(this,D)?r[0]=="\\"?t(this,T).unshift(`@ ${r.slice(1)}`):r[0]=="/"?t(this,T).unshift(r.slice(1)):t(this,T)[0]+=r:(t(this,T)[0]=r,t(this,T).unshift(""))}},t(this,G)[2]=function(r){t(this,T).unshift(`Copyrite: ${r}`)},t(this,G)[3]=function(r,a){a<1&&t(this,ge)<1&&t(this,T).unshift(`TrkTitle: ${r}`)},t(this,G)[4]=function(r,a){t(this,T).unshift(`${Vt(t(this,ge),""," ")}Instrmnt: ${r}`)},t(this,G)[5]=function(r){r.trim()==""?t(this,T).unshift(""):t(this,T)[0]+=`${r}`},t(this,G)[6]=function(r){t(this,T).unshift(`${Vt(t(this,ge),""," ")}C.Marker: ${r}`)},t(this,G)[7]=function(r){t(this,T).unshift(`CuePoint: ${r}`)},t(this,G)[32]=function(r){w(this,ge,r[0]+1)},t(this,G)[33]=function(r,a){console.debug(`Track ${a} requests to get assigned to output ${r}.`),t(e,Se)[a]=r+1},t(this,G)[81]=function(r,a){w(e,Fe,r/1e3)},t(this,G)[127]=function(r,a){t(e,Te).run(r,a)},t(this,Te).default=function(r){console.warn(`Unrecognized sequencer-specific byte sequence: ${r}`)},t(this,Te).add([67,0,1],function(r,a){t(e,Se)[a]=r[0]+1}),w(this,Re,new ie("universal non-realtime")),w(this,Oe,new ie("universal realtime")),w(this,re,new ie("Yamaha")),w(this,he,new ie("Roland")),w(this,de,new ie("Korg")),w(this,Ae,new ie("Kawai")),w(this,Ie,new ie("Akai")),w(this,De,new ie("Casio"));let o=function(r){console.info(`Unrecognized SysEx in "${this.name}" set.`,r)};t(this,Re).default=o,t(this,Oe).default=o,t(this,re).default=o,t(this,he).default=o,t(this,de).default=o,t(this,Ae).default=o,t(this,Ie).default=o,t(this,De).default=o,t(this,Re).add([9],r=>{e.switchMode(["gm","?","g2"][r[0]-1],!0),w(e,D,t(e,D)||!1),console.info(`MIDI reset: ${["GM","Init","GM2"][r[0]-1]}`),r[0]==2&&e.init()}),t(this,Oe).add([4,1],r=>{w(e,q,((r[1]<<7)+r[0])/16383*100)}).add([4,3],r=>((r[1]<<7)+r[0]-8192)/8192).add([4,4],r=>r[1]-64),t(this,re).add([76,0,0],r=>{switch(r[0]){case 125:{console.info(`XG drum setup reset: ${r}`);break}case 126:{e.switchMode("xg",!0),w(e,D,!1),console.info("MIDI reset: XG");break}default:{let a=[0,0,0,0],n=(s,i)=>{a[i]=s};if(r.subarray(1).forEach((s,i)=>{let f=i+r[0];([n,n,n,n,l=>{w(this,q,l*129/16383*100)},l=>{},l=>{}][f]||(()=>{}))(s,i)}),r[0]<4){let s=0;a.forEach(i=>{s=s<<4,s+=i}),s-=1024}}}}).add([76,2,1],r=>{let a="XG ";r[0]<32?(a+="reverb ",r.subarray(1).forEach((n,s)=>{([i=>{e.setEffectTypeRaw(0,!1,i),console.info(`${a}main type: ${je[i]}`)},i=>{e.setEffectTypeRaw(0,!0,i),console.debug(`${a}sub type: ${i+1}`)},i=>{console.debug(`${a}time: ${Tt(i)}s`)},i=>{console.debug(`${a}diffusion: ${i}`)},i=>{console.debug(`${a}initial delay: ${i}`)},i=>{console.debug(`${a}HPF cutoff: ${qe[i]}Hz`)},i=>{console.debug(`${a}LPF cutoff: ${qe[i]}Hz`)},i=>{console.debug(`${a}width: ${i}`)},i=>{console.debug(`${a}height: ${i}`)},i=>{console.debug(`${a}depth: ${i}`)},i=>{console.debug(`${a}wall type: ${i}`)},i=>{console.debug(`${a}dry/wet: ${i}`)},i=>{console.debug(`${a}send: ${z(i)}dB`)},i=>{console.debug(`${a}pan: ${i-64}`)},!1,!1,i=>{console.debug(`${a}delay: ${i}`)},i=>{console.debug(`${a}density: ${i}`)},i=>{console.debug(`${a}balance: ${i}`)},i=>{},i=>{console.debug(`${a}feedback: ${i}`)},i=>{}][r[0]+s]||function(){console.warn(`Unknown XG reverb address: ${r[0]}.`)})(n)})):r[0]<64?(a+="chorus ",r.subarray(1).forEach((n,s)=>{([i=>{e.setEffectTypeRaw(1,!1,i),console.info(`${a}main type: ${je[i]}`)},i=>{e.setEffectTypeRaw(1,!0,i),console.debug(`${a}sub type: ${i+1}`)},i=>{console.debug(`${a}LFO: ${Ct[i]}Hz`)},i=>{},i=>{console.debug(`${a}feedback: ${i}`)},i=>{console.debug(`${a}delay offset: ${Rt(i)}ms`)},i=>{},i=>{console.debug(`${a}low: ${qe[i]}Hz`)},i=>{console.debug(`${a}low: ${i-64}dB`)},i=>{console.debug(`${a}high: ${qe[i]}Hz`)},i=>{console.debug(`${a}high: ${i-64}dB`)},i=>{console.debug(`${a}dry/wet: ${i}`)},i=>{console.debug(`${a}send: ${z(i)}dB`)},i=>{console.debug(`${a}pan: ${i-64}`)},i=>{console.debug(`${a}to reverb: ${z(i)}dB`)},!1,i=>{},i=>{},i=>{},i=>{console.debug(`${a}LFO phase diff: ${(i-64)*3}deg`)},i=>{console.debug(`${a}input mode: ${i?"stereo":"mono"}`)},i=>{}][r[0]-32+s]||function(){console.warn(`Unknown XG chorus address: ${r[0]}.`)})(n)})):r[0]<86?(a+="variation ",r.subarray(1).forEach((n,s)=>{([i=>{e.setEffectTypeRaw(2,!1,i),console.info(`${a}main type: ${je[i]}`)},i=>{e.setEffectTypeRaw(2,!0,i),console.debug(`${a}sub type: ${i+1}`)}][r[0]-64+s]||function(){})(n)})):r[0]<97?(a+="variation ",r.subarray(1).forEach((n,s)=>{[i=>{console.debug(`${a}send: ${z(i)}dB`)},i=>{console.debug(`${a}pan: ${i-64}`)},i=>{console.debug(`${a}to reverb: ${z(i)}dB`)},i=>{console.debug(`${a}to chorus: ${z(i)}dB`)},i=>{console.debug(`${a}connection: ${i?"system":"insertion"}`)},i=>{console.debug(`${a}channel: CH${i+1}`)},i=>{console.debug(`${a}mod wheel: ${i-64}`)},i=>{console.debug(`${a}bend wheel: ${i-64}`)},i=>{console.debug(`${a}channel after touch: ${i-64}`)},i=>{console.debug(`${a}AC1: ${i-64}`)},i=>{console.debug(`${a}AC2: ${i-64}`)}][r[0]-86+s](n)})):r[0]>111&&r[0]<118?a+="variation ":console.warn(`Unknown XG variation address: ${r[0]}`)}).add([76,2,64],r=>{r.subarray(1).forEach((a,n)=>{let s=n+r[0];if(s==0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][a]}`);else{let i=s-1>>2,f=s-1&3,l=`XG EQ ${i} ${["gain","freq","Q","shape"][f]}: `;[()=>{console.debug(`${l}${a-64}dB`)},()=>{console.debug(`${l}${a} (raw)`)},()=>{console.debug(`${l}${a/10}`)},()=>{console.debug(`${l}${["shelf","peak"][+!!a]}`)}][f]()}})}).add([76,3],r=>{let a=r[0],n=r[1],s=`XG Insertion ${r[0]+1} `;r.subarray(2).forEach((i,f)=>{([l=>{e.setEffectTypeRaw(3+a,!1,l),console.info(`${s}main type: ${je[l]}`)},l=>{e.setEffectTypeRaw(3+a,!0,l),console.debug(`${s}sub type: ${l+1}`)}][n+f]||function(){})(i)})}).add([76,6,0],r=>{let a=r[0];a<64?e.setLetterDisplay(r.subarray(1),"XG letter display",a):w(e,ke,Date.now())}).add([76,7,0],r=>{let a=r[0];w(e,j,0),w(e,ne,Date.now()+3200),t(e,Y,fe).fill(0);let n=r.subarray(1);for(let s=0;s<a;s++)n.unshift(0);n.forEach(function(s,i){let f=Math.floor(i/16),l=i%16,d=(l*3+f)*7,b=7,y=0;for(d-=l*5,f==2&&(b=2);y<b;)t(e,Y,fe)[d+y]=s>>6-y&1,y++})}).add([76,8],(r,a)=>{let n=e.chRedir(r[0],a,!0),s=r[1],i=$.cc*n,f=`XG CH${n+1} `,l=`Unknown XG part address ${s}.`;r.subarray(2).forEach((d,b)=>{s<1?console.debug(l):s<41?([()=>{t(e,p)[i+g[0]]=d},()=>{t(e,p)[i+g[32]]=d},()=>{t(e,A)[n]=d},()=>{let y=e.chRedir(d,a,!0);t(e,N)[n]=y,n!=y&&(e.buildRchTree(),console.info(`${f}receives from CH${y+1}`))},()=>{t(e,Z)[n]=+!d},()=>{},()=>{e.setChType(n,d,C.xg),console.debug(`${f}type: ${Qe[d]||d}`)},()=>{t(e,S)[$.rpn*n+3]=d},!1,!1,()=>{t(e,p)[i+g[7]]=d},!1,!1,()=>{t(e,p)[i+g[10]]=d||128},!1,!1,()=>{t(e,p)[i+g[128]]=d},()=>{t(e,p)[i+g[93]]=d},()=>{t(e,p)[i+g[91]]=d},()=>{t(e,p)[i+g[94]]=d},()=>{t(e,p)[i+g[76]]=d},()=>{t(e,p)[i+g[77]]=d},()=>{t(e,p)[i+g[78]]=d},()=>{t(e,p)[i+g[74]]=d},()=>{t(e,p)[i+g[71]]=d},()=>{t(e,p)[i+g[73]]=d},()=>{t(e,p)[i+g[75]]=d},()=>{t(e,p)[i+g[72]]=d}][s+b-1]||(()=>{}))():s<48?console.debug(l):s<111?s>102&&s<105&&(t(e,p)[i+g[[5,65][s&1]]]=d):s<114?console.debug(l):s<116?console.debug(`${f}EQ ${["bass","treble"][s&1]} gain: ${d-64}dB`):s<118?console.debug(l):s<120?console.debug(`${f}EQ ${["bass","treble"][s&1]} freq: ${d}`):console.debug(l)})}).add([76,9],(r,a)=>{let n=e.chRedir(r[0],a,!0),s=r[1],i=`PLG-150VL CH${n+1} `;r.subarray(2).forEach((f,l)=>{let d=l+s;switch(d){case 1:{console.info(`${i}breath mode: ${["system","breath","velocity","touch EG"][f]}`);break}case 0:case 27:case 28:break;default:if(d<27){let b=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][d-3>>1];d&1?d<23?(console.debug(`${i}${b} control source: ${It(f)}`),f&&f<96&&e.allocateAce(f)):console.debug(`${i}${b} scale break point: ${f}`):console.debug(`${i}${b} depth: ${f-64}`)}}})}).add([76,10],r=>{}).add([76,16],r=>{}).add([76,17,0,0],r=>{}).add([76,112],r=>{console.debug(`XG enable PLG-1${["50VL","00SG","50DX"][r[0]]} for CH${r[2]+1}.`)}).add([73,0,0],(r,a)=>{let n=r[0];r.subarray(1).forEach((s,i)=>{let f=n+i;f==8?console.debug(`MU1000 set LCD contrast to ${s}.`):f>9&&f<16&&[()=>{e.dispatchEvent("channelactive",s)},()=>{s<8?(e.dispatchEvent("channelmin",s<<4),console.info(`Octavia System: Minimum CH${(s<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{s<8?(e.dispatchEvent("channelmax",(s<<4)+15),console.info(`Octavia System: Maximum CH${(s<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{w(e,te,!!s),console.info(`Octavia System: RS receiving ${["dis","en"][s]}abled.`)}][f-10]()})}).add([73,10,0],(r,a)=>{let n=r[0],s=`MU1000 RS${t(e,te)?"":" (ignored)"}: `;if(n<16)switch(n){case 2:{let i=e.chRedir(0,a,!0);t(e,te)&&(e.dispatchEvent("channelmin",i),e.dispatchEvent("channelmax",i+63)),console.info(`${s}Show CH1~64`);break}case 3:{let i=e.chRedir(r[1]<<5,a,!0);t(e,te)&&e.dispatchEvent("channelmin",i),t(e,te)&&e.dispatchEvent("channelmax",i+31),console.info(`${s}Show CH${i+1}~CH${i+32}`);break}default:console.debug(`${s}unknown switch ${n} invoked.`)}else if(n<32){if(t(e,te)){let i=e.chRedir(n-16+(t(e,Xe)<<4),a,!0);e.dispatchEvent("channelactive",i)}}else if(n<36){let i=e.chRedir(n-32<<4,a,!0);t(e,te)&&(e.dispatchEvent("channelmin",i),e.dispatchEvent("channelmax",i+15),w(e,Xe,n-32)),console.info(`${s}Show CH${i+1}~CH${i+16}`)}}).add([93,3],(r,a)=>{let n=e.chRedir(r[0],a,!0),s=`PLG-100SG CH${n+1} `,i=Date.now();if(r[1]==0){let f="",l=0;r.subarray(2).forEach((d,b)=>{b%2==0?f+=Ot[d]||d.toString().padStart("0"):l+=d*13}),i>=t(e,Ve)&&t(e,T).unshift("SG Lyric: "),t(e,T)[0]+=`${At(f)}`,w(e,Ve,i+Math.ceil(l/2)+t(e,Fe)),W()&&console.debug(`${s}vocals: ${f}`)}else console.warn(`Unknown PLG-100SG data: ${r}`)}),t(this,re).add([76,48],r=>{}).add([76,49],r=>{}).add([76,50],r=>{}).add([76,51],r=>{}),t(this,re).add([89,0],(r,a,n)=>{if(e.eprom){let s=r[0],i=(r[1]<<14)+(r[2]<<7)+r[3]+(e.eprom.offset||0);W()&&console.debug(`MU1000 EPROM trail to 0x${i.toString(16).padStart(6,"0")}, ${s} bytes.`);let f=e.eprom.data;r.subarray(4).forEach((l,d)=>{let b=d>>3,y=d&7;if(y==7)for(let k=0;k<7;k++)f[i+7*b+k]+=(l>>6-k&1)<<7;else f[i+7*b+y]=l})}}).add([89,1],(r,a,n)=>{let s=(r[0]<<21)+(r[1]<<14)+(r[2]<<7)+r[3];W()&&console.debug(`MU1000 EPROM jump to 0x${s.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=s)}).add([89,2],(r,a,n)=>{if(e.eprom){let s=(r[0]<<21)+(r[1]<<14)+(r[2]<<7)+r[3]+(e.eprom.offset||0);W()&&console.debug(`MU1000 EPROM write to 0x${s.toString(16).padStart(6,"0")}.`);let i=e.eprom.data;r.subarray(4).forEach((f,l)=>{let d=l>>3,b=l&7;if(b==7)for(let y=0;y<7;y++)i[s+7*d+y]+=(f>>6-y&1)<<7;else i[s+7*d+b]=f})}}).add([89,3],(r,a,n)=>{}),t(this,re).add([39,48],(r,a,n)=>{}).add([43,0,0],(r,a,n)=>{let s=[0,0,0,0],i=(f,l)=>{s[l]=f};if(r.subarray(1).forEach((f,l)=>{let d=l+r[0];[i,i,i,i,()=>{w(this,q,f*129/16383*100)},()=>f-64,()=>f||128,()=>f,()=>f,()=>{console.debug(`TG300 variation on cc${f}.`)}][d](f,d)}),r[0]<4){let f=0;s.forEach(l=>{f=f<<4,f+=l}),f-=1024}}).add([43,1,0],(r,a,n)=>{}).add([43,2],(r,a,n)=>{let s=e.chRedir(r[0],a,!0),i=r[1],f=$.cc*s,l=`TG300 CH${s+1} `;r.subarray(2).forEach((d,b)=>{b<5?([()=>{},()=>{t(e,p)[f+g[0]]=d},()=>{t(e,p)[f+g[32]]=d},()=>{t(e,A)[s]=d},()=>{let y=e.chRedir(d,a,!0);t(e,N)[s]=y,s!=y&&(e.buildRchTree(),console.info(`${l}receives from CH${y+1}`))}][b+i]||(()=>{}))(d,b+i):b<21||(b<47?([()=>{t(e,Z)[s]=+!d},()=>{},()=>{},()=>{t(e,S)[$.rpn*s+3]=d},()=>{},()=>{t(e,p)[f+g[7]]=d},!1,!1,()=>{t(e,p)[f+g[10]]=d||128},!1,!1,()=>{console.debug(`${l} AC1 at cc${d}`)},()=>{console.debug(`${l} AC2 at cc${d}`)},()=>{t(e,p)[f+g[128]]=d},()=>{t(e,p)[f+g[93]]=d},()=>{t(e,p)[f+g[91]]=d},()=>{t(e,p)[f+g[94]]=d},()=>{t(e,p)[f+g[76]]=d},()=>{t(e,p)[f+g[77]]=d},()=>{t(e,p)[f+g[74]]=d},()=>{t(e,p)[f+g[71]]=d},()=>{t(e,p)[f+g[73]]=d},()=>{t(e,p)[f+g[75]]=d},()=>{t(e,p)[f+g[72]]=d},()=>{t(e,p)[f+g[78]]=d}][b+i-21]||(()=>{}))(d,b+i):b<95||([()=>{t(e,p)[f+g[65]]=d},()=>{t(e,p)[f+g[5]]=d}][b+i-95]||(()=>{}))(d,b+i))})}).add([43,7,0],(r,a,n)=>{let s=r[0];e.setLetterDisplay(r.subarray(1),"TG300 letter display",s)}).add([43,7,1],(r,a,n)=>{w(e,j,0),w(e,ne,Date.now()+3200),t(e,Y,fe).fill(0),r.forEach(function(s,i){let f=Math.floor(i/16),l=i%16,d=(l*3+f)*7,b=7,y=0;for(d-=l*5,f==2&&(b=2);y<b;)t(e,Y,fe)[d+y]=s>>6-y&1,y++})}),t(this,he).add([66,18,0,0,127],(r,a,n)=>{e.switchMode("gs",!0),t(e,p)[$.cc*9]=120,t(e,p)[$.cc*25]=120,t(e,p)[$.cc*41]=120,t(e,p)[$.cc*57]=120,w(e,ee,3),w(e,D,!1),t(e,be).fill(0),console.info(`GS system to ${["single","dual"][r[0]]} mode.`)}).add([66,18,64,0],(r,a,n)=>{switch(r[0]){case 127:{e.switchMode("gs",!0),t(e,p)[$.cc*9]=120,t(e,p)[$.cc*25]=120,t(e,p)[$.cc*41]=120,t(e,p)[$.cc*57]=120,w(e,D,!1),t(e,be).fill(0),console.info("MIDI reset: GS");break}default:{let s=[0,0,0,0],i=(f,l)=>{s[l]=f};if(r.subarray(1).forEach((f,l)=>{let d=l+r[0];[i,i,i,i,b=>{w(this,q,b*129/16383*100)},b=>{},b=>{}][d](f,l)}),r[0]<4){let f=0;s.forEach(l=>{f=f<<4,f+=l}),f-=1024}}}}).add([66,18,64,1],r=>{let a=r[0];if(a<16){let n="".padStart(a," ");r.subarray(1).forEach((s,i)=>{n+=String.fromCharCode(Math.max(32,s))}),n=n.padEnd(16," "),console.debug(`GS patch name: ${n}`)}else a<48||(a<65?r.subarray(1).forEach((n,s)=>{let i=`GS ${a+s>55?"chorus":"reverb"} `;([()=>{console.info(`${i}type: ${dt[n]}`),e.setEffectType(0,40,n)},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${i}predelay: ${n}ms`)},()=>{console.info(`${i}type: ${Dt[n]}`),e.setEffectType(1,40,16+n)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${i}to reverb: ${z(n)}`)},()=>{console.debug(`${i}to delay: ${z(n)}`)}][a+s-48]||(()=>{}))()}):a<80?console.debug(`Unknown GS patch address: ${a}`):a<91?r.subarray(1).forEach((n,s)=>{let i="GS delay ";([()=>{console.info(`${i}type: ${Pt[n]}`),e.setEffectType(2,40,32+n)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${i}to reverb: ${z(n)}`)}][a+s-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${a}`))}).add([66,18,64,2],r=>{let a="GS EQ ";r.subarray(1).forEach((n,s)=>{([()=>{console.debug(`${a}low freq: ${[200,400][n]}Hz`)},()=>{console.debug(`${a}low gain: ${n-64}dB`)},()=>{console.debug(`${a}high freq: ${[3e3,6e3][n]}Hz`)},()=>{console.debug(`${a}high gain: ${n-64}dB`)}][r[0]+s]||function(){console.warn(`Unknown GS EQ address: ${r[0]+s}`)})()})}).add([66,18,64,3],r=>{let a="GS EFX ",n=function(s,i){let f=Ut(t(e,Q).subarray(10,12),i,s);f&&console.debug(`${a}${ft(t(e,Q).subarray(10,12))} ${f}`)};r.subarray(1).forEach((s,i)=>{([()=>{e.setEffectTypeRaw(3,!1,32+s)},()=>{e.setEffectTypeRaw(3,!0,s),console.info(`${a}type: ${ft(t(e,Q).subarray(10,12))}`)},!1,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,()=>{console.debug(`${a}to reverb: ${z(s)}dB`)},()=>{console.debug(`${a}to chorus: ${z(s)}dB`)},()=>{console.debug(`${a}to delay: ${z(s)}dB`)},!1,()=>{console.debug(`${a}1 source: ${s}`),s&&s<96&&e.allocateAce(s)},()=>{console.debug(`${a}1 depth: ${s-64}`)},()=>{console.debug(`${a}2 source: ${s}`),s&&s<96&&e.allocateAce(s)},()=>{console.debug(`${a}2 depth: ${s-64}`)},()=>{console.debug(`${a}to EQ: ${s?"ON":"OFF"}`)}][r[0]+i]||function(f,l){console.warn(`Unknown GS EFX address: ${l}`)})(s,r[0]+i)})}).add([66,18,65],r=>{}).add([69,18,16],r=>{var a;switch(r[0]){case 0:{let n=r[1];e.setLetterDisplay(r.subarray(2),"GS display text",n);break}case 32:{w(e,ne,Date.now()+3200),r[1]==0&&w(e,j,Math.max(Math.min(r[2]-1,9),0));break}default:if(r[0]<11){t(e,j)>9&&w(e,j,0),w(e,ne,Date.now()+3200),(a=t(e,ue)[r[0]-1])!=null&&a.length||(t(e,ue)[r[0]-1]=new Uint8Array(256));let n=t(e,ue)[r[0]-1],s=r[1];n.fill(0);let i=r.subarray(2);for(let f=0;f<s;f++)i.unshift(0);i.forEach(function(f,l){let d=Math.floor(l/16),b=l%16,y=(b*4+d)*5,k=5,m=0;for(y-=b*4,d==3&&(k=1);m<k;)n[y+m]=f>>4-m&1,m++})}else console.warn(`Unknown GS display section: ${r[0]}`)}});let h=function(r,a,n){let s=r[0],i=$.cc*a,f=$.rpn*a,l=`GS CH${a+1} `;s<3?r.subarray(1).forEach((d,b)=>{[()=>{t(e,p)[i+g[0]]=d},()=>{t(e,A)[a]=d},()=>{let y=e.chRedir(d,n,!0);t(e,N)[a]=y,a!=y&&(e.buildRchTree(),console.info(`${l}receives from CH${y+1}`))}][s+b]()}):s<19||(s<44?r.subarray(1).forEach((d,b)=>{([()=>{t(e,Z)[a]=+!d},!1,()=>{e.setChType(a,d<<1,C.gs),console.debug(`${l}type: ${d?"drum ":"melodic"}${d||""}`)},()=>{t(e,S)[f+3]=d},!1,()=>{t(e,p)[i+g[7]]=d},!1,!1,()=>{t(e,p)[i+g[10]]=d||128},!1,!1,()=>{console.debug(`${l}CC 1: cc${d}`)},()=>{console.debug(`${l}CC 2: cc${d}`)},()=>{t(e,p)[i+g[93]]=d},()=>{t(e,p)[i+g[91]]=d},!1,!1,()=>{t(e,S)[f+1]=d},()=>{t(e,S)[f+2]=d},()=>{t(e,p)[i+g[94]]=d}][s+b-19]||(()=>{}))()}):s<76||console.debug(`Unknown GS part address: ${s}`))},c=function(r,a){let n=r[0],s=`GS CH${a+1} `;n<2?r.subarray(1).forEach((i,f)=>{[()=>{t(e,p)[$.cc*a+g[32]]=i},()=>{}][n+f]()}):n<32?console.warn(`Unknown GS misc address: ${n}`):n<35?r.subarray(1).forEach((i,f)=>{[()=>{console.debug(`${s}EQ: o${["ff","n"][i]}`)},()=>{},()=>{console.debug(`${s}EFX: o${["ff","n"][i]}`)}][n+f-32]()}):console.warn(`Unknown GS misc address: ${n}`)};t(this,he).add([66,18,64,16],(r,a)=>{h(r,e.chRedir(9,a,!0),a)}).add([66,18,64,17],(r,a)=>{h(r,e.chRedir(0,a,!0),a)}).add([66,18,64,18],(r,a)=>{h(r,e.chRedir(1,a,!0),a)}).add([66,18,64,19],(r,a)=>{h(r,e.chRedir(2,a,!0),a)}).add([66,18,64,20],(r,a)=>{h(r,e.chRedir(3,a,!0),a)}).add([66,18,64,21],(r,a)=>{h(r,e.chRedir(4,a,!0),a)}).add([66,18,64,22],(r,a)=>{h(r,e.chRedir(5,a,!0),a)}).add([66,18,64,23],(r,a)=>{h(r,e.chRedir(6,a,!0),a)}).add([66,18,64,24],(r,a)=>{h(r,e.chRedir(7,a,!0),a)}).add([66,18,64,25],(r,a)=>{h(r,e.chRedir(8,a,!0),a)}).add([66,18,64,26],(r,a)=>{h(r,e.chRedir(10,a,!0),a)}).add([66,18,64,27],(r,a)=>{h(r,e.chRedir(11,a,!0),a)}).add([66,18,64,28],(r,a)=>{h(r,e.chRedir(12,a,!0),a)}).add([66,18,64,29],(r,a)=>{h(r,e.chRedir(13,a,!0),a)}).add([66,18,64,30],(r,a)=>{h(r,e.chRedir(14,a,!0),a)}).add([66,18,64,31],(r,a)=>{h(r,e.chRedir(15,a,!0),a)}).add([66,18,64,64],(r,a)=>{c(r,e.chRedir(9,a,!0))}).add([66,18,64,65],(r,a)=>{c(r,e.chRedir(0,a,!0))}).add([66,18,64,66],(r,a)=>{c(r,e.chRedir(1,a,!0))}).add([66,18,64,67],(r,a)=>{c(r,e.chRedir(2,a,!0))}).add([66,18,64,68],(r,a)=>{c(r,e.chRedir(3,a,!0))}).add([66,18,64,69],(r,a)=>{c(r,e.chRedir(4,a,!0))}).add([66,18,64,70],(r,a)=>{c(r,e.chRedir(5,a,!0))}).add([66,18,64,71],(r,a)=>{c(r,e.chRedir(6,a,!0))}).add([66,18,64,72],(r,a)=>{c(r,e.chRedir(7,a,!0))}).add([66,18,64,73],(r,a)=>{c(r,e.chRedir(8,a,!0))}).add([66,18,64,74],(r,a)=>{c(r,e.chRedir(10,a,!0))}).add([66,18,64,75],(r,a)=>{c(r,e.chRedir(11,a,!0))}).add([66,18,64,76],(r,a)=>{c(r,e.chRedir(12,a,!0))}).add([66,18,64,77],(r,a)=>{c(r,e.chRedir(13,a,!0))}).add([66,18,64,78],(r,a)=>{c(r,e.chRedir(14,a,!0))}).add([66,18,64,79],(r,a)=>{c(r,e.chRedir(15,a,!0))}),t(this,de).add([54,65],(r,a)=>{e.switchMode("x5d");let n=(r[1]<<7)+r[0],s=(r[3]<<7)+r[2],i=e.chRedir(n&15,a,!0),f=$.cc*i;[()=>{s<1||(s<101?(e.setChType(i,e.CH_MELODIC,C.x5d),t(e,A)[i]=s-1,t(e,p)[f+g[0]]=82):s<229?(e.setChType(i,e.CH_MELODIC,C.x5d),t(e,A)[i]=s-101,t(e,p)[f+g[0]]=56):(e.setChType(i,e.CH_DRUMS,C.x5d),t(e,A)[i]=Ft[s-229]||0,t(e,p)[f+g[0]]=62))},()=>{t(e,p)[f+g[7]]=s},()=>{s<31&&(t(e,p)[f+g[10]]=Math.round((s-15)*4.2+64))},()=>{t(e,p)[f+g[93]]=Ye(s)},()=>{t(e,p)[f+g[91]]=Ye(s)},()=>{t(e,S)[i*$.rpn+3]=s>8191?s-16320:64+s},()=>{t(e,S)[i*$.rpn+1]=s>8191?s-16320:64+s},()=>{s>0&&(t(e,S)[i*$.rpn]=s)},()=>{}][n>>4]()}).add([54,76,0],(r,a)=>{e.switchMode("x5d",!0);let n="",s=82,i=0,f=0,l="MSB	PRG	LSB	NME";se(r,function(d,b){if(b<16400){let y=b%164;switch(!0){case y<10:{d>31&&(n+=String.fromCharCode(d));break}case y==11:{l+=`
${s}	${i}	${f}	${n.trim().replace("Init Voice","")}`,i++,n="";break}}i>99&&(s=90,i=0)}}),e.userBank.clearRange({msb:82,prg:[0,99],lsb:0}),e.userBank.load(l)}).add([54,77,0],(r,a)=>{e.switchMode("x5d",!0);let n="",s=90,i=0,f=0,l="MSB	PRG	LSB	NME";se(r,function(d,b){if(b<13600){let y=b%136;switch(!0){case y<10:{d>31&&(n+=String.fromCharCode(d));break}case y==11:{l+=`
${s}	${i}	${f}	${n.trim().replace("Init Combi","")}`,i++,n="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(l)}).add([54,78],(r,a)=>{e.switchMode("x5d",!0),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][r[0]]} mode.`)}).add([54,85],(r,a)=>{e.switchMode("x5d",!0),se(r,(n,s)=>{s>0&&s<3&&e.setEffectType(s-1,44,n)})}).add([54,104],(r,a)=>{e.switchMode("x5d",!0),se(r,function(n,s,i,f){if(s<192){let l=e.chRedir(Math.floor(s/12),a,!0),d=l*$.cc;switch(s%12){case 0:{n<128?(e.setChType(l,e.CH_MELODIC,C.x5d),t(e,p)[d+g[0]]=82,t(e,A)[l]=n):(e.setChType(l,e.CH_DRUMS,C.x5d),t(e,p)[d+g[0]]=62,t(e,A)[l]=Ft[n-128]),n>0&&(t(e,V)[l]=1);break}case 1:{t(e,p)[d+g[7]]=n;break}case 2:{t(e,S)[l*$.rpn+3]=n>127?n-192:64+n;break}case 3:{t(e,S)[l*$.rpn+1]=n>127?n-192:64+n;break}case 4:{n<31&&(t(e,p)[d+g[10]]=Math.round((n-15)*4.2+64));break}case 5:{let b=n>>4,y=n&15;t(e,p)[d+g[91]]=Ye(y),t(e,p)[d+g[93]]=Ye(b);break}case 10:break;case 11:{let b=e.chRedir(n&15,a,!0),y=n>>4;t(e,N)[l]=n,(b!=l||y)&&(console.info(`X5D Part CH${l+1} receives from CH${b+1}.`),e.buildRchTree())}}}else{let l=e.chRedir(s-192,a,!0)}})}),t(this,he).add([22,18,127],r=>{e.switchMode("mt32",!0),w(e,D,!1),e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(r,a,n)=>{e.switchMode("mt32");let s=e.chRedir(n,a,!0),i=r[1];r.subarray(2).forEach((f,l)=>{let d=l+i;t(e,ve)[d+(s-1)*16]=f,([!1,()=>{let b=t(e,ve)[s-1<<4];if(b<3)if(t(e,ce)[s]=1,b==2)for(let y=0;y<name.length;y++)t(e,J)[(s-1)*$.cmt+y]=t(e,Ee)[f*$.cmt+y];else{let y=e.baseBank.get(0,f+(b<<6),127,"mt32").name;for(let k=0;k<y.length;k++)t(e,J)[(s-1)*$.cmt+k]=y.charCodeAt(k)}},()=>{t(e,S)[s*$.rpn+3]=f+40},()=>{t(e,S)[s*$.rpn+1]=f+14},()=>{t(e,S)[s*$.rpn]=f},!1,()=>{t(e,p)[$.cc*s+g[91]]=f?127:0},!1,()=>{t(e,p)[$.cc*s+g[7]]=f},()=>{t(e,p)[$.cc*s+g[10]]=Math.ceil(f*9.05)}][d]||(()=>{}))()})}).add([22,18,1],(r,a,n)=>{e.switchMode("mt32");let s=e.chRedir(n,a,!0)}).add([22,18,2],(r,a,n)=>{e.switchMode("mt32");let s=e.chRedir(n,a,!0),i=r[1]+(r[0]<<7);i<10&&(t(e,ce)[s]=1),r.subarray(2).forEach((f,l)=>{let d=l+i;d<14&&(t(e,J)[(s-1)*$.cmt+d]=f)})}).add([22,18,3],(r,a,n)=>{if(e.switchMode("mt32"),r[0]){let s=r[1]-16}else{let s=r[1];r.subarray(2).forEach((i,f)=>{let l=f+s;t(e,ve)[l]=i;let d=e.chRedir(1+l>>4,a,!0),b=l&15;([!1,()=>{let y=t(e,ve)[d-1<<4];if(y<3)if(t(e,ce)[d]=1,y==2)for(let k=0;k<name.length;k++)t(e,J)[(d-1)*$.cmt+k]=t(e,Ee)[i*$.cmt+k];else{let k=e.baseBank.get(0,i+(y<<6),127,"mt32").name;for(let m=0;m<k.length;m++)t(e,J)[(d-1)*$.cmt+m]=k.charCodeAt(m)}},()=>{t(e,S)[d*$.rpn+3]=i+40},()=>{t(e,S)[d*$.rpn+1]=i+14},()=>{t(e,S)[d*$.rpn]=i},!1,()=>{t(e,p)[$.cc*d+g[91]]=i?127:0},!1,()=>{t(e,p)[$.cc*d+g[7]]=i},()=>{t(e,p)[$.cc*d+g[10]]=Math.ceil(i*9.05)}][b]||(()=>{}))()})}}).add([22,18,4],(r,a,n)=>{e.switchMode("mt32");let s=r[1]+(r[0]<<7);r.subarray(2).forEach((i,f)=>{let l=f+s,d=e.chRedir(Math.floor(l/246+1),a,!0),b=l%246;b<14&&(t(e,J)[(d-1)*$.cmt+b]=i),b<10&&(t(e,ce)[d]=1)})}).add([22,18,5],(r,a,n)=>{e.switchMode("mt32");let s=(r[0]<<7)+r[1];r.subarray(2).forEach((i,f)=>{let l=s+f,d=Math.floor(l/8),b=l&7,y=d*8;t(e,_e)[l]=i,([!1,()=>{let k=t(e,_e)[y];if(k<3){let m="";if(k==2){let E=$.cmt*d;m=`MT-m:${i.toString().padStart(3,"0")}`}else m=e.baseBank.get(0,i+(k<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:d}),e.userBank.load(`MSB	LSB	PRG	NME
000	127	${d}	${m}`,!0)}}][b]||(()=>{}))()})}).add([22,18,8],(r,a,n)=>{e.switchMode("mt32");let s=((r[0]&1)<<7)+r[1];r.subarray(2).forEach((i,f)=>{let l=s+f;l<$.cmt&&(t(e,Ee)[(r[0]>>1)*$.cmt+l]=i)})}).add([22,18,16],(r,a,n)=>{e.switchMode("mt32");let s=r[1],i=!1,f=function(l,d){t(e,N)[d-12]=l,i=!0};r.subarray(2).forEach((l,d)=>{let b=d+s;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,f,f,f,f,f,f,f,f,f,()=>{w(e,q,l)}][b]||(()=>{}))(l,d)}),i&&e.buildRchTree()}).add([22,18,32],r=>{e.switchMode("mt32");let a=r[1],n=" ".repeat(a);r.subarray(2).forEach(s=>{s>31&&(n+=String.fromCharCode(s))}),w(e,le,n.padStart(20," ")),w(e,ke,Date.now()+3200)}).add([22,18,82],(r,a)=>{let n=e.chRedir(0,a,!0);for(let s=0;s<16;s++)t(e,B).ano(n+s),s&&s<10&&(t(e,A)[n+s]=ut[s-1]);console.info("MT-32 alt reset complete.")}),t(this,de).add([66,0],(r,a)=>{e.switchMode("ns5r",!0),w(e,D,!1),console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][r[0]]} mode.`)}).add([66,1],(r,a)=>{e.switchMode(["ns5r","05rw"][r[0]],!0),w(e,D,!1)}).add([66,18,0,0],(r,a)=>{let n=r[0];switch(n){case 124:case 126:case 127:{e.switchMode("ns5r",!0),w(e,D,!1);break}case 125:{console.info(`NS5R drum setup reset: ${r}`);break}default:if(n<10){let s=[0,0,0,0],i=(f,l)=>{s[l]=f};if(r.subarray(1).forEach((f,l)=>{[i,i,i,i,()=>{w(e,q,f*129/16383*100)},()=>f-64,()=>f-64,()=>{},()=>{},()=>{}][n+l]()}),r[0]<4){let f=0;s.forEach(l=>{f=f<<4,f+=l}),f-=1024}}}}).add([66,18,0,1],(r,a)=>{}).add([66,18,0,2],(r,a)=>{}).add([66,18,1],(r,a)=>{let n=e.chRedir(r[0],a,!0),s=n*$.cc,i=r[1],f=`NS5R CH${n+1} `;r.subarray(2).forEach((l,d)=>{let b=i+d;b<3?[()=>{t(e,p)[s+g[0]]=l||121},()=>{t(e,p)[s+g[32]]=l},()=>{t(e,A)[n]=l}][b]():b<8||(b<14?[()=>{let y=e.chRedir(l,a,!0);t(e,N)[n]=y,n!=y&&(e.buildRchTree(),console.info(`${f}receives from CH${y+1}`))},()=>{t(e,Z)[n]=+!l},()=>{e.setChType(n,l,C.ns5r),console.debug(`${f}type: ${Qe[l]}`)},()=>{t(e,S)[$.rpn*n+3]=l},()=>{},()=>{}][b-8]():b<16||(b<33?[()=>{t(e,p)[s+g[7]]=l},()=>{t(e,p)[s+g[11]]=l},()=>{},()=>{},()=>{t(e,p)[s+g[10]]=l||128},()=>{},()=>{},()=>{t(e,p)[s+g[93]]=l},()=>{t(e,p)[s+g[91]]=l},()=>{t(e,p)[s+g[76]]=l},()=>{t(e,p)[s+g[77]]=l},()=>{t(e,p)[s+g[78]]=l},()=>{t(e,p)[s+g[74]]=l},()=>{t(e,p)[s+g[71]]=l},()=>{t(e,p)[s+g[73]]=l},()=>{t(e,p)[s+g[75]]=l},()=>{t(e,p)[s+g[72]]=l}][b-16]():b<112||b<114&&[()=>{t(e,p)[s+g[5]]=l},()=>{t(e,p)[s+g[65]]=l}][b-112]()))})}).add([66,18,8,0],(r,a)=>{let n=r[0];if(n<32)e.setLetterDisplay(r.subarray(1,33),"NS5R letter display");else{let s=n-32;w(e,ne,Date.now()+3200),w(e,j,10),t(e,Y,fe).fill(0);let i=r.subarray(1),f=4;i.forEach(function(l,d){let b=d+s,y=b>>4,k=b&15;if(b<80){let m=y<f?l:l>>3,E=0,x=y<f?6:3;for(;m>0;)t(e,Y,fe)[k*32+y*7+(x-E)]=m&1,m=m>>1,E++}})}}).add([66,52],(r,a)=>{e.switchMode("ns5r",!0),w(e,D,!1);let n="";se(r,(s,i)=>{i<8?(s>31&&(n+=String.fromCharCode(s)),i==7&&(e.aiEfxName=n)):i<10&&e.setEffectType(i-8,44,s)})}).add([66,53],(r,a)=>{e.switchMode("ns5r",!0),w(e,D,!1),se(r,function(n,s){switch(!0){case s<2944:{let i=e.chRedir(Math.floor(s/92),a,!0),f=i*$.cc;switch(s%92){case 0:{t(e,p)[f+g[0]]=n||121;break}case 1:{t(e,p)[f+g[32]]=n;break}case 2:{t(e,A)[i]=n,n>0&&(t(e,V)[i]=1);break}case 3:{let l=e.chRedir(n,a,!0);t(e,N)[i]=l,i!=l&&(console.info(`NS5R CH${i+1} receives from CH${l+1}.`),e.buildRchTree())}case 7:break;case 8:{t(e,S)[i*$.rpn+3]=n<40||n>88?n+(n>63?-192:64):n;break}case 9:case 10:{t(e,p)[f+g[7]]=n;break}case 11:{t(e,p)[f+g[11]]=n;break}case 14:{t(e,p)[f+g[10]]=n||128;break}case 19:{t(e,p)[f+g[93]]=n;break}case 20:{t(e,p)[f+g[91]]=n;break}case 84:{t(e,p)[f+g[65]]=n;break}case 85:{t(e,p)[f+g[5]]=n;break}}break}case s<3096:break;case s<3134:break;case s<8566:break}})}).add([66,54],(r,a)=>{e.switchMode("ns5r",!0);let n="",s=80,i=0,f=0,l="MSB	PRG	LSB	NME";se(r,function(d,b){let y=b%158;switch(!0){case y<10:{d>31&&(n+=String.fromCharCode(d));break}case y==11:{s=d&127;break}case y==12:{f=d&127;break}case y==13:{l+=`
${s}	${i}	${f}	${n.trim().replace("Init Voice","")}`,i++,n="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(l)}).add([66,55],(r,a)=>{e.switchMode("ns5r",!0);let n="",s=88,i=0,f=0,l="MSB	PRG	LSB	NME";se(r,function(d,b){let y=b%126;switch(!0){case y<10:{d>31&&(n+=String.fromCharCode(d));break}case y==11:break;case y==12:break;case y==13:{l+=`
${s}	${i}	${f}	${n.trim().replace("Init Combi","")}`,i++,n="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(l)}).add([66,125],r=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][r[0]]||"white")}).add([66,127],r=>{let a=new Uint8Array(5760);se(r,(n,s,i)=>{if(s<720)for(let f=0;f<8;f++)a[s*8+f]=n>>7-f&1}),e.dispatchEvent("screen",{type:"ns5r",data:a})}).add([76],(r,a,n)=>{t(e,de).run([66,...r],a,n)}),t(this,Ae).add([16,0,8,0],(r,a,n)=>{let s=(r[2]<<4)+r[3],i="K11 ";([()=>{e.switchMode("k11",!0),w(e,D,!1),w(e,ee,s?4:0),console.info("MIDI reset: GMega/K11")},()=>{console.debug(`${i}reverb type: ${s}`)},()=>{console.debug(`${i}reverb time: ${s}`)},()=>{console.debug(`${i}reverb time: ${s}`)},()=>{console.debug(`${i}reverb predelay: ${s}`)},()=>{console.debug(`${i}reverb predelay: ${s}`)},()=>{console.debug(`${i}depth high: ${s}`)},()=>{console.debug(`${i}depth high: ${s}`)},()=>{console.debug(`${i}depth low: ${s}`)},()=>{console.debug(`${i}depth low: ${s}`)}][r[0]]||(()=>{}))()}).add([16,0,8,1],(r,a,n)=>{let s=e.chRedir(r[1],a,!0),i=$.cc*s,f=$.rpn*s,l=(r[3]<<4)+r[4],d=`K11 CH${s+1} `;([()=>{l<128?(e.setChType(s,e.CH_MELODIC,C.k11),t(e,p)[i+g[0]]=0,t(e,A)[s]=l):(e.setChType(s,e.CH_DRUMS,C.k11),t(e,A)[s]=l-128)},()=>{let b=e.chRedir(l,a,!0);t(e,N)[s]=b,s!=b&&(e.buildRchTree(),console.info(`${d}receives from CH${b+1}`))},()=>{t(e,p)[i+g[7]]=l},()=>{t(e,V)[s]=l},()=>{t(e,p)[i+g[10]]=l},()=>{t(e,S)[f+3]=l+40},()=>{t(e,S)[f+1]=l>>1,t(e,S)[f+2]=l&1},()=>{t(e,p)[i+g[91]]=l?127:0},()=>{},()=>{t(e,p)[i+g[74]]=l},()=>{t(e,p)[i+g[73]]=l},()=>{t(e,p)[i+g[72]]=l}][r[0]]||(()=>{}))()}).add([16,0,9,0],(r,a,n)=>{let s=(r[2]<<4)+r[3],i="GMLX ";([()=>{console.debug(`${i}reverb type: ${s}`)},()=>{console.debug(`${i}reverb time: ${s}`)},()=>{console.debug(`${i}reverb predelay: ${s}`)},()=>{console.debug(`${i}depth high: ${s}`)},()=>{console.debug(`${i}depth low: ${s}`)}][r[0]]||(()=>{}))()}).add([16,0,9,3],(r,a,n)=>{let s=(r[2]<<4)+r[3],i=e.chRedir(r[1],a,!0),f=i*$.cc;[()=>{s<128?(e.setChType(i,e.CH_MELODIC,C.k11),t(e,p)[f+g[0]]=0,t(e,p)[f+g[32]]=0,t(e,A)[i]=s):s<160?(e.setChType(i,e.CH_MELODIC,C.k11),t(e,p)[f+g[0]]=0,t(e,p)[f+g[32]]=7,t(e,A)[i]=s-100):(e.setChType(i,e.CH_DRUMS,C.k11),t(e,p)[f+g[0]]=122,t(e,p)[f+g[32]]=0,t(e,A)[i]=s-160)},()=>{let l=e.chRedir(s,a,!0);t(e,N)[i]=l,i!=l&&(e.buildRchTree(),console.info(`GMLX CH${i+1} receives from CH${l+1}`))}][r[0]]()}).add([16,0,9,4],(r,a,n)=>{let s=(r[2]<<4)+r[3],i=e.chRedir(r[1],a,!0),f=i*$.cc,l=i*$.rpn,d=`GMLX CH${i+1} `;[()=>{t(e,V)[i]=s},()=>{t(e,p)[f+g[7]]=s},()=>{t(e,p)[f+g[10]]=s},()=>{t(e,p)[f+g[91]]=s?127:0},()=>{t(e,S)[l+3]=s+40},()=>{t(e,S)[l+1]=s},()=>{t(e,S)[l]=s},()=>{}][r[0]]()}),t(this,Ie).add([66,93,64],(r,a,n)=>{let s=r[2];switch(r[0]){case 0:{switch(r[1]){case 4:{w(e,q,s*129/16383*100);break}case 5:{s-64;break}case 6:{console.debug(`SG global reverb: ${s?"on":"off"}`);break}case 127:{e.switchMode("sg",!0);break}}break}case 1:{switch(r[1]){case 48:{console.debug(`SG reverb type: ${dt[s]}`);break}}break}default:if(r[0]>>4==1){let i=e.chRedir(r[0]&15,a,!0);if(r[1]==2){let f=e.chRedir(s,a,!0);t(e,N)[i]=f,i!=f&&(e.buildRchTree(),console.info(`SG CH${i+1} receives from CH${f+1}`))}else r[1]==19&&(t(e,p)[$.cc*i+g[7]]=s)}else console.warn(`Unknown AKAI SG SysEx: ${r}`)}}),t(this,De).add([9],(r,a,n)=>{console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremelo","phaser","rotary speaker","enhancer","flanger","EQ"][r[0]]||"off"}`)}),t(this,re).add([127,0],(r,a,n)=>{t(e,de).run([127,1,...r],a,n)}).add([127,1,0,0,14],(r,a,n)=>{e.switchMode("s90es");let s="S90 ES bulk header ",i=[];i[95]=(f,l,d)=>{console.debug(`${s}multi edit buffer: ${f[1]}`)},(i[r[0]]||(()=>{console.info(`Unrecognized ${s}ID: ${r[0]}.`)}))(r.subarray(1))}).add([127,1,0,0,15],(r,a,n)=>{e.switchMode("s90es");let s="S90 ES bulk footer ",i=[];i[95]=(f,l,d)=>{console.debug(`${s}multi edit buffer: ${f[1]}`)},(i[r[0]]||(()=>{console.info(`Unrecognized ${s}ID: ${r[0]}.`)}))(r.subarray(1))}).add([127,1,0,58,55],(r,a,n)=>{e.switchMode("s90es");let s=e.chRedir(r[0],a,!0),i=$.cc*s,f=r[1],l=`S90 ES bulk CH${s<16?s+1:"U"+(s-95)} `;console.debug(l,r),!(r[0]>15)&&(t(e,V)[s]=1,r.subarray(2).forEach((d,b)=>{([()=>{t(e,p)[i+g[0]]=d},()=>{t(e,p)[i+g[32]]=d},()=>{t(e,A)[s]=d},()=>{let y=e.chRedir(d,a,!0);t(e,N)[s]=y,s!=y&&(e.buildRchTree(),console.info(`${l}receives from CH${y+1}`))},()=>{t(e,Z)[s]=d?0:1},!1,!1,!1,!1,!1,!1,!1,!1,()=>{t(e,p)[i+g[7]]=d},()=>{t(e,p)[i+g[10]]=d},!1,!1,!1,()=>{t(e,p)[i+g[91]]=d},()=>{t(e,p)[i+g[93]]=d},()=>{t(e,p)[i+g[94]]=d},()=>{t(e,p)[i+g[128]]=d},()=>{},()=>{t(e,p)[i+g[74]]=d},()=>{t(e,p)[i+g[71]]=d},!1,()=>{t(e,p)[i+g[65]]=d},()=>{t(e,p)[i+g[5]]=d},()=>{}][f+b]||(()=>{}))()}))})}chRedir(e,o,h){if(t(this,Se)[o])return(t(this,Se)[o]-1)*16+e;if([2,3].indexOf(t(this,ee))>-1){if(h==1)return e;let c=0,r=!0;for(;r;)t(this,be)[e+c]==0?(t(this,be)[e+c]=o,console.debug(`Assign track ${o} to channel ${e+c+1}.`),r=!1):t(this,be)[e+c]==o?r=!1:(c+=16,c>=128&&(c=0,r=!1));return e+c}else return e}buildRchTree(){let e=[];t(this,N).forEach((o,h)=>{var c;(c=e[o])!=null&&c.constructor||(e[o]=[]),e[o].push(h)}),w(this,Je,e)}getActive(){let e=t(this,V).slice();return t(this,I)==C.mt32,e}getCc(e){let o=e*$.cc,h=t(this,p).subarray(o,o+$.cc);return h[g[0]]=h[g[0]]||t(this,me),h[g[32]]=h[g[32]]||t(this,ee),h}getCcCh(e,o){if(We.indexOf(o)<0)throw new Error("CC number not accepted");return t(this,p)[$.cc*e+g[o]]}getCcAll(){let e=t(this,p).slice();for(let o=0;o<$.ch;o++){let h=o*$.cc;e[h+g[0]]=e[h+g[0]]||t(this,me),e[h+g[32]]=e[h+g[32]]||t(this,ee)}return e}getChType(){return t(this,R)}setChType(e,o,h=t(this,I)){o&=15,t(this,R)[e]=o,o>0&&(t(this,p)[e*$.cc+g[0]]=Me[h])}getPitch(){return t(this,we)}getProgram(){return t(this,A)}getTexts(){return t(this,T).slice()}getVel(e){let o=new Map,h=this;return t(h,L).forEach(function(c,r){let a=Math.floor(c/128),n=c%128;e==a&&t(h,U)[c]>0&&o.set(n,{v:t(h,U)[c],s:t(h,H)[r]})}),o}getBitmap(){return{bitmap:t(this,Y,fe),expire:t(this,ne)}}getLetter(){return{text:t(this,le),expire:t(this,ke)}}getMode(){return $e[t(this,I)]}getMaster(){return{volume:t(this,q)}}getRawStrength(){let e=this;return t(this,L).forEach(function(o){let h=Math.floor(o/128);t(e,U)[o]>t(e,oe)[h]&&(t(e,oe)[h]=t(e,U)[o])}),t(this,oe)}getStrength(){let e=[],o=this;return this.getRawStrength().forEach(function(h,c){e[c]=Math.floor(h*t(o,p)[c*$.cc+g[7]]*t(o,p)[c*$.cc+g[11]]*t(o,q)/803288)}),e}getRpn(){return t(this,S)}getNrpn(){return t(this,Ge)}getVoice(e,o,h,c){let r=e||t(this,me),a=o,n=h||t(this,ee);$e[t(this,I)]=="ns5r"&&r>0&&r<56&&(n=3);let s=this.userBank.get(r,a,n,c);if($e[t(this,I)]=="mt32"&&s.name.indexOf("MT-m:")==0){let i=parseInt(s.name.slice(5)),f=i*$.cmt,l="";t(this,Ee).subarray(f,f+10).forEach(d=>{d>31&&(l+=String.fromCharCode(d))}),this.userBank.load(`MSB	LSB	PRG
0	127	${a}	${l}`,!0),s.name=l,s.ending=" "}return(s.ending!=" "||!s.name.length)&&(s=this.baseBank.get(r,a,n,c)),s}getChVoice(e){let o=this.getVoice(t(this,p)[e*$.cc+g[0]],t(this,A)[e],t(this,p)[e*$.cc+g[32]],$e[t(this,I)]);if(t(this,ce)[e])switch(t(this,I)){case C.mt32:o.ending="~",o.name="",t(this,J).subarray(14*(e-1),14*(e-1)+10).forEach(h=>{h>31&&(o.name+=String.fromCharCode(h))})}return o}getPitchShift(e){let o=e*$.rpn;return t(this,we)[e]/8192*t(this,S)[o]+(t(this,S)[o+3]-64)+((t(this,S)[o+1]<<7)+t(this,S)[o+2]-8192)/8192}getEffectType(e=0){let o=3*e+1;return t(this,Q).subarray(o,o+2)}setEffectTypeRaw(e=0,o,h){let c=3*e;t(this,Q)[c]=1,t(this,Q)[c+1+ +o]=h}setEffectType(e=0,o,h){this.setEffectTypeRaw(e,!1,o),this.setEffectTypeRaw(e,!0,h)}setLetterDisplay(e,o,h=0,c=3200){let r=this,a;w(r,le," ".repeat(h)),e.forEach(n=>{w(r,le,t(r,le)+String.fromCharCode(n>31?n:32)),n<32&&(a=a||new Set,a.add(n))}),w(r,ke,Date.now()+3200),w(r,le,t(r,le).padEnd(32," ")),a&&(a=Array.from(a),a.forEach((n,s,i)=>{i[s]=n.toString(16).padStart(2,"0")}),console.warn(`${o}${o?" ":""}invalid code point${a.length>1?"s":""}: 0x${a.join(", 0x")}`))}allocateAce(e){if(!e||e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}let o=!0,h=0;for(;o&&h<$.ace;)t(this,pe)[h]==e?o=!1:t(this,pe)[h]||(o=!1,t(this,pe)[h]=e,console.info(`Allocated cc${e} to ACE slot ${h}.`)),h++;h>=$.ace&&console.warn("ACE slots are full.")}getAce(){return t(this,pe)}getChAce(e,o){if(o<0||o>=$.ace)throw new RangeError("No such ACE slot");let h=t(this,pe)[o];if(h){if(We.indexOf(h)>=0)return t(this,p)[e*$.cc+g[h]];throw new Error(`Invalid ACE source: ${h}`)}else return 0}init(e=0){this.dispatchEvent("mode","?"),w(this,I,0),w(this,me,0),w(this,ee,0),w(this,ge,0),t(this,V).fill(0),t(this,p).fill(0),t(this,pe).fill(0),t(this,A).fill(0),t(this,U).fill(0),t(this,L).fill(0),t(this,oe).fill(0),t(this,we).fill(0),t(this,Ge).fill(0),t(this,Ze).fill(0),w(this,q,100),w(this,T,[]),w(this,Fe,500),w(this,Ve,0),w(this,ke,0),w(this,le,""),w(this,ne,0),w(this,j,0),t(this,Y,fe).fill(0),w(this,D,!1),w(this,Xe,0),w(this,te,!0),t(this,N).forEach(function(o,h,c){c[h]=h}),this.buildRchTree(),e==0&&(t(this,be).fill(0),t(this,Se).fill(0)),t(this,p)[$.cc*9]=Me[0],t(this,p)[$.cc*25]=Me[0],t(this,p)[$.cc*41]=Me[0],t(this,p)[$.cc*57]=Me[0],t(this,R).fill(this.CH_MELODIC),t(this,R)[9]=this.CH_DRUM1,t(this,R)[25]=this.CH_DRUM3,t(this,R)[41]=this.CH_DRUMS,t(this,R)[57]=this.CH_DRUMS,t(this,R)[73]=this.CH_DRUM5,t(this,R)[89]=this.CH_DRUM7,t(this,R)[105]=this.CH_DRUMS,t(this,R)[121]=this.CH_DRUMS,t(this,_e).fill(0),t(this,Ee).fill(0),t(this,ve).fill(0),t(this,J).fill(0),t(this,ce).fill(0),t(this,Q).fill(0),this.aiEfxName="",this.userBank.clearRange({msb:0,lsb:127,prg:[0,127]});for(let o=0;o<$.ch;o++){let h=o*$.cc;t(this,p)[h+g[7]]=100,t(this,p)[h+g[11]]=127,t(this,p)[h+g[10]]=64,t(this,p)[h+g[71]]=64,t(this,p)[h+g[72]]=64,t(this,p)[h+g[73]]=64,t(this,p)[h+g[74]]=64,t(this,p)[h+g[75]]=64,t(this,p)[h+g[76]]=64,t(this,p)[h+g[77]]=64,t(this,p)[h+g[78]]=64,t(this,p)[h+g[91]]=40,t(this,p)[h+g[101]]=127,t(this,p)[h+g[100]]=127,t(this,p)[h+g[99]]=127,t(this,p)[h+g[98]]=127;let c=o*$.rpn;t(this,S)[c]=2,t(this,S)[c+1]=64,t(this,S)[c+2]=0,t(this,S)[c+3]=64,t(this,S)[c+4]=0,t(this,S)[c+5]=0}}switchMode(e,o=!1){let h=$e.indexOf(e);if(h>-1){if(t(this,I)==0||o){let c=t(this,I);w(this,I,h),w(this,j,0),w(this,me,Nt[0][h]),w(this,ee,Nt[1][h]);for(let a=0;a<$.ch;a++)t(this,R)[a]>0&&t(this,p)[a*$.cc+g[0]]==Me[c]&&(t(this,p)[a*$.cc]=Me[h]);switch(this.initOnReset,h){case C.mt32:{ut.forEach((a,n)=>{let s=n+1;t(this,V)[s]||(t(this,A)[s]=a,t(this,p)[s*$.cc+g[91]]=127)});break}}let r;switch(h){case C.gs:{r=[40,4,40,18,40,32,32,0,0,0,0,0,0,0];break}case C.x5d:case C.ns5r:{r=[44,1,44,19,44,0,44,0,0,0,0,0,0,0];break}default:r=[1,0,65,0,5,0,0,0,0,0,0,0,0,0]}for(let a=0;a<$.efx;a++)t(this,Q)[3*a]||(t(this,Q)[3*a+1]=r[2*a],t(this,Q)[3*a+2]=r[2*a+1]);this.dispatchEvent("mode",e)}}else throw new Error(`Unknown mode ${e}`)}newStrength(){t(this,oe).fill(0)}runJson(e){var o;if(e.type>14)return e.type==15&&e.data.constructor!=Uint8Array&&(e.data=Uint8Array.from(e.data)),t(this,et)[e.type].call(this,e);{let h=this.chRedir(e.part,e.track),c=!1;(o=t(this,Je)[h])==null||o.forEach(r=>{e.channel=r,c=!0,t(this,et)[e.type].call(this,e)}),c||console.warn(`${Ht[e.type]?Ht[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!=null?e.data[0]:e.data).toString():""} event sent to CH${h+1} without any recipient.`)}t(this,T).length>100&&t(this,T).splice(100,t(this,T).length-99)}runRaw(e){}async loadBank(e,o){switch(e=e.toLowerCase(),e){case"s7e":break;default:throw new Error(`Unknown bank format ${e}`)}}},I=new WeakMap,j=new WeakMap,ne=new WeakMap,ue=new WeakMap,Y=new WeakSet,fe=function(){return t(this,ue)[t(this,j)]},Kt=function(e){t(this,ue)[t(this,j)]=e},V=new WeakMap,N=new WeakMap,R=new WeakMap,p=new WeakMap,pe=new WeakMap,A=new WeakMap,U=new WeakMap,Z=new WeakMap,L=new WeakMap,H=new WeakMap,we=new WeakMap,oe=new WeakMap,Ce=new WeakMap,S=new WeakMap,Ge=new WeakMap,Ze=new WeakMap,ce=new WeakMap,ve=new WeakMap,J=new WeakMap,_e=new WeakMap,Ee=new WeakMap,Q=new WeakMap,me=new WeakMap,ee=new WeakMap,q=new WeakMap,ge=new WeakMap,Fe=new WeakMap,Ve=new WeakMap,le=new WeakMap,ke=new WeakMap,Xe=new WeakMap,te=new WeakMap,D=new WeakMap,Je=new WeakMap,gt=new WeakMap,T=new WeakMap,be=new WeakMap,Se=new WeakMap,G=new WeakMap,Te=new WeakMap,B=new WeakMap,et=new WeakMap,it=new WeakMap,Re=new WeakMap,Oe=new WeakMap,re=new WeakMap,he=new WeakMap,de=new WeakMap,Ae=new WeakMap,Ie=new WeakMap,De=new WeakMap,Xt);var vt=or(zt(),1);O();O();var tt,jt,qt=(jt=class{constructor(u,e,o,h){v(this,tt,!1);w(this,tt,u),this.start=e,this.end=o,this.data=h}get duration(){return this.ranged?this.end-this.start:0}get ranged(){return t(this,tt)}},tt=new WeakMap,jt),$t=class extends qt{constructor(u,e,o){super(!0,u,e,o)}},Yt=class extends qt{constructor(u,e){super(!1,u,u,e)}},Pe,Qt,wt=(Qt=class extends Array{constructor(){super(...arguments);v(this,Pe,-1)}resetIndex(e){w(this,Pe,-1)}fresh(){this.sort(function(e,o){return e.start==o.start?0:(+(e.start>o.start)<<1)-1}),this.forEach(function(e,o){e.index=o})}step(e,o=!1){let h=[];if(o)for(let c=0;c<this.length&&!(this[c].start>e);c++){if(this[c].end<e)continue;h.push(this[c])}else{let c=this.getRange(t(this,Pe)==-1?0:e-1,e),r=this;c.forEach(function(a){a.index>t(r,Pe)&&(h.push(a),w(r,Pe,a.index))})}return h}getRange(e,o){var n;e>o&&([e,o]=[o,e]);let h=[],c=-1,r=Math.ceil(Math.sqrt(this.length)),a=!0;for(let s=0;s<this.length;s+=r)this[s+r]?c<0&&this[s+r].start>=e&&(c=s):c=c<0?s:c;for(;a;)((n=this[c])==null?void 0:n.end)<o?this[c].start>=e&&h.push(this[c]):a=!1,c++;return h}},Pe=new WeakMap,Qt);var br=0xffffffffffff,Wt=function(u){let e=new wt,o=this,h=u.timeDivision,c=120,r=new wt,a=0,n=0;r.push(new $t(0,br,[120,0])),u.track.forEach(function(l){a=0,l.event.forEach(function(d){a+=d.deltaTime,d.type==255&&(d==null?void 0:d.metaType)==81&&(c=6e7/d.data,r[r.length-1]&&r.push(new $t(a,0xffffffffffff,[c,0])))})}),r.fresh(),r.forEach(function(l,d,b){d>0&&(b[d-1].end=l.start)});let s=120;r.forEach(function(l,d,b){d>0&&(l.end==l.start?b.splice(b.indexOf(l),1):s==l.data[0]&&(b[d-1].end=l.end,b.splice(b.indexOf(l),1)),s=l.data[0])});let i=0,f=120;return r.forEach(function(l){let d=l.start,b=d/f/h*60+i;f=l.data[0],i=b-d/f/h*60,l.data[1]=i}),console.debug("All tempo changes: ",r),c=120,a=0,n=0,u.track.forEach(function(l,d){a=0,n=0;let b=d+1;l.event.forEach(function(y,k){a+=y.deltaTime;let m=r.step(a,!0)[0];m&&(c=m.data[0],n=m.data[1]);let E={type:y.type,data:y.data,track:b,part:0};y.type>14?E.meta=y.metaType:E.part=y.channel,e.push(new Yt(a/c/h*60+n,E))})}),e.fresh(),self.midiEvents=e,console.debug(`Parsed a type ${u.formatType} MIDI sequence.`),e};vt.default.customInterpreter=Lt;var Ke,Ue,Le,Be,rt,xe,ze,_,Ne,ye,He,Zt,ua=(Zt=class extends at{constructor(e,o=.5,h=.5){super();M(this,"device");v(this,Ke,void 0);v(this,Ue,"");v(this,Le,[]);v(this,Be,new Uint8ClampedArray(128));v(this,rt,new Uint8ClampedArray(128));v(this,xe,.5);v(this,ze,120);v(this,_,4);v(this,Ne,4);v(this,ye,0);v(this,He,0);M(this,"smoothingAtk",0);M(this,"smoothingDcy",0);let c=this;this.smoothingAtk=o,this.smoothingDcy=h,this.device=e,this.addEventListener("meta",function(r){var a;(a=r==null?void 0:r.data)==null||a.forEach(function(n){(t(c,Le)[n.meta]||console.debug).call(c,n.meta,n.data)})}),this.device.addEventListener("mode",function(r){c.dispatchEvent("mode",r.data)}),this.device.addEventListener("channelactive",function(r){c.dispatchEvent("channelactive",r.data)}),this.device.addEventListener("channelmin",function(r){c.dispatchEvent("channelmin",r.data)}),this.device.addEventListener("channelmax",function(r){c.dispatchEvent("channelmax",r.data)}),this.device.addEventListener("channelreset",function(r){c.dispatchEvent("channelreset")}),this.device.addEventListener("screen",function(r){c.dispatchEvent("screen",r.data)}),t(this,Le)[3]=function(r,a){var n;((n=t(c,Ue))==null?void 0:n.length)<1&&w(c,Ue,a)},t(this,Le)[81]=function(r,a){let n=c.noteProgress,s=t(c,xe)||.5;w(c,ze,6e7/a),w(c,xe,a/1e6),w(c,ye,t(c,ye)+(n*(s/t(c,xe))-n))},t(this,Le)[88]=function(r,a){let n=c.noteProgress,s=c.noteOverall,i=c.noteBar,f=c.noteBeat,l=t(c,_),d=t(c,Ne);w(c,_,a[0]),w(c,Ne,1<<a[1]);let b=24*(32/a[3])/a[2];if(l!=t(c,_)){let y=i;w(c,ye,t(c,ye)-y*(t(c,_)-l)),f+1>=l&&(l<t(c,_)?w(c,ye,t(c,ye)-Math.ceil(t(c,_)-f-1)):w(c,ye,t(c,ye)+t(c,_)))}}}reset(){var e;this.dispatchEvent("reset"),(e=t(this,Ke))==null||e.resetIndex(),this.device.init(),w(this,Ue,""),w(this,xe,.5),w(this,ze,120),w(this,_,4),w(this,Ne,4),w(this,ye,0),w(this,He,0)}async loadFile(e){w(this,Ke,Wt(vt.default.parse(new Uint8Array(await e.arrayBuffer()))))}switchMode(e,o=!1){this.device.switchMode(e,o)}getMode(){return this.device.getMode()}getVoice(){return this.device.getVoice(...arguments)}getChVoice(e){return this.device.getChVoice(e)}get noteProgress(){return t(this,He)/t(this,xe)}get noteOverall(){return this.noteProgress-t(this,ye)}get noteBar(){return Math.floor(this.noteOverall/t(this,_))}get noteBeat(){let e=this.noteOverall%t(this,_);return e<0&&(e+=t(this,_)),e}getTimeSig(){return[t(this,_),t(this,Ne)]}getTempo(){return t(this,ze)}sendCmd(e){this.device.runJson(e)}render(e){var m;e>t(this,He)&&w(this,He,e);let o=((m=t(this,Ke))==null?void 0:m.step(e))||[],h=0,c=new Set,r=this,a=[];this.device.getStrength().forEach((E,x)=>{t(this,rt)[x]=E}),r.device.newStrength(),o.forEach(function(E){let x=E.data;x.type==9&&(x.data[1]>0?c.add(x.part*128+x.data[0]):c.has(x.part*128+x.data[0])&&h++),E.data.type==8&&c.has(x.part*128+x.data[0])&&h++;let P=r.device.runJson(x);switch(P==null?void 0:P.reply){case"meta":{a.push(P);break}}P!=null&&P.reply&&delete P.reply}),(a==null?void 0:a.length)>0&&this.dispatchEvent("meta",a);let n=this.device.getActive(),s=[],i=r.device.getPitch(),f=r.device.getCcAll(),l=r.device.getProgram(),d=r.device.getChType(),b=this.device.getStrength();b.forEach(function(E,x,P){P[x]=Math.max(t(r,rt)[x],E);let F=P[x]-t(r,Be)[x],ae=g.length*x;if(F>=0){let nt=4*.25**(f[ae+g[73]]/64);t(r,Be)[x]+=Math.ceil(F-F*r.smoothingAtk**nt)}else{let nt=4*.25**(f[ae+g[72]]/64);t(r,Be)[x]+=Math.floor(F-F*r.smoothingDcy**nt)}});let y=0;return n.forEach(function(E,x){E&&(s[x]=r.device.getVel(x),y+=s[x].size)}),{extraPoly:h,curPoly:y,chInUse:n,chKeyPr:s,chPitch:i,chProgr:l,chContr:f,chType:d,eventCount:o.length,title:t(this,Ue),bitmap:this.device.getBitmap(),letter:this.device.getLetter(),texts:this.device.getTexts(),master:this.device.getMaster(),mode:this.device.getMode(),strength:t(this,Be).slice(),velo:b,rpn:this.device.getRpn(),tSig:this.getTimeSig(),tempo:this.getTempo(),noteBar:this.noteBar,noteBeat:this.noteBeat,ace:this.device.getAce()}}},Ke=new WeakMap,Ue=new WeakMap,Le=new WeakMap,Be=new WeakMap,rt=new WeakMap,xe=new WeakMap,ze=new WeakMap,_=new WeakMap,Ne=new WeakMap,ye=new WeakMap,He=new WeakMap,Zt);export{ua as RootDisplay,g as ccToPos,bt as dnToPos};
