var ir=Object.create;var ht=Object.defineProperty;var nr=Object.getOwnPropertyDescriptor;var or=Object.getOwnPropertyNames;var cr=Object.getPrototypeOf,lr=Object.prototype.hasOwnProperty;var hr=(u,e,n)=>e in u?ht(u,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):u[e]=n;var St=(u,e)=>()=>(u&&(e=u(u=0)),e);var dr=(u,e)=>()=>(e||u((e={exports:{}}).exports,e),e.exports);var fr=(u,e,n,h)=>{if(e&&typeof e=="object"||typeof e=="function")for(let c of or(e))!lr.call(u,c)&&c!==n&&ht(u,c,{get:()=>e[c],enumerable:!(h=nr(e,c))||h.enumerable});return u};var ur=(u,e,n)=>(n=u!=null?ir(cr(u)):{},fr(e||!u||!u.__esModule?ht(n,"default",{value:u,enumerable:!0}):n,u));var C=(u,e,n)=>(hr(u,typeof e!="symbol"?e+"":e,n),n),xt=(u,e,n)=>{if(!e.has(u))throw TypeError("Cannot "+n)};var t=(u,e,n)=>(xt(u,e,"read from private field"),n?n.call(u):e.get(u)),E=(u,e,n)=>{if(e.has(u))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(u):e.set(u,n)},w=(u,e,n,h)=>(xt(u,e,"write to private field"),h?h.call(u,n):e.set(u,n),n);var Mt=St(()=>{"use strict";R();(function(){var u=function(o,i,s){var f,l;if(self.MessageEvent)switch(o){case"message":{l=new MessageEvent(o,{data:i,ports:s==null?void 0:s.ports}),Object.defineProperty(l,"source",{value:s==null?void 0:s.source});break}default:l=new Event(o)}else l=document.createEvent("Event"),l.initEvent(o,!1,!1),s&&o=="message"&&(l.data=i,s.source&&Object.defineProperty(l,"source",{value:s.source}),(f=s.ports)!=null&&f.length&&Object.defineProperty(l,"ports",{value:s.ports}));return l};self.BroadcastChannel?console.info("[Snowy] Snowy is disabled."):(console.info("[Snowy] Snowy is enabled. Path: ".concat(self.SNOWY_PATH||"/snowy.js")),n=[],h={},c=function(o){var i,s=this;if((this==null?void 0:this.constructor)!=c)throw new TypeError("Illegal constructor");n.push(this),(i=h[o])!=null&&i.constructor||(h[o]=[]),h[o].push(this);var f=Math.floor(Math.random()*281474976710656),l=[],d=0,b=[],y=!0,k=!1;Object.defineProperty(this,"id",{get:function(){return f}}),Object.defineProperty(this,"name",{value:o}),this.close=function(){var m,x=n.indexOf(s);x>-1?(e.postMessage({t:"d",c:o,i:f}),n.splice(x,1),(m=h[o])!=null&&m.constructor&&(x=h[o].indexOf(s),x>-1&&h[o].splice(x,1)),h[o].length||delete h[o],console.debug("[Snowy] BroadcastChannel closed."),k=!0):console.debug("[Snowy] BroadcastChannel already closed.")},this.postMessage=function(m){if(e){if(k)throw new Error("Channel already closed");e.postMessage({t:"m",c:o,i:f,m:d,d:m}),d++,d>4294967295&&(d=0)}else b.push(m),console.debug("[Snowy] Message is cached.")},this.flush=function(){if(e){if(y){for(e.postMessage({t:"r",c:o,i:f}),console.debug("[Snowy] ".concat(b.length," message(s) in cache."));b.length;){var m=b.shift();s.postMessage(m)}y=!1,console.debug("[Snowy] All cached messages are flushed away.")}}else throw new Error("Tried to flush when the ports are not ready")},this.receiveMessage=function(m){m.c==o?m.i!=f&&s.dispatchEvent(u("message",m.d,{source:s})):console.debug("[Snowy] Channel ID mismatch. Instance ".concat(f," receives from ").concat(o,", not ").concat(m.c,"."))};var v={};this.dispatchEvent=function(m){var x,A;if(Object.defineProperty(m,"target",{value:s}),Object.defineProperty(m,"currentTarget",{value:s}),(x=v[m.type])!=null&&x.length)for(var V=v[m.type],ae=0;ae<V.length;ae++)((A=V[ae])==null?void 0:A.constructor)==Function&&V[ae].call(s,m);s["on".concat(m.type)]&&s["on".concat(m.type)].constructor==Function&&s["on".concat(m.type)].call(s,m)},this.addEventListener=function(m,x){var A;(A=v[m])!=null&&A.constructor||(v[m]=[]);var V=v[m].indexOf(x);V==-1&&v[m].push(x)},this.removeEventListener=function(m,x){var A,V;if((A=v[m])!=null&&A.length){var ae=v[m].indexOf(x);ae>-1&&v[m].splice(ae,1)}!((V=v[m])!=null&&V.length)&&v[m].constructor&&delete v[m]}},self.BroadcastChannel=c,r=function(){if(e){e.addEventListener("message",function(i){var s=i.data,f=!1;switch(s.t){case"k":{f=!1,e.postMessage({t:"k"});break}case"m":{var l=h[s.c];if(l!=null&&l.length)for(var d=0;d<l.length;d++)l[d].receiveMessage(s);break}case"c":{for(var b=[],y=0;y<n.length;y++){var k=n[y].name;b.indexOf(k)<0&&b.push(k)}e.postMessage({t:"k",c:b});break}default:f=!0}f&&console.info("ReceiveBroadcast",s)});for(var o=0;o<n.length;o++)n[o].flush()}else throw new Error("Message port isn't yet ready");console.info("[Snowy] Snowy is active.")},a=function(){if(!e){var o=new SharedWorker(self.SNOWY_PATH||"/snowy.js");o.port.start();var i=function(s){s.data.t=="swc"&&(o.port.removeEventListener("message",i),e=o.port,e.postMessage({t:"k"}),r())};o.port.addEventListener("message",i)}},a());var e,n,h,c,r,a})()});var R=St(()=>{"use strict";Mt();{let u=function(e,n){let h=new FileReader;return new Promise((c,r)=>{switch(h.addEventListener("abort",()=>{r(new Error("Blob read aborted"))}),h.addEventListener("error",a=>{r(h.error||a.data||new Error("Blob read error"))}),h.addEventListener("load",()=>{c(h.result)}),n.toLowerCase()){case"arraybuffer":case"buffer":{h.readAsArrayBuffer(e);break}case"string":case"text":{h.readAsText(e);break}default:r(new Error(`Unknown target ${n}`))}})};Blob.prototype.arrayBuffer=Blob.prototype.arrayBuffer||function(){return u(this,"buffer")},Blob.prototype.text=Blob.prototype.text||function(){return u(this,"text")}}String.prototype.replaceAll=String.prototype.replaceAll||function(u,e){let n=0,h=16,c=this,r=[];for(;n<h&&c.lastIndexOf(u)>-1;){let a=c.lastIndexOf(u);r.unshift(c.slice(a+u.length)),c=c.slice(0,a),a==0&&r.unshift(""),n++}return c.length&&r.unshift(c),r.join(e)||""},String.prototype.padStart=String.prototype.padStart||function(u,e){if(e){let n=this;for(;n.length<u;)n=`${e}${n}`;return n}},String.prototype.padEnd=String.prototype.padEnd||function(u,e){if(e){let n=this;for(;n.length<u;)n+=e;return n}}});var Zt=dr((fa,Et)=>{R();(function(){"use strict";let u={fatal:!0},e=[new TextDecoder("iso-8859-15",u),new TextDecoder("sjis",u),new TextDecoder("euc-jp",u),new TextDecoder("utf-8",u),new TextDecoder("utf-16",u),new TextDecoder("ascii")],n={debug:!1,parse:function(h,c){if(h instanceof Uint8Array)return n.Uint8(h);if(typeof h=="string")return n.Base64(h);if(h instanceof HTMLElement&&h.type==="file")return n.addListener(h,c);throw new Error("MidiParser.parse() : Invalid input provided")},addListener:function(h,c){if(!File||!FileReader)throw new Error("The File|FileReader APIs are not supported in this browser. Use instead MidiParser.Base64() or MidiParser.Uint8()");if(h===void 0||!(h instanceof HTMLElement)||h.tagName!=="INPUT"||h.type.toLowerCase()!=="file")return console.warn("MidiParser.addListener() : Provided element is not a valid FILE INPUT element"),!1;c=c||function(){},h.addEventListener("change",function(r){if(!r.target.files.length)return!1;console.log("MidiParser.addListener() : File detected in INPUT ELEMENT processing data..");let a=new FileReader;a.readAsArrayBuffer(r.target.files[0]),a.onload=function(o){c(n.Uint8(new Uint8Array(o.target.result)))}})},Base64:function(h){let c=function(o){var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(o=o.replace(/^.*?base64,/,""),o=String(o).replace(/[\t\n\f\r ]+/g,""),!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(o))throw new TypeError("Failed to execute _atob() : The string to be decoded is not correctly encoded.");o+="==".slice(2-(3&o.length));let s,f="",l,d,b=0;for(;b<o.length;)s=i.indexOf(o.charAt(b++))<<18|i.indexOf(o.charAt(b++))<<12|(l=i.indexOf(o.charAt(b++)))<<6|(d=i.indexOf(o.charAt(b++))),f+=l===64?String.fromCharCode(s>>16&255):d===64?String.fromCharCode(s>>16&255,s>>8&255):String.fromCharCode(s>>16&255,s>>8&255,255&s);return f}(h=String(h));var r=c.length;let a=new Uint8Array(new ArrayBuffer(r));for(let o=0;o<r;o++)a[o]=c.charCodeAt(o);return n.Uint8(a)},Uint8:function(a){let c={data:null,pointer:0,movePointer:function(l){return this.pointer+=l,this.pointer},readInt:function(l){if((l=Math.min(l,this.data.byteLength-this.pointer))<1)return-1;let d=0;if(1<l)for(let b=1;b<=l-1;b++)d+=this.data.getUint8(this.pointer)*Math.pow(256,l-b),this.pointer++;return d+=this.data.getUint8(this.pointer),this.pointer++,d},readStr:function(l){let d=new Uint8Array(l),b=!1,y;d.forEach((k,v)=>{d[v]=this.readInt(1)});for(let k=0;k<e.length;k++)if(!b)try{if(y=e[k].decode(d),k==0)for(let v=0;v<y.length;v++){let m=y.charCodeAt(v);if(m>191||m>127&&m<160)throw new RangeError(`Invalid code point: ${m}`)}b=!0,console.debug(`String byte sequence in ${e[k].encoding}`)}catch(v){console.debug(`SMF string ${v}`)}return y||"String byte sequence read failed."},backOne:function(){this.pointer--},readIntVLV:function(){let l=0;if(this.pointer>=this.data.byteLength)return-1;if(this.data.getUint8(this.pointer)<128)l=this.readInt(1);else{let b=[];for(;128<=this.data.getUint8(this.pointer);)b.push(this.readInt(1)-128);var d=this.readInt(1);for(let y=1;y<=b.length;y++)l+=b[b.length-y]*Math.pow(128,y);l+=d}return l}};if(c.data=new DataView(a.buffer,a.byteOffset,a.byteLength),c.readInt(4)!==1297377380)return console.warn("Header validation failed (not MIDI standard or file corrupt.)"),!1;c.readInt(4);let r={};r.formatType=c.readInt(2),r.tracks=c.readInt(2),r.track=[];var a=c.readInt(1),o=c.readInt(1);128<=a?(r.timeDivision=[],r.timeDivision[0]=a-128,r.timeDivision[1]=o):r.timeDivision=256*a+o;for(let l=1;l<=r.tracks;l++){r.track[l-1]={event:[]};var i,s=c.readInt(4);if(s===-1)break;if(s!==1297379947)return!1;c.readInt(4);let d=0,b=!1,y,k;for(;!b&&(d++,r.track[l-1].event[d-1]={},r.track[l-1].event[d-1].deltaTime=c.readIntVLV(),(y=c.readInt(1))!==-1);)if(128<=y?k=y:(y=k,c.movePointer(-1)),y===255){r.track[l-1].event[d-1].type=255,r.track[l-1].event[d-1].metaType=c.readInt(1);var f=c.readIntVLV();switch(r.track[l-1].event[d-1].metaType){case 47:case-1:b=!0;break;case 1:case 2:case 3:case 4:case 5:case 7:case 6:r.track[l-1].event[d-1].data=c.readStr(f);break;case 33:case 89:case 81:r.track[l-1].event[d-1].data=c.readInt(f);break;case 84:r.track[l-1].event[d-1].data=[],r.track[l-1].event[d-1].data[0]=c.readInt(1),r.track[l-1].event[d-1].data[1]=c.readInt(1),r.track[l-1].event[d-1].data[2]=c.readInt(1),r.track[l-1].event[d-1].data[3]=c.readInt(1),r.track[l-1].event[d-1].data[4]=c.readInt(1);break;case 88:r.track[l-1].event[d-1].data=[],r.track[l-1].event[d-1].data[0]=c.readInt(1),r.track[l-1].event[d-1].data[1]=c.readInt(1),r.track[l-1].event[d-1].data[2]=c.readInt(1),r.track[l-1].event[d-1].data[3]=c.readInt(1);break;default:this.customInterpreter!==null&&(r.track[l-1].event[d-1].data=this.customInterpreter(r.track[l-1].event[d-1].metaType,c,f)),this.customInterpreter!==null&&r.track[l-1].event[d-1].data!==!1||(c.readInt(f),r.track[l-1].event[d-1].data=c.readInt(f),this.debug&&console.info("Unimplemented 0xFF meta event! data block readed as Integer"))}}else switch((y=y.toString(16).split(""))[1]||y.unshift("0"),r.track[l-1].event[d-1].type=parseInt(y[0],16),r.track[l-1].event[d-1].channel=parseInt(y[1],16),r.track[l-1].event[d-1].type){case 15:this.customInterpreter!==null&&(r.track[l-1].event[d-1].data=this.customInterpreter(r.track[l-1].event[d-1].type,c,!1)),this.customInterpreter!==null&&r.track[l-1].event[d-1].data!==!1||(i=c.readIntVLV(),r.track[l-1].event[d-1].data=c.readInt(i),this.debug&&console.info("Unimplemented 0xF exclusive events! data block readed as Integer"));break;case 10:case 11:case 14:case 8:case 9:r.track[l-1].event[d-1].data=[],r.track[l-1].event[d-1].data[0]=c.readInt(1),r.track[l-1].event[d-1].data[1]=c.readInt(1);break;case 12:case 13:r.track[l-1].event[d-1].data=c.readInt(1);break;case-1:b=!0;break;default:if(this.customInterpreter!==null&&(r.track[l-1].event[d-1].data=this.customInterpreter(r.track[l-1].event[d-1].metaType,c,!1)),this.customInterpreter===null||r.track[l-1].event[d-1].data===!1)return console.log("Unknown EVENT detected... reading cancelled!"),!1}}return r},customInterpreter:null};if(typeof Et<"u")Et.exports=n;else{let h=typeof window=="object"&&window.self===window&&window||typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;h.MidiParser=n}})()});R();R();var z,Ct,it=(Ct=class{constructor(){E(this,z,{})}addEventListener(u,e){t(this,z)[u]||(t(this,z)[u]=[]),t(this,z)[u].unshift(e)}removeEventListener(u,e){if(t(this,z)[u]){let n=t(this,z)[u].indexOf(e);n>-1&&t(this,z)[u].splice(n,1),t(this,z)[u].length<1&&delete t(this,z)[u]}}dispatchEvent(u,e){var c;let n=new Event(u),h=this;n.data=e,((c=t(this,z)[u])==null?void 0:c.length)>0&&t(this,z)[u].forEach(function(r){try{r==null||r.call(h,n)}catch(a){console.error(a)}}),this[`on${u}`]&&this[`on${u}`](n)}},z=new WeakMap,Ct);R();R();var Tt=function(u,e){let n=Math.min(u.length,e.length),h=u.slice(0,n),c=e.slice(0,n),r=0,a=0;for(;a<n&&r==0;)r=Math.sign(h[a]-c[a]),a++;return r},se=function(u=""){this.name=u,this.pool=[],this.point=function(e,n=!1){if(this.pool.length>0){let h=this.pool.length,c=1<<Math.floor(Math.log2(h)),r=c,a=64;for(;c>=1&&a>=0;){if(a<=0)throw new Error("TTL reached.");if(r==h)r-=c;else{let i=Tt(e,this.pool[r]);switch(i){case 0:{a=0;break}case 1:{r+c<=h&&(r+=c);break}case-1:{r!=0&&(r-=c);break}default:console.warn(`Unexpected result ${i}.`)}}c=c>>1,a--}let o=!0;if(r>=this.pool.length)o=!1;else{let i=this;this.pool[r].forEach(function(s,f,l){o&&s!=e[f]&&(o=!1)}),!o&&Tt(e,this.pool[r])>0&&r++}return o||n?r:-1}else return n?0:-1},this.add=function(e,n){return e.data=n,this.pool.splice(this.point(e,!0),0,e),this},this.default=function(e){console.warn(`No match in "${this.name||"(unknown)"}" for "${e}". Default action not defined.`)},this.get=function(e){let n=this.point(e);if(n>-1)return this.pool[n].data;this.default(e)},this.run=function(e,...n){let h=this.point(e);h>-1?e.subarray?this.pool[h].data(e.subarray(this.pool[h].length),...n):this.pool[h].data(e.slice(this.pool[h].length),...n):this.default(e,...n)}};R();var pr=["MSB","PRG","LSB"],dt=function(u){let e=Math.floor(u/10),n=u%10;return`${e.toString(16)}${n}`},K,Rt,ft=(Rt=class{constructor(...u){E(this,K,void 0);C(this,"strictMode",!1);this.loadFiles(...u)}get(u=0,e=0,n=0,h){let c=[u,e,n],r,a=Array.from(arguments);switch(h){case"xg":{u==32?a[2]+=4:u==33||u==35||u==36?a[2]+=5:u==79?a[0]=95:u==80?a[0]=96:u==81?a[0]=97:u==82?a[0]=98:u==83?a[0]=99:u==84&&(a[0]=100);break}case"gs":{u==0&&n<5?a[2]=0:u>125&&n<5&&n!=2&&(a[2]=u,a[0]=0);break}case"sg":{u==8&&n==0&&(a[2]=5);break}case"s90es":{n<8?a[2]+=17:n<32?a[2]+=13:a[2]=(a[2]>>3)+19;break}case"motif":{n<8?a[2]+=28:n<32?a[2]+=13:a[2]=(a[2]>>3)+19;break}}let o=" ",i="M",s=!1,f=0;switch(a[0]){case 0:{a[2]==127?i="MT-a":a[2]==126?i="MT-b":a[2]==7?i="GM-k":a[2]==5?i="SG-a":a[2]==4?i="SP-l":a[2]==0||h=="gs"&&a[2]<5?i="GM-a":(i="y",s=!0);break}case 8:{h=="sg"?i="GM-s":i="r:";break}case 48:{i=`yM${(a[2]>>3).toString().padStart(2,"0")}`,s=!0;break}case 56:{i="GM-b";break}case 61:case 120:{i="rDrm";break}case 62:{i="kDrm";break}case 63:{if(a[2]<17){let y=a[2];i=y<10?"kP:":"kC:",i+=y%10}else a[2]<34?i=["Pre1","Pre2","Pre3","Pre4","Usr1","Usr2","DrmP","DrmU","Plg1","Plg2","Plg3","Pre1","Pre2","Pre3","Pre4","Pre5","Pre6"][a[2]-17]:i="Ds";break}case 64:{i="ySFX";break}case 67:{i="DX:S";break}case 80:case 81:case 82:case 83:{i=`Prg${"UABC"[a[0]-80]}`;break}case 88:case 89:case 90:case 91:{i=`Cmb${"UABC"[a[0]-88]}`;break}case 95:{i=`${["DR","PC"][a[2]]}-d`;break}case 96:{i=a[2]==106?"AP-a":"PF",a[2]>63&&(f=63),s=!0;break}case 97:{i="VL:",s=!0,f=112;break}case 98:{i="SG-a";break}case 99:{i="DX",a[2]>63&&(f=63),s=!0;break}case 100:{i="AN",a[2]>63&&(f=63),s=!0;break}case 121:{i=`GM-${a[2]?"":"a"}`,s=!0;break}case 122:{i="lDrm";break}case 126:{i="yDrS";break}case 127:{a[2]==127?i="rDrm":i="yDrm";break}default:a[0]<48?i="r:":i="M"}i.length<4&&(i+=`${(s?n:u)-f}`.padStart(4-i.length,"0")),h=="xg"&&u==16&&(r=`Voice${(n*128+e+1).toString().padStart(3,"0")}`,o=" ");let l=[a[0],a[1],a[2]];for(;!((r==null?void 0:r.length)>=0);)r=t(this,K)[a[1]||0][(a[0]<<7)+a[2]],r||(this.strictMode?(r="",o="?"):t(this,K)[a[1]||0][a[0]<<7]?a[0]==0?(a[2]=0,o="^"):a[2]<1?(a[0]=0,o="*"):(a[2]--,o="^"):u==48?(a[0]=0,a[2]=0,o="!"):u==62?(a[1]--,o=" ",a[1]<1&&!(r!=null&&r.length)&&(a[0]=0,o="!")):u<63?a[0]==0?(a[2]=0,o="^"):a[2]<1?(a[0]=0,o="*"):a[2]--:u==80?(r=`PrgU:${e.toString().padStart(3,"0")}`,o="!"):u==88?(r=`CmbU:${e.toString().padStart(3,"0")}`,o="!"):u==121?(r=`GM2Vox0${n}`,o="#"):u==122?(a[1]==32?a[1]==0:a[1]%=7,r=t(this,K)[a[1]||0][(a[0]<<7)+a[2]],r?o=" ":(r="",o="*")):a[1]==0?(r=`${u.toString().padStart(3,"0")} ${e.toString().padStart(3,"0")} ${n.toString().padStart(3,"0")}`,o="!"):a[0]==0?(a[2]=0,o="^"):a[2]>0?a[2]--:a[1]>0?(a[1]=0,o="!"):(a[0]=0,o="?"));let d=[a[0],a[1],a[2]];(h=="gs"||h=="ns5r")&&o=="^"&&(o=" "),u==127&&o=="^"&&(o=" "),o!=" "&&self.debugMode&&(r="");let b="??";switch(a[0]){case 0:{a[2]==0?b="GM":a[2]==5||a[2]==7?b="KG":a[2]<120?b="XG":a[2]==127&&(b="MT");break}case 48:{b="MU";break}case 56:{b="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{b="AI";break}case 62:case 82:case 90:{b="XD";break}case 63:{a[2]<17?b="KR":a[2]<34?b="ES":b="DS";break}case 64:case 126:{b="XG";break}case 67:case 99:{b="DX";break}case 81:{b="RW";break}case 95:{b=["DR","PC"][a[2]];break}case 96:{b=a[2]==106?"AP":"PF";break}case 97:{b="VL";break}case 98:{b="SG";break}case 100:{b="AN";break}case 120:{b="GS";break}case 121:{b=a[2]?"G2":"GM";break}case 122:{b="KG";break}case 127:{b=a[2]==127?"MT":e==0?"GM":"XG";break}default:a[0]<48&&(a[0]==16&&h=="xg"?b="XG":b="GS")}return{name:r||`${dt(u||0)} ${dt(e||0)} ${dt(n||0)}`,iid:l,eid:d,sid:c,ending:o,sect:i,standard:b}}async load(u,e,n){let h=this,c=[],r=0,a=0;u.split(`
`).forEach(function(o,i){let s=o.split("	"),f=[];i==0?s.forEach(function(l,d){c[pr.indexOf(l)]=d}):s.forEach(async function(l,d){var b;d>2?(t(h,K)[f[c[1]]]=t(h,K)[f[c[1]]]||[],(!((b=t(h,K)[f[c[1]]][(f[c[0]]<<7)+f[c[2]]])!=null&&b.length)||e)&&(t(h,K)[f[c[1]]][(f[c[0]]<<7)+f[c[2]]]=s[3],r++),a++):f.push(parseInt(s[d]))})}),e||console.debug(`Map "${n||"(internal)"}": ${a} total, ${r} loaded.`)}clearRange(u){let e=u.prg!=null?u.prg.constructor==Array?u.prg:[u.prg,u.prg]:[0,127],n=u.msb!=null?u.msb.constructor==Array?u.msb:[u.msb,u.msb]:[0,127],h=u.lsb!=null?u.lsb.constructor==Array?u.lsb:[u.lsb,u.lsb]:[0,127];for(let c=n[0];c<=n[1];c++){let r=c<<7;for(let a=h[0];a<=h[1];a++){let o=r+a;for(let i=e[0];i<=e[1];i++)delete t(this,K)[i][o]}}}init(){w(this,K,[]);for(let u=0;u<128;u++)t(this,K).push([""])}async loadFiles(...u){this.init();let e=this;u.forEach(async function(n,h){try{await fetch(`./data/bank/${n}.tsv`).then(function(c){return c.text()}).then(c=>{e.load(c,!1,n)})}catch(c){console.error(`Failed loading "${n}.tsv".`)}})}},K=new WeakMap,Rt);R();R();var Ge,Ot,Pt=(Ot=class{constructor(){E(this,Ge,{});C(this,"context")}set(u,e){t(this,Ge)[u]=e}has(u){return!!t(this,Ge)[u]}async read(u,e){if(!this.has(u))throw new Error(`No decoder registered for "${u}"`);return await t(this,Ge)[u].call(this.context||this,e)}},Ge=new WeakMap,Ot);var br=function(u,e){let n=!0;return e.forEach((h,c)=>{n=n&&u[c]==h}),n},Dt=function(u){let e=0;return u.forEach(n=>{e*=256,e+=n}),e},Qe=new TextDecoder,nt=new Pt;nt.set("s7e",async function(u){let e=new Uint8Array(await u.slice(0,65536).arrayBuffer()),n="MSB	LSB	PRG	NME",h=[0,0,0,0],c=32,r=0,a=0,o=!0,i=[],s=0;for(;o;){let f=e.subarray(r);([()=>{Qe.decode(f.subarray(0,4))=="YSFC"?(r+=80,a=1):r++},()=>{if(br(f.subarray(0,4),h))i.forEach((l,d,b)=>{let y=Dt(e.subarray(l.start+4,l.start+8));l.length=y}),a=2;else{let l=Qe.decode(f.subarray(0,4)),d=Dt(f.subarray(4,8));i.push({type:l,start:d}),r+=8}},()=>{let l=i[s],d=e.subarray(l.start,l.start+l.length),b=32;switch(l.type){case"ENVC":{let y=c;for(;y<d.length;){let k=d.subarray(y,y+b),v=Qe.decode(k.subarray(0,10)).trimEnd();v.slice(0,5)=="Init "&&(v=""),v&&(n+=`
063	${(k[17]+13).toString().padStart(3,"0")}	${k[19].toString().padStart(3,"0")}	${v}`),y+=b}break}case"EDVC":{let y=c;for(;y<d.length;){let k=d.subarray(y,y+b),v=Qe.decode(k.subarray(0,10)).trimEnd();v.slice(0,5)=="Init "&&(v=""),v&&(n+=`
063	024	${k[19].toString().padStart(3,"0")}	${v}`),y+=b}break}case"EPVC":{let y=32,k=c;for(;k<d.length;){let v=d.subarray(k,k+y),m=Qe.decode(v.subarray(0,10)).trimEnd();m=="----------"&&(m=""),m&&(n+=`
063	${(v[17]+1).toString().padStart(3,"0")}	${v[19].toString().padStart(3,"0")}	${m}`),k+=y}break}}s++,s>=i.length&&(a=3,o=!1)}][a]||(()=>{o=!1}))()}return n});R();var We=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),Ye=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],gr=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],_e=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],It=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],At=function(u){let e=.1,n=-.3;return u>66?(e=5,n=315):u>56?(e=1,n=47):u>46&&(e=.5,n=18.5),e*u-n},Ut=function(u){return u>105?gr[u-106]:u>100?u*1.1-100:u/10},Lt=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),ut={};`hi*,
ka,か
ki,き
ku,く
ke,け
ko,こ
ky,き!
kw,くl
tsu,つ
ts,つl
sa,さ
si,すぃ
su,す
se,せ
so,そ
shi,し
sh,し!
ta,た
ti,てぃ
tu,とぅ
te,て
to,と
tchy,ち!
tchi,ち
na,な
ni,に
nu,ぬ
ne,ね
no,の
ny,に!
nn,ん
ha,は
hi,ひ
hu,ほぅ
he,へ
ho,ほ
hy,ひ!
fa,ふぁ
fi,ふぃ
fu,ふ
fe,ふぇ
fo,ふぉ
ma,ま
mi,み
mu,む
me,め
mo,も
my,み!
mm,
ra,ら
ri,り
ru,る
re,れ
ro,ろ
ry,り!
wa,わ
wi,うぃ
we,うぇ
wo,を
nga,ガ
ngi,ギ
ngu,グ
nge,ゲ
ngo,ゴ
ngy,ギ!
ng,
ga,が
gi,ぎ
gu,ぐ
ge,げ
go,ご
gy,ぎ!
gw,ぐl
za,ざ
zi,ずぃ
zu,ず
ze,ぜ
zo,ぞ
ja,じゃ
ji,じ
ju,じゅ
je,じぇ
jo,じょ
jy,じ!
da,だ
di,でぃ
du,どぅ
de,で
do,ど
dy,で!
ba,ば
bi,び
bu,ぶ
be,べ
bo,ぼ
by,び!
va,ゔぁ
vi,ゔぃ
vu,ゔ
ve,ゔぇ
vo,ゔぉ
pa,ぱ
pi,ぴ
pu,ぷ
pe,ペ
po,ぽ
py,ぴ!
!ya,ゃ
!yu,ゅ
!ye,ぇ
!yo,ょ
ya,や
yu,ゆ
ye,いぇ
yo,よ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
la,ぁ
li,ぃ
lu,ぅ
le,ぇ
lo,ぉ
a,あ
i,い
u,う
e,え
o,お
*,っ
~,
^,
_,`.split(`
`).forEach(u=>{let e=u.split(",");ut[e[0]]=e[1]});var Bt=function(u){let e=u;u[0]=="*"&&(e=e.slice(1)),["aa","ii","uu","ee","oo"].forEach(h=>{for(;e.indexOf(h)>-1;)e=e.replace(h,h[0])});for(let h in ut)e=e.replaceAll(h,ut[h]);e.indexOf("ん")==0&&e.length>1&&(e=e.slice(1));let n=e.indexOf("!");return n>-1&&e.length>1&&(e=e.slice(n+1)),e},Nt=function(u){return u?u<96?`cc${u}`:["aftertouch","velocity","pitch bend"][u-96]:"off"};R();var pt=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],Ht=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],Gt=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var yr={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},$r={66307:["drive"],66309:["vowel",u=>"aiueo"[u]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",u=>["off","LPF","HPF"][u]],94984:["noise type",u=>["white","pink"][u]],94987:["disc type",u=>["LP","SP","EP","RND"]],94990:["hum type",u=>`${u+5}0Hz`],94993:["M/S",u=>["mono","stereo"][u]]},bt=function(u){return yr[(u[0]-32<<8)+u[1]]||`0x${u[0].toString(16).padStart(2,"0")}${u[1].toString(16).padStart(2,"0")}`},_t=function(u,e,n){let h=(u[0]-32<<16)+(u[1]<<8)+e,c=$r[h]||{},r=c[0];if(r!=null&&r.length)return r+=`: ${(c[1]||function(){})(n)||n}`,r},gt=[68,48,95,78,41,3,110,122,0];R();var q=function(u=64){return Math.round(2e3*Math.log10(u/64))/100},Ft=function(u,e,n){let h=[],c=n==!1?e.readIntVLV():n;u==0||u==127;for(let r=0;r<c;r++){let a=e.readInt(1);if(h.push(a),a!=247){if(a!=240){if(a>127)return console.debug(`Early termination: ${h}`),h.pop(),e.backOne(),e.backOne(),new Uint8Array(h)}}}return new Uint8Array(h)},Vt=function(u){let e=0;return u.forEach(n=>{e+=n,e=e&127}),~e+1&127},ie=function(u,e){let n=0,h=0;for(let c=0;c<u.length;c++){let r=c%8-1,a=(h>>r&1)<<7,o=u[c];o+=a,c%8!=0?(e(o,n,u),n++):h=u[c]}},Ze=function(u){let e=Math.floor(u*14.2);return e<128?e:0};var $e=["?","gm","gs","xg","g2","mt32","ns5r","ag10","x5d","05rw","k11","sg","krs","s90es","motif"],Xt=[[0,0,0,0,121,0,0,56,82,81,0,0,63,63,63],[0,0,4,0,0,127,0,0,0,0,0,0,0,0,0]],Me=[120,127,120,127,120,127,61,62,62,62,120,122,122,127],wr=[0,3,81,84,88],zt={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},yt={0:0,1:1,2:3,5:4},Kt=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],qt=[36,37],ct=[20,21,22,23,24,25,26,28,29,30,31,36,37,64,65],Je=[0,1,2,4,5,6,7,8,10,11,32,38,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,84,91,92,93,94,95,98,99,100,101,128,12,13,16,17,18,19],Er=[12,13,16,17,18,19],mr=[33,99,100,32,102,8,9,10],jt=[0,16,25,40,32,64,26,48],M={};$e.forEach((u,e)=>{M[u]=e});var g={length:Je.length};Je.forEach((u,e)=>{g[u]=e});var wt={length:ct.length};ct.forEach((u,e)=>{wt[u]=e});var Y=function(){return!!self.Bun||self.debugMode||!1},vr=function(u){let e=[],n=0;return u==null||u.forEach(function(h,c){h==247?e.push(u.subarray(n,c)):h==240&&(n=c+1)}),e.length||e.push(u.subarray(0)),Y()&&console.debug(e),e},Qt=function(u,e="",n="",h=2){return u?`${e}${u.toString().padStart(h,"0")}${n}`:""},$={ch:128,cc:Je.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,ace:8,drm:8,dpn:ct.length,dnc:128,efx:7},P,j,ne,fe,W,de,Yt,U,H,O,p,ue,D,L,J,B,G,we,oe,Ce,S,Fe,et,ce,Ee,ee,Ve,me,Q,ve,te,X,pe,Xe,ze,le,ke,Ke,re,I,tt,$t,T,be,Se,_,Te,N,rt,ot,Re,Oe,Z,he,ge,Pe,De,Ie,Wt,oa=(Wt=class extends it{constructor(){super();E(this,W);C(this,"NOTE_IDLE",0);C(this,"NOTE_ATTACK",1);C(this,"NOTE_DECAY",2);C(this,"NOTE_SUSTAIN",3);C(this,"NOTE_HELD",4);C(this,"NOTE_RELEASE",5);C(this,"NOTE_SOSTENUTO_ATTACK",8);C(this,"NOTE_SOSTENUTO_DECAY",9);C(this,"NOTE_SOSTENUTO_SUSTAIN",10);C(this,"NOTE_SOSTENUTO_HELD",11);C(this,"CH_MELODIC",0);C(this,"CH_DRUMS",1);C(this,"CH_DRUM1",2);C(this,"CH_DRUM2",3);C(this,"CH_DRUM3",4);C(this,"CH_DRUM4",5);C(this,"CH_DRUM5",6);C(this,"CH_DRUM6",7);C(this,"CH_DRUM7",8);C(this,"CH_DRUM8",9);E(this,P,0);E(this,j,0);E(this,ne,0);E(this,fe,new Array(11));E(this,U,new Uint8Array($.ch));E(this,H,new Uint8Array($.ch));E(this,O,new Uint8Array($.ch));E(this,p,new Uint8Array($.ch*$.cc));E(this,ue,new Uint8Array($.ace));E(this,D,new Uint8Array($.ch));E(this,L,new Uint8Array($.ch*$.nn));E(this,J,new Uint8Array($.ch));E(this,B,new Uint16Array($.pl));E(this,G,new Uint8Array($.pl));E(this,we,new Int16Array($.ch));E(this,oe,new Uint8Array($.ch));E(this,Ce,0);E(this,S,new Uint8Array($.ch*$.rpn));E(this,Fe,new Int8Array($.ch*qt.length));E(this,et,new Uint8Array($.drm*$.dpn*$.dnc));E(this,ce,new Uint8Array($.ch));E(this,Ee,new Uint8Array(128));E(this,ee,new Uint8Array($.cmt*8));E(this,Ve,new Uint8Array(1024));E(this,me,new Uint8Array($.cmt*64));E(this,Q,new Uint8Array($.efx*3));E(this,ve,0);E(this,te,0);E(this,X,100);E(this,pe,0);E(this,Xe,500);E(this,ze,0);E(this,le,"");E(this,ke,0);E(this,Ke,0);E(this,re,!0);E(this,I,!1);E(this,tt,void 0);E(this,$t,new Uint8Array(2));E(this,T,[]);E(this,be,new Uint8Array($.ch));E(this,Se,new Uint8Array($.tr));C(this,"baseBank",new ft("gm","gm2","xg","gs","ns5r","gmega","plg-150vl","plg-150pf","plg-150dx","plg-150an","plg-150dr","plg-100sg","kross","s90es"));C(this,"userBank",new ft("gm"));C(this,"initOnReset",!1);C(this,"aiEfxName","");E(this,_,[]);E(this,Te,void 0);E(this,N,{nOff:(e,n)=>{let h=e*128+n,c=t(this,B).lastIndexOf(h);c>-1&&(t(this,p)[$.cc*e+g[64]]>63?(t(this,G)[c]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:n,velo:t(this,L)[h],state:this.NOTE_HELD})):t(this,p)[$.cc*e+g[66]]>63&&t(this,G)[c]==this.NOTE_SOSTENUTO_SUSTAIN?(t(this,G)[c]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:n,velo:t(this,L)[h],state:this.NOTE_SOSTENUTO_HELD})):(t(this,B)[c]=0,t(this,L)[h]=0,t(this,G)[c]=this.NOTE_IDLE,this.dispatchEvent("note",{part:e,note:n,velo:0,state:this.NOTE_IDLE})))},nOn:(e,n,h)=>{let c=e*128+n,r=0;for(t(this,J)[e]&&t(this,N).ano(e);t(this,G)[r]>0&&t(this,B)[r]!=c;)r++;r<$.pl?(t(this,B)[r]=c,t(this,L)[c]=h,t(this,G)[r]=this.NOTE_SUSTAIN,t(this,oe)[e]<h&&(t(this,oe)[e]=h),this.dispatchEvent("note",{part:e,note:n,velo:h,state:this.NOTE_SUSTAIN})):console.error("Polyphony exceeded.")},nAt:(e,n,h)=>{},cAt:(e,n)=>{},hoOf:e=>{t(this,G).forEach((n,h)=>{if(n==this.NOTE_HELD){let c=t(this,B)[h],r=c>>7;e==r&&(t(this,G)[h]=this.NOTE_IDLE,t(this,B)[h]=0,t(this,L)[c]=0,this.dispatchEvent("note",{part:e,note:c&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{t(this,G).forEach((n,h)=>{let c;switch(n){case this.NOTE_ATTACK:{c=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{c=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{c=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(c){t(this,G)[h]=c;let r=t(this,B)[h];this.dispatchEvent("note",{part:e,note:r&127,velo:t(this,L)[r],state:c})}})},soOf:e=>{t(this,G).forEach((n,h)=>{if(n==this.NOTE_SOSTENUTO_HELD){let c=t(this,B)[h],r=c>>7;e==r&&(t(this,G)[h]=this.NOTE_IDLE,t(this,B)[h]=0,t(this,L)[c]=0,this.dispatchEvent("note",{part:e,note:c&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{t(this,B).forEach((n,h,c)=>{let r=n>>7,a=n&127;n==0&&t(this,L)[0]==0||r==e&&t(this,N).nOff(r,a)})}});E(this,rt,{8:function(e){let n=e.channel,h=e.data[0];t(this,N).nOff(n,h)},9:function(e){let n=e.channel;t(this,U)[n]=1;let h=e.data[0],c=e.data[1];c>0?t(this,N).nOn(n,h,c):t(this,N).nOff(n,h)},10:function(e){let n=e.channel,h=n*128+e.data[0];t(this,B).indexOf(h)>-1&&(t(this,L)[h]=data[1],this.dispatchEvent("note",{part:n,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let n=e.channel;[0,32].indexOf(e.data[0])>-1&&(()=>{switch(t(this,P)){case M.s90es:case M.motif:{if(e.data[0]==0){[0,63].indexOf(e.data[1])>-1&&(t(this,U)[n]=1);break}e.data[1]&&(t(this,U)[n]=1);break}default:{t(this,U)[n]=1;break}}})();let h=n*$.cc;switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{t(this,N).ano(n),t(this,we)[n]=0;let c=n*$.cc;t(this,p)[c+g[1]]=0,t(this,p)[c+g[5]]=0,t(this,p)[c+g[64]]=0,t(this,p)[c+g[65]]=0,t(this,p)[c+g[66]]=0,t(this,p)[c+g[67]]=0,t(this,p)[c+g[11]]=127,t(this,p)[c+g[101]]=127,t(this,p)[c+g[100]]=127,t(this,p)[c+g[99]]=127,t(this,p)[c+g[98]]=127;return}case 123:{t(this,N).ano(n);return}case 124:{t(this,N).ano(n);return}case 125:{t(this,N).ano(n);return}case 126:{t(this,J)[n]=1,t(this,N).ano(n);return}case 127:{t(this,J)[n]=0,t(this,N).ano(n);return}}if(g[e.data[0]]==null)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(Er.indexOf(e.data[0])>-1&&this.allocateAce(e.data[0]),e.data[0]){case 0:{if(Y()&&console.debug(`${$e[t(this,P)]}, CH${n+1}: ${e.data[1]}`),t(this,P)==0)e.data[1]<48?(t(this,O)[n]>0&&(e.data[1]=t(this,p)[h],e.data[1]=120,console.debug(`Forced channel ${n+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),this.switchMode("gs"))):e.data[1]==62?this.switchMode("x5d"):e.data[1]==63?this.switchMode("krs"):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg");else if(t(this,P)==M.gs)e.data[1]<56&&t(this,O)[n]>0&&(e.data[1]=t(this,p)[h],e.data[1]=120,console.debug(`Forced channel ${n+1} to stay drums.`));else if(t(this,P)==M.gm)e.data[1]<48?t(this,O)[n]>0&&(e.data[1]=120,this.switchMode("gs",!0),console.debug(`Forced channel ${n+1} to stay drums.`)):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg",!0);else if(t(this,P)==M.x5d){if(e.data[1]>0&&e.data[1]<8)this.switchMode("05rw",!0);else if(e.data[1]==56){let c=0;for(let r=0;r<16;r++){let a=t(this,p)[$.cc*r];(a==56||a==62)&&c++}c>14&&this.switchMode("ag10",!0)}}switch(t(this,P)){case M.xg:{[126,127].indexOf(e.data[1])>-1?t(this,O)[n]==0&&(this.setChType(n,this.CH_DRUM2),console.debug(`CH${n+1} set to drums by MSB.`)):t(this,O)[n]>0&&(this.setChType(n,this.CH_MELODIC),console.debug(`CH${n+1} set to melodic by MSB.`));break}case M["05rw"]:case M.x5d:case M.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?t(this,O)[n]==0&&(this.setChType(n,this.CH_DRUM2),console.debug(`CH${n+1} set to drums by MSB.`)):t(this,O)[n]>0&&(this.setChType(n,this.CH_MELODIC),console.debug(`CH${n+1} set to melodic by MSB.`));break}case M.g2:{e.data[1]==120?t(this,O)[n]==0&&(this.setChType(n,this.CH_DRUMS),console.debug(`CH${n+1} set to drums by MSB.`)):t(this,O)[n]>0&&(this.setChType(n,this.CH_MELODIC),console.debug(`CH${n+1} set to melodic by MSB.`));break}}this.dispatchEvent("voice",{part:n});break}case 6:{if(t(this,Ce)){[M.xg,M.gs,M.ns5r].indexOf(t(this,P))<0&&console.warn(`NRPN commits are not available under "${$e[t(this,P)]}" mode, even when they are supported in Octavia.`);let c=t(this,p)[h+g[99]],r=t(this,p)[h+g[98]];if(c==1){let a=mr.indexOf(r);if(a>-1)t(this,p)[h+g[71+a]]=e.data[1],Y()&&console.debug(`Redirected NRPN 1 ${r} to cc${71+a}.`),this.dispatchEvent("cc",{part:n,cc:71+a,data:e.data[1]});else{let o=qt.indexOf(r);o>-1?t(this,Fe)[n*10+o]=e.data[1]-64:console.warn(`NRPN 0x01${r.toString(16).padStart(2,"0")} is not supported.`),Y()&&console.debug(`CH${n+1} voice NRPN ${r} commit`)}}else{if(ct.indexOf(c)<0){let o=`NRPN 0x${c.toString(16).padStart(2,"0")}${r.toString(16).padStart(2,"0")} `;c==127?console.warn(`${o}is not necessary. Consider removing it.`):console.warn(`${o}is not supported.`)}else{let o=t(this,O)[n]-2;o<0?console.warn(`CH${n+1} cannot accept drum NRPN as type ${Ye[t(this,O)[n]]}.`):t(this,et)[(o*$.dpn+wt[c])*$.dnc+r]=e.data[1]-64}Y()&&console.debug(`CH${n+1} (${Ye[t(this,O)[n]]}) drum NRPN ${c} commit`)}}else{let c=yt[t(this,p)[h+g[100]]];t(this,p)[h+g[101]]==0&&c!=null&&(Y()&&console.debug(`CH${n+1} RPN 0 ${t(this,p)[h+g[100]]} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],Kt[c][0]),Kt[c][1]),t(this,S)[n*$.rpn+c]=e.data[1])}break}case 32:{switch(t(this,P)){case M.s90es:case M.motif:{this.setChType(n,[32,40].indexOf(e.data[1])>-1?this.CH_DRUMS:this.CH_MELODIC,t(this,P),!0);break}}this.dispatchEvent("voice",{part:n});break}case 38:{t(this,Ce)||t(this,p)[h+101]==0&&yt[t(this,p)[h+100]]!=null&&(t(this,S)[n*$.rpn+yt[t(this,p)[h+100]]+1]=e.data[1]);break}case 64:{e.data[1]<64&&t(this,N).hoOf(n);break}case 66:{e.data[1]>>6?t(this,N).soOn(n):t(this,N).soOf(n);break}case 98:case 99:{w(this,Ce,1);break}case 100:case 101:{w(this,Ce,0);break}}t(this,p)[h+g[e.data[0]]]=e.data[1],this.dispatchEvent("cc",{part:n,cc:e.data[0],data:e.data[1]})}},12:function(e){let n=e.channel;switch(t(this,P)){case M.s90es:case M.motif:{e.data&&(t(this,U)[n]=1);break}default:t(this,U)[n]=1}t(this,D)[n]=e.data,t(this,ce)[n]=0,Y()&&console.debug(`T:${e.track} C:${n} P:${e.data}`),this.dispatchEvent("voice",{part:n})},13:function(e){let n=this,h=e.channel;t(this,B).forEach(function(c){let r=c>>7;h==r&&(t(n,L)[c]=e.data,n.dispatchEvent("note",{part:h,note:c&127,velo:e.data,state:n.NOTE_SUSTAIN}))})},14:function(e){let n=e.channel;t(this,we)[n]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:n,pitch:this.getPitchShift(n)})},15:function(e){vr(e.data).forEach(n=>{let h=n[0],c=n[1];(t(this,ot)[h]||function(){console.debug(`Unknown manufacturer ${h}.`)})(c,n.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(t(this,_)[e.meta]||function(h,c,r){}).call(this,e.data,e.track,e.meta),e.meta!=32&&w(this,pe,0);let n=wr.indexOf(e.meta)>-1;if(Y()&&console.debug(e),n)return e.reply="meta",e}});E(this,ot,{64:(e,n,h)=>{t(this,Pe).run(n,h,e)},65:(e,n,h)=>{if(n[0]<16)t(this,he).run(n,h,e),console.warn("Unknown device SysEx!");else{let c=n[n.length-1],r=Vt(n.subarray(2,n.length-1));c==r?t(this,he).run(n.subarray(0,n.length-1),h,e):console.warn(`Bad GS checksum ${c}. Should be ${r}.`)}},66:(e,n,h)=>{t(this,ge).run(n,h,e)},67:(e,n,h)=>{t(this,Z).run(n,h,e)},68:(e,n,h)=>{t(this,Ie).run(n,h,e)},71:(e,n,h)=>{t(this,De).run(n,h,e)},126:(e,n,h)=>{t(this,Re).run(n,h,e)},127:(e,n,h)=>{this.switchMode("gm"),t(this,Oe).run(n,h,e)}});E(this,Re,void 0);E(this,Oe,void 0);E(this,Z,void 0);E(this,he,void 0);E(this,ge,void 0);E(this,Pe,void 0);E(this,De,void 0);E(this,Ie,void 0);let e=this;w(this,W,new Uint8Array(256),Yt),t(this,fe)[10]=new Uint8Array(512),w(this,Te,new se),this.userBank.strictMode=!0,this.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),t(this,_)[1]=function(r){switch(r.slice(0,2)){case"@I":{w(this,I,!0),t(this,T).unshift(`Kar.Info: ${r.slice(2)}`);break}case"@K":{w(this,I,!0),t(this,T).unshift("Karaoke mode active."),console.debug(`Karaoke mode active: ${r.slice(2)}`);break}case"@L":{w(this,I,!0),t(this,T).unshift(`Language: ${r.slice(2)}`);break}case"@T":{w(this,I,!0),t(this,T).unshift(`Ka.Title: ${r.slice(2)}`);break}case"@V":{w(this,I,!0),t(this,T).unshift(`Kara.Ver: ${r.slice(2)}`);break}case"XF":{let a=r.slice(2).split(":");switch(a[0]){case"hd":{a.slice(1).forEach((o,i)=>{o.length&&t(this,T).unshift(`${["SongDate","SnRegion","SongCat.","SongBeat","SongInst","Sn.Vocal","SongCmp.","SongLrc.","SongArr.","SongPerf","SongPrg.","SongTags"][i]}: ${o}`)});break}case"ln":{a.slice(1).forEach((o,i)=>{o.length&&t(this,T).unshift(`${["Kar.Lang","Kar.Name","Kar.Cmp.","Kar.Lrc.","kar.Arr.","Kar.Perf","Kar.Prg."][i]}: ${o}`)});break}default:t(this,T).unshift(`XGF_Data: ${r}`)}break}default:t(this,I)?r[0]=="\\"?t(this,T).unshift(`@ ${r.slice(1)}`):r[0]=="/"?t(this,T).unshift(r.slice(1)):t(this,T)[0]+=r:(t(this,T)[0]=r,t(this,T).unshift(""))}},t(this,_)[2]=function(r){t(this,T).unshift(`Copyrite: ${r}`)},t(this,_)[3]=function(r,a){a<1&&t(this,pe)<1&&t(this,T).unshift(`TrkTitle: ${r}`)},t(this,_)[4]=function(r,a){t(this,T).unshift(`${Qt(t(this,pe),""," ")}Instrmnt: ${r}`)},t(this,_)[5]=function(r){r.trim()==""?t(this,T).unshift(""):t(this,T)[0]+=`${r}`},t(this,_)[6]=function(r){t(this,T).unshift(`${Qt(t(this,pe),""," ")}C.Marker: ${r}`)},t(this,_)[7]=function(r){t(this,T).unshift(`CuePoint: ${r}`)},t(this,_)[32]=function(r){w(this,pe,r[0]+1)},t(this,_)[33]=function(r,a){console.debug(`Track ${a} requests to get assigned to output ${r}.`),t(e,Se)[a]=r+1},t(this,_)[81]=function(r,a){w(e,Xe,r/1e3)},t(this,_)[127]=function(r,a){t(e,Te).run(r,a)},t(this,Te).default=function(r){console.warn(`Unrecognized sequencer-specific byte sequence: ${r}`)},t(this,Te).add([67,0,1],function(r,a){t(e,Se)[a]=r[0]+1}),w(this,Re,new se("universal non-realtime")),w(this,Oe,new se("universal realtime")),w(this,Z,new se("Yamaha")),w(this,he,new se("Roland")),w(this,ge,new se("Korg")),w(this,Pe,new se("Kawai")),w(this,De,new se("Akai")),w(this,Ie,new se("Casio"));let n=function(r){console.info(`Unrecognized SysEx in "${this.name}" set.`,r)};t(this,Re).default=n,t(this,Oe).default=n,t(this,Z).default=n,t(this,he).default=n,t(this,ge).default=n,t(this,Pe).default=n,t(this,De).default=n,t(this,Ie).default=n,t(this,Re).add([9],r=>{e.switchMode(["gm","?","g2"][r[0]-1],!0),w(e,I,t(e,I)||!1),console.info(`MIDI reset: ${["GM","Init","GM2"][r[0]-1]}`),r[0]==2&&e.init()}),t(this,Oe).add([4,1],r=>{w(e,X,((r[1]<<7)+r[0])/16383*100)}).add([4,3],r=>((r[1]<<7)+r[0]-8192)/8192).add([4,4],r=>r[1]-64),t(this,Z).add([76,0,0],r=>{switch(r[0]){case 125:{console.info(`XG drum setup reset: ${r}`);break}case 126:{e.switchMode("xg",!0),w(e,I,!1),console.info("MIDI reset: XG");break}default:{let a=[0,0,0,0],o=(i,s)=>{a[s]=i};if(r.subarray(1).forEach((i,s)=>{let f=s+r[0];([o,o,o,o,l=>{w(this,X,l*129/16383*100)},l=>{},l=>{}][f]||(()=>{}))(i,s)}),r[0]<4){let i=0;a.forEach(s=>{i=i<<4,i+=s}),i-=1024}}}}).add([76,2,1],r=>{let a="XG ";r[0]<32?(a+="reverb ",r.subarray(1).forEach((o,i)=>{([s=>{e.setEffectTypeRaw(0,!1,s),console.info(`${a}main type: ${We[s]}`)},s=>{e.setEffectTypeRaw(0,!0,s),console.debug(`${a}sub type: ${s+1}`)},s=>{console.debug(`${a}time: ${At(s)}s`)},s=>{console.debug(`${a}diffusion: ${s}`)},s=>{console.debug(`${a}initial delay: ${s}`)},s=>{console.debug(`${a}HPF cutoff: ${_e[s]}Hz`)},s=>{console.debug(`${a}LPF cutoff: ${_e[s]}Hz`)},s=>{console.debug(`${a}width: ${s}`)},s=>{console.debug(`${a}height: ${s}`)},s=>{console.debug(`${a}depth: ${s}`)},s=>{console.debug(`${a}wall type: ${s}`)},s=>{console.debug(`${a}dry/wet: ${s}`)},s=>{console.debug(`${a}send: ${q(s)}dB`)},s=>{console.debug(`${a}pan: ${s-64}`)},!1,!1,s=>{console.debug(`${a}delay: ${s}`)},s=>{console.debug(`${a}density: ${s}`)},s=>{console.debug(`${a}balance: ${s}`)},s=>{},s=>{console.debug(`${a}feedback: ${s}`)},s=>{}][r[0]+i]||function(){console.warn(`Unknown XG reverb address: ${r[0]}.`)})(o)})):r[0]<64?(a+="chorus ",r.subarray(1).forEach((o,i)=>{([s=>{e.setEffectTypeRaw(1,!1,s),console.info(`${a}main type: ${We[s]}`)},s=>{e.setEffectTypeRaw(1,!0,s),console.debug(`${a}sub type: ${s+1}`)},s=>{console.debug(`${a}LFO: ${It[s]}Hz`)},s=>{},s=>{console.debug(`${a}feedback: ${s}`)},s=>{console.debug(`${a}delay offset: ${Ut(s)}ms`)},s=>{},s=>{console.debug(`${a}low: ${_e[s]}Hz`)},s=>{console.debug(`${a}low: ${s-64}dB`)},s=>{console.debug(`${a}high: ${_e[s]}Hz`)},s=>{console.debug(`${a}high: ${s-64}dB`)},s=>{console.debug(`${a}dry/wet: ${s}`)},s=>{console.debug(`${a}send: ${q(s)}dB`)},s=>{console.debug(`${a}pan: ${s-64}`)},s=>{console.debug(`${a}to reverb: ${q(s)}dB`)},!1,s=>{},s=>{},s=>{},s=>{console.debug(`${a}LFO phase diff: ${(s-64)*3}deg`)},s=>{console.debug(`${a}input mode: ${s?"stereo":"mono"}`)},s=>{}][r[0]-32+i]||function(){console.warn(`Unknown XG chorus address: ${r[0]}.`)})(o)})):r[0]<86?(a+="variation ",r.subarray(1).forEach((o,i)=>{([s=>{e.setEffectTypeRaw(2,!1,s),console.info(`${a}main type: ${We[s]}`)},s=>{e.setEffectTypeRaw(2,!0,s),console.debug(`${a}sub type: ${s+1}`)}][r[0]-64+i]||function(){})(o)})):r[0]<97?(a+="variation ",r.subarray(1).forEach((o,i)=>{[s=>{console.debug(`${a}send: ${q(s)}dB`)},s=>{console.debug(`${a}pan: ${s-64}`)},s=>{console.debug(`${a}to reverb: ${q(s)}dB`)},s=>{console.debug(`${a}to chorus: ${q(s)}dB`)},s=>{console.debug(`${a}connection: ${s?"system":"insertion"}`)},s=>{console.debug(`${a}channel: CH${s+1}`)},s=>{console.debug(`${a}mod wheel: ${s-64}`)},s=>{console.debug(`${a}bend wheel: ${s-64}`)},s=>{console.debug(`${a}channel after touch: ${s-64}`)},s=>{console.debug(`${a}AC1: ${s-64}`)},s=>{console.debug(`${a}AC2: ${s-64}`)}][r[0]-86+i](o)})):r[0]>111&&r[0]<118?a+="variation ":console.warn(`Unknown XG variation address: ${r[0]}`)}).add([76,2,64],r=>{r.subarray(1).forEach((a,o)=>{let i=o+r[0];if(i==0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][a]}`);else{let s=i-1>>2,f=i-1&3,l=`XG EQ ${s} ${["gain","freq","Q","shape"][f]}: `;[()=>{console.debug(`${l}${a-64}dB`)},()=>{console.debug(`${l}${a} (raw)`)},()=>{console.debug(`${l}${a/10}`)},()=>{console.debug(`${l}${["shelf","peak"][+!!a]}`)}][f]()}})}).add([76,3],r=>{let a=r[0],o=r[1],i=`XG Insertion ${r[0]+1} `;r.subarray(2).forEach((s,f)=>{([l=>{e.setEffectTypeRaw(3+a,!1,l),console.info(`${i}main type: ${We[l]}`)},l=>{e.setEffectTypeRaw(3+a,!0,l),console.debug(`${i}sub type: ${l+1}`)}][o+f]||function(){})(s)})}).add([76,6,0],r=>{let a=r[0];a<64?e.setLetterDisplay(r.subarray(1),"XG letter display",a):w(e,ke,Date.now())}).add([76,7,0],r=>{let a=r[0];w(e,j,0),w(e,ne,Date.now()+3200),t(e,W,de).fill(0);let o=r.subarray(1);for(let i=0;i<a;i++)o.unshift(0);o.forEach(function(i,s){let f=Math.floor(s/16),l=s%16,d=(l*3+f)*7,b=7,y=0;for(d-=l*5,f==2&&(b=2);y<b;)t(e,W,de)[d+y]=i>>6-y&1,y++})}).add([76,8],(r,a)=>{let o=e.chRedir(r[0],a,!0),i=r[1],s=$.cc*o,f=`XG CH${o+1} `,l=`Unknown XG part address ${i}.`;r.subarray(2).forEach((d,b)=>{i<1?console.debug(l):i<41?([()=>{t(e,p)[s+g[0]]=d},()=>{t(e,p)[s+g[32]]=d},()=>{t(e,D)[o]=d},()=>{let y=e.chRedir(d,a,!0);t(e,H)[o]=y,o!=y&&(e.buildRchTree(),console.info(`${f}receives from CH${y+1}`))},()=>{t(e,J)[o]=+!d},()=>{},()=>{e.setChType(o,d,M.xg),console.debug(`${f}type: ${Ye[d]||d}`)},()=>{t(e,S)[$.rpn*o+3]=d},!1,!1,()=>{t(e,p)[s+g[7]]=d},!1,!1,()=>{t(e,p)[s+g[10]]=d||128},!1,!1,()=>{t(e,p)[s+g[128]]=d},()=>{t(e,p)[s+g[93]]=d},()=>{t(e,p)[s+g[91]]=d},()=>{t(e,p)[s+g[94]]=d},()=>{t(e,p)[s+g[76]]=d},()=>{t(e,p)[s+g[77]]=d},()=>{t(e,p)[s+g[78]]=d},()=>{t(e,p)[s+g[74]]=d},()=>{t(e,p)[s+g[71]]=d},()=>{t(e,p)[s+g[73]]=d},()=>{t(e,p)[s+g[75]]=d},()=>{t(e,p)[s+g[72]]=d}][i+b-1]||(()=>{}))():i<48?console.debug(l):i<111?i>102&&i<105&&(t(e,p)[s+g[[5,65][i&1]]]=d):i<114?console.debug(l):i<116?console.debug(`${f}EQ ${["bass","treble"][i&1]} gain: ${d-64}dB`):i<118?console.debug(l):i<120?console.debug(`${f}EQ ${["bass","treble"][i&1]} freq: ${d}`):console.debug(l)})}).add([76,9],(r,a)=>{let o=e.chRedir(r[0],a,!0),i=r[1],s=`PLG-150VL CH${o+1} `;r.subarray(2).forEach((f,l)=>{let d=l+i;switch(d){case 1:{console.info(`${s}breath mode: ${["system","breath","velocity","touch EG"][f]}`);break}case 0:case 27:case 28:break;default:if(d<27){let b=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][d-3>>1];d&1?d<23?(console.debug(`${s}${b} control source: ${Nt(f)}`),f&&f<96&&e.allocateAce(f)):console.debug(`${s}${b} scale break point: ${f}`):console.debug(`${s}${b} depth: ${f-64}`)}}})}).add([76,10],r=>{}).add([76,16],r=>{}).add([76,17,0,0],r=>{}).add([76,112],r=>{console.debug(`XG enable PLG-1${["50VL","00SG","50DX"][r[0]]} for CH${r[2]+1}.`)}).add([73,0,0],(r,a)=>{let o=r[0];r.subarray(1).forEach((i,s)=>{let f=o+s;f==8?console.debug(`MU1000 set LCD contrast to ${i}.`):f>9&&f<16&&[()=>{e.dispatchEvent("channelactive",i)},()=>{i<8?(e.dispatchEvent("channelmin",i<<4),console.info(`Octavia System: Minimum CH${(i<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{i<8?(e.dispatchEvent("channelmax",(i<<4)+15),console.info(`Octavia System: Maximum CH${(i<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{w(e,re,!!i),console.info(`Octavia System: RS receiving ${["dis","en"][i]}abled.`)}][f-10]()})}).add([73,10,0],(r,a)=>{let o=r[0],i=`MU1000 RS${t(e,re)?"":" (ignored)"}: `;if(o<16)switch(o){case 2:{let s=e.chRedir(0,a,!0);t(e,re)&&(e.dispatchEvent("channelmin",s),e.dispatchEvent("channelmax",s+63)),console.info(`${i}Show CH1~64`);break}case 3:{let s=e.chRedir(r[1]<<5,a,!0);t(e,re)&&e.dispatchEvent("channelmin",s),t(e,re)&&e.dispatchEvent("channelmax",s+31),console.info(`${i}Show CH${s+1}~CH${s+32}`);break}default:console.debug(`${i}unknown switch ${o} invoked.`)}else if(o<32){if(t(e,re)){let s=e.chRedir(o-16+(t(e,Ke)<<4),a,!0);e.dispatchEvent("channelactive",s)}}else if(o<36){let s=e.chRedir(o-32<<4,a,!0);t(e,re)&&(e.dispatchEvent("channelmin",s),e.dispatchEvent("channelmax",s+15),w(e,Ke,o-32)),console.info(`${i}Show CH${s+1}~CH${s+16}`)}}).add([93,3],(r,a)=>{let o=e.chRedir(r[0],a,!0),i=`PLG-100SG CH${o+1} `,s=Date.now();if(r[1]==0){let f="",l=0;r.subarray(2).forEach((d,b)=>{b%2==0?f+=Lt[d]||d.toString().padStart("0"):l+=d*13}),s>=t(e,ze)&&t(e,T).unshift("SG Lyric: "),t(e,T)[0]+=`${Bt(f)}`,w(e,ze,s+Math.ceil(l/2)+t(e,Xe)),Y()&&console.debug(`${i}vocals: ${f}`)}else console.warn(`Unknown PLG-100SG data: ${r}`)}),t(this,Z).add([76,48],r=>{}).add([76,49],r=>{}).add([76,50],r=>{}).add([76,51],r=>{}),t(this,Z).add([89,0],(r,a,o)=>{if(e.eprom){let i=r[0],s=(r[1]<<14)+(r[2]<<7)+r[3]+(e.eprom.offset||0);Y()&&console.debug(`MU1000 EPROM trail to 0x${s.toString(16).padStart(6,"0")}, ${i} bytes.`);let f=e.eprom.data;r.subarray(4).forEach((l,d)=>{let b=d>>3,y=d&7;if(y==7)for(let k=0;k<7;k++)f[s+7*b+k]+=(l>>6-k&1)<<7;else f[s+7*b+y]=l})}}).add([89,1],(r,a,o)=>{let i=(r[0]<<21)+(r[1]<<14)+(r[2]<<7)+r[3];Y()&&console.debug(`MU1000 EPROM jump to 0x${i.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=i)}).add([89,2],(r,a,o)=>{if(e.eprom){let i=(r[0]<<21)+(r[1]<<14)+(r[2]<<7)+r[3]+(e.eprom.offset||0);Y()&&console.debug(`MU1000 EPROM write to 0x${i.toString(16).padStart(6,"0")}.`);let s=e.eprom.data;r.subarray(4).forEach((f,l)=>{let d=l>>3,b=l&7;if(b==7)for(let y=0;y<7;y++)s[i+7*d+y]+=(f>>6-y&1)<<7;else s[i+7*d+b]=f})}}).add([89,3],(r,a,o)=>{}),t(this,Z).add([39,48],(r,a,o)=>{}).add([43,0,0],(r,a,o)=>{let i=[0,0,0,0],s=(f,l)=>{i[l]=f};if(r.subarray(1).forEach((f,l)=>{let d=l+r[0];[s,s,s,s,()=>{w(this,X,f*129/16383*100)},()=>f-64,()=>f||128,()=>f,()=>f,()=>{console.debug(`TG300 variation on cc${f}.`)}][d](f,d)}),r[0]<4){let f=0;i.forEach(l=>{f=f<<4,f+=l}),f-=1024}}).add([43,1,0],(r,a,o)=>{}).add([43,2],(r,a,o)=>{let i=e.chRedir(r[0],a,!0),s=r[1],f=$.cc*i,l=`TG300 CH${i+1} `;r.subarray(2).forEach((d,b)=>{b<5?([()=>{},()=>{t(e,p)[f+g[0]]=d},()=>{t(e,p)[f+g[32]]=d},()=>{t(e,D)[i]=d},()=>{let y=e.chRedir(d,a,!0);t(e,H)[i]=y,i!=y&&(e.buildRchTree(),console.info(`${l}receives from CH${y+1}`))}][b+s]||(()=>{}))(d,b+s):b<21||(b<47?([()=>{t(e,J)[i]=+!d},()=>{},()=>{},()=>{t(e,S)[$.rpn*i+3]=d},()=>{},()=>{t(e,p)[f+g[7]]=d},!1,!1,()=>{t(e,p)[f+g[10]]=d||128},!1,!1,()=>{console.debug(`${l} AC1 at cc${d}`)},()=>{console.debug(`${l} AC2 at cc${d}`)},()=>{t(e,p)[f+g[128]]=d},()=>{t(e,p)[f+g[93]]=d},()=>{t(e,p)[f+g[91]]=d},()=>{t(e,p)[f+g[94]]=d},()=>{t(e,p)[f+g[76]]=d},()=>{t(e,p)[f+g[77]]=d},()=>{t(e,p)[f+g[74]]=d},()=>{t(e,p)[f+g[71]]=d},()=>{t(e,p)[f+g[73]]=d},()=>{t(e,p)[f+g[75]]=d},()=>{t(e,p)[f+g[72]]=d},()=>{t(e,p)[f+g[78]]=d}][b+s-21]||(()=>{}))(d,b+s):b<95||([()=>{t(e,p)[f+g[65]]=d},()=>{t(e,p)[f+g[5]]=d}][b+s-95]||(()=>{}))(d,b+s))})}).add([43,7,0],(r,a,o)=>{let i=r[0];e.setLetterDisplay(r.subarray(1),"TG300 letter display",i)}).add([43,7,1],(r,a,o)=>{w(e,j,0),w(e,ne,Date.now()+3200),t(e,W,de).fill(0),r.forEach(function(i,s){let f=Math.floor(s/16),l=s%16,d=(l*3+f)*7,b=7,y=0;for(d-=l*5,f==2&&(b=2);y<b;)t(e,W,de)[d+y]=i>>6-y&1,y++})}),t(this,he).add([66,18,0,0,127],(r,a,o)=>{e.switchMode("gs",!0),t(e,p)[$.cc*9]=120,t(e,p)[$.cc*25]=120,t(e,p)[$.cc*41]=120,t(e,p)[$.cc*57]=120,w(e,te,3),w(e,I,!1),t(e,be).fill(0),console.info(`GS system to ${["single","dual"][r[0]]} mode.`)}).add([66,18,64,0],(r,a,o)=>{switch(r[0]){case 127:{e.switchMode("gs",!0),t(e,p)[$.cc*9]=120,t(e,p)[$.cc*25]=120,t(e,p)[$.cc*41]=120,t(e,p)[$.cc*57]=120,w(e,I,!1),t(e,be).fill(0),console.info("MIDI reset: GS");break}default:{let i=[0,0,0,0],s=(f,l)=>{i[l]=f};if(r.subarray(1).forEach((f,l)=>{let d=l+r[0];[s,s,s,s,b=>{w(this,X,b*129/16383*100)},b=>{},b=>{}][d](f,l)}),r[0]<4){let f=0;i.forEach(l=>{f=f<<4,f+=l}),f-=1024}}}}).add([66,18,64,1],r=>{let a=r[0];if(a<16){let o="".padStart(a," ");r.subarray(1).forEach((i,s)=>{o+=String.fromCharCode(Math.max(32,i))}),o=o.padEnd(16," "),console.debug(`GS patch name: ${o}`)}else a<48||(a<65?r.subarray(1).forEach((o,i)=>{let s=`GS ${a+i>55?"chorus":"reverb"} `;([()=>{console.info(`${s}type: ${pt[o]}`),e.setEffectType(0,40,o)},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${s}predelay: ${o}ms`)},()=>{console.info(`${s}type: ${Ht[o]}`),e.setEffectType(1,40,16+o)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${s}to reverb: ${q(o)}`)},()=>{console.debug(`${s}to delay: ${q(o)}`)}][a+i-48]||(()=>{}))()}):a<80?console.debug(`Unknown GS patch address: ${a}`):a<91?r.subarray(1).forEach((o,i)=>{let s="GS delay ";([()=>{console.info(`${s}type: ${Gt[o]}`),e.setEffectType(2,40,32+o)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${s}to reverb: ${q(o)}`)}][a+i-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${a}`))}).add([66,18,64,2],r=>{let a="GS EQ ";r.subarray(1).forEach((o,i)=>{([()=>{console.debug(`${a}low freq: ${[200,400][o]}Hz`)},()=>{console.debug(`${a}low gain: ${o-64}dB`)},()=>{console.debug(`${a}high freq: ${[3e3,6e3][o]}Hz`)},()=>{console.debug(`${a}high gain: ${o-64}dB`)}][r[0]+i]||function(){console.warn(`Unknown GS EQ address: ${r[0]+i}`)})()})}).add([66,18,64,3],r=>{let a="GS EFX ",o=function(i,s){let f=_t(t(e,Q).subarray(10,12),s,i);f&&console.debug(`${a}${bt(t(e,Q).subarray(10,12))} ${f}`)};r.subarray(1).forEach((i,s)=>{([()=>{e.setEffectTypeRaw(3,!1,32+i)},()=>{e.setEffectTypeRaw(3,!0,i),console.info(`${a}type: ${bt(t(e,Q).subarray(10,12))}`)},!1,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,()=>{console.debug(`${a}to reverb: ${q(i)}dB`)},()=>{console.debug(`${a}to chorus: ${q(i)}dB`)},()=>{console.debug(`${a}to delay: ${q(i)}dB`)},!1,()=>{console.debug(`${a}1 source: ${i}`),i&&i<96&&e.allocateAce(i)},()=>{console.debug(`${a}1 depth: ${i-64}`)},()=>{console.debug(`${a}2 source: ${i}`),i&&i<96&&e.allocateAce(i)},()=>{console.debug(`${a}2 depth: ${i-64}`)},()=>{console.debug(`${a}to EQ: ${i?"ON":"OFF"}`)}][r[0]+s]||function(f,l){console.warn(`Unknown GS EFX address: ${l}`)})(i,r[0]+s)})}).add([66,18,65],r=>{}).add([69,18,16],r=>{var a;switch(r[0]){case 0:{let o=r[1];e.setLetterDisplay(r.subarray(2),"GS display text",o);break}case 32:{w(e,ne,Date.now()+3200),r[1]==0&&w(e,j,Math.max(Math.min(r[2]-1,9),0));break}default:if(r[0]<11){t(e,j)>9&&w(e,j,0),w(e,ne,Date.now()+3200),(a=t(e,fe)[r[0]-1])!=null&&a.length||(t(e,fe)[r[0]-1]=new Uint8Array(256));let o=t(e,fe)[r[0]-1],i=r[1];o.fill(0);let s=r.subarray(2);for(let f=0;f<i;f++)s.unshift(0);s.forEach(function(f,l){let d=Math.floor(l/16),b=l%16,y=(b*4+d)*5,k=5,v=0;for(y-=b*4,d==3&&(k=1);v<k;)o[y+v]=f>>4-v&1,v++})}else console.warn(`Unknown GS display section: ${r[0]}`)}});let h=function(r,a,o){let i=r[0],s=$.cc*a,f=$.rpn*a,l=`GS CH${a+1} `;i<3?r.subarray(1).forEach((d,b)=>{[()=>{t(e,p)[s+g[0]]=d},()=>{t(e,D)[a]=d},()=>{let y=e.chRedir(d,o,!0);t(e,H)[a]=y,a!=y&&(e.buildRchTree(),console.info(`${l}receives from CH${y+1}`))}][i+b]()}):i<19||(i<44?r.subarray(1).forEach((d,b)=>{([()=>{t(e,J)[a]=+!d},!1,()=>{e.setChType(a,d<<1,M.gs),console.debug(`${l}type: ${d?"drum ":"melodic"}${d||""}`)},()=>{t(e,S)[f+3]=d},!1,()=>{t(e,p)[s+g[7]]=d},!1,!1,()=>{t(e,p)[s+g[10]]=d||128},!1,!1,()=>{console.debug(`${l}CC 1: cc${d}`)},()=>{console.debug(`${l}CC 2: cc${d}`)},()=>{t(e,p)[s+g[93]]=d},()=>{t(e,p)[s+g[91]]=d},!1,!1,()=>{t(e,S)[f+1]=d},()=>{t(e,S)[f+2]=d},()=>{t(e,p)[s+g[94]]=d}][i+b-19]||(()=>{}))()}):i<76||console.debug(`Unknown GS part address: ${i}`))},c=function(r,a){let o=r[0],i=`GS CH${a+1} `;o<2?r.subarray(1).forEach((s,f)=>{[()=>{t(e,p)[$.cc*a+g[32]]=s},()=>{}][o+f]()}):o<32?console.warn(`Unknown GS misc address: ${o}`):o<35?r.subarray(1).forEach((s,f)=>{[()=>{console.debug(`${i}EQ: o${["ff","n"][s]}`)},()=>{},()=>{console.debug(`${i}EFX: o${["ff","n"][s]}`)}][o+f-32]()}):console.warn(`Unknown GS misc address: ${o}`)};t(this,he).add([66,18,64,16],(r,a)=>{h(r,e.chRedir(9,a,!0),a)}).add([66,18,64,17],(r,a)=>{h(r,e.chRedir(0,a,!0),a)}).add([66,18,64,18],(r,a)=>{h(r,e.chRedir(1,a,!0),a)}).add([66,18,64,19],(r,a)=>{h(r,e.chRedir(2,a,!0),a)}).add([66,18,64,20],(r,a)=>{h(r,e.chRedir(3,a,!0),a)}).add([66,18,64,21],(r,a)=>{h(r,e.chRedir(4,a,!0),a)}).add([66,18,64,22],(r,a)=>{h(r,e.chRedir(5,a,!0),a)}).add([66,18,64,23],(r,a)=>{h(r,e.chRedir(6,a,!0),a)}).add([66,18,64,24],(r,a)=>{h(r,e.chRedir(7,a,!0),a)}).add([66,18,64,25],(r,a)=>{h(r,e.chRedir(8,a,!0),a)}).add([66,18,64,26],(r,a)=>{h(r,e.chRedir(10,a,!0),a)}).add([66,18,64,27],(r,a)=>{h(r,e.chRedir(11,a,!0),a)}).add([66,18,64,28],(r,a)=>{h(r,e.chRedir(12,a,!0),a)}).add([66,18,64,29],(r,a)=>{h(r,e.chRedir(13,a,!0),a)}).add([66,18,64,30],(r,a)=>{h(r,e.chRedir(14,a,!0),a)}).add([66,18,64,31],(r,a)=>{h(r,e.chRedir(15,a,!0),a)}).add([66,18,64,64],(r,a)=>{c(r,e.chRedir(9,a,!0))}).add([66,18,64,65],(r,a)=>{c(r,e.chRedir(0,a,!0))}).add([66,18,64,66],(r,a)=>{c(r,e.chRedir(1,a,!0))}).add([66,18,64,67],(r,a)=>{c(r,e.chRedir(2,a,!0))}).add([66,18,64,68],(r,a)=>{c(r,e.chRedir(3,a,!0))}).add([66,18,64,69],(r,a)=>{c(r,e.chRedir(4,a,!0))}).add([66,18,64,70],(r,a)=>{c(r,e.chRedir(5,a,!0))}).add([66,18,64,71],(r,a)=>{c(r,e.chRedir(6,a,!0))}).add([66,18,64,72],(r,a)=>{c(r,e.chRedir(7,a,!0))}).add([66,18,64,73],(r,a)=>{c(r,e.chRedir(8,a,!0))}).add([66,18,64,74],(r,a)=>{c(r,e.chRedir(10,a,!0))}).add([66,18,64,75],(r,a)=>{c(r,e.chRedir(11,a,!0))}).add([66,18,64,76],(r,a)=>{c(r,e.chRedir(12,a,!0))}).add([66,18,64,77],(r,a)=>{c(r,e.chRedir(13,a,!0))}).add([66,18,64,78],(r,a)=>{c(r,e.chRedir(14,a,!0))}).add([66,18,64,79],(r,a)=>{c(r,e.chRedir(15,a,!0))}),t(this,ge).add([54,65],(r,a)=>{e.switchMode("x5d");let o=(r[1]<<7)+r[0],i=(r[3]<<7)+r[2],s=e.chRedir(o&15,a,!0),f=$.cc*s;[()=>{i<1||(i<101?(e.setChType(s,e.CH_MELODIC,M.x5d),t(e,D)[s]=i-1,t(e,p)[f+g[0]]=82):i<229?(e.setChType(s,e.CH_MELODIC,M.x5d),t(e,D)[s]=i-101,t(e,p)[f+g[0]]=56):(e.setChType(s,e.CH_DRUMS,M.x5d),t(e,D)[s]=jt[i-229]||0,t(e,p)[f+g[0]]=62))},()=>{t(e,p)[f+g[7]]=i},()=>{i<31&&(t(e,p)[f+g[10]]=Math.round((i-15)*4.2+64))},()=>{t(e,p)[f+g[93]]=Ze(i)},()=>{t(e,p)[f+g[91]]=Ze(i)},()=>{t(e,S)[s*$.rpn+3]=i>8191?i-16320:64+i},()=>{t(e,S)[s*$.rpn+1]=i>8191?i-16320:64+i},()=>{i>0&&(t(e,S)[s*$.rpn]=i)},()=>{}][o>>4]()}).add([54,76,0],(r,a)=>{e.switchMode("x5d",!0);let o="",i=82,s=0,f=0,l="MSB	PRG	LSB	NME";ie(r,function(d,b){if(b<16400){let y=b%164;switch(!0){case y<10:{d>31&&(o+=String.fromCharCode(d));break}case y==11:{l+=`
${i}	${s}	${f}	${o.trim().replace("Init Voice","")}`,s++,o="";break}}s>99&&(i=90,s=0)}}),e.userBank.clearRange({msb:82,prg:[0,99],lsb:0}),e.userBank.load(l)}).add([54,77,0],(r,a)=>{e.switchMode("x5d",!0);let o="",i=90,s=0,f=0,l="MSB	PRG	LSB	NME";ie(r,function(d,b){if(b<13600){let y=b%136;switch(!0){case y<10:{d>31&&(o+=String.fromCharCode(d));break}case y==11:{l+=`
${i}	${s}	${f}	${o.trim().replace("Init Combi","")}`,s++,o="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(l)}).add([54,78],(r,a)=>{e.switchMode("x5d",!0),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][r[0]]} mode.`)}).add([54,85],(r,a)=>{e.switchMode("x5d",!0),ie(r,(o,i)=>{i>0&&i<3&&e.setEffectType(i-1,44,o)})}).add([54,104],(r,a)=>{e.switchMode("x5d",!0),ie(r,function(o,i,s,f){if(i<192){let l=e.chRedir(Math.floor(i/12),a,!0),d=l*$.cc;switch(i%12){case 0:{o<128?(e.setChType(l,e.CH_MELODIC,M.x5d),t(e,p)[d+g[0]]=82,t(e,D)[l]=o):(e.setChType(l,e.CH_DRUMS,M.x5d),t(e,p)[d+g[0]]=62,t(e,D)[l]=jt[o-128]),o>0&&(t(e,U)[l]=1);break}case 1:{t(e,p)[d+g[7]]=o;break}case 2:{t(e,S)[l*$.rpn+3]=o>127?o-192:64+o;break}case 3:{t(e,S)[l*$.rpn+1]=o>127?o-192:64+o;break}case 4:{o<31&&(t(e,p)[d+g[10]]=Math.round((o-15)*4.2+64));break}case 5:{let b=o>>4,y=o&15;t(e,p)[d+g[91]]=Ze(y),t(e,p)[d+g[93]]=Ze(b);break}case 10:break;case 11:{let b=e.chRedir(o&15,a,!0),y=o>>4;t(e,H)[l]=o,(b!=l||y)&&(console.info(`X5D Part CH${l+1} receives from CH${b+1}.`),e.buildRchTree())}}}else{let l=e.chRedir(i-192,a,!0)}})}),t(this,he).add([22,18,127],r=>{e.switchMode("mt32",!0),w(e,I,!1),e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(r,a,o)=>{e.switchMode("mt32");let i=e.chRedir(o,a,!0),s=r[1];r.subarray(2).forEach((f,l)=>{let d=l+s;t(e,Ee)[d+(i-1)*16]=f,([!1,()=>{let b=t(e,Ee)[i-1<<4];if(b<3)if(t(e,ce)[i]=1,b==2)for(let y=0;y<name.length;y++)t(e,ee)[(i-1)*$.cmt+y]=t(e,me)[f*$.cmt+y];else{let y=e.baseBank.get(0,f+(b<<6),127,"mt32").name;for(let k=0;k<y.length;k++)t(e,ee)[(i-1)*$.cmt+k]=y.charCodeAt(k)}},()=>{t(e,S)[i*$.rpn+3]=f+40},()=>{t(e,S)[i*$.rpn+1]=f+14},()=>{t(e,S)[i*$.rpn]=f},!1,()=>{t(e,p)[$.cc*i+g[91]]=f?127:0},!1,()=>{t(e,p)[$.cc*i+g[7]]=f},()=>{t(e,p)[$.cc*i+g[10]]=Math.ceil(f*9.05)}][d]||(()=>{}))()})}).add([22,18,1],(r,a,o)=>{e.switchMode("mt32");let i=e.chRedir(o,a,!0)}).add([22,18,2],(r,a,o)=>{e.switchMode("mt32");let i=e.chRedir(o,a,!0),s=r[1]+(r[0]<<7);s<10&&(t(e,ce)[i]=1),r.subarray(2).forEach((f,l)=>{let d=l+s;d<14&&(t(e,ee)[(i-1)*$.cmt+d]=f)})}).add([22,18,3],(r,a,o)=>{if(e.switchMode("mt32"),r[0]){let i=r[1]-16}else{let i=r[1];r.subarray(2).forEach((s,f)=>{let l=f+i;t(e,Ee)[l]=s;let d=e.chRedir(1+l>>4,a,!0),b=l&15;([!1,()=>{let y=t(e,Ee)[d-1<<4];if(y<3)if(t(e,ce)[d]=1,y==2)for(let k=0;k<name.length;k++)t(e,ee)[(d-1)*$.cmt+k]=t(e,me)[s*$.cmt+k];else{let k=e.baseBank.get(0,s+(y<<6),127,"mt32").name;for(let v=0;v<k.length;v++)t(e,ee)[(d-1)*$.cmt+v]=k.charCodeAt(v)}},()=>{t(e,S)[d*$.rpn+3]=s+40},()=>{t(e,S)[d*$.rpn+1]=s+14},()=>{t(e,S)[d*$.rpn]=s},!1,()=>{t(e,p)[$.cc*d+g[91]]=s?127:0},!1,()=>{t(e,p)[$.cc*d+g[7]]=s},()=>{t(e,p)[$.cc*d+g[10]]=Math.ceil(s*9.05)}][b]||(()=>{}))()})}}).add([22,18,4],(r,a,o)=>{e.switchMode("mt32");let i=r[1]+(r[0]<<7);r.subarray(2).forEach((s,f)=>{let l=f+i,d=e.chRedir(Math.floor(l/246+1),a,!0),b=l%246;b<14&&(t(e,ee)[(d-1)*$.cmt+b]=s),b<10&&(t(e,ce)[d]=1)})}).add([22,18,5],(r,a,o)=>{e.switchMode("mt32");let i=(r[0]<<7)+r[1];r.subarray(2).forEach((s,f)=>{let l=i+f,d=Math.floor(l/8),b=l&7,y=d*8;t(e,Ve)[l]=s,([!1,()=>{let k=t(e,Ve)[y];if(k<3){let v="";if(k==2){let m=$.cmt*d;v=`MT-m:${s.toString().padStart(3,"0")}`}else v=e.baseBank.get(0,s+(k<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:d}),e.userBank.load(`MSB	LSB	PRG	NME
000	127	${d}	${v}`,!0)}}][b]||(()=>{}))()})}).add([22,18,8],(r,a,o)=>{e.switchMode("mt32");let i=((r[0]&1)<<7)+r[1];r.subarray(2).forEach((s,f)=>{let l=i+f;l<$.cmt&&(t(e,me)[(r[0]>>1)*$.cmt+l]=s)})}).add([22,18,16],(r,a,o)=>{e.switchMode("mt32");let i=r[1],s=!1,f=function(l,d){t(e,H)[d-12]=l,s=!0};r.subarray(2).forEach((l,d)=>{let b=d+i;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,f,f,f,f,f,f,f,f,f,()=>{w(e,X,l)}][b]||(()=>{}))(l,d)}),s&&e.buildRchTree()}).add([22,18,32],r=>{e.switchMode("mt32");let a=r[1],o=" ".repeat(a);r.subarray(2).forEach(i=>{i>31&&(o+=String.fromCharCode(i))}),w(e,le,o.padStart(20," ")),w(e,ke,Date.now()+3200)}).add([22,18,82],(r,a)=>{let o=e.chRedir(0,a,!0);for(let i=0;i<16;i++)t(e,N).ano(o+i),i&&i<10&&(t(e,D)[o+i]=gt[i-1]);console.info("MT-32 alt reset complete.")}),t(this,ge).add([66,0],(r,a)=>{e.switchMode("ns5r",!0),w(e,I,!1),console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][r[0]]} mode.`)}).add([66,1],(r,a)=>{e.switchMode(["ns5r","05rw"][r[0]],!0),w(e,I,!1)}).add([66,18,0,0],(r,a)=>{let o=r[0];switch(o){case 124:case 126:case 127:{e.switchMode("ns5r",!0),w(e,I,!1);break}case 125:{console.info(`NS5R drum setup reset: ${r}`);break}default:if(o<10){let i=[0,0,0,0],s=(f,l)=>{i[l]=f};if(r.subarray(1).forEach((f,l)=>{[s,s,s,s,()=>{w(e,X,f*129/16383*100)},()=>f-64,()=>f-64,()=>{},()=>{},()=>{}][o+l]()}),r[0]<4){let f=0;i.forEach(l=>{f=f<<4,f+=l}),f-=1024}}}}).add([66,18,0,1],(r,a)=>{}).add([66,18,0,2],(r,a)=>{}).add([66,18,1],(r,a)=>{let o=e.chRedir(r[0],a,!0),i=o*$.cc,s=r[1],f=`NS5R CH${o+1} `;r.subarray(2).forEach((l,d)=>{let b=s+d;b<3?[()=>{t(e,p)[i+g[0]]=l||121},()=>{t(e,p)[i+g[32]]=l},()=>{t(e,D)[o]=l}][b]():b<8||(b<14?[()=>{let y=e.chRedir(l,a,!0);t(e,H)[o]=y,o!=y&&(e.buildRchTree(),console.info(`${f}receives from CH${y+1}`))},()=>{t(e,J)[o]=+!l},()=>{e.setChType(o,l,M.ns5r),console.debug(`${f}type: ${Ye[l]}`)},()=>{t(e,S)[$.rpn*o+3]=l},()=>{},()=>{}][b-8]():b<16||(b<33?[()=>{t(e,p)[i+g[7]]=l},()=>{t(e,p)[i+g[11]]=l},()=>{},()=>{},()=>{t(e,p)[i+g[10]]=l||128},()=>{},()=>{},()=>{t(e,p)[i+g[93]]=l},()=>{t(e,p)[i+g[91]]=l},()=>{t(e,p)[i+g[76]]=l},()=>{t(e,p)[i+g[77]]=l},()=>{t(e,p)[i+g[78]]=l},()=>{t(e,p)[i+g[74]]=l},()=>{t(e,p)[i+g[71]]=l},()=>{t(e,p)[i+g[73]]=l},()=>{t(e,p)[i+g[75]]=l},()=>{t(e,p)[i+g[72]]=l}][b-16]():b<112||b<114&&[()=>{t(e,p)[i+g[5]]=l},()=>{t(e,p)[i+g[65]]=l}][b-112]()))})}).add([66,18,8,0],(r,a)=>{let o=r[0];if(o<32)e.setLetterDisplay(r.subarray(1,33),"NS5R letter display");else{let i=o-32;w(e,ne,Date.now()+3200),w(e,j,10),t(e,W,de).fill(0);let s=r.subarray(1),f=4;s.forEach(function(l,d){let b=d+i,y=b>>4,k=b&15;if(b<80){let v=y<f?l:l>>3,m=0,x=y<f?6:3;for(;v>0;)t(e,W,de)[k*32+y*7+(x-m)]=v&1,v=v>>1,m++}})}}).add([66,52],(r,a)=>{e.switchMode("ns5r",!0),w(e,I,!1);let o="";ie(r,(i,s)=>{s<8?(i>31&&(o+=String.fromCharCode(i)),s==7&&(e.aiEfxName=o)):s<10&&e.setEffectType(s-8,44,i)})}).add([66,53],(r,a)=>{e.switchMode("ns5r",!0),w(e,I,!1),ie(r,function(o,i){switch(!0){case i<2944:{let s=e.chRedir(Math.floor(i/92),a,!0),f=s*$.cc;switch(i%92){case 0:{t(e,p)[f+g[0]]=o||121;break}case 1:{t(e,p)[f+g[32]]=o;break}case 2:{t(e,D)[s]=o,o>0&&(t(e,U)[s]=1);break}case 3:{let l=e.chRedir(o,a,!0);t(e,H)[s]=l,s!=l&&(console.info(`NS5R CH${s+1} receives from CH${l+1}.`),e.buildRchTree())}case 7:break;case 8:{t(e,S)[s*$.rpn+3]=o<40||o>88?o+(o>63?-192:64):o;break}case 9:case 10:{t(e,p)[f+g[7]]=o;break}case 11:{t(e,p)[f+g[11]]=o;break}case 14:{t(e,p)[f+g[10]]=o||128;break}case 19:{t(e,p)[f+g[93]]=o;break}case 20:{t(e,p)[f+g[91]]=o;break}case 84:{t(e,p)[f+g[65]]=o;break}case 85:{t(e,p)[f+g[5]]=o;break}}break}case i<3096:break;case i<3134:break;case i<8566:break}})}).add([66,54],(r,a)=>{e.switchMode("ns5r",!0);let o="",i=80,s=0,f=0,l="MSB	PRG	LSB	NME";ie(r,function(d,b){let y=b%158;switch(!0){case y<10:{d>31&&(o+=String.fromCharCode(d));break}case y==11:{i=d&127;break}case y==12:{f=d&127;break}case y==13:{l+=`
${i}	${s}	${f}	${o.trim().replace("Init Voice","")}`,s++,o="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(l)}).add([66,55],(r,a)=>{e.switchMode("ns5r",!0);let o="",i=88,s=0,f=0,l="MSB	PRG	LSB	NME";ie(r,function(d,b){let y=b%126;switch(!0){case y<10:{d>31&&(o+=String.fromCharCode(d));break}case y==11:break;case y==12:break;case y==13:{l+=`
${i}	${s}	${f}	${o.trim().replace("Init Combi","")}`,s++,o="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(l)}).add([66,125],r=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][r[0]]||"white")}).add([66,127],r=>{let a=new Uint8Array(5760);ie(r,(o,i,s)=>{if(i<720)for(let f=0;f<8;f++)a[i*8+f]=o>>7-f&1}),e.dispatchEvent("screen",{type:"ns5r",data:a})}).add([76],(r,a,o)=>{t(e,ge).run([66,...r],a,o)}),t(this,Pe).add([16,0,8,0],(r,a,o)=>{let i=(r[2]<<4)+r[3],s="K11 ";([()=>{e.switchMode("k11",!0),w(e,I,!1),w(e,te,i?4:0),console.info("MIDI reset: GMega/K11")},()=>{console.debug(`${s}reverb type: ${i}`)},()=>{console.debug(`${s}reverb time: ${i}`)},()=>{console.debug(`${s}reverb time: ${i}`)},()=>{console.debug(`${s}reverb predelay: ${i}`)},()=>{console.debug(`${s}reverb predelay: ${i}`)},()=>{console.debug(`${s}depth high: ${i}`)},()=>{console.debug(`${s}depth high: ${i}`)},()=>{console.debug(`${s}depth low: ${i}`)},()=>{console.debug(`${s}depth low: ${i}`)}][r[0]]||(()=>{}))()}).add([16,0,8,1],(r,a,o)=>{let i=e.chRedir(r[1],a,!0),s=$.cc*i,f=$.rpn*i,l=(r[3]<<4)+r[4],d=`K11 CH${i+1} `;([()=>{l<128?(e.setChType(i,e.CH_MELODIC,M.k11),t(e,p)[s+g[0]]=0,t(e,D)[i]=l):(e.setChType(i,e.CH_DRUMS,M.k11),t(e,D)[i]=l-128)},()=>{let b=e.chRedir(l,a,!0);t(e,H)[i]=b,i!=b&&(e.buildRchTree(),console.info(`${d}receives from CH${b+1}`))},()=>{t(e,p)[s+g[7]]=l},()=>{t(e,U)[i]=l},()=>{t(e,p)[s+g[10]]=l},()=>{t(e,S)[f+3]=l+40},()=>{t(e,S)[f+1]=l>>1,t(e,S)[f+2]=l&1},()=>{t(e,p)[s+g[91]]=l?127:0},()=>{},()=>{t(e,p)[s+g[74]]=l},()=>{t(e,p)[s+g[73]]=l},()=>{t(e,p)[s+g[72]]=l}][r[0]]||(()=>{}))()}).add([16,0,9,0],(r,a,o)=>{let i=(r[2]<<4)+r[3],s="GMLX ";([()=>{console.debug(`${s}reverb type: ${i}`)},()=>{console.debug(`${s}reverb time: ${i}`)},()=>{console.debug(`${s}reverb predelay: ${i}`)},()=>{console.debug(`${s}depth high: ${i}`)},()=>{console.debug(`${s}depth low: ${i}`)}][r[0]]||(()=>{}))()}).add([16,0,9,3],(r,a,o)=>{let i=(r[2]<<4)+r[3],s=e.chRedir(r[1],a,!0),f=s*$.cc;[()=>{i<128?(e.setChType(s,e.CH_MELODIC,M.k11),t(e,p)[f+g[0]]=0,t(e,p)[f+g[32]]=0,t(e,D)[s]=i):i<160?(e.setChType(s,e.CH_MELODIC,M.k11),t(e,p)[f+g[0]]=0,t(e,p)[f+g[32]]=7,t(e,D)[s]=i-100):(e.setChType(s,e.CH_DRUMS,M.k11),t(e,p)[f+g[0]]=122,t(e,p)[f+g[32]]=0,t(e,D)[s]=i-160)},()=>{let l=e.chRedir(i,a,!0);t(e,H)[s]=l,s!=l&&(e.buildRchTree(),console.info(`GMLX CH${s+1} receives from CH${l+1}`))}][r[0]]()}).add([16,0,9,4],(r,a,o)=>{let i=(r[2]<<4)+r[3],s=e.chRedir(r[1],a,!0),f=s*$.cc,l=s*$.rpn,d=`GMLX CH${s+1} `;[()=>{t(e,U)[s]=i},()=>{t(e,p)[f+g[7]]=i},()=>{t(e,p)[f+g[10]]=i},()=>{t(e,p)[f+g[91]]=i?127:0},()=>{t(e,S)[l+3]=i+40},()=>{t(e,S)[l+1]=i},()=>{t(e,S)[l]=i},()=>{}][r[0]]()}),t(this,De).add([66,93,64],(r,a,o)=>{let i=r[2];switch(r[0]){case 0:{switch(r[1]){case 4:{w(e,X,i*129/16383*100);break}case 5:{i-64;break}case 6:{console.debug(`SG global reverb: ${i?"on":"off"}`);break}case 127:{e.switchMode("sg",!0);break}}break}case 1:{switch(r[1]){case 48:{console.debug(`SG reverb type: ${pt[i]}`);break}}break}default:if(r[0]>>4==1){let s=e.chRedir(r[0]&15,a,!0);if(r[1]==2){let f=e.chRedir(i,a,!0);t(e,H)[s]=f,s!=f&&(e.buildRchTree(),console.info(`SG CH${s+1} receives from CH${f+1}`))}else r[1]==19&&(t(e,p)[$.cc*s+g[7]]=i)}else console.warn(`Unknown AKAI SG SysEx: ${r}`)}}),t(this,Ie).add([9],(r,a,o)=>{console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremelo","phaser","rotary speaker","enhancer","flanger","EQ"][r[0]]||"off"}`)}),t(this,Z).add([127,0],(r,a,o)=>{e.switchMode("motif");let i=new Uint8Array([127,1,...r]);t(e,Z).run(i,a,o)}).add([127,1,0,0],(r,a,o)=>{e.switchMode("s90es");let i="S90/Motif ES system ",s=r[0];r.subarray(1).forEach((f,l)=>{([()=>{w(e,X,f*12900/16383)}][s+l]||(()=>{console.info(`Unrecognized ${i}ID: ${s+l}`)}))()})}).add([127,1,0,0,14],(r,a,o)=>{e.switchMode("s90es");let i="S90/Motif ES bulk header ",s=[];s[95]=(f,l,d)=>{console.debug(`${i}multi edit buffer: ${f[1]}`)},(s[r[0]]||(()=>{console.info(`Unrecognized ${i}ID: ${r[0]}.`)}))(r.subarray(1))}).add([127,1,0,0,15],(r,a,o)=>{e.switchMode("s90es");let i="S90/Motif ES bulk footer ",s=[];s[95]=(f,l,d)=>{console.debug(`${i}multi edit buffer: ${f[1]}`)},(s[r[0]]||(()=>{console.info(`Unrecognized ${i}ID: ${r[0]}.`)}))(r.subarray(1))}).add([127,1,0,58,55],(r,a,o)=>{e.switchMode("s90es");let i=e.chRedir(r[0],a,!0),s=$.cc*i,f=r[1],l=`S90/Motif ES bulk CH${i<16?i+1:"U"+(i-95)} `;console.debug(l,r),!(r[0]>15)&&r.subarray(2).forEach((d,b)=>{([()=>{t(e,p)[s+g[0]]=d},()=>{d&&(t(e,U)[i]=1),t(e,p)[s+g[32]]=d,t(e,O)[i]=this.setChType(i,[32,40].indexOf(d)>-1?this.CH_DRUMS:this.CH_MELODIC,t(this,P),!0)},()=>{d&&(t(e,U)[i]=1),t(e,D)[i]=d},()=>{let y=e.chRedir(d,a,!0);t(e,H)[i]=y,i!=y&&(e.buildRchTree(),console.info(`${l}receives from CH${y+1}`))},()=>{t(e,J)[i]=d?0:1},!1,!1,!1,!1,!1,!1,!1,!1,()=>{t(e,p)[s+g[7]]=d},()=>{t(e,p)[s+g[10]]=d},!1,!1,!1,()=>{t(e,p)[s+g[91]]=d},()=>{t(e,p)[s+g[93]]=d},()=>{t(e,p)[s+g[94]]=d},()=>{t(e,p)[s+g[128]]=d},()=>{},()=>{t(e,p)[s+g[74]]=d},()=>{t(e,p)[s+g[71]]=d},!1,()=>{t(e,p)[s+g[65]]=d},()=>{t(e,p)[s+g[5]]=d},()=>{}][f+b]||(()=>{}))()})}).add([127,1,54,16],(r,a,o)=>{e.switchMode("s90es");let i=r[0];r.subarray(1).forEach((s,f)=>{let d=`S90/Motif ES EQ${(f>>2)+1} `;([()=>{let b=s-64},()=>{let b=_e[s]},()=>{let b=s/10},()=>{let b=s}][i+f&3]||(()=>{}))()})})}chRedir(e,n,h){if(t(this,Se)[n])return(t(this,Se)[n]-1)*16+e;if([2,3].indexOf(t(this,te))>-1){if(h==1)return e;let c=0,r=!0;for(;r;)t(this,be)[e+c]==0?(t(this,be)[e+c]=n,console.debug(`Assign track ${n} to channel ${e+c+1}.`),r=!1):t(this,be)[e+c]==n?r=!1:(c+=16,c>=128&&(c=0,r=!1));return e+c}else return e}buildRchTree(){let e=[];t(this,H).forEach((n,h)=>{var c;(c=e[n])!=null&&c.constructor||(e[n]=[]),e[n].push(h)}),w(this,tt,e)}getActive(){let e=t(this,U).slice();return t(this,P)==M.mt32,e}getCc(e){let n=e*$.cc,h=t(this,p).subarray(n,n+$.cc);return h[g[0]]=h[g[0]]||t(this,ve),h[g[32]]=h[g[32]]||t(this,te),h}getCcCh(e,n){if(Je.indexOf(n)<0)throw new Error("CC number not accepted");return t(this,p)[$.cc*e+g[n]]}getCcAll(){let e=t(this,p).slice();for(let n=0;n<$.ch;n++){let h=n*$.cc;e[h+g[0]]=e[h+g[0]]||t(this,ve),e[h+g[32]]=e[h+g[32]]||t(this,te)}return e}getChType(){return t(this,O)}setChType(e,n,h=t(this,P),c=!1){n&=15,t(this,O)[e]=n,n>0&&!c&&(t(this,p)[e*$.cc+g[0]]=Me[h])}getPitch(){return t(this,we)}getProgram(){return t(this,D)}getTexts(){return t(this,T).slice()}getVel(e){let n=new Map,h=this;return t(h,B).forEach(function(c,r){let a=Math.floor(c/128),o=c%128;e==a&&t(h,L)[c]>0&&n.set(o,{v:t(h,L)[c],s:t(h,G)[r]})}),n}getBitmap(){return{bitmap:t(this,W,de),expire:t(this,ne)}}getLetter(){return{text:t(this,le),expire:t(this,ke)}}getMode(){return $e[t(this,P)]}getMaster(){return{volume:t(this,X)}}getRawStrength(){let e=this;return t(this,B).forEach(function(n){let h=Math.floor(n/128);t(e,L)[n]>t(e,oe)[h]&&(t(e,oe)[h]=t(e,L)[n])}),t(this,oe)}getStrength(){let e=[],n=this;return this.getRawStrength().forEach(function(h,c){e[c]=Math.floor(h*t(n,p)[c*$.cc+g[7]]*t(n,p)[c*$.cc+g[11]]*t(n,X)/803288)}),e}getRpn(){return t(this,S)}getNrpn(){return t(this,Fe)}getVoice(e,n,h,c){let r=e||t(this,ve),a=n,o=h||t(this,te);$e[t(this,P)]=="ns5r"&&r>0&&r<56&&(o=3);let i=this.userBank.get(r,a,o,c);if($e[t(this,P)]=="mt32"&&i.name.indexOf("MT-m:")==0){let s=parseInt(i.name.slice(5)),f=s*$.cmt,l="";t(this,me).subarray(f,f+10).forEach(d=>{d>31&&(l+=String.fromCharCode(d))}),this.userBank.load(`MSB	LSB	PRG
0	127	${a}	${l}`,!0),i.name=l,i.ending=" "}return(i.ending!=" "||!i.name.length)&&(i=this.baseBank.get(r,a,o,c)),i}getChVoice(e){let n=this.getVoice(t(this,p)[e*$.cc+g[0]],t(this,D)[e],t(this,p)[e*$.cc+g[32]],$e[t(this,P)]);if(t(this,ce)[e])switch(t(this,P)){case M.mt32:n.ending="~",n.name="",t(this,ee).subarray(14*(e-1),14*(e-1)+10).forEach(h=>{h>31&&(n.name+=String.fromCharCode(h))})}return n}getPitchShift(e){let n=e*$.rpn;return t(this,we)[e]/8192*t(this,S)[n]+(t(this,S)[n+3]-64)+((t(this,S)[n+1]<<7)+t(this,S)[n+2]-8192)/8192}getEffectType(e=0){let n=3*e+1;return t(this,Q).subarray(n,n+2)}setEffectTypeRaw(e=0,n,h){let c=3*e;t(this,Q)[c]=1,t(this,Q)[c+1+ +n]=h}setEffectType(e=0,n,h){this.setEffectTypeRaw(e,!1,n),this.setEffectTypeRaw(e,!0,h)}setLetterDisplay(e,n,h=0,c=3200){let r=this,a;w(r,le," ".repeat(h)),e.forEach(o=>{w(r,le,t(r,le)+String.fromCharCode(o>31?o:32)),o<32&&(a=a||new Set,a.add(o))}),w(r,ke,Date.now()+3200),w(r,le,t(r,le).padEnd(32," ")),a&&(a=Array.from(a),a.forEach((o,i,s)=>{s[i]=o.toString(16).padStart(2,"0")}),console.warn(`${n}${n?" ":""}invalid code point${a.length>1?"s":""}: 0x${a.join(", 0x")}`))}allocateAce(e){if(!e||e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}let n=!0,h=0;for(;n&&h<$.ace;)t(this,ue)[h]==e?n=!1:t(this,ue)[h]||(n=!1,t(this,ue)[h]=e,console.info(`Allocated cc${e} to ACE slot ${h}.`)),h++;h>=$.ace&&console.warn("ACE slots are full.")}getAce(){return t(this,ue)}getChAce(e,n){if(n<0||n>=$.ace)throw new RangeError("No such ACE slot");let h=t(this,ue)[n];if(h){if(Je.indexOf(h)>=0)return t(this,p)[e*$.cc+g[h]];throw new Error(`Invalid ACE source: ${h}`)}else return 0}init(e=0){this.dispatchEvent("mode","?"),w(this,P,0),w(this,ve,0),w(this,te,0),w(this,pe,0),t(this,U).fill(0),t(this,p).fill(0),t(this,ue).fill(0),t(this,D).fill(0),t(this,L).fill(0),t(this,B).fill(0),t(this,oe).fill(0),t(this,we).fill(0),t(this,Fe).fill(0),t(this,et).fill(0),w(this,X,100),w(this,T,[]),w(this,Xe,500),w(this,ze,0),w(this,ke,0),w(this,le,""),w(this,ne,0),w(this,j,0),t(this,W,de).fill(0),w(this,I,!1),w(this,Ke,0),w(this,re,!0),t(this,H).forEach(function(n,h,c){c[h]=h}),this.buildRchTree(),e==0&&(t(this,be).fill(0),t(this,Se).fill(0)),t(this,p)[$.cc*9]=Me[0],t(this,p)[$.cc*25]=Me[0],t(this,p)[$.cc*41]=Me[0],t(this,p)[$.cc*57]=Me[0],t(this,O).fill(this.CH_MELODIC),t(this,O)[9]=this.CH_DRUM1,t(this,O)[25]=this.CH_DRUM3,t(this,O)[41]=this.CH_DRUMS,t(this,O)[57]=this.CH_DRUMS,t(this,O)[73]=this.CH_DRUM5,t(this,O)[89]=this.CH_DRUM7,t(this,O)[105]=this.CH_DRUMS,t(this,O)[121]=this.CH_DRUMS,t(this,Ve).fill(0),t(this,me).fill(0),t(this,Ee).fill(0),t(this,ee).fill(0),t(this,ce).fill(0),t(this,Q).fill(0),this.aiEfxName="",this.userBank.clearRange({msb:0,lsb:127,prg:[0,127]});for(let n=0;n<$.ch;n++){let h=n*$.cc;t(this,p)[h+g[7]]=100,t(this,p)[h+g[11]]=127,t(this,p)[h+g[10]]=64,t(this,p)[h+g[71]]=64,t(this,p)[h+g[72]]=64,t(this,p)[h+g[73]]=64,t(this,p)[h+g[74]]=64,t(this,p)[h+g[75]]=64,t(this,p)[h+g[76]]=64,t(this,p)[h+g[77]]=64,t(this,p)[h+g[78]]=64,t(this,p)[h+g[91]]=40,t(this,p)[h+g[101]]=127,t(this,p)[h+g[100]]=127,t(this,p)[h+g[99]]=127,t(this,p)[h+g[98]]=127;let c=n*$.rpn;t(this,S)[c]=2,t(this,S)[c+1]=64,t(this,S)[c+2]=0,t(this,S)[c+3]=64,t(this,S)[c+4]=0,t(this,S)[c+5]=0}}switchMode(e,n=!1){let h=$e.indexOf(e);if(h>-1){if(t(this,P)==0||n){let c=t(this,P);w(this,P,h),w(this,j,0),w(this,ve,Xt[0][h]),w(this,te,Xt[1][h]);for(let a=0;a<$.ch;a++)t(this,O)[a]>0&&t(this,p)[a*$.cc+g[0]]==Me[c]&&(t(this,p)[a*$.cc]=Me[h]);switch(this.initOnReset,h){case M.mt32:{gt.forEach((a,o)=>{let i=o+1;t(this,U)[i]||(t(this,D)[i]=a,t(this,p)[i*$.cc+g[91]]=127)});break}}let r;switch(h){case M.gs:{r=[40,4,40,18,40,32,32,0,0,0,0,0,0,0];break}case M.x5d:case M.ns5r:{r=[44,1,44,19,44,0,44,0,0,0,0,0,0,0];break}default:r=[1,0,65,0,5,0,0,0,0,0,0,0,0,0]}for(let a=0;a<$.efx;a++)t(this,Q)[3*a]||(t(this,Q)[3*a+1]=r[2*a],t(this,Q)[3*a+2]=r[2*a+1]);this.dispatchEvent("mode",e)}}else throw new Error(`Unknown mode ${e}`)}newStrength(){t(this,oe).fill(0)}runJson(e){var n;if(e.type>14)return e.type==15&&e.data.constructor!=Uint8Array&&(e.data=Uint8Array.from(e.data)),t(this,rt)[e.type].call(this,e);{let h=this.chRedir(e.part,e.track),c=!1;(n=t(this,tt)[h])==null||n.forEach(r=>{e.channel=r,c=!0,t(this,rt)[e.type].call(this,e)}),c||console.warn(`${zt[e.type]?zt[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!=null?e.data[0]:e.data).toString():""} event sent to CH${h+1} without any recipient.`)}t(this,T).length>100&&t(this,T).splice(100,t(this,T).length-99)}runRaw(e){}async loadBank(e,n){switch(e=e.toLowerCase(),e){case"s7e":{this.userBank.clearRange({msb:63,lsb:[21,22]}),this.userBank.clearRange({msb:63,lsb:[24,27]});break}default:throw new Error(`Unknown bank format ${e}`)}switch(e){case"s7e":{nt.context=this,this.userBank.load(await nt.read(e,n));break}}}},P=new WeakMap,j=new WeakMap,ne=new WeakMap,fe=new WeakMap,W=new WeakSet,de=function(){return t(this,fe)[t(this,j)]},Yt=function(e){t(this,fe)[t(this,j)]=e},U=new WeakMap,H=new WeakMap,O=new WeakMap,p=new WeakMap,ue=new WeakMap,D=new WeakMap,L=new WeakMap,J=new WeakMap,B=new WeakMap,G=new WeakMap,we=new WeakMap,oe=new WeakMap,Ce=new WeakMap,S=new WeakMap,Fe=new WeakMap,et=new WeakMap,ce=new WeakMap,Ee=new WeakMap,ee=new WeakMap,Ve=new WeakMap,me=new WeakMap,Q=new WeakMap,ve=new WeakMap,te=new WeakMap,X=new WeakMap,pe=new WeakMap,Xe=new WeakMap,ze=new WeakMap,le=new WeakMap,ke=new WeakMap,Ke=new WeakMap,re=new WeakMap,I=new WeakMap,tt=new WeakMap,$t=new WeakMap,T=new WeakMap,be=new WeakMap,Se=new WeakMap,_=new WeakMap,Te=new WeakMap,N=new WeakMap,rt=new WeakMap,ot=new WeakMap,Re=new WeakMap,Oe=new WeakMap,Z=new WeakMap,he=new WeakMap,ge=new WeakMap,Pe=new WeakMap,De=new WeakMap,Ie=new WeakMap,Wt);var kt=ur(Zt(),1);R();R();var at,Jt,tr=(Jt=class{constructor(u,e,n,h){E(this,at,!1);w(this,at,u),this.start=e,this.end=n,this.data=h}get duration(){return this.ranged?this.end-this.start:0}get ranged(){return t(this,at)}},at=new WeakMap,Jt),mt=class extends tr{constructor(u,e,n){super(!0,u,e,n)}},rr=class extends tr{constructor(u,e){super(!1,u,u,e)}},Ae,er,vt=(er=class extends Array{constructor(){super(...arguments);E(this,Ae,-1)}resetIndex(e){w(this,Ae,-1)}fresh(){this.sort(function(e,n){return e.start==n.start?0:(+(e.start>n.start)<<1)-1}),this.forEach(function(e,n){e.index=n})}step(e,n=!1){let h=[];if(n)for(let c=0;c<this.length&&!(this[c].start>e);c++){if(this[c].end<e)continue;h.push(this[c])}else{let c=this.getRange(t(this,Ae)==-1?0:e-1,e),r=this;c.forEach(function(a){a.index>t(r,Ae)&&(h.push(a),w(r,Ae,a.index))})}return h}getRange(e,n){var o;e>n&&([e,n]=[n,e]);let h=[],c=-1,r=Math.ceil(Math.sqrt(this.length)),a=!0;for(let i=0;i<this.length;i+=r)this[i+r]?c<0&&this[i+r].start>=e&&(c=i):c=c<0?i:c;for(;a;)((o=this[c])==null?void 0:o.end)<n?this[c].start>=e&&h.push(this[c]):a=!1,c++;return h}},Ae=new WeakMap,er);var kr=0xffffffffffff,ar=function(u){let e=new vt,n=this,h=u.timeDivision,c=120,r=new vt,a=0,o=0;r.push(new mt(0,kr,[120,0])),u.track.forEach(function(l){a=0,l.event.forEach(function(d){a+=d.deltaTime,d.type==255&&(d==null?void 0:d.metaType)==81&&(c=6e7/d.data,r[r.length-1]&&r.push(new mt(a,0xffffffffffff,[c,0])))})}),r.fresh(),r.forEach(function(l,d,b){d>0&&(b[d-1].end=l.start)});let i=120;r.forEach(function(l,d,b){d>0&&(l.end==l.start?b.splice(b.indexOf(l),1):i==l.data[0]&&(b[d-1].end=l.end,b.splice(b.indexOf(l),1)),i=l.data[0])});let s=0,f=120;return r.forEach(function(l){let d=l.start,b=d/f/h*60+s;f=l.data[0],s=b-d/f/h*60,l.data[1]=s}),console.debug("All tempo changes: ",r),c=120,a=0,o=0,u.track.forEach(function(l,d){a=0,o=0;let b=d+1;l.event.forEach(function(y,k){a+=y.deltaTime;let v=r.step(a,!0)[0];v&&(c=v.data[0],o=v.data[1]);let m={type:y.type,data:y.data,track:b,part:0};y.type>14?m.meta=y.metaType:m.part=y.channel,e.push(new rr(a/c/h*60+o,m))})}),e.fresh(),self.midiEvents=e,console.debug(`Parsed a type ${u.formatType} MIDI sequence.`),e};kt.default.customInterpreter=Ft;var qe,Ue,Le,Be,st,xe,je,F,Ne,ye,He,sr,Ta=(sr=class extends it{constructor(e,n=.5,h=.5){super();C(this,"device");E(this,qe,void 0);E(this,Ue,"");E(this,Le,[]);E(this,Be,new Uint8ClampedArray(128));E(this,st,new Uint8ClampedArray(128));E(this,xe,.5);E(this,je,120);E(this,F,4);E(this,Ne,4);E(this,ye,0);E(this,He,0);C(this,"smoothingAtk",0);C(this,"smoothingDcy",0);let c=this;this.smoothingAtk=n,this.smoothingDcy=h,this.device=e,this.addEventListener("meta",function(r){var a;(a=r==null?void 0:r.data)==null||a.forEach(function(o){(t(c,Le)[o.meta]||console.debug).call(c,o.meta,o.data)})}),this.device.addEventListener("mode",function(r){c.dispatchEvent("mode",r.data)}),this.device.addEventListener("channelactive",function(r){c.dispatchEvent("channelactive",r.data)}),this.device.addEventListener("channelmin",function(r){c.dispatchEvent("channelmin",r.data)}),this.device.addEventListener("channelmax",function(r){c.dispatchEvent("channelmax",r.data)}),this.device.addEventListener("channelreset",function(r){c.dispatchEvent("channelreset")}),this.device.addEventListener("screen",function(r){c.dispatchEvent("screen",r.data)}),t(this,Le)[3]=function(r,a){var o;((o=t(c,Ue))==null?void 0:o.length)<1&&w(c,Ue,a)},t(this,Le)[81]=function(r,a){let o=c.noteProgress,i=t(c,xe)||.5;w(c,je,6e7/a),w(c,xe,a/1e6),w(c,ye,t(c,ye)+(o*(i/t(c,xe))-o))},t(this,Le)[88]=function(r,a){let o=c.noteProgress,i=c.noteOverall,s=c.noteBar,f=c.noteBeat,l=t(c,F),d=t(c,Ne);w(c,F,a[0]),w(c,Ne,1<<a[1]);let b=24*(32/a[3])/a[2];if(l!=t(c,F)){let y=s;w(c,ye,t(c,ye)-y*(t(c,F)-l)),f+1>=l&&(l<t(c,F)?w(c,ye,t(c,ye)-Math.ceil(t(c,F)-f-1)):w(c,ye,t(c,ye)+t(c,F)))}}}reset(){var e;this.dispatchEvent("reset"),(e=t(this,qe))==null||e.resetIndex(),this.device.init(),w(this,Ue,""),w(this,xe,.5),w(this,je,120),w(this,F,4),w(this,Ne,4),w(this,ye,0),w(this,He,0)}async loadFile(e){w(this,qe,ar(kt.default.parse(new Uint8Array(await e.arrayBuffer()))))}switchMode(e,n=!1){this.device.switchMode(e,n)}getMode(){return this.device.getMode()}getVoice(){return this.device.getVoice(...arguments)}getChVoice(e){return this.device.getChVoice(e)}get noteProgress(){return t(this,He)/t(this,xe)}get noteOverall(){return this.noteProgress-t(this,ye)}get noteBar(){return Math.floor(this.noteOverall/t(this,F))}get noteBeat(){let e=this.noteOverall%t(this,F);return e<0&&(e+=t(this,F)),e}getTimeSig(){return[t(this,F),t(this,Ne)]}getTempo(){return t(this,je)}sendCmd(e){this.device.runJson(e)}render(e){var v;e>t(this,He)&&w(this,He,e);let n=((v=t(this,qe))==null?void 0:v.step(e))||[],h=0,c=new Set,r=this,a=[];this.device.getStrength().forEach((m,x)=>{t(this,st)[x]=m}),r.device.newStrength(),n.forEach(function(m){let x=m.data;x.type==9&&(x.data[1]>0?c.add(x.part*128+x.data[0]):c.has(x.part*128+x.data[0])&&h++),m.data.type==8&&c.has(x.part*128+x.data[0])&&h++;let A=r.device.runJson(x);switch(A==null?void 0:A.reply){case"meta":{a.push(A);break}}A!=null&&A.reply&&delete A.reply}),(a==null?void 0:a.length)>0&&this.dispatchEvent("meta",a);let o=this.device.getActive(),i=[],s=r.device.getPitch(),f=r.device.getCcAll(),l=r.device.getProgram(),d=r.device.getChType(),b=this.device.getStrength();b.forEach(function(m,x,A){A[x]=Math.max(t(r,st)[x],m);let V=A[x]-t(r,Be)[x],ae=g.length*x;if(V>=0){let lt=4*.25**(f[ae+g[73]]/64);t(r,Be)[x]+=Math.ceil(V-V*r.smoothingAtk**lt)}else{let lt=4*.25**(f[ae+g[72]]/64);t(r,Be)[x]+=Math.floor(V-V*r.smoothingDcy**lt)}});let y=0;return o.forEach(function(m,x){m&&(i[x]=r.device.getVel(x),y+=i[x].size)}),{extraPoly:h,curPoly:y,chInUse:o,chKeyPr:i,chPitch:s,chProgr:l,chContr:f,chType:d,eventCount:n.length,title:t(this,Ue),bitmap:this.device.getBitmap(),letter:this.device.getLetter(),texts:this.device.getTexts(),master:this.device.getMaster(),mode:this.device.getMode(),strength:t(this,Be).slice(),velo:b,rpn:this.device.getRpn(),tSig:this.getTimeSig(),tempo:this.getTempo(),noteBar:this.noteBar,noteBeat:this.noteBeat,ace:this.device.getAce()}}},qe=new WeakMap,Ue=new WeakMap,Le=new WeakMap,Be=new WeakMap,st=new WeakMap,xe=new WeakMap,je=new WeakMap,F=new WeakMap,Ne=new WeakMap,ye=new WeakMap,He=new WeakMap,sr);export{Ta as RootDisplay,g as ccToPos,wt as dnToPos};
