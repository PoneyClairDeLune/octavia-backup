var Jt=Object.create;var ot=Object.defineProperty;var er=Object.getOwnPropertyDescriptor;var tr=Object.getOwnPropertyNames;var rr=Object.getPrototypeOf,ar=Object.prototype.hasOwnProperty;var ir=(u,e,o)=>e in u?ot(u,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):u[e]=o;var mt=(u,e)=>()=>(u&&(e=u(u=0)),e);var sr=(u,e)=>()=>(e||u((e={exports:{}}).exports,e),e.exports);var nr=(u,e,o,l)=>{if(e&&typeof e=="object"||typeof e=="function")for(let c of tr(e))!ar.call(u,c)&&c!==o&&ot(u,c,{get:()=>e[c],enumerable:!(l=er(e,c))||l.enumerable});return u};var or=(u,e,o)=>(o=u!=null?Jt(rr(u)):{},nr(e||!u||!u.__esModule?ot(o,"default",{value:u,enumerable:!0}):o,u));var M=(u,e,o)=>(ir(u,typeof e!="symbol"?e+"":e,o),o),Et=(u,e,o)=>{if(!e.has(u))throw TypeError("Cannot "+o)};var r=(u,e,o)=>(Et(u,e,"read from private field"),o?o.call(u):e.get(u)),w=(u,e,o)=>{if(e.has(u))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(u):e.set(u,o)},v=(u,e,o,l)=>(Et(u,e,"write to private field"),l?l.call(u,o):e.set(u,o),o);var kt=mt(()=>{"use strict";O();(function(){var u=function(s,n,i){var d,h;if(self.MessageEvent)switch(s){case"message":{h=new MessageEvent(s,{data:n,ports:i==null?void 0:i.ports}),Object.defineProperty(h,"source",{value:i==null?void 0:i.source});break}default:h=new Event(s)}else h=document.createEvent("Event"),h.initEvent(s,!1,!1),i&&s=="message"&&(h.data=n,i.source&&Object.defineProperty(h,"source",{value:i.source}),(d=i.ports)!=null&&d.length&&Object.defineProperty(h,"ports",{value:i.ports}));return h};self.BroadcastChannel?console.info("[Snowy] Snowy is disabled."):(console.info("[Snowy] Snowy is enabled. Path: ".concat(self.SNOWY_PATH||"/snowy.js")),o=[],l={},c=function(s){var n,i=this;if((this==null?void 0:this.constructor)!=c)throw new TypeError("Illegal constructor");o.push(this),(n=l[s])!=null&&n.constructor||(l[s]=[]),l[s].push(this);var d=Math.floor(Math.random()*281474976710656),h=[],f=0,b=[],$=!0,k=!1;Object.defineProperty(this,"id",{get:function(){return d}}),Object.defineProperty(this,"name",{value:s}),this.close=function(){var m,x=o.indexOf(i);x>-1?(e.postMessage({t:"d",c:s,i:d}),o.splice(x,1),(m=l[s])!=null&&m.constructor&&(x=l[s].indexOf(i),x>-1&&l[s].splice(x,1)),l[s].length||delete l[s],console.debug("[Snowy] BroadcastChannel closed."),k=!0):console.debug("[Snowy] BroadcastChannel already closed.")},this.postMessage=function(m){if(e){if(k)throw new Error("Channel already closed");e.postMessage({t:"m",c:s,i:d,m:f,d:m}),f++,f>4294967295&&(f=0)}else b.push(m),console.debug("[Snowy] Message is cached.")},this.flush=function(){if(e){if($){for(e.postMessage({t:"r",c:s,i:d}),console.debug("[Snowy] ".concat(b.length," message(s) in cache."));b.length;){var m=b.shift();i.postMessage(m)}$=!1,console.debug("[Snowy] All cached messages are flushed away.")}}else throw new Error("Tried to flush when the ports are not ready")},this.receiveMessage=function(m){m.c==s?m.i!=d&&i.dispatchEvent(u("message",m.d,{source:i})):console.debug("[Snowy] Channel ID mismatch. Instance ".concat(d," receives from ").concat(s,", not ").concat(m.c,"."))};var E={};this.dispatchEvent=function(m){var x,P;if(Object.defineProperty(m,"target",{value:i}),Object.defineProperty(m,"currentTarget",{value:i}),(x=E[m.type])!=null&&x.length)for(var F=E[m.type],te=0;te<F.length;te++)((P=F[te])==null?void 0:P.constructor)==Function&&F[te].call(i,m);i["on".concat(m.type)]&&i["on".concat(m.type)].constructor==Function&&i["on".concat(m.type)].call(i,m)},this.addEventListener=function(m,x){var P;(P=E[m])!=null&&P.constructor||(E[m]=[]);var F=E[m].indexOf(x);F==-1&&E[m].push(x)},this.removeEventListener=function(m,x){var P,F;if((P=E[m])!=null&&P.length){var te=E[m].indexOf(x);te>-1&&E[m].splice(te,1)}!((F=E[m])!=null&&F.length)&&E[m].constructor&&delete E[m]}},self.BroadcastChannel=c,t=function(){if(e){e.addEventListener("message",function(n){var i=n.data,d=!1;switch(i.t){case"k":{d=!1,e.postMessage({t:"k"});break}case"m":{var h=l[i.c];if(h!=null&&h.length)for(var f=0;f<h.length;f++)h[f].receiveMessage(i);break}case"c":{for(var b=[],$=0;$<o.length;$++){var k=o[$].name;b.indexOf(k)<0&&b.push(k)}e.postMessage({t:"k",c:b});break}default:d=!0}d&&console.info("ReceiveBroadcast",i)});for(var s=0;s<o.length;s++)o[s].flush()}else throw new Error("Message port isn't yet ready");console.info("[Snowy] Snowy is active.")},a=function(){if(!e){var s=new SharedWorker(self.SNOWY_PATH||"/snowy.js");s.port.start();var n=function(i){i.data.t=="swc"&&(s.port.removeEventListener("message",n),e=s.port,e.postMessage({t:"k"}),t())};s.port.addEventListener("message",n)}},a());var e,o,l,c,t,a})()});var O=mt(()=>{"use strict";kt();{let u=function(e,o){let l=new FileReader;return new Promise((c,t)=>{switch(l.addEventListener("abort",()=>{t(new Error("Blob read aborted"))}),l.addEventListener("error",a=>{t(l.error||a.data||new Error("Blob read error"))}),l.addEventListener("load",()=>{c(l.result)}),o.toLowerCase()){case"arraybuffer":case"buffer":{l.readAsArrayBuffer(e);break}case"string":case"text":{l.readAsText(e);break}default:t(new Error(`Unknown target ${o}`))}})};Blob.prototype.arrayBuffer=Blob.prototype.arrayBuffer||function(){return u(this,"buffer")},Blob.prototype.text=Blob.prototype.text||function(){return u(this,"text")}}String.prototype.replaceAll=String.prototype.replaceAll||function(u,e){let o=0,l=16,c=this,t=[];for(;o<l&&c.lastIndexOf(u)>-1;){let a=c.lastIndexOf(u);t.unshift(c.slice(a+u.length)),c=c.slice(0,a),a==0&&t.unshift(""),o++}return c.length&&t.unshift(c),t.join(e)||""},String.prototype.padStart=String.prototype.padStart||function(u,e){if(e){let o=this;for(;o.length<u;)o=`${e}${o}`;return o}},String.prototype.padEnd=String.prototype.padEnd||function(u,e){if(e){let o=this;for(;o.length<u;)o+=e;return o}}});var zt=sr((Wr,yt)=>{O();(function(){"use strict";let u={fatal:!0},e=[new TextDecoder("iso-8859-15",u),new TextDecoder("sjis",u),new TextDecoder("euc-jp",u),new TextDecoder("utf-8",u),new TextDecoder("utf-16",u),new TextDecoder("ascii")],o={debug:!1,parse:function(l,c){if(l instanceof Uint8Array)return o.Uint8(l);if(typeof l=="string")return o.Base64(l);if(l instanceof HTMLElement&&l.type==="file")return o.addListener(l,c);throw new Error("MidiParser.parse() : Invalid input provided")},addListener:function(l,c){if(!File||!FileReader)throw new Error("The File|FileReader APIs are not supported in this browser. Use instead MidiParser.Base64() or MidiParser.Uint8()");if(l===void 0||!(l instanceof HTMLElement)||l.tagName!=="INPUT"||l.type.toLowerCase()!=="file")return console.warn("MidiParser.addListener() : Provided element is not a valid FILE INPUT element"),!1;c=c||function(){},l.addEventListener("change",function(t){if(!t.target.files.length)return!1;console.log("MidiParser.addListener() : File detected in INPUT ELEMENT processing data..");let a=new FileReader;a.readAsArrayBuffer(t.target.files[0]),a.onload=function(s){c(o.Uint8(new Uint8Array(s.target.result)))}})},Base64:function(l){let c=function(s){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(s=s.replace(/^.*?base64,/,""),s=String(s).replace(/[\t\n\f\r ]+/g,""),!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(s))throw new TypeError("Failed to execute _atob() : The string to be decoded is not correctly encoded.");s+="==".slice(2-(3&s.length));let i,d="",h,f,b=0;for(;b<s.length;)i=n.indexOf(s.charAt(b++))<<18|n.indexOf(s.charAt(b++))<<12|(h=n.indexOf(s.charAt(b++)))<<6|(f=n.indexOf(s.charAt(b++))),d+=h===64?String.fromCharCode(i>>16&255):f===64?String.fromCharCode(i>>16&255,i>>8&255):String.fromCharCode(i>>16&255,i>>8&255,255&i);return d}(l=String(l));var t=c.length;let a=new Uint8Array(new ArrayBuffer(t));for(let s=0;s<t;s++)a[s]=c.charCodeAt(s);return o.Uint8(a)},Uint8:function(a){let c={data:null,pointer:0,movePointer:function(h){return this.pointer+=h,this.pointer},readInt:function(h){if((h=Math.min(h,this.data.byteLength-this.pointer))<1)return-1;let f=0;if(1<h)for(let b=1;b<=h-1;b++)f+=this.data.getUint8(this.pointer)*Math.pow(256,h-b),this.pointer++;return f+=this.data.getUint8(this.pointer),this.pointer++,f},readStr:function(h){let f=new Uint8Array(h),b=!1,$;f.forEach((k,E)=>{f[E]=this.readInt(1)});for(let k=0;k<e.length;k++)if(!b)try{if($=e[k].decode(f),k==0)for(let E=0;E<$.length;E++){let m=$.charCodeAt(E);if(m>191||m>127&&m<160)throw new RangeError(`Invalid code point: ${m}`)}b=!0,console.debug(`String byte sequence in ${e[k].encoding}`)}catch(E){console.debug(`SMF string ${E}`)}return $||"String byte sequence read failed."},backOne:function(){this.pointer--},readIntVLV:function(){let h=0;if(this.pointer>=this.data.byteLength)return-1;if(this.data.getUint8(this.pointer)<128)h=this.readInt(1);else{let b=[];for(;128<=this.data.getUint8(this.pointer);)b.push(this.readInt(1)-128);var f=this.readInt(1);for(let $=1;$<=b.length;$++)h+=b[b.length-$]*Math.pow(128,$);h+=f}return h}};if(c.data=new DataView(a.buffer,a.byteOffset,a.byteLength),c.readInt(4)!==1297377380)return console.warn("Header validation failed (not MIDI standard or file corrupt.)"),!1;c.readInt(4);let t={};t.formatType=c.readInt(2),t.tracks=c.readInt(2),t.track=[];var a=c.readInt(1),s=c.readInt(1);128<=a?(t.timeDivision=[],t.timeDivision[0]=a-128,t.timeDivision[1]=s):t.timeDivision=256*a+s;for(let h=1;h<=t.tracks;h++){t.track[h-1]={event:[]};var n,i=c.readInt(4);if(i===-1)break;if(i!==1297379947)return!1;c.readInt(4);let f=0,b=!1,$,k;for(;!b&&(f++,t.track[h-1].event[f-1]={},t.track[h-1].event[f-1].deltaTime=c.readIntVLV(),($=c.readInt(1))!==-1);)if(128<=$?k=$:($=k,c.movePointer(-1)),$===255){t.track[h-1].event[f-1].type=255,t.track[h-1].event[f-1].metaType=c.readInt(1);var d=c.readIntVLV();switch(t.track[h-1].event[f-1].metaType){case 47:case-1:b=!0;break;case 1:case 2:case 3:case 4:case 5:case 7:case 6:t.track[h-1].event[f-1].data=c.readStr(d);break;case 33:case 89:case 81:t.track[h-1].event[f-1].data=c.readInt(d);break;case 84:t.track[h-1].event[f-1].data=[],t.track[h-1].event[f-1].data[0]=c.readInt(1),t.track[h-1].event[f-1].data[1]=c.readInt(1),t.track[h-1].event[f-1].data[2]=c.readInt(1),t.track[h-1].event[f-1].data[3]=c.readInt(1),t.track[h-1].event[f-1].data[4]=c.readInt(1);break;case 88:t.track[h-1].event[f-1].data=[],t.track[h-1].event[f-1].data[0]=c.readInt(1),t.track[h-1].event[f-1].data[1]=c.readInt(1),t.track[h-1].event[f-1].data[2]=c.readInt(1),t.track[h-1].event[f-1].data[3]=c.readInt(1);break;default:this.customInterpreter!==null&&(t.track[h-1].event[f-1].data=this.customInterpreter(t.track[h-1].event[f-1].metaType,c,d)),this.customInterpreter!==null&&t.track[h-1].event[f-1].data!==!1||(c.readInt(d),t.track[h-1].event[f-1].data=c.readInt(d),this.debug&&console.info("Unimplemented 0xFF meta event! data block readed as Integer"))}}else switch(($=$.toString(16).split(""))[1]||$.unshift("0"),t.track[h-1].event[f-1].type=parseInt($[0],16),t.track[h-1].event[f-1].channel=parseInt($[1],16),t.track[h-1].event[f-1].type){case 15:this.customInterpreter!==null&&(t.track[h-1].event[f-1].data=this.customInterpreter(t.track[h-1].event[f-1].type,c,!1)),this.customInterpreter!==null&&t.track[h-1].event[f-1].data!==!1||(n=c.readIntVLV(),t.track[h-1].event[f-1].data=c.readInt(n),this.debug&&console.info("Unimplemented 0xF exclusive events! data block readed as Integer"));break;case 10:case 11:case 14:case 8:case 9:t.track[h-1].event[f-1].data=[],t.track[h-1].event[f-1].data[0]=c.readInt(1),t.track[h-1].event[f-1].data[1]=c.readInt(1);break;case 12:case 13:t.track[h-1].event[f-1].data=c.readInt(1);break;case-1:b=!0;break;default:if(this.customInterpreter!==null&&(t.track[h-1].event[f-1].data=this.customInterpreter(t.track[h-1].event[f-1].metaType,c,!1)),this.customInterpreter===null||t.track[h-1].event[f-1].data===!1)return console.log("Unknown EVENT detected... reading cancelled!"),!1}}return t},customInterpreter:null};if(typeof yt<"u")yt.exports=o;else{let l=typeof window=="object"&&window.self===window&&window||typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;l.MidiParser=o}})()});O();O();var V,St,at=(St=class{constructor(){w(this,V,{})}addEventListener(u,e){r(this,V)[u]||(r(this,V)[u]=[]),r(this,V)[u].unshift(e)}removeEventListener(u,e){if(r(this,V)[u]){let o=r(this,V)[u].indexOf(e);o>-1&&r(this,V)[u].splice(o,1),r(this,V)[u].length<1&&delete r(this,V)[u]}}dispatchEvent(u,e){var c;let o=new Event(u),l=this;o.data=e,((c=r(this,V)[u])==null?void 0:c.length)>0&&r(this,V)[u].forEach(function(t){try{t==null||t.call(l,o)}catch(a){console.error(a)}}),this[`on${u}`]&&this[`on${u}`](o)}},V=new WeakMap,St);O();O();var xt=function(u,e){let o=Math.min(u.length,e.length),l=u.slice(0,o),c=e.slice(0,o),t=0,a=0;for(;a<o&&t==0;)t=Math.sign(l[a]-c[a]),a++;return t},re=function(u=""){this.name=u,this.pool=[],this.point=function(e,o=!1){if(this.pool.length>0){let l=this.pool.length,c=1<<Math.floor(Math.log2(l)),t=c,a=64;for(;c>=1&&a>=0;){if(a<=0)throw new Error("TTL reached.");if(t==l)t-=c;else{let n=xt(e,this.pool[t]);switch(n){case 0:{a=0;break}case 1:{t+c<=l&&(t+=c);break}case-1:{t!=0&&(t-=c);break}default:console.warn(`Unexpected result ${n}.`)}}c=c>>1,a--}let s=!0;if(t>=this.pool.length)s=!1;else{let n=this;this.pool[t].forEach(function(i,d,h){s&&i!=e[d]&&(s=!1)}),!s&&xt(e,this.pool[t])>0&&t++}return s||o?t:-1}else return o?0:-1},this.add=function(e,o){return e.data=o,this.pool.splice(this.point(e,!0),0,e),this},this.default=function(e){console.warn(`No match in "${this.name||"(unknown)"}" for "${e}". Default action not defined.`)},this.get=function(e){let o=this.point(e);if(o>-1)return this.pool[o].data;this.default(e)},this.run=function(e,...o){let l=this.point(e);l>-1?this.pool[l].data(e.slice(this.pool[l].length),...o):this.default(e,...o)}};O();var cr=["MSB","PRG","LSB"];var ct=function(u){let e=Math.floor(u/10),o=u%10;return`${e.toString(16)}${o}`},X,Mt,lt=(Mt=class{constructor(...u){w(this,X,void 0);M(this,"strictMode",!1);this.loadFiles(...u)}get(u=0,e=0,o=0,l){let c,t=Array.from(arguments);switch(l){case"xg":{u==32?t[2]+=4:u==33||u==35||u==36?t[2]+=5:u==79?t[0]=95:u==80?t[0]=96:u==81?t[0]=97:u==82?t[0]=98:u==83?t[0]=99:u==84&&(t[0]=100);break}case"gs":{u==0&&o<5?t[2]=0:u>125&&o<5&&o!=2&&(t[2]=u,t[0]=0);break}case"sg":{u==8&&o==0&&(t[2]=5);break}}let a=" ",s="M",n=!1,i=0;switch(t[0]){case 0:{t[2]==127?s="MT-a":t[2]==126?s="MT-b":t[2]==7?s="GM-k":t[2]==5?s="SG-a":t[2]==4?s="SP-l":t[2]==0||l=="gs"&&t[2]<5?s="GM-a":(s="y",n=!0);break}case 8:{l=="sg"?s="GM-s":s="r:";break}case 48:{s=`yM${(t[2]>>3).toString().padStart(2,"0")}`,n=!0;break}case 56:{s="GM-b";break}case 61:case 120:{s="rDrm";break}case 62:{s="kDrm";break}case 63:{let h=t[2];s=h<10?"kP:":"kC:",s+=h%10;break}case 64:{s="ySFX";break}case 67:{s="DX:S";break}case 80:case 81:case 82:case 83:{s=`Prg${"UABC"[t[0]-80]}`;break}case 88:case 89:case 90:case 91:{s=`Cmb${"UABC"[t[0]-88]}`;break}case 95:{s=`${["DR","PC"][t[2]]}-d`;break}case 96:{s=t[2]==106?"AP-a":"PF",t[2]>63&&(i=63),n=!0;break}case 97:{s="VL:",n=!0,i=112;break}case 98:{s="SG-a";break}case 99:{s="DX",t[2]>63&&(i=63),n=!0;break}case 100:{s="AN",t[2]>63&&(i=63),n=!0;break}case 121:{s=`GM-${t[2]?"":"a"}`,n=!0;break}case 122:{s="lDrm";break}case 126:{s="yDrS";break}case 127:{t[2]==127?s="rDrm":s="yDrm";break}default:t[0]<48?s="r:":s="M"}for(s.length<4&&(s+=`${(n?o:u)-i}`.padStart(4-s.length,"0")),l=="xg"&&u==16&&(c=`Voice${(o*128+e+1).toString().padStart(3,"0")}`,a=" ");!((c==null?void 0:c.length)>=0);)c=r(this,X)[t[1]||0][(t[0]<<7)+t[2]],c||(this.strictMode?(c="",a="?"):r(this,X)[t[1]||0][t[0]<<7]?t[0]==0?(t[2]=0,a="^"):t[2]<1?(t[0]=0,a="*"):(t[2]--,a="^"):u==48?(t[0]=0,t[2]=0,a="!"):u==62?(t[1]--,a=" ",t[1]<1&&!(c!=null&&c.length)&&(t[0]=0,a="!")):u<64?t[0]==0?(t[2]=0,a="^"):t[2]<1?(t[0]=0,a="*"):t[2]--:u==80?(c=`PrgU:${e.toString().padStart(3,"0")}`,a="!"):u==88?(c=`CmbU:${e.toString().padStart(3,"0")}`,a="!"):u==121?(c=`GM2Vox0${o}`,a="#"):u==122?(t[1]==32?t[1]==0:t[1]%=7,c=r(this,X)[t[1]||0][(t[0]<<7)+t[2]],c?a=" ":(c="",a="*")):t[1]==0?(c=`${u.toString().padStart(3,"0")} ${e.toString().padStart(3,"0")} ${o.toString().padStart(3,"0")}`,a="!"):t[0]==0?(t[2]=0,a="^"):t[2]>0?t[2]--:t[1]>0?(t[1]=0,a="!"):(t[0]=0,a="?"));(l=="gs"||l=="ns5r")&&a=="^"&&(a=" "),u==127&&a=="^"&&(a=" "),a!=" "&&self.debugMode&&(c="");let d="??";switch(t[0]){case 0:{t[2]==0?d="GM":t[2]==5||t[2]==7?d="KG":t[2]<120?d="XG":t[2]==127&&(d="MT");break}case 48:{d="MU";break}case 56:{d="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{d="AI";break}case 62:case 82:case 90:{d="XD";break}case 63:d="KR";case 64:case 126:{d="XG";break}case 67:case 99:{d="DX";break}case 81:{d="RW";break}case 95:{d=["DR","PC"][t[2]];break}case 96:{d=t[2]==106?"AP":"PF";break}case 97:{d="VL";break}case 98:{d="SG";break}case 100:{d="AN";break}case 120:{d="GS";break}case 121:{d=t[2]?"G2":"GM";break}case 122:{d="KG";break}case 127:{d=t[2]==127?"MT":e==0?"GM":"XG";break}default:t[0]<48&&(t[0]==16&&l=="xg"?d="XG":d="GS")}return{name:c||`${ct(u||0)} ${ct(e||0)} ${ct(o||0)}`,ending:a,sect:s,standard:d}}async load(u,e,o){let l=this,c=[],t=0,a=0;u.split(`
`).forEach(function(s,n){let i=s.split("	"),d=[];n==0?i.forEach(function(h,f){c[cr.indexOf(h)]=f}):i.forEach(async function(h,f){var b;f>2?(r(l,X)[d[c[1]]]=r(l,X)[d[c[1]]]||[],(!((b=r(l,X)[d[c[1]]][(d[c[0]]<<7)+d[c[2]]])!=null&&b.length)||e)&&(r(l,X)[d[c[1]]][(d[c[0]]<<7)+d[c[2]]]=i[3],t++),a++):d.push(parseInt(i[f]))})}),e||console.debug(`Map "${o||"(internal)"}": ${a} total, ${t} loaded.`)}clearRange(u){let e=u.prg!=null?u.prg.constructor==Array?u.prg:[u.prg,u.prg]:[0,127],o=u.msb!=null?u.msb.constructor==Array?u.msb:[u.msb,u.msb]:[0,127],l=u.lsb!=null?u.lsb.constructor==Array?u.lsb:[u.lsb,u.lsb]:[0,127];for(let c=o[0];c<=o[1];c++){let t=c<<7;for(let a=l[0];a<=l[1];a++){let s=t+a;for(let n=e[0];n<=e[1];n++)delete r(this,X)[n][s]}}}init(){v(this,X,[]);for(let u=0;u<128;u++)r(this,X).push([""])}async loadFiles(...u){this.init();let e=this;u.forEach(async function(o,l){try{await fetch(`./data/bank/${o}.tsv`).then(function(c){return c.text()}).then(c=>{e.load(c,!1,o)})}catch(c){console.error(`Failed loading "${o}.tsv".`)}})}},X=new WeakMap,Mt);O();var je=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),Qe=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],lr=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],qe=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],Ct=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],Tt=function(u){let e=.1,o=-.3;return u>66?(e=5,o=315):u>56?(e=1,o=47):u>46&&(e=.5,o=18.5),e*u-o},Rt=function(u){return u>105?lr[u-106]:u>100?u*1.1-100:u/10},Ot=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),ht={};`hi*,
ka,か
ki,き
ku,く
ke,け
ko,こ
ky,き!
kw,くl
tsu,つ
ts,つl
sa,さ
si,すぃ
su,す
se,せ
so,そ
shi,し
sh,し!
ta,た
ti,てぃ
tu,とぅ
te,て
to,と
tchy,ち!
tchi,ち
na,な
ni,に
nu,ぬ
ne,ね
no,の
ny,に!
nn,ん
ha,は
hi,ひ
hu,ほぅ
he,へ
ho,ほ
hy,ひ!
fa,ふぁ
fi,ふぃ
fu,ふ
fe,ふぇ
fo,ふぉ
ma,ま
mi,み
mu,む
me,め
mo,も
my,み!
mm,
ra,ら
ri,り
ru,る
re,れ
ro,ろ
ry,り!
wa,わ
wi,うぃ
we,うぇ
wo,を
nga,ガ
ngi,ギ
ngu,グ
nge,ゲ
ngo,ゴ
ngy,ギ!
ng,
ga,が
gi,ぎ
gu,ぐ
ge,げ
go,ご
gy,ぎ!
gw,ぐl
za,ざ
zi,ずぃ
zu,ず
ze,ぜ
zo,ぞ
ja,じゃ
ji,じ
ju,じゅ
je,じぇ
jo,じょ
jy,じ!
da,だ
di,でぃ
du,どぅ
de,で
do,ど
dy,で!
ba,ば
bi,び
bu,ぶ
be,べ
bo,ぼ
by,び!
va,ゔぁ
vi,ゔぃ
vu,ゔ
ve,ゔぇ
vo,ゔぉ
pa,ぱ
pi,ぴ
pu,ぷ
pe,ペ
po,ぽ
py,ぴ!
!ya,ゃ
!yu,ゅ
!ye,ぇ
!yo,ょ
ya,や
yu,ゆ
ye,いぇ
yo,よ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
la,ぁ
li,ぃ
lu,ぅ
le,ぇ
lo,ぉ
a,あ
i,い
u,う
e,え
o,お
*,っ
~,
^,
_,`.split(`
`).forEach(u=>{let e=u.split(",");ht[e[0]]=e[1]});var At=function(u){let e=u;u[0]=="*"&&(e=e.slice(1)),["aa","ii","uu","ee","oo"].forEach(l=>{for(;e.indexOf(l)>-1;)e=e.replace(l,l[0])});for(let l in ht)e=e.replaceAll(l,ht[l]);e.indexOf("ん")==0&&e.length>1&&(e=e.slice(1));let o=e.indexOf("!");return o>-1&&e.length>1&&(e=e.slice(o+1)),e},It=function(u){return u?u<96?`cc${u}`:["aftertouch","velocity","pitch bend"][u-96]:"off"};O();var dt=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],Dt=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],Pt=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var hr={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},dr={66307:["drive"],66309:["vowel",u=>"aiueo"[u]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",u=>["off","LPF","HPF"][u]],94984:["noise type",u=>["white","pink"][u]],94987:["disc type",u=>["LP","SP","EP","RND"]],94990:["hum type",u=>`${u+5}0Hz`],94993:["M/S",u=>["mono","stereo"][u]]},ft=function(u){return hr[(u[0]-32<<8)+u[1]]||`0x${u[0].toString(16).padStart(2,"0")}${u[1].toString(16).padStart(2,"0")}`},Ut=function(u,e,o){let l=(u[0]-32<<16)+(u[1]<<8)+e,c=dr[l]||{},t=c[0];if(t!=null&&t.length)return t+=`: ${(c[1]||function(){})(o)||o}`,t},ut=[68,48,95,78,41,3,110,122,0];O();var K=function(u=64){return Math.round(2e3*Math.log10(u/64))/100},Lt=function(u,e,o){let l=[],c=o==!1?e.readIntVLV():o;u==0||u==127;for(let t=0;t<c;t++){let a=e.readInt(1);if(l.push(a),a!=247){if(a!=240){if(a>127)return console.debug(`Early termination: ${l}`),l.pop(),e.backOne(),e.backOne(),new Uint8Array(l)}}}return new Uint8Array(l)},Bt=function(u){let e=0;return u.forEach(o=>{e+=o,e=e&127}),~e+1&127},ae=function(u,e){let o=0,l=0;for(let c=0;c<u.length;c++){let t=c%8-1,a=(l>>t&1)<<7,s=u[c];s+=a,c%8!=0?(e(s,o,u),o++):l=u[c]}},Ye=function(u){let e=Math.floor(u*14.2);return e<128?e:0};var $e=["?","gm","gs","xg","g2","mt32","ns5r","ag10","x5d","05rw","krs","k11","sg"],Nt=[[0,0,0,0,121,0,0,56,82,81,63,0,0],[0,0,4,0,0,127,0,0,0,0,0,0,0]],Me=[120,127,120,127,120,127,61,62,62,62,120,122,122],fr=[0,3,81,84,88],Ht={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},pt={0:0,1:1,2:3,5:4},Gt=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],_t=[36,37],st=[20,21,22,23,24,25,26,28,29,30,31,36,37,64,65],We=[0,1,2,4,5,6,7,8,10,11,32,38,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,84,91,92,93,94,95,98,99,100,101,128,12,13,16,17,18,19],ur=[12,13,16,17,18,19],pr=[33,99,100,32,102,8,9,10],Ft=[0,16,25,40,32,64,26,48],C={};$e.forEach((u,e)=>{C[u]=e});var g={length:We.length};We.forEach((u,e)=>{g[u]=e});var bt={length:st.length};st.forEach((u,e)=>{bt[u]=e});var W=function(){return!!self.Bun||self.debugMode||!1},gr=function(u){let e=[],o=0;return u==null||u.forEach(function(l,c){l==247?e.push(u.subarray(o,c)):l==240&&(o=c+1)}),e.length||e.push(u.subarray(0)),W()&&console.debug(e),e},Vt=function(u,e="",o="",l=2){return u?`${e}${u.toString().padStart(l,"0")}${o}`:""},y={ch:128,cc:We.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,ace:8,drm:8,dpn:st.length,dnc:128,efx:7},I,z,ie,fe,Y,de,Kt,j,H,R,p,ue,A,U,se,L,N,ve,ne,Ce,S,Ge,Ze,oe,we,Z,_e,me,Q,Ee,J,q,pe,Fe,Ve,ce,ke,Xe,ee,D,Je,gt,T,ge,Se,G,Te,B,et,it,Re,Oe,le,he,be,Ae,Ie,De,Xt,zr=(Xt=class extends at{constructor(){super();w(this,Y);M(this,"NOTE_IDLE",0);M(this,"NOTE_ATTACK",1);M(this,"NOTE_DECAY",2);M(this,"NOTE_SUSTAIN",3);M(this,"NOTE_HELD",4);M(this,"NOTE_RELEASE",5);M(this,"NOTE_SOSTENUTO_ATTACK",8);M(this,"NOTE_SOSTENUTO_DECAY",9);M(this,"NOTE_SOSTENUTO_SUSTAIN",10);M(this,"NOTE_SOSTENUTO_HELD",11);M(this,"CH_MELODIC",0);M(this,"CH_DRUMS",1);M(this,"CH_DRUM1",2);M(this,"CH_DRUM2",3);M(this,"CH_DRUM3",4);M(this,"CH_DRUM4",5);M(this,"CH_DRUM5",6);M(this,"CH_DRUM6",7);M(this,"CH_DRUM7",8);M(this,"CH_DRUM8",9);w(this,I,0);w(this,z,0);w(this,ie,0);w(this,fe,new Array(11));w(this,j,new Uint8Array(y.ch));w(this,H,new Uint8Array(y.ch));w(this,R,new Uint8Array(y.ch));w(this,p,new Uint8Array(y.ch*y.cc));w(this,ue,new Uint8Array(y.ace));w(this,A,new Uint8Array(y.ch));w(this,U,new Uint8Array(y.ch*y.nn));w(this,se,new Uint8Array(y.ch));w(this,L,new Uint16Array(y.pl));w(this,N,new Uint8Array(y.pl));w(this,ve,new Int16Array(y.ch));w(this,ne,new Uint8Array(y.ch));w(this,Ce,0);w(this,S,new Uint8Array(y.ch*y.rpn));w(this,Ge,new Int8Array(y.ch*_t.length));w(this,Ze,new Uint8Array(y.drm*y.dpn*y.dnc));w(this,oe,new Uint8Array(y.ch));w(this,we,new Uint8Array(128));w(this,Z,new Uint8Array(y.cmt*8));w(this,_e,new Uint8Array(1024));w(this,me,new Uint8Array(y.cmt*64));w(this,Q,new Uint8Array(y.efx*3));w(this,Ee,0);w(this,J,0);w(this,q,100);w(this,pe,0);w(this,Fe,500);w(this,Ve,0);w(this,ce,"");w(this,ke,0);w(this,Xe,0);w(this,ee,!0);w(this,D,!1);w(this,Je,void 0);w(this,gt,new Uint8Array(2));w(this,T,[]);w(this,ge,new Uint8Array(y.ch));w(this,Se,new Uint8Array(y.tr));M(this,"baseBank",new lt("gm","gm2","xg","gs","ns5r","gmega","plg-150vl","plg-150pf","plg-150dx","plg-150an","plg-150dr","plg-100sg","kross"));M(this,"userBank",new lt("gm"));M(this,"initOnReset",!1);M(this,"aiEfxName","");w(this,G,[]);w(this,Te,void 0);w(this,B,{nOff:(e,o)=>{let l=e*128+o,c=r(this,L).lastIndexOf(l);c>-1&&(r(this,p)[y.cc*e+g[64]]>63?(r(this,N)[c]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:o,velo:r(this,U)[l],state:this.NOTE_HELD})):r(this,p)[y.cc*e+g[66]]>63&&r(this,N)[c]==this.NOTE_SOSTENUTO_SUSTAIN?(r(this,N)[c]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:o,velo:r(this,U)[l],state:this.NOTE_SOSTENUTO_HELD})):(r(this,L)[c]=0,r(this,U)[l]=0,r(this,N)[c]=this.NOTE_IDLE,this.dispatchEvent("note",{part:e,note:o,velo:0,state:this.NOTE_IDLE})))},nOn:(e,o,l)=>{let c=e*128+o,t=0;for(r(this,se)[e]&&r(this,B).ano(e);r(this,N)[t]>0&&r(this,L)[t]!=c;)t++;t<y.pl?(r(this,L)[t]=c,r(this,U)[c]=l,r(this,N)[t]=this.NOTE_SUSTAIN,r(this,ne)[e]<l&&(r(this,ne)[e]=l),this.dispatchEvent("note",{part:e,note:o,velo:l,state:this.NOTE_SUSTAIN})):console.error("Polyphony exceeded.")},nAt:(e,o,l)=>{},cAt:(e,o)=>{},hoOf:e=>{r(this,N).forEach((o,l)=>{if(o==this.NOTE_HELD){let c=r(this,L)[l],t=c>>7;e==t&&(r(this,N)[l]=this.NOTE_IDLE,r(this,L)[l]=0,r(this,U)[c]=0,this.dispatchEvent("note",{part:e,note:c&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{r(this,N).forEach((o,l)=>{let c;switch(o){case this.NOTE_ATTACK:{c=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{c=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{c=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(c){r(this,N)[l]=c;let t=r(this,L)[l];this.dispatchEvent("note",{part:e,note:t&127,velo:r(this,U)[t],state:c})}})},soOf:e=>{r(this,N).forEach((o,l)=>{if(o==this.NOTE_SOSTENUTO_HELD){let c=r(this,L)[l],t=c>>7;e==t&&(r(this,N)[l]=this.NOTE_IDLE,r(this,L)[l]=0,r(this,U)[c]=0,this.dispatchEvent("note",{part:e,note:c&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{r(this,L).forEach((o,l,c)=>{let t=o>>7,a=o&127;o==0&&r(this,U)[0]==0||t==e&&r(this,B).nOff(t,a)})}});w(this,et,{8:function(e){let o=e.channel,l=e.data[0];r(this,B).nOff(o,l)},9:function(e){let o=e.channel;r(this,j)[o]=1;let l=e.data[0],c=e.data[1];c>0?r(this,B).nOn(o,l,c):r(this,B).nOff(o,l)},10:function(e){let o=e.channel,l=o*128+e.data[0];r(this,L).indexOf(l)>-1&&(r(this,U)[l]=data[1],this.dispatchEvent("note",{part:o,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let o=e.channel;r(this,j)[o]=1;let l=o*y.cc;switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{r(this,B).ano(o),r(this,ve)[o]=0;let c=o*y.cc;r(this,p)[c+g[1]]=0,r(this,p)[c+g[5]]=0,r(this,p)[c+g[64]]=0,r(this,p)[c+g[65]]=0,r(this,p)[c+g[66]]=0,r(this,p)[c+g[67]]=0,r(this,p)[c+g[11]]=127,r(this,p)[c+g[101]]=127,r(this,p)[c+g[100]]=127,r(this,p)[c+g[99]]=127,r(this,p)[c+g[98]]=127;return}case 123:{r(this,B).ano(o);return}case 124:{r(this,B).ano(o);return}case 125:{r(this,B).ano(o);return}case 126:{r(this,se)[o]=1,r(this,B).ano(o);return}case 127:{r(this,se)[o]=0,r(this,B).ano(o);return}}if(g[e.data[0]]==null)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(ur.indexOf(e.data[0])>-1&&this.allocateAce(e.data[0]),e.data[0]){case 0:{if(W()&&console.debug(`${$e[r(this,I)]}, CH${o+1}: ${e.data[1]}`),r(this,I)==0)e.data[1]<48?(r(this,R)[o]>0&&(e.data[1]=r(this,p)[l],e.data[1]=120,console.debug(`Forced channel ${o+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),this.switchMode("gs"))):e.data[1]==62?this.switchMode("x5d"):e.data[1]==63?this.switchMode("krs"):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg");else if(r(this,I)==C.gs)e.data[1]<56&&r(this,R)[o]>0&&(e.data[1]=r(this,p)[l],e.data[1]=120,console.debug(`Forced channel ${o+1} to stay drums.`));else if(r(this,I)==C.gm)e.data[1]<48?r(this,R)[o]>0&&(e.data[1]=120,this.switchMode("gs",!0),console.debug(`Forced channel ${o+1} to stay drums.`)):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg",!0);else if(r(this,I)==C.x5d){if(e.data[1]>0&&e.data[1]<8)this.switchMode("05rw",!0);else if(e.data[1]==56){let c=0;for(let t=0;t<16;t++){let a=r(this,p)[y.cc*t];(a==56||a==62)&&c++}c>14&&this.switchMode("ag10",!0)}}switch(r(this,I)){case C.xg:{[126,127].indexOf(e.data[1])>-1?r(this,R)[o]==0&&(this.setChType(o,this.CH_DRUM2),console.debug(`CH${o+1} set to drums by MSB.`)):r(this,R)[o]>0&&(this.setChType(o,this.CH_MELODIC),console.debug(`CH${o+1} set to melodic by MSB.`));break}case C["05rw"]:case C.x5d:case C.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?r(this,R)[o]==0&&(this.setChType(o,this.CH_DRUM2),console.debug(`CH${o+1} set to drums by MSB.`)):r(this,R)[o]>0&&(this.setChType(o,this.CH_MELODIC),console.debug(`CH${o+1} set to melodic by MSB.`));break}case C.g2:{e.data[1]==120?r(this,R)[o]==0&&(this.setChType(o,this.CH_DRUMS),console.debug(`CH${o+1} set to drums by MSB.`)):r(this,R)[o]>0&&(this.setChType(o,this.CH_MELODIC),console.debug(`CH${o+1} set to melodic by MSB.`));break}}this.dispatchEvent("voice",{part:o});break}case 6:{if(r(this,Ce)){[C.xg,C.gs,C.ns5r].indexOf(r(this,I))<0&&console.warn(`NRPN commits are not available under "${$e[r(this,I)]}" mode, even when they are supported in Octavia.`);let c=r(this,p)[l+g[99]],t=r(this,p)[l+g[98]];if(c==1){let a=pr.indexOf(t);if(a>-1)r(this,p)[l+g[71+a]]=e.data[1],W()&&console.debug(`Redirected NRPN 1 ${t} to cc${71+a}.`),this.dispatchEvent("cc",{part:o,cc:71+a,data:e.data[1]});else{let s=_t.indexOf(t);s>-1?r(this,Ge)[o*10+s]=e.data[1]-64:console.warn(`NRPN 0x01${t.toString(16).padStart(2,"0")} is not supported.`),W()&&console.debug(`CH${o+1} voice NRPN ${t} commit`)}}else{if(st.indexOf(c)<0){let s=`NRPN 0x${c.toString(16).padStart(2,"0")}${t.toString(16).padStart(2,"0")} `;c==127?console.warn(`${s}is not necessary. Consider removing it.`):console.warn(`${s}is not supported.`)}else{let s=r(this,R)[o]-2;s<0?console.warn(`CH${o+1} cannot accept drum NRPN as type ${Qe[r(this,R)[o]]}.`):r(this,Ze)[(s*y.dpn+bt[c])*y.dnc+t]=e.data[1]-64}W()&&console.debug(`CH${o+1} (${Qe[r(this,R)[o]]}) drum NRPN ${c} commit`)}}else{let c=pt[r(this,p)[l+g[100]]];r(this,p)[l+g[101]]==0&&c!=null&&(W()&&console.debug(`CH${o+1} RPN 0 ${r(this,p)[l+g[100]]} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],Gt[c][0]),Gt[c][1]),r(this,S)[o*y.rpn+c]=e.data[1])}break}case 32:{this.dispatchEvent("voice",{part:o});break}case 38:{r(this,Ce)||r(this,p)[l+101]==0&&pt[r(this,p)[l+100]]!=null&&(r(this,S)[o*y.rpn+pt[r(this,p)[l+100]]+1]=e.data[1]);break}case 64:{e.data[1]<64&&r(this,B).hoOf(o);break}case 66:{e.data[1]>>6?r(this,B).soOn(o):r(this,B).soOf(o);break}case 98:case 99:{v(this,Ce,1);break}case 100:case 101:{v(this,Ce,0);break}}r(this,p)[l+g[e.data[0]]]=e.data[1],this.dispatchEvent("cc",{part:o,cc:e.data[0],data:e.data[1]})}},12:function(e){let o=e.channel;r(this,j)[o]=1,r(this,A)[o]=e.data,r(this,oe)[o]=0,W()&&console.debug(`T:${e.track} C:${o} P:${e.data}`),this.dispatchEvent("voice",{part:o})},13:function(e){let o=this,l=e.channel;r(this,L).forEach(function(c){let t=c>>7;l==t&&(r(o,U)[c]=e.data,o.dispatchEvent("note",{part:l,note:c&127,velo:e.data,state:o.NOTE_SUSTAIN}))})},14:function(e){let o=e.channel;r(this,ve)[o]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:o,pitch:this.getPitchShift(o)})},15:function(e){gr(e.data).forEach(o=>{let l=o[0],c=o[1];(r(this,it)[l]||function(){console.debug(`Unknown manufacturer ${l}.`)})(c,o.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(r(this,G)[e.meta]||function(l,c,t){}).call(this,e.data,e.track,e.meta),e.meta!=32&&v(this,pe,0);let o=fr.indexOf(e.meta)>-1;if(W()&&console.debug(e),o)return e.reply="meta",e}});w(this,it,{64:(e,o,l)=>{r(this,Ae).run(o,l,e)},65:(e,o,l)=>{if(o[0]<16)r(this,he).run(o,l,e),console.warn("Unknown device SysEx!");else{let c=o[o.length-1],t=Bt(o.subarray(2,o.length-1));c==t?r(this,he).run(o.subarray(0,o.length-1),l,e):console.warn(`Bad GS checksum ${c}. Should be ${t}.`)}},66:(e,o,l)=>{r(this,be).run(o,l,e)},67:(e,o,l)=>{r(this,le).run(o,l,e)},68:(e,o,l)=>{r(this,De).run(o,l,e)},71:(e,o,l)=>{r(this,Ie).run(o,l,e)},126:(e,o,l)=>{r(this,Re).run(o,l,e)},127:(e,o,l)=>{this.switchMode("gm"),r(this,Oe).run(o,l,e)}});w(this,Re,void 0);w(this,Oe,void 0);w(this,le,void 0);w(this,he,void 0);w(this,be,void 0);w(this,Ae,void 0);w(this,Ie,void 0);w(this,De,void 0);let e=this;v(this,Y,new Uint8Array(256),Kt),r(this,fe)[10]=new Uint8Array(512),v(this,Te,new re),this.userBank.strictMode=!0,this.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),r(this,G)[1]=function(t){switch(t.slice(0,2)){case"@I":{v(this,D,!0),r(this,T).unshift(`Kar.Info: ${t.slice(2)}`);break}case"@K":{v(this,D,!0),r(this,T).unshift("Karaoke mode active."),console.debug(`Karaoke mode active: ${t.slice(2)}`);break}case"@L":{v(this,D,!0),r(this,T).unshift(`Language: ${t.slice(2)}`);break}case"@T":{v(this,D,!0),r(this,T).unshift(`Ka.Title: ${t.slice(2)}`);break}case"@V":{v(this,D,!0),r(this,T).unshift(`Kara.Ver: ${t.slice(2)}`);break}case"XF":{let a=t.slice(2).split(":");switch(a[0]){case"hd":{a.slice(1).forEach((s,n)=>{s.length&&r(this,T).unshift(`${["SongDate","SnRegion","SongCat.","SongBeat","SongInst","Sn.Vocal","SongCmp.","SongLrc.","SongArr.","SongPerf","SongPrg.","SongTags"][n]}: ${s}`)});break}case"ln":{a.slice(1).forEach((s,n)=>{s.length&&r(this,T).unshift(`${["Kar.Lang","Kar.Name","Kar.Cmp.","Kar.Lrc.","kar.Arr.","Kar.Perf","Kar.Prg."][n]}: ${s}`)});break}default:r(this,T).unshift(`XGF_Data: ${t}`)}break}default:r(this,D)?t[0]=="\\"?r(this,T).unshift(`@ ${t.slice(1)}`):t[0]=="/"?r(this,T).unshift(t.slice(1)):r(this,T)[0]+=t:(r(this,T)[0]=t,r(this,T).unshift(""))}},r(this,G)[2]=function(t){r(this,T).unshift(`Copyrite: ${t}`)},r(this,G)[3]=function(t,a){a<1&&r(this,pe)<1&&r(this,T).unshift(`TrkTitle: ${t}`)},r(this,G)[4]=function(t,a){r(this,T).unshift(`${Vt(r(this,pe),""," ")}Instrmnt: ${t}`)},r(this,G)[5]=function(t){t.trim()==""?r(this,T).unshift(""):r(this,T)[0]+=`${t}`},r(this,G)[6]=function(t){r(this,T).unshift(`${Vt(r(this,pe),""," ")}C.Marker: ${t}`)},r(this,G)[7]=function(t){r(this,T).unshift(`CuePoint: ${t}`)},r(this,G)[32]=function(t){v(this,pe,t[0]+1)},r(this,G)[33]=function(t,a){console.debug(`Track ${a} requests to get assigned to output ${t}.`),r(e,Se)[a]=t+1},r(this,G)[81]=function(t,a){v(e,Fe,t/1e3)},r(this,G)[127]=function(t,a){r(e,Te).run(t,a)},r(this,Te).default=function(t){console.warn(`Unrecognized sequencer-specific byte sequence: ${t}`)},r(this,Te).add([67,0,1],function(t,a){r(e,Se)[a]=t[0]+1}),v(this,Re,new re("universal non-realtime")),v(this,Oe,new re("universal realtime")),v(this,le,new re("Yamaha")),v(this,he,new re("Roland")),v(this,be,new re("Korg")),v(this,Ae,new re("Kawai")),v(this,Ie,new re("Akai")),v(this,De,new re("Casio"));let o=function(t){console.info(`Unrecognized SysEx in "${this.name}" set.`,t)};r(this,Re).default=o,r(this,Oe).default=o,r(this,le).default=o,r(this,he).default=o,r(this,be).default=o,r(this,Ae).default=o,r(this,Ie).default=o,r(this,De).default=o,r(this,Re).add([9],t=>{e.switchMode(["gm","?","g2"][t[0]-1],!0),v(e,D,r(e,D)||!1),console.info(`MIDI reset: ${["GM","Init","GM2"][t[0]-1]}`),t[0]==2&&e.init()}),r(this,Oe).add([4,1],t=>{v(e,q,((t[1]<<7)+t[0])/16383*100)}).add([4,3],t=>((t[1]<<7)+t[0]-8192)/8192).add([4,4],t=>t[1]-64),r(this,le).add([76,0,0],t=>{switch(t[0]){case 125:{console.info(`XG drum setup reset: ${t}`);break}case 126:{e.switchMode("xg",!0),v(e,D,!1),console.info("MIDI reset: XG");break}default:{let a=[0,0,0,0],s=(n,i)=>{a[i]=n};if(t.subarray(1).forEach((n,i)=>{let d=i+t[0];([s,s,s,s,h=>{v(this,q,h*129/16383*100)},h=>{},h=>{}][d]||(()=>{}))(n,i)}),t[0]<4){let n=0;a.forEach(i=>{n=n<<4,n+=i}),n-=1024}}}}).add([76,2,1],t=>{let a="XG ";t[0]<32?(a+="reverb ",t.subarray(1).forEach((s,n)=>{([i=>{e.setEffectTypeRaw(0,!1,i),console.info(`${a}main type: ${je[i]}`)},i=>{e.setEffectTypeRaw(0,!0,i),console.debug(`${a}sub type: ${i+1}`)},i=>{console.debug(`${a}time: ${Tt(i)}s`)},i=>{console.debug(`${a}diffusion: ${i}`)},i=>{console.debug(`${a}initial delay: ${i}`)},i=>{console.debug(`${a}HPF cutoff: ${qe[i]}Hz`)},i=>{console.debug(`${a}LPF cutoff: ${qe[i]}Hz`)},i=>{console.debug(`${a}width: ${i}`)},i=>{console.debug(`${a}height: ${i}`)},i=>{console.debug(`${a}depth: ${i}`)},i=>{console.debug(`${a}wall type: ${i}`)},i=>{console.debug(`${a}dry/wet: ${i}`)},i=>{console.debug(`${a}send: ${K(i)}dB`)},i=>{console.debug(`${a}pan: ${i-64}`)},!1,!1,i=>{console.debug(`${a}delay: ${i}`)},i=>{console.debug(`${a}density: ${i}`)},i=>{console.debug(`${a}balance: ${i}`)},i=>{},i=>{console.debug(`${a}feedback: ${i}`)},i=>{}][t[0]+n]||function(){console.warn(`Unknown XG reverb address: ${t[0]}.`)})(s)})):t[0]<64?(a+="chorus ",t.subarray(1).forEach((s,n)=>{([i=>{e.setEffectTypeRaw(1,!1,i),console.info(`${a}main type: ${je[i]}`)},i=>{e.setEffectTypeRaw(1,!0,i),console.debug(`${a}sub type: ${i+1}`)},i=>{console.debug(`${a}LFO: ${Ct[i]}Hz`)},i=>{},i=>{console.debug(`${a}feedback: ${i}`)},i=>{console.debug(`${a}delay offset: ${Rt(i)}ms`)},i=>{},i=>{console.debug(`${a}low: ${qe[i]}Hz`)},i=>{console.debug(`${a}low: ${i-64}dB`)},i=>{console.debug(`${a}high: ${qe[i]}Hz`)},i=>{console.debug(`${a}high: ${i-64}dB`)},i=>{console.debug(`${a}dry/wet: ${i}`)},i=>{console.debug(`${a}send: ${K(i)}dB`)},i=>{console.debug(`${a}pan: ${i-64}`)},i=>{console.debug(`${a}to reverb: ${K(i)}dB`)},!1,i=>{},i=>{},i=>{},i=>{console.debug(`${a}LFO phase diff: ${(i-64)*3}deg`)},i=>{console.debug(`${a}input mode: ${i?"stereo":"mono"}`)},i=>{}][t[0]-32+n]||function(){console.warn(`Unknown XG chorus address: ${t[0]}.`)})(s)})):t[0]<86?(a+="variation ",t.subarray(1).forEach((s,n)=>{([i=>{e.setEffectTypeRaw(2,!1,i),console.info(`${a}main type: ${je[i]}`)},i=>{e.setEffectTypeRaw(2,!0,i),console.debug(`${a}sub type: ${i+1}`)}][t[0]-64+n]||function(){})(s)})):t[0]<97?(a+="variation ",t.subarray(1).forEach((s,n)=>{[i=>{console.debug(`${a}send: ${K(i)}dB`)},i=>{console.debug(`${a}pan: ${i-64}`)},i=>{console.debug(`${a}to reverb: ${K(i)}dB`)},i=>{console.debug(`${a}to chorus: ${K(i)}dB`)},i=>{console.debug(`${a}connection: ${i?"system":"insertion"}`)},i=>{console.debug(`${a}channel: CH${i+1}`)},i=>{console.debug(`${a}mod wheel: ${i-64}`)},i=>{console.debug(`${a}bend wheel: ${i-64}`)},i=>{console.debug(`${a}channel after touch: ${i-64}`)},i=>{console.debug(`${a}AC1: ${i-64}`)},i=>{console.debug(`${a}AC2: ${i-64}`)}][t[0]-86+n](s)})):t[0]>111&&t[0]<118?a+="variation ":console.warn(`Unknown XG variation address: ${t[0]}`)}).add([76,2,64],t=>{t.subarray(1).forEach((a,s)=>{let n=s+t[0];if(n==0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][a]}`);else{let i=n-1>>2,d=n-1&3,h=`XG EQ ${i} ${["gain","freq","Q","shape"][d]}: `;[()=>{console.debug(`${h}${a-64}dB`)},()=>{console.debug(`${h}${a} (raw)`)},()=>{console.debug(`${h}${a/10}`)},()=>{console.debug(`${h}${["shelf","peak"][+!!a]}`)}][d]()}})}).add([76,3],t=>{let a=t[0],s=t[1],n=`XG Insertion ${t[0]+1} `;t.subarray(2).forEach((i,d)=>{([h=>{e.setEffectTypeRaw(3+a,!1,h),console.info(`${n}main type: ${je[h]}`)},h=>{e.setEffectTypeRaw(3+a,!0,h),console.debug(`${n}sub type: ${h+1}`)}][s+d]||function(){})(i)})}).add([76,6,0],t=>{let a=t[0];a<64?e.setLetterDisplay(t.subarray(1),"XG letter display",a):v(e,ke,Date.now())}).add([76,7,0],t=>{let a=t[0];v(e,z,0),v(e,ie,Date.now()+3200),r(e,Y,de).fill(0);let s=t.subarray(1);for(let n=0;n<a;n++)s.unshift(0);s.forEach(function(n,i){let d=Math.floor(i/16),h=i%16,f=(h*3+d)*7,b=7,$=0;for(f-=h*5,d==2&&(b=2);$<b;)r(e,Y,de)[f+$]=n>>6-$&1,$++})}).add([76,8],(t,a)=>{let s=e.chRedir(t[0],a,!0),n=t[1],i=y.cc*s,d=`XG CH${s+1} `,h=`Unknown XG part address ${n}.`;t.subarray(2).forEach((f,b)=>{n<1?console.debug(h):n<41?([()=>{r(e,p)[i+g[0]]=f},()=>{r(e,p)[i+g[32]]=f},()=>{r(e,A)[s]=f},()=>{let $=e.chRedir(f,a,!0);r(e,H)[s]=$,s!=$&&(e.buildRchTree(),console.info(`${d}receives from CH${$+1}`))},()=>{r(e,se)[s]=+!f},()=>{},()=>{e.setChType(s,f,C.xg),console.debug(`${d}type: ${Qe[f]||f}`)},()=>{r(e,S)[y.rpn*s+3]=f},!1,!1,()=>{r(e,p)[i+g[7]]=f},!1,!1,()=>{r(e,p)[i+g[10]]=f||128},!1,!1,()=>{r(e,p)[i+g[128]]=f},()=>{r(e,p)[i+g[93]]=f},()=>{r(e,p)[i+g[91]]=f},()=>{r(e,p)[i+g[94]]=f},()=>{r(e,p)[i+g[76]]=f},()=>{r(e,p)[i+g[77]]=f},()=>{r(e,p)[i+g[78]]=f},()=>{r(e,p)[i+g[74]]=f},()=>{r(e,p)[i+g[71]]=f},()=>{r(e,p)[i+g[73]]=f},()=>{r(e,p)[i+g[75]]=f},()=>{r(e,p)[i+g[72]]=f}][n+b-1]||(()=>{}))():n<48?console.debug(h):n<111?n>102&&n<105&&(r(e,p)[i+g[[5,65][n&1]]]=f):n<114?console.debug(h):n<116?console.debug(`${d}EQ ${["bass","treble"][n&1]} gain: ${f-64}dB`):n<118?console.debug(h):n<120?console.debug(`${d}EQ ${["bass","treble"][n&1]} freq: ${f}`):console.debug(h)})}).add([76,9],(t,a)=>{let s=e.chRedir(t[0],a,!0),n=t[1],i=`PLG-150VL CH${s+1} `;t.subarray(2).forEach((d,h)=>{let f=h+n;switch(f){case 1:{console.info(`${i}breath mode: ${["system","breath","velocity","touch EG"][d]}`);break}case 0:case 27:case 28:break;default:if(f<27){let b=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][f-3>>1];f&1?f<23?(console.debug(`${i}${b} control source: ${It(d)}`),d&&d<96&&e.allocateAce(d)):console.debug(`${i}${b} scale break point: ${d}`):console.debug(`${i}${b} depth: ${d-64}`)}}})}).add([76,10],t=>{}).add([76,16],t=>{}).add([76,17,0,0],t=>{}).add([76,112],t=>{console.debug(`XG enable PLG-1${["50VL","00SG","50DX"][t[0]]} for CH${t[2]+1}.`)}).add([73,0,0],(t,a)=>{let s=t[0];t.subarray(1).forEach((n,i)=>{let d=s+i;d==8?console.debug(`MU1000 set LCD contrast to ${n}.`):d>9&&d<16&&[()=>{e.dispatchEvent("channelactive",n)},()=>{n<8?(e.dispatchEvent("channelmin",n<<4),console.info(`Octavia System: Minimum CH${(n<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{n<8?(e.dispatchEvent("channelmax",(n<<4)+15),console.info(`Octavia System: Maximum CH${(n<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{v(e,ee,!!n),console.info(`Octavia System: RS receiving ${["dis","en"][n]}abled.`)}][d-10]()})}).add([73,10,0],(t,a)=>{let s=t[0],n=`MU1000 RS${r(e,ee)?"":" (ignored)"}: `;if(s<16)switch(s){case 2:{let i=e.chRedir(0,a,!0);r(e,ee)&&(e.dispatchEvent("channelmin",i),e.dispatchEvent("channelmax",i+63)),console.info(`${n}Show CH1~64`);break}case 3:{let i=e.chRedir(t[1]<<5,a,!0);r(e,ee)&&e.dispatchEvent("channelmin",i),r(e,ee)&&e.dispatchEvent("channelmax",i+31),console.info(`${n}Show CH${i+1}~CH${i+32}`);break}default:console.debug(`${n}unknown switch ${s} invoked.`)}else if(s<32){if(r(e,ee)){let i=e.chRedir(s-16+(r(e,Xe)<<4),a,!0);e.dispatchEvent("channelactive",i)}}else if(s<36){let i=e.chRedir(s-32<<4,a,!0);r(e,ee)&&(e.dispatchEvent("channelmin",i),e.dispatchEvent("channelmax",i+15),v(e,Xe,s-32)),console.info(`${n}Show CH${i+1}~CH${i+16}`)}}).add([93,3],(t,a)=>{let s=e.chRedir(t[0],a,!0),n=`PLG-100SG CH${s+1} `,i=Date.now();if(t[1]==0){let d="",h=0;t.subarray(2).forEach((f,b)=>{b%2==0?d+=Ot[f]||f.toString().padStart("0"):h+=f*13}),i>=r(e,Ve)&&r(e,T).unshift("SG Lyric: "),r(e,T)[0]+=`${At(d)}`,v(e,Ve,i+Math.ceil(h/2)+r(e,Fe)),W()&&console.debug(`${n}vocals: ${d}`)}else console.warn(`Unknown PLG-100SG data: ${t}`)}),r(this,le).add([76,48],t=>{}).add([76,49],t=>{}).add([76,50],t=>{}).add([76,51],t=>{}),r(this,le).add([89,0],(t,a,s)=>{if(e.eprom){let n=t[0],i=(t[1]<<14)+(t[2]<<7)+t[3]+(e.eprom.offset||0);W()&&console.debug(`MU1000 EPROM trail to 0x${i.toString(16).padStart(6,"0")}, ${n} bytes.`);let d=e.eprom.data;t.subarray(4).forEach((h,f)=>{let b=f>>3,$=f&7;if($==7)for(let k=0;k<7;k++)d[i+7*b+k]+=(h>>6-k&1)<<7;else d[i+7*b+$]=h})}}).add([89,1],(t,a,s)=>{let n=(t[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3];W()&&console.debug(`MU1000 EPROM jump to 0x${n.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=n)}).add([89,2],(t,a,s)=>{if(e.eprom){let n=(t[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3]+(e.eprom.offset||0);W()&&console.debug(`MU1000 EPROM write to 0x${n.toString(16).padStart(6,"0")}.`);let i=e.eprom.data;t.subarray(4).forEach((d,h)=>{let f=h>>3,b=h&7;if(b==7)for(let $=0;$<7;$++)i[n+7*f+$]+=(d>>6-$&1)<<7;else i[n+7*f+b]=d})}}).add([89,3],(t,a,s)=>{}),r(this,le).add([39,48],(t,a,s)=>{}).add([43,0,0],(t,a,s)=>{let n=[0,0,0,0],i=(d,h)=>{n[h]=d};if(t.subarray(1).forEach((d,h)=>{let f=h+t[0];[i,i,i,i,()=>{v(this,q,d*129/16383*100)},()=>d-64,()=>d||128,()=>d,()=>d,()=>{console.debug(`TG300 variation on cc${d}.`)}][f](d,f)}),t[0]<4){let d=0;n.forEach(h=>{d=d<<4,d+=h}),d-=1024}}).add([43,1,0],(t,a,s)=>{}).add([43,2],(t,a,s)=>{let n=e.chRedir(t[0],a,!0),i=t[1],d=y.cc*n,h=`TG300 CH${n+1} `;t.subarray(2).forEach((f,b)=>{b<5?([()=>{},()=>{r(e,p)[d+g[0]]=f},()=>{r(e,p)[d+g[32]]=f},()=>{r(e,A)[n]=f},()=>{let $=e.chRedir(f,a,!0);r(e,H)[n]=$,n!=$&&(e.buildRchTree(),console.info(`${h}receives from CH${$+1}`))}][b+i]||(()=>{}))(f,b+i):b<21||(b<47?([()=>{r(e,se)[n]=+!f},()=>{},()=>{},()=>{r(e,S)[y.rpn*n+3]=f},()=>{},()=>{r(e,p)[d+g[7]]=f},!1,!1,()=>{r(e,p)[d+g[10]]=f||128},!1,!1,()=>{console.debug(`${h} AC1 at cc${f}`)},()=>{console.debug(`${h} AC2 at cc${f}`)},()=>{r(e,p)[d+g[128]]=f},()=>{r(e,p)[d+g[93]]=f},()=>{r(e,p)[d+g[91]]=f},()=>{r(e,p)[d+g[94]]=f},()=>{r(e,p)[d+g[76]]=f},()=>{r(e,p)[d+g[77]]=f},()=>{r(e,p)[d+g[74]]=f},()=>{r(e,p)[d+g[71]]=f},()=>{r(e,p)[d+g[73]]=f},()=>{r(e,p)[d+g[75]]=f},()=>{r(e,p)[d+g[72]]=f},()=>{r(e,p)[d+g[78]]=f}][b+i-21]||(()=>{}))(f,b+i):b<95||([()=>{r(e,p)[d+g[65]]=f},()=>{r(e,p)[d+g[5]]=f}][b+i-95]||(()=>{}))(f,b+i))})}).add([43,7,0],(t,a,s)=>{let n=t[0];e.setLetterDisplay(t.subarray(1),"TG300 letter display",n)}).add([43,7,1],(t,a,s)=>{v(e,z,0),v(e,ie,Date.now()+3200),r(e,Y,de).fill(0),t.forEach(function(n,i){let d=Math.floor(i/16),h=i%16,f=(h*3+d)*7,b=7,$=0;for(f-=h*5,d==2&&(b=2);$<b;)r(e,Y,de)[f+$]=n>>6-$&1,$++})}),r(this,he).add([66,18,0,0,127],(t,a,s)=>{e.switchMode("gs",!0),r(e,p)[y.cc*9]=120,r(e,p)[y.cc*25]=120,r(e,p)[y.cc*41]=120,r(e,p)[y.cc*57]=120,v(e,J,3),v(e,D,!1),r(e,ge).fill(0),console.info(`GS system to ${["single","dual"][t[0]]} mode.`)}).add([66,18,64,0],(t,a,s)=>{switch(t[0]){case 127:{e.switchMode("gs",!0),r(e,p)[y.cc*9]=120,r(e,p)[y.cc*25]=120,r(e,p)[y.cc*41]=120,r(e,p)[y.cc*57]=120,v(e,D,!1),r(e,ge).fill(0),console.info("MIDI reset: GS");break}default:{let n=[0,0,0,0],i=(d,h)=>{n[h]=d};if(t.subarray(1).forEach((d,h)=>{let f=h+t[0];[i,i,i,i,b=>{v(this,q,b*129/16383*100)},b=>{},b=>{}][f](d,h)}),t[0]<4){let d=0;n.forEach(h=>{d=d<<4,d+=h}),d-=1024}}}}).add([66,18,64,1],t=>{let a=t[0];if(a<16){let s="".padStart(a," ");t.subarray(1).forEach((n,i)=>{s+=String.fromCharCode(Math.max(32,n))}),s=s.padEnd(16," "),console.debug(`GS patch name: ${s}`)}else a<48||(a<65?t.subarray(1).forEach((s,n)=>{let i=`GS ${a+n>55?"chorus":"reverb"} `;([()=>{console.info(`${i}type: ${dt[s]}`),e.setEffectType(0,40,s)},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${i}predelay: ${s}ms`)},()=>{console.info(`${i}type: ${Dt[s]}`),e.setEffectType(1,40,16+s)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${i}to reverb: ${K(s)}`)},()=>{console.debug(`${i}to delay: ${K(s)}`)}][a+n-48]||(()=>{}))()}):a<80?console.debug(`Unknown GS patch address: ${a}`):a<91?t.subarray(1).forEach((s,n)=>{let i="GS delay ";([()=>{console.info(`${i}type: ${Pt[s]}`),e.setEffectType(2,40,32+s)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${i}to reverb: ${K(s)}`)}][a+n-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${a}`))}).add([66,18,64,2],t=>{let a="GS EQ ";t.subarray(1).forEach((s,n)=>{([()=>{console.debug(`${a}low freq: ${[200,400][s]}Hz`)},()=>{console.debug(`${a}low gain: ${s-64}dB`)},()=>{console.debug(`${a}high freq: ${[3e3,6e3][s]}Hz`)},()=>{console.debug(`${a}high gain: ${s-64}dB`)}][t[0]+n]||function(){console.warn(`Unknown GS EQ address: ${t[0]+n}`)})()})}).add([66,18,64,3],t=>{let a="GS EFX ",s=function(n,i){let d=Ut(r(e,Q).subarray(10,12),i,n);d&&console.debug(`${a}${ft(r(e,Q).subarray(10,12))} ${d}`)};t.subarray(1).forEach((n,i)=>{([()=>{e.setEffectTypeRaw(3,!1,32+n)},()=>{e.setEffectTypeRaw(3,!0,n),console.info(`${a}type: ${ft(r(e,Q).subarray(10,12))}`)},!1,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,()=>{console.debug(`${a}to reverb: ${K(n)}dB`)},()=>{console.debug(`${a}to chorus: ${K(n)}dB`)},()=>{console.debug(`${a}to delay: ${K(n)}dB`)},!1,()=>{console.debug(`${a}1 source: ${n}`),n&&n<96&&e.allocateAce(n)},()=>{console.debug(`${a}1 depth: ${n-64}`)},()=>{console.debug(`${a}2 source: ${n}`),n&&n<96&&e.allocateAce(n)},()=>{console.debug(`${a}2 depth: ${n-64}`)},()=>{console.debug(`${a}to EQ: ${n?"ON":"OFF"}`)}][t[0]+i]||function(d,h){console.warn(`Unknown GS EFX address: ${h}`)})(n,t[0]+i)})}).add([66,18,65],t=>{}).add([69,18,16],t=>{var a;switch(t[0]){case 0:{let s=t[1];e.setLetterDisplay(t.subarray(2),"GS display text",s);break}case 32:{v(e,ie,Date.now()+3200),t[1]==0&&v(e,z,Math.max(Math.min(t[2]-1,9),0));break}default:if(t[0]<11){r(e,z)>9&&v(e,z,0),v(e,ie,Date.now()+3200),(a=r(e,fe)[t[0]-1])!=null&&a.length||(r(e,fe)[t[0]-1]=new Uint8Array(256));let s=r(e,fe)[t[0]-1],n=t[1];s.fill(0);let i=t.subarray(2);for(let d=0;d<n;d++)i.unshift(0);i.forEach(function(d,h){let f=Math.floor(h/16),b=h%16,$=(b*4+f)*5,k=5,E=0;for($-=b*4,f==3&&(k=1);E<k;)s[$+E]=d>>4-E&1,E++})}else console.warn(`Unknown GS display section: ${t[0]}`)}});let l=function(t,a,s){let n=t[0],i=y.cc*a,d=y.rpn*a,h=`GS CH${a+1} `;n<3?t.subarray(1).forEach((f,b)=>{[()=>{r(e,p)[i+g[0]]=f},()=>{r(e,A)[a]=f},()=>{let $=e.chRedir(f,s,!0);r(e,H)[a]=$,a!=$&&(e.buildRchTree(),console.info(`${h}receives from CH${$+1}`))}][n+b]()}):n<19||(n<44?t.subarray(1).forEach((f,b)=>{([()=>{r(e,se)[a]=+!f},!1,()=>{e.setChType(a,f<<1,C.gs),console.debug(`${h}type: ${f?"drum ":"melodic"}${f||""}`)},()=>{r(e,S)[d+3]=f},!1,()=>{r(e,p)[i+g[7]]=f},!1,!1,()=>{r(e,p)[i+g[10]]=f||128},!1,!1,()=>{console.debug(`${h}CC 1: cc${f}`)},()=>{console.debug(`${h}CC 2: cc${f}`)},()=>{r(e,p)[i+g[93]]=f},()=>{r(e,p)[i+g[91]]=f},!1,!1,()=>{r(e,S)[d+1]=f},()=>{r(e,S)[d+2]=f},()=>{r(e,p)[i+g[94]]=f}][n+b-19]||(()=>{}))()}):n<76||console.debug(`Unknown GS part address: ${n}`))},c=function(t,a){let s=t[0],n=`GS CH${a+1} `;s<2?t.subarray(1).forEach((i,d)=>{[()=>{r(e,p)[y.cc*a+g[32]]=i},()=>{}][s+d]()}):s<32?console.warn(`Unknown GS misc address: ${s}`):s<35?t.subarray(1).forEach((i,d)=>{[()=>{console.debug(`${n}EQ: o${["ff","n"][i]}`)},()=>{},()=>{console.debug(`${n}EFX: o${["ff","n"][i]}`)}][s+d-32]()}):console.warn(`Unknown GS misc address: ${s}`)};r(this,he).add([66,18,64,16],(t,a)=>{l(t,e.chRedir(9,a,!0),a)}).add([66,18,64,17],(t,a)=>{l(t,e.chRedir(0,a,!0),a)}).add([66,18,64,18],(t,a)=>{l(t,e.chRedir(1,a,!0),a)}).add([66,18,64,19],(t,a)=>{l(t,e.chRedir(2,a,!0),a)}).add([66,18,64,20],(t,a)=>{l(t,e.chRedir(3,a,!0),a)}).add([66,18,64,21],(t,a)=>{l(t,e.chRedir(4,a,!0),a)}).add([66,18,64,22],(t,a)=>{l(t,e.chRedir(5,a,!0),a)}).add([66,18,64,23],(t,a)=>{l(t,e.chRedir(6,a,!0),a)}).add([66,18,64,24],(t,a)=>{l(t,e.chRedir(7,a,!0),a)}).add([66,18,64,25],(t,a)=>{l(t,e.chRedir(8,a,!0),a)}).add([66,18,64,26],(t,a)=>{l(t,e.chRedir(10,a,!0),a)}).add([66,18,64,27],(t,a)=>{l(t,e.chRedir(11,a,!0),a)}).add([66,18,64,28],(t,a)=>{l(t,e.chRedir(12,a,!0),a)}).add([66,18,64,29],(t,a)=>{l(t,e.chRedir(13,a,!0),a)}).add([66,18,64,30],(t,a)=>{l(t,e.chRedir(14,a,!0),a)}).add([66,18,64,31],(t,a)=>{l(t,e.chRedir(15,a,!0),a)}).add([66,18,64,64],(t,a)=>{c(t,e.chRedir(9,a,!0))}).add([66,18,64,65],(t,a)=>{c(t,e.chRedir(0,a,!0))}).add([66,18,64,66],(t,a)=>{c(t,e.chRedir(1,a,!0))}).add([66,18,64,67],(t,a)=>{c(t,e.chRedir(2,a,!0))}).add([66,18,64,68],(t,a)=>{c(t,e.chRedir(3,a,!0))}).add([66,18,64,69],(t,a)=>{c(t,e.chRedir(4,a,!0))}).add([66,18,64,70],(t,a)=>{c(t,e.chRedir(5,a,!0))}).add([66,18,64,71],(t,a)=>{c(t,e.chRedir(6,a,!0))}).add([66,18,64,72],(t,a)=>{c(t,e.chRedir(7,a,!0))}).add([66,18,64,73],(t,a)=>{c(t,e.chRedir(8,a,!0))}).add([66,18,64,74],(t,a)=>{c(t,e.chRedir(10,a,!0))}).add([66,18,64,75],(t,a)=>{c(t,e.chRedir(11,a,!0))}).add([66,18,64,76],(t,a)=>{c(t,e.chRedir(12,a,!0))}).add([66,18,64,77],(t,a)=>{c(t,e.chRedir(13,a,!0))}).add([66,18,64,78],(t,a)=>{c(t,e.chRedir(14,a,!0))}).add([66,18,64,79],(t,a)=>{c(t,e.chRedir(15,a,!0))}),r(this,be).add([54,65],(t,a)=>{e.switchMode("x5d");let s=(t[1]<<7)+t[0],n=(t[3]<<7)+t[2],i=e.chRedir(s&15,a,!0),d=y.cc*i;[()=>{n<1||(n<101?(e.setChType(i,e.CH_MELODIC,C.x5d),r(e,A)[i]=n-1,r(e,p)[d+g[0]]=82):n<229?(e.setChType(i,e.CH_MELODIC,C.x5d),r(e,A)[i]=n-101,r(e,p)[d+g[0]]=56):(e.setChType(i,e.CH_DRUMS,C.x5d),r(e,A)[i]=Ft[n-229]||0,r(e,p)[d+g[0]]=62))},()=>{r(e,p)[d+g[7]]=n},()=>{n<31&&(r(e,p)[d+g[10]]=Math.round((n-15)*4.2+64))},()=>{r(e,p)[d+g[93]]=Ye(n)},()=>{r(e,p)[d+g[91]]=Ye(n)},()=>{r(e,S)[i*y.rpn+3]=n>8191?n-16320:64+n},()=>{r(e,S)[i*y.rpn+1]=n>8191?n-16320:64+n},()=>{n>0&&(r(e,S)[i*y.rpn]=n)},()=>{}][s>>4]()}).add([54,76,0],(t,a)=>{e.switchMode("x5d",!0);let s="",n=82,i=0,d=0,h="MSB	PRG	LSB	NME";ae(t,function(f,b){if(b<16400){let $=b%164;switch(!0){case $<10:{f>31&&(s+=String.fromCharCode(f));break}case $==11:{h+=`
${n}	${i}	${d}	${s.trim().replace("Init Voice","")}`,i++,s="";break}}i>99&&(n=90,i=0)}}),e.userBank.clearRange({msb:82,prg:[0,99],lsb:0}),e.userBank.load(h)}).add([54,77,0],(t,a)=>{e.switchMode("x5d",!0);let s="",n=90,i=0,d=0,h="MSB	PRG	LSB	NME";ae(t,function(f,b){if(b<13600){let $=b%136;switch(!0){case $<10:{f>31&&(s+=String.fromCharCode(f));break}case $==11:{h+=`
${n}	${i}	${d}	${s.trim().replace("Init Combi","")}`,i++,s="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(h)}).add([54,78],(t,a)=>{e.switchMode("x5d",!0),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][t[0]]} mode.`)}).add([54,85],(t,a)=>{e.switchMode("x5d",!0),ae(t,(s,n)=>{n>0&&n<3&&e.setEffectType(n-1,44,s)})}).add([54,104],(t,a)=>{e.switchMode("x5d",!0),ae(t,function(s,n,i,d){if(n<192){let h=e.chRedir(Math.floor(n/12),a,!0),f=h*y.cc;switch(n%12){case 0:{s<128?(e.setChType(h,e.CH_MELODIC,C.x5d),r(e,p)[f+g[0]]=82,r(e,A)[h]=s):(e.setChType(h,e.CH_DRUMS,C.x5d),r(e,p)[f+g[0]]=62,r(e,A)[h]=Ft[s-128]),s>0&&(r(e,j)[h]=1);break}case 1:{r(e,p)[f+g[7]]=s;break}case 2:{r(e,S)[h*y.rpn+3]=s>127?s-192:64+s;break}case 3:{r(e,S)[h*y.rpn+1]=s>127?s-192:64+s;break}case 4:{s<31&&(r(e,p)[f+g[10]]=Math.round((s-15)*4.2+64));break}case 5:{let b=s>>4,$=s&15;r(e,p)[f+g[91]]=Ye($),r(e,p)[f+g[93]]=Ye(b);break}case 10:break;case 11:{let b=e.chRedir(s&15,a,!0),$=s>>4;r(e,H)[h]=s,(b!=h||$)&&(console.info(`X5D Part CH${h+1} receives from CH${b+1}.`),e.buildRchTree())}}}else{let h=e.chRedir(n-192,a,!0)}})}),r(this,he).add([22,18,127],t=>{e.switchMode("mt32",!0),v(e,D,!1),e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(t,a,s)=>{e.switchMode("mt32");let n=e.chRedir(s,a,!0),i=t[1];t.subarray(2).forEach((d,h)=>{let f=h+i;r(e,we)[f+(n-1)*16]=d,([!1,()=>{let b=r(e,we)[n-1<<4];if(b<3)if(r(e,oe)[n]=1,b==2)for(let $=0;$<name.length;$++)r(e,Z)[(n-1)*y.cmt+$]=r(e,me)[d*y.cmt+$];else{let $=e.baseBank.get(0,d+(b<<6),127,"mt32").name;for(let k=0;k<$.length;k++)r(e,Z)[(n-1)*y.cmt+k]=$.charCodeAt(k)}},()=>{r(e,S)[n*y.rpn+3]=d+40},()=>{r(e,S)[n*y.rpn+1]=d+14},()=>{r(e,S)[n*y.rpn]=d},!1,()=>{r(e,p)[y.cc*n+g[91]]=d?127:0},!1,()=>{r(e,p)[y.cc*n+g[7]]=d},()=>{r(e,p)[y.cc*n+g[10]]=Math.ceil(d*9.05)}][f]||(()=>{}))()})}).add([22,18,1],(t,a,s)=>{e.switchMode("mt32");let n=e.chRedir(s,a,!0)}).add([22,18,2],(t,a,s)=>{e.switchMode("mt32");let n=e.chRedir(s,a,!0),i=t[1]+(t[0]<<7);i<10&&(r(e,oe)[n]=1),t.subarray(2).forEach((d,h)=>{let f=h+i;f<14&&(r(e,Z)[(n-1)*y.cmt+f]=d)})}).add([22,18,3],(t,a,s)=>{if(e.switchMode("mt32"),t[0]){let n=t[1]-16}else{let n=t[1];t.subarray(2).forEach((i,d)=>{let h=d+n;r(e,we)[h]=i;let f=e.chRedir(1+h>>4,a,!0),b=h&15;([!1,()=>{let $=r(e,we)[f-1<<4];if($<3)if(r(e,oe)[f]=1,$==2)for(let k=0;k<name.length;k++)r(e,Z)[(f-1)*y.cmt+k]=r(e,me)[i*y.cmt+k];else{let k=e.baseBank.get(0,i+($<<6),127,"mt32").name;for(let E=0;E<k.length;E++)r(e,Z)[(f-1)*y.cmt+E]=k.charCodeAt(E)}},()=>{r(e,S)[f*y.rpn+3]=i+40},()=>{r(e,S)[f*y.rpn+1]=i+14},()=>{r(e,S)[f*y.rpn]=i},!1,()=>{r(e,p)[y.cc*f+g[91]]=i?127:0},!1,()=>{r(e,p)[y.cc*f+g[7]]=i},()=>{r(e,p)[y.cc*f+g[10]]=Math.ceil(i*9.05)}][b]||(()=>{}))()})}}).add([22,18,4],(t,a,s)=>{e.switchMode("mt32");let n=t[1]+(t[0]<<7);t.subarray(2).forEach((i,d)=>{let h=d+n,f=e.chRedir(Math.floor(h/246+1),a,!0),b=h%246;b<14&&(r(e,Z)[(f-1)*y.cmt+b]=i),b<10&&(r(e,oe)[f]=1)})}).add([22,18,5],(t,a,s)=>{e.switchMode("mt32");let n=(t[0]<<7)+t[1];t.subarray(2).forEach((i,d)=>{let h=n+d,f=Math.floor(h/8),b=h&7,$=f*8;r(e,_e)[h]=i,([!1,()=>{let k=r(e,_e)[$];if(k<3){let E="";if(k==2){let m=y.cmt*f;E=`MT-m:${i.toString().padStart(3,"0")}`}else E=e.baseBank.get(0,i+(k<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:f}),e.userBank.load(`MSB	LSB	PRG	NME
000	127	${f}	${E}`,!0)}}][b]||(()=>{}))()})}).add([22,18,8],(t,a,s)=>{e.switchMode("mt32");let n=((t[0]&1)<<7)+t[1];t.subarray(2).forEach((i,d)=>{let h=n+d;h<y.cmt&&(r(e,me)[(t[0]>>1)*y.cmt+h]=i)})}).add([22,18,16],(t,a,s)=>{e.switchMode("mt32");let n=t[1],i=!1,d=function(h,f){r(e,H)[f-12]=h,i=!0};t.subarray(2).forEach((h,f)=>{let b=f+n;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,d,d,d,d,d,d,d,d,d,()=>{v(e,q,h)}][b]||(()=>{}))(h,f)}),i&&e.buildRchTree()}).add([22,18,32],t=>{e.switchMode("mt32");let a=t[1],s=" ".repeat(a);t.subarray(2).forEach(n=>{n>31&&(s+=String.fromCharCode(n))}),v(e,ce,s.padStart(20," ")),v(e,ke,Date.now()+3200)}).add([22,18,82],(t,a)=>{let s=e.chRedir(0,a,!0);for(let n=0;n<16;n++)r(e,B).ano(s+n),n&&n<10&&(r(e,A)[s+n]=ut[n-1]);console.info("MT-32 alt reset complete.")}),r(this,be).add([66,0],(t,a)=>{e.switchMode("ns5r",!0),v(e,D,!1),console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][t[0]]} mode.`)}).add([66,1],(t,a)=>{e.switchMode(["ns5r","05rw"][t[0]],!0),v(e,D,!1)}).add([66,18,0,0],(t,a)=>{let s=t[0];switch(s){case 124:case 126:case 127:{e.switchMode("ns5r",!0),v(e,D,!1);break}case 125:{console.info(`NS5R drum setup reset: ${t}`);break}default:if(s<10){let n=[0,0,0,0],i=(d,h)=>{n[h]=d};if(t.subarray(1).forEach((d,h)=>{[i,i,i,i,()=>{v(e,q,d*129/16383*100)},()=>d-64,()=>d-64,()=>{},()=>{},()=>{}][s+h]()}),t[0]<4){let d=0;n.forEach(h=>{d=d<<4,d+=h}),d-=1024}}}}).add([66,18,0,1],(t,a)=>{}).add([66,18,0,2],(t,a)=>{}).add([66,18,1],(t,a)=>{let s=e.chRedir(t[0],a,!0),n=s*y.cc,i=t[1],d=`NS5R CH${s+1} `;t.subarray(2).forEach((h,f)=>{let b=i+f;b<3?[()=>{r(e,p)[n+g[0]]=h||121},()=>{r(e,p)[n+g[32]]=h},()=>{r(e,A)[s]=h}][b]():b<8||(b<14?[()=>{let $=e.chRedir(h,a,!0);r(e,H)[s]=$,s!=$&&(e.buildRchTree(),console.info(`${d}receives from CH${$+1}`))},()=>{r(e,se)[s]=+!h},()=>{e.setChType(s,h,C.ns5r),console.debug(`${d}type: ${Qe[h]}`)},()=>{r(e,S)[y.rpn*s+3]=h},()=>{},()=>{}][b-8]():b<16||(b<33?[()=>{r(e,p)[n+g[7]]=h},()=>{r(e,p)[n+g[11]]=h},()=>{},()=>{},()=>{r(e,p)[n+g[10]]=h||128},()=>{},()=>{},()=>{r(e,p)[n+g[93]]=h},()=>{r(e,p)[n+g[91]]=h},()=>{r(e,p)[n+g[76]]=h},()=>{r(e,p)[n+g[77]]=h},()=>{r(e,p)[n+g[78]]=h},()=>{r(e,p)[n+g[74]]=h},()=>{r(e,p)[n+g[71]]=h},()=>{r(e,p)[n+g[73]]=h},()=>{r(e,p)[n+g[75]]=h},()=>{r(e,p)[n+g[72]]=h}][b-16]():b<112||b<114&&[()=>{r(e,p)[n+g[5]]=h},()=>{r(e,p)[n+g[65]]=h}][b-112]()))})}).add([66,18,8,0],(t,a)=>{let s=t[0];if(s<32)e.setLetterDisplay(t.subarray(1,33),"NS5R letter display");else{let n=s-32;v(e,ie,Date.now()+3200),v(e,z,10),r(e,Y,de).fill(0);let i=t.subarray(1),d=4;i.forEach(function(h,f){let b=f+n,$=b>>4,k=b&15;if(b<80){let E=$<d?h:h>>3,m=0,x=$<d?6:3;for(;E>0;)r(e,Y,de)[k*32+$*7+(x-m)]=E&1,E=E>>1,m++}})}}).add([66,52],(t,a)=>{e.switchMode("ns5r",!0),v(e,D,!1);let s="";ae(t,(n,i)=>{i<8?(n>31&&(s+=String.fromCharCode(n)),i==7&&(e.aiEfxName=s)):i<10&&e.setEffectType(i-8,44,n)})}).add([66,53],(t,a)=>{e.switchMode("ns5r",!0),v(e,D,!1),ae(t,function(s,n){switch(!0){case n<2944:{let i=e.chRedir(Math.floor(n/92),a,!0),d=i*y.cc;switch(n%92){case 0:{r(e,p)[d+g[0]]=s||121;break}case 1:{r(e,p)[d+g[32]]=s;break}case 2:{r(e,A)[i]=s,s>0&&(r(e,j)[i]=1);break}case 3:{let h=e.chRedir(s,a,!0);r(e,H)[i]=h,i!=h&&(console.info(`NS5R CH${i+1} receives from CH${h+1}.`),e.buildRchTree())}case 7:break;case 8:{r(e,S)[i*y.rpn+3]=s<40||s>88?s+(s>63?-192:64):s;break}case 9:case 10:{r(e,p)[d+g[7]]=s;break}case 11:{r(e,p)[d+g[11]]=s;break}case 14:{r(e,p)[d+g[10]]=s||128;break}case 19:{r(e,p)[d+g[93]]=s;break}case 20:{r(e,p)[d+g[91]]=s;break}case 84:{r(e,p)[d+g[65]]=s;break}case 85:{r(e,p)[d+g[5]]=s;break}}break}case n<3096:break;case n<3134:break;case n<8566:break}})}).add([66,54],(t,a)=>{e.switchMode("ns5r",!0);let s="",n=80,i=0,d=0,h="MSB	PRG	LSB	NME";ae(t,function(f,b){let $=b%158;switch(!0){case $<10:{f>31&&(s+=String.fromCharCode(f));break}case $==11:{n=f&127;break}case $==12:{d=f&127;break}case $==13:{h+=`
${n}	${i}	${d}	${s.trim().replace("Init Voice","")}`,i++,s="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(h)}).add([66,55],(t,a)=>{e.switchMode("ns5r",!0);let s="",n=88,i=0,d=0,h="MSB	PRG	LSB	NME";ae(t,function(f,b){let $=b%126;switch(!0){case $<10:{f>31&&(s+=String.fromCharCode(f));break}case $==11:break;case $==12:break;case $==13:{h+=`
${n}	${i}	${d}	${s.trim().replace("Init Combi","")}`,i++,s="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(h)}).add([66,125],t=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][t[0]]||"white")}).add([66,127],t=>{let a=new Uint8Array(5760);ae(t,(s,n,i)=>{if(n<720)for(let d=0;d<8;d++)a[n*8+d]=s>>7-d&1}),e.dispatchEvent("screen",{type:"ns5r",data:a})}).add([76],(t,a,s)=>{r(e,be).run([66,...t],a,s)}),r(this,Ae).add([16,0,8,0],(t,a,s)=>{let n=(t[2]<<4)+t[3],i="K11 ";([()=>{e.switchMode("k11",!0),v(e,D,!1),v(e,J,n?4:0),console.info("MIDI reset: GMega/K11")},()=>{console.debug(`${i}reverb type: ${n}`)},()=>{console.debug(`${i}reverb time: ${n}`)},()=>{console.debug(`${i}reverb time: ${n}`)},()=>{console.debug(`${i}reverb predelay: ${n}`)},()=>{console.debug(`${i}reverb predelay: ${n}`)},()=>{console.debug(`${i}depth high: ${n}`)},()=>{console.debug(`${i}depth high: ${n}`)},()=>{console.debug(`${i}depth low: ${n}`)},()=>{console.debug(`${i}depth low: ${n}`)}][t[0]]||(()=>{}))()}).add([16,0,8,1],(t,a,s)=>{let n=e.chRedir(t[1],a,!0),i=y.cc*n,d=y.rpn*n,h=(t[3]<<4)+t[4],f=`K11 CH${n+1} `;([()=>{h<128?(e.setChType(n,e.CH_MELODIC,C.k11),r(e,p)[i+g[0]]=0,r(e,A)[n]=h):(e.setChType(n,e.CH_DRUMS,C.k11),r(e,A)[n]=h-128)},()=>{let b=e.chRedir(h,a,!0);r(e,H)[n]=b,n!=b&&(e.buildRchTree(),console.info(`${f}receives from CH${b+1}`))},()=>{r(e,p)[i+g[7]]=h},()=>{r(e,j)[n]=h},()=>{r(e,p)[i+g[10]]=h},()=>{r(e,S)[d+3]=h+40},()=>{r(e,S)[d+1]=h>>1,r(e,S)[d+2]=h&1},()=>{r(e,p)[i+g[91]]=h?127:0},()=>{},()=>{r(e,p)[i+g[74]]=h},()=>{r(e,p)[i+g[73]]=h},()=>{r(e,p)[i+g[72]]=h}][t[0]]||(()=>{}))()}).add([16,0,9,0],(t,a,s)=>{let n=(t[2]<<4)+t[3],i="GMLX ";([()=>{console.debug(`${i}reverb type: ${n}`)},()=>{console.debug(`${i}reverb time: ${n}`)},()=>{console.debug(`${i}reverb predelay: ${n}`)},()=>{console.debug(`${i}depth high: ${n}`)},()=>{console.debug(`${i}depth low: ${n}`)}][t[0]]||(()=>{}))()}).add([16,0,9,3],(t,a,s)=>{let n=(t[2]<<4)+t[3],i=e.chRedir(t[1],a,!0),d=i*y.cc;[()=>{n<128?(e.setChType(i,e.CH_MELODIC,C.k11),r(e,p)[d+g[0]]=0,r(e,p)[d+g[32]]=0,r(e,A)[i]=n):n<160?(e.setChType(i,e.CH_MELODIC,C.k11),r(e,p)[d+g[0]]=0,r(e,p)[d+g[32]]=7,r(e,A)[i]=n-100):(e.setChType(i,e.CH_DRUMS,C.k11),r(e,p)[d+g[0]]=122,r(e,p)[d+g[32]]=0,r(e,A)[i]=n-160)},()=>{let h=e.chRedir(n,a,!0);r(e,H)[i]=h,i!=h&&(e.buildRchTree(),console.info(`GMLX CH${i+1} receives from CH${h+1}`))}][t[0]]()}).add([16,0,9,4],(t,a,s)=>{let n=(t[2]<<4)+t[3],i=e.chRedir(t[1],a,!0),d=i*y.cc,h=i*y.rpn,f=`GMLX CH${i+1} `;[()=>{r(e,j)[i]=n},()=>{r(e,p)[d+g[7]]=n},()=>{r(e,p)[d+g[10]]=n},()=>{r(e,p)[d+g[91]]=n?127:0},()=>{r(e,S)[h+3]=n+40},()=>{r(e,S)[h+1]=n},()=>{r(e,S)[h]=n},()=>{}][t[0]]()}),r(this,Ie).add([66,93,64],(t,a,s)=>{let n=t[2];switch(t[0]){case 0:{switch(t[1]){case 4:{v(e,q,n*129/16383*100);break}case 5:{n-64;break}case 6:{console.debug(`SG global reverb: ${n?"on":"off"}`);break}case 127:{e.switchMode("sg",!0);break}}break}case 1:{switch(t[1]){case 48:{console.debug(`SG reverb type: ${dt[n]}`);break}}break}default:if(t[0]>>4==1){let i=e.chRedir(t[0]&15,a,!0);if(t[1]==2){let d=e.chRedir(n,a,!0);r(e,H)[i]=d,i!=d&&(e.buildRchTree(),console.info(`SG CH${i+1} receives from CH${d+1}`))}else t[1]==19&&(r(e,p)[y.cc*i+g[7]]=n)}else console.warn(`Unknown AKAI SG SysEx: ${t}`)}}),r(this,De).add([9],(t,a,s)=>{console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremelo","phaser","rotary speaker","enhancer","flanger","EQ"][t[0]]||"off"}`)})}chRedir(e,o,l){if(r(this,Se)[o])return(r(this,Se)[o]-1)*16+e;if([2,3].indexOf(r(this,J))>-1){if(l==1)return e;let c=0,t=!0;for(;t;)r(this,ge)[e+c]==0?(r(this,ge)[e+c]=o,console.debug(`Assign track ${o} to channel ${e+c+1}.`),t=!1):r(this,ge)[e+c]==o?t=!1:(c+=16,c>=128&&(c=0,t=!1));return e+c}else return e}buildRchTree(){let e=[];r(this,H).forEach((o,l)=>{var c;(c=e[o])!=null&&c.constructor||(e[o]=[]),e[o].push(l)}),v(this,Je,e)}getActive(){let e=r(this,j).slice();return r(this,I)==C.mt32,e}getCc(e){let o=e*y.cc,l=r(this,p).subarray(o,o+y.cc);return l[g[0]]=l[g[0]]||r(this,Ee),l[g[32]]=l[g[32]]||r(this,J),l}getCcCh(e,o){if(We.indexOf(o)<0)throw new Error("CC number not accepted");return r(this,p)[y.cc*e+g[o]]}getCcAll(){let e=r(this,p).slice();for(let o=0;o<y.ch;o++){let l=o*y.cc;e[l+g[0]]=e[l+g[0]]||r(this,Ee),e[l+g[32]]=e[l+g[32]]||r(this,J)}return e}getChType(){return r(this,R)}setChType(e,o,l=r(this,I)){o&=15,r(this,R)[e]=o,o>0&&(r(this,p)[e*y.cc+g[0]]=Me[l])}getPitch(){return r(this,ve)}getProgram(){return r(this,A)}getTexts(){return r(this,T).slice()}getVel(e){let o=new Map,l=this;return r(l,L).forEach(function(c,t){let a=Math.floor(c/128),s=c%128;e==a&&r(l,U)[c]>0&&o.set(s,{v:r(l,U)[c],s:r(l,N)[t]})}),o}getBitmap(){return{bitmap:r(this,Y,de),expire:r(this,ie)}}getLetter(){return{text:r(this,ce),expire:r(this,ke)}}getMode(){return $e[r(this,I)]}getMaster(){return{volume:r(this,q)}}getRawStrength(){let e=this;return r(this,L).forEach(function(o){let l=Math.floor(o/128);r(e,U)[o]>r(e,ne)[l]&&(r(e,ne)[l]=r(e,U)[o])}),r(this,ne)}getStrength(){let e=[],o=this;return this.getRawStrength().forEach(function(l,c){e[c]=Math.floor(l*r(o,p)[c*y.cc+g[7]]*r(o,p)[c*y.cc+g[11]]*r(o,q)/803288)}),e}getRpn(){return r(this,S)}getNrpn(){return r(this,Ge)}getVoice(e,o,l,c){let t=e||r(this,Ee),a=o,s=l||r(this,J);$e[r(this,I)]=="ns5r"&&t>0&&t<56&&(s=3);let n=this.userBank.get(t,a,s,c);if($e[r(this,I)]=="mt32"&&n.name.indexOf("MT-m:")==0){let i=parseInt(n.name.slice(5)),d=i*y.cmt,h="";r(this,me).subarray(d,d+10).forEach(f=>{f>31&&(h+=String.fromCharCode(f))}),this.userBank.load(`MSB	LSB	PRG
0	127	${a}	${h}`,!0),n.name=h,n.ending=" "}return(n.ending!=" "||!n.name.length)&&(n=this.baseBank.get(t,a,s,c)),n}getChVoice(e){let o=this.getVoice(r(this,p)[e*y.cc+g[0]],r(this,A)[e],r(this,p)[e*y.cc+g[32]],$e[r(this,I)]);if(r(this,oe)[e])switch(r(this,I)){case C.mt32:o.ending="~",o.name="",r(this,Z).subarray(14*(e-1),14*(e-1)+10).forEach(l=>{l>31&&(o.name+=String.fromCharCode(l))})}return o}getPitchShift(e){let o=e*y.rpn;return r(this,ve)[e]/8192*r(this,S)[o]+(r(this,S)[o+3]-64)+((r(this,S)[o+1]<<7)+r(this,S)[o+2]-8192)/8192}getEffectType(e=0){let o=3*e+1;return r(this,Q).subarray(o,o+2)}setEffectTypeRaw(e=0,o,l){let c=3*e;r(this,Q)[c]=1,r(this,Q)[c+1+ +o]=l}setEffectType(e=0,o,l){this.setEffectTypeRaw(e,!1,o),this.setEffectTypeRaw(e,!0,l)}setLetterDisplay(e,o,l=0,c=3200){let t=this,a;v(t,ce," ".repeat(l)),e.forEach(s=>{v(t,ce,r(t,ce)+String.fromCharCode(s>31?s:32)),s<32&&(a=a||new Set,a.add(s))}),v(t,ke,Date.now()+3200),v(t,ce,r(t,ce).padEnd(32," ")),a&&(a=Array.from(a),a.forEach((s,n,i)=>{i[n]=s.toString(16).padStart(2,"0")}),console.warn(`${o}${o?" ":""}invalid code point${a.length>1?"s":""}: 0x${a.join(", 0x")}`))}allocateAce(e){if(!e||e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}let o=!0,l=0;for(;o&&l<y.ace;)r(this,ue)[l]==e?o=!1:r(this,ue)[l]||(o=!1,r(this,ue)[l]=e,console.info(`Allocated cc${e} to ACE slot ${l}.`)),l++;l>=y.ace&&console.warn("ACE slots are full.")}getAce(){return r(this,ue)}getChAce(e,o){if(o<0||o>=y.ace)throw new RangeError("No such ACE slot");let l=r(this,ue)[o];if(l){if(We.indexOf(l)>=0)return r(this,p)[e*y.cc+g[l]];throw new Error(`Invalid ACE source: ${l}`)}else return 0}init(e=0){this.dispatchEvent("mode","?"),v(this,I,0),v(this,Ee,0),v(this,J,0),v(this,pe,0),r(this,j).fill(0),r(this,p).fill(0),r(this,ue).fill(0),r(this,A).fill(0),r(this,U).fill(0),r(this,L).fill(0),r(this,ne).fill(0),r(this,ve).fill(0),r(this,Ge).fill(0),r(this,Ze).fill(0),v(this,q,100),v(this,T,[]),v(this,Fe,500),v(this,Ve,0),v(this,ke,0),v(this,ce,""),v(this,ie,0),v(this,z,0),r(this,Y,de).fill(0),v(this,D,!1),v(this,Xe,0),v(this,ee,!0),r(this,H).forEach(function(o,l,c){c[l]=l}),this.buildRchTree(),e==0&&(r(this,ge).fill(0),r(this,Se).fill(0)),r(this,p)[y.cc*9]=Me[0],r(this,p)[y.cc*25]=Me[0],r(this,p)[y.cc*41]=Me[0],r(this,p)[y.cc*57]=Me[0],r(this,R).fill(this.CH_MELODIC),r(this,R)[9]=this.CH_DRUM1,r(this,R)[25]=this.CH_DRUM3,r(this,R)[41]=this.CH_DRUMS,r(this,R)[57]=this.CH_DRUMS,r(this,R)[73]=this.CH_DRUM5,r(this,R)[89]=this.CH_DRUM7,r(this,R)[105]=this.CH_DRUMS,r(this,R)[121]=this.CH_DRUMS,r(this,_e).fill(0),r(this,me).fill(0),r(this,we).fill(0),r(this,Z).fill(0),r(this,oe).fill(0),r(this,Q).fill(0),this.aiEfxName="",this.userBank.clearRange({msb:0,lsb:127,prg:[0,127]});for(let o=0;o<y.ch;o++){let l=o*y.cc;r(this,p)[l+g[7]]=100,r(this,p)[l+g[11]]=127,r(this,p)[l+g[10]]=64,r(this,p)[l+g[71]]=64,r(this,p)[l+g[72]]=64,r(this,p)[l+g[73]]=64,r(this,p)[l+g[74]]=64,r(this,p)[l+g[75]]=64,r(this,p)[l+g[76]]=64,r(this,p)[l+g[77]]=64,r(this,p)[l+g[78]]=64,r(this,p)[l+g[91]]=40,r(this,p)[l+g[101]]=127,r(this,p)[l+g[100]]=127,r(this,p)[l+g[99]]=127,r(this,p)[l+g[98]]=127;let c=o*y.rpn;r(this,S)[c]=2,r(this,S)[c+1]=64,r(this,S)[c+2]=0,r(this,S)[c+3]=64,r(this,S)[c+4]=0,r(this,S)[c+5]=0}}switchMode(e,o=!1){let l=$e.indexOf(e);if(l>-1){if(r(this,I)==0||o){let c=r(this,I);v(this,I,l),v(this,z,0),v(this,Ee,Nt[0][l]),v(this,J,Nt[1][l]);for(let a=0;a<y.ch;a++)r(this,R)[a]>0&&r(this,p)[a*y.cc+g[0]]==Me[c]&&(r(this,p)[a*y.cc]=Me[l]);switch(this.initOnReset,l){case C.mt32:{ut.forEach((a,s)=>{let n=s+1;r(this,j)[n]||(r(this,A)[n]=a,r(this,p)[n*y.cc+g[91]]=127)});break}}let t;switch(l){case C.gs:{t=[40,4,40,18,40,32,32,0,0,0,0,0,0,0];break}case C.x5d:case C.ns5r:{t=[44,1,44,19,44,0,44,0,0,0,0,0,0,0];break}default:t=[1,0,65,0,5,0,0,0,0,0,0,0,0,0]}for(let a=0;a<y.efx;a++)r(this,Q)[3*a]||(r(this,Q)[3*a+1]=t[2*a],r(this,Q)[3*a+2]=t[2*a+1]);this.dispatchEvent("mode",e)}}else throw new Error(`Unknown mode ${e}`)}newStrength(){r(this,ne).fill(0)}runJson(e){var o;if(e.type>14)return e.type==15&&e.data.constructor!=Uint8Array&&(e.data=Uint8Array.from(e.data)),r(this,et)[e.type].call(this,e);{let l=this.chRedir(e.part,e.track),c=!1;(o=r(this,Je)[l])==null||o.forEach(t=>{e.channel=t,c=!0,r(this,et)[e.type].call(this,e)}),c||console.warn(`${Ht[e.type]?Ht[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!=null?e.data[0]:e.data).toString():""} event sent to CH${l+1} without any recipient.`)}r(this,T).length>100&&r(this,T).splice(100,r(this,T).length-99)}runRaw(e){}},I=new WeakMap,z=new WeakMap,ie=new WeakMap,fe=new WeakMap,Y=new WeakSet,de=function(){return r(this,fe)[r(this,z)]},Kt=function(e){r(this,fe)[r(this,z)]=e},j=new WeakMap,H=new WeakMap,R=new WeakMap,p=new WeakMap,ue=new WeakMap,A=new WeakMap,U=new WeakMap,se=new WeakMap,L=new WeakMap,N=new WeakMap,ve=new WeakMap,ne=new WeakMap,Ce=new WeakMap,S=new WeakMap,Ge=new WeakMap,Ze=new WeakMap,oe=new WeakMap,we=new WeakMap,Z=new WeakMap,_e=new WeakMap,me=new WeakMap,Q=new WeakMap,Ee=new WeakMap,J=new WeakMap,q=new WeakMap,pe=new WeakMap,Fe=new WeakMap,Ve=new WeakMap,ce=new WeakMap,ke=new WeakMap,Xe=new WeakMap,ee=new WeakMap,D=new WeakMap,Je=new WeakMap,gt=new WeakMap,T=new WeakMap,ge=new WeakMap,Se=new WeakMap,G=new WeakMap,Te=new WeakMap,B=new WeakMap,et=new WeakMap,it=new WeakMap,Re=new WeakMap,Oe=new WeakMap,le=new WeakMap,he=new WeakMap,be=new WeakMap,Ae=new WeakMap,Ie=new WeakMap,De=new WeakMap,Xt);var wt=or(zt(),1);O();O();var tt,jt,qt=(jt=class{constructor(u,e,o,l){w(this,tt,!1);v(this,tt,u),this.start=e,this.end=o,this.data=l}get duration(){return this.ranged?this.end-this.start:0}get ranged(){return r(this,tt)}},tt=new WeakMap,jt),$t=class extends qt{constructor(u,e,o){super(!0,u,e,o)}},Yt=class extends qt{constructor(u,e){super(!1,u,u,e)}},Pe,Qt,vt=(Qt=class extends Array{constructor(){super(...arguments);w(this,Pe,-1)}resetIndex(e){v(this,Pe,-1)}fresh(){this.sort(function(e,o){return e.start==o.start?0:(+(e.start>o.start)<<1)-1}),this.forEach(function(e,o){e.index=o})}step(e,o=!1){let l=[];if(o)for(let c=0;c<this.length&&!(this[c].start>e);c++){if(this[c].end<e)continue;l.push(this[c])}else{let c=this.getRange(r(this,Pe)==-1?0:e-1,e),t=this;c.forEach(function(a){a.index>r(t,Pe)&&(l.push(a),v(t,Pe,a.index))})}return l}getRange(e,o){var s;e>o&&([e,o]=[o,e]);let l=[],c=-1,t=Math.ceil(Math.sqrt(this.length)),a=!0;for(let n=0;n<this.length;n+=t)this[n+t]?c<0&&this[n+t].start>=e&&(c=n):c=c<0?n:c;for(;a;)((s=this[c])==null?void 0:s.end)<o?this[c].start>=e&&l.push(this[c]):a=!1,c++;return l}},Pe=new WeakMap,Qt);var br=0xffffffffffff,Wt=function(u){let e=new vt,o=this,l=u.timeDivision,c=120,t=new vt,a=0,s=0;t.push(new $t(0,br,[120,0])),u.track.forEach(function(h){a=0,h.event.forEach(function(f){a+=f.deltaTime,f.type==255&&(f==null?void 0:f.metaType)==81&&(c=6e7/f.data,t[t.length-1]&&t.push(new $t(a,0xffffffffffff,[c,0])))})}),t.fresh(),t.forEach(function(h,f,b){f>0&&(b[f-1].end=h.start)});let n=120;t.forEach(function(h,f,b){f>0&&(h.end==h.start?b.splice(b.indexOf(h),1):n==h.data[0]&&(b[f-1].end=h.end,b.splice(b.indexOf(h),1)),n=h.data[0])});let i=0,d=120;return t.forEach(function(h){let f=h.start,b=f/d/l*60+i;d=h.data[0],i=b-f/d/l*60,h.data[1]=i}),console.debug("All tempo changes: ",t),c=120,a=0,s=0,u.track.forEach(function(h,f){a=0,s=0;let b=f+1;h.event.forEach(function($,k){a+=$.deltaTime;let E=t.step(a,!0)[0];E&&(c=E.data[0],s=E.data[1]);let m={type:$.type,data:$.data,track:b,part:0};$.type>14?m.meta=$.metaType:m.part=$.channel,e.push(new Yt(a/c/l*60+s,m))})}),e.fresh(),self.midiEvents=e,console.debug(`Parsed a type ${u.formatType} MIDI sequence.`),e};wt.default.customInterpreter=Lt;var Ke,Ue,Le,Be,rt,xe,ze,_,Ne,ye,He,Zt,ua=(Zt=class extends at{constructor(e,o=.5,l=.5){super();M(this,"device");w(this,Ke,void 0);w(this,Ue,"");w(this,Le,[]);w(this,Be,new Uint8ClampedArray(128));w(this,rt,new Uint8ClampedArray(128));w(this,xe,.5);w(this,ze,120);w(this,_,4);w(this,Ne,4);w(this,ye,0);w(this,He,0);M(this,"smoothingAtk",0);M(this,"smoothingDcy",0);let c=this;this.smoothingAtk=o,this.smoothingDcy=l,this.device=e,this.addEventListener("meta",function(t){var a;(a=t==null?void 0:t.data)==null||a.forEach(function(s){(r(c,Le)[s.meta]||console.debug).call(c,s.meta,s.data)})}),this.device.addEventListener("mode",function(t){c.dispatchEvent("mode",t.data)}),this.device.addEventListener("channelactive",function(t){c.dispatchEvent("channelactive",t.data)}),this.device.addEventListener("channelmin",function(t){c.dispatchEvent("channelmin",t.data)}),this.device.addEventListener("channelmax",function(t){c.dispatchEvent("channelmax",t.data)}),this.device.addEventListener("channelreset",function(t){c.dispatchEvent("channelreset")}),this.device.addEventListener("screen",function(t){c.dispatchEvent("screen",t.data)}),r(this,Le)[3]=function(t,a){var s;((s=r(c,Ue))==null?void 0:s.length)<1&&v(c,Ue,a)},r(this,Le)[81]=function(t,a){let s=c.noteProgress,n=r(c,xe)||.5;v(c,ze,6e7/a),v(c,xe,a/1e6),v(c,ye,r(c,ye)+(s*(n/r(c,xe))-s))},r(this,Le)[88]=function(t,a){let s=c.noteProgress,n=c.noteOverall,i=c.noteBar,d=c.noteBeat,h=r(c,_),f=r(c,Ne);v(c,_,a[0]),v(c,Ne,1<<a[1]);let b=24*(32/a[3])/a[2];if(h!=r(c,_)){let $=i;v(c,ye,r(c,ye)-$*(r(c,_)-h)),d+1>=h&&(h<r(c,_)?v(c,ye,r(c,ye)-Math.ceil(r(c,_)-d-1)):v(c,ye,r(c,ye)+r(c,_)))}}}reset(){var e;this.dispatchEvent("reset"),(e=r(this,Ke))==null||e.resetIndex(),this.device.init(),v(this,Ue,""),v(this,xe,.5),v(this,ze,120),v(this,_,4),v(this,Ne,4),v(this,ye,0),v(this,He,0)}async loadFile(e){v(this,Ke,Wt(wt.default.parse(new Uint8Array(await e.arrayBuffer()))))}switchMode(e,o=!1){this.device.switchMode(e,o)}getMode(){return this.device.getMode()}getVoice(){return this.device.getVoice(...arguments)}getChVoice(e){return this.device.getChVoice(e)}get noteProgress(){return r(this,He)/r(this,xe)}get noteOverall(){return this.noteProgress-r(this,ye)}get noteBar(){return Math.floor(this.noteOverall/r(this,_))}get noteBeat(){let e=this.noteOverall%r(this,_);return e<0&&(e+=r(this,_)),e}getTimeSig(){return[r(this,_),r(this,Ne)]}getTempo(){return r(this,ze)}sendCmd(e){this.device.runJson(e)}render(e){var E;e>r(this,He)&&v(this,He,e);let o=((E=r(this,Ke))==null?void 0:E.step(e))||[],l=0,c=new Set,t=this,a=[];this.device.getStrength().forEach((m,x)=>{r(this,rt)[x]=m}),t.device.newStrength(),o.forEach(function(m){let x=m.data;x.type==9&&(x.data[1]>0?c.add(x.part*128+x.data[0]):c.has(x.part*128+x.data[0])&&l++),m.data.type==8&&c.has(x.part*128+x.data[0])&&l++;let P=t.device.runJson(x);switch(P==null?void 0:P.reply){case"meta":{a.push(P);break}}P!=null&&P.reply&&delete P.reply}),(a==null?void 0:a.length)>0&&this.dispatchEvent("meta",a);let s=this.device.getActive(),n=[],i=t.device.getPitch(),d=t.device.getCcAll(),h=t.device.getProgram(),f=t.device.getChType(),b=this.device.getStrength();b.forEach(function(m,x,P){P[x]=Math.max(r(t,rt)[x],m);let F=P[x]-r(t,Be)[x],te=g.length*x;if(F>=0){let nt=4*.25**(d[te+g[73]]/64);r(t,Be)[x]+=Math.ceil(F-F*t.smoothingAtk**nt)}else{let nt=4*.25**(d[te+g[72]]/64);r(t,Be)[x]+=Math.floor(F-F*t.smoothingDcy**nt)}});let $=0;return s.forEach(function(m,x){m&&(n[x]=t.device.getVel(x),$+=n[x].size)}),{extraPoly:l,curPoly:$,chInUse:s,chKeyPr:n,chPitch:i,chProgr:h,chContr:d,chType:f,eventCount:o.length,title:r(this,Ue),bitmap:this.device.getBitmap(),letter:this.device.getLetter(),texts:this.device.getTexts(),master:this.device.getMaster(),mode:this.device.getMode(),strength:r(this,Be).slice(),velo:b,rpn:this.device.getRpn(),tSig:this.getTimeSig(),tempo:this.getTempo(),noteBar:this.noteBar,noteBeat:this.noteBeat,ace:this.device.getAce()}}},Ke=new WeakMap,Ue=new WeakMap,Le=new WeakMap,Be=new WeakMap,rt=new WeakMap,xe=new WeakMap,ze=new WeakMap,_=new WeakMap,Ne=new WeakMap,ye=new WeakMap,He=new WeakMap,Zt);export{ua as RootDisplay,g as ccToPos,bt as dnToPos};
