var Jt=Object.create;var ot=Object.defineProperty;var er=Object.getOwnPropertyDescriptor;var tr=Object.getOwnPropertyNames;var rr=Object.getPrototypeOf,ar=Object.prototype.hasOwnProperty;var sr=(f,e,o)=>e in f?ot(f,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):f[e]=o;var mt=(f,e)=>()=>(f&&(e=f(f=0)),e);var ir=(f,e)=>()=>(e||f((e={exports:{}}).exports,e),e.exports);var nr=(f,e,o,c)=>{if(e&&typeof e=="object"||typeof e=="function")for(let t of tr(e))!ar.call(f,t)&&t!==o&&ot(f,t,{get:()=>e[t],enumerable:!(c=er(e,t))||c.enumerable});return f};var or=(f,e,o)=>(o=f!=null?Jt(rr(f)):{},nr(e||!f||!f.__esModule?ot(o,"default",{value:f,enumerable:!0}):o,f));var M=(f,e,o)=>(sr(f,typeof e!="symbol"?e+"":e,o),o),Et=(f,e,o)=>{if(!e.has(f))throw TypeError("Cannot "+o)};var r=(f,e,o)=>(Et(f,e,"read from private field"),o?o.call(f):e.get(f)),v=(f,e,o)=>{if(e.has(f))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(f):e.set(f,o)},$=(f,e,o,c)=>(Et(f,e,"write to private field"),c?c.call(f,o):e.set(f,o),o);var kt=mt(()=>{"use strict";O();(function(){var f=function(s,i,h){var d,l;if(self.MessageEvent)switch(s){case"message":{l=new MessageEvent(s,{data:i,ports:h==null?void 0:h.ports}),Object.defineProperty(l,"source",{value:h==null?void 0:h.source});break}default:l=new Event(s)}else l=document.createEvent("Event"),l.initEvent(s,!1,!1),h&&s=="message"&&(l.data=i,h.source&&Object.defineProperty(l,"source",{value:h.source}),(d=h.ports)!=null&&d.length&&Object.defineProperty(l,"ports",{value:h.ports}));return l};self.BroadcastChannel?console.info("[Snowy] Snowy is disabled."):(console.info("[Snowy] Snowy is enabled. Path: ".concat(self.SNOWY_PATH||"/snowy.js")),o=[],c={},t=function(s){var i,h=this;if((this==null?void 0:this.constructor)!=t)throw new TypeError("Illegal constructor");o.push(this),(i=c[s])!=null&&i.constructor||(c[s]=[]),c[s].push(this);var d=Math.floor(Math.random()*281474976710656),l=[],u=0,b=[],w=!0,S=!1;Object.defineProperty(this,"id",{get:function(){return d}}),Object.defineProperty(this,"name",{value:s}),this.close=function(){var m,k=o.indexOf(h);k>-1?(e.postMessage({t:"d",c:s,i:d}),o.splice(k,1),(m=c[s])!=null&&m.constructor&&(k=c[s].indexOf(h),k>-1&&c[s].splice(k,1)),c[s].length||delete c[s],console.debug("[Snowy] BroadcastChannel closed."),S=!0):console.debug("[Snowy] BroadcastChannel already closed.")},this.postMessage=function(m){if(e){if(S)throw new Error("Channel already closed");e.postMessage({t:"m",c:s,i:d,m:u,d:m}),u++,u>4294967295&&(u=0)}else b.push(m),console.debug("[Snowy] Message is cached.")},this.flush=function(){if(e){if(w){for(e.postMessage({t:"r",c:s,i:d}),console.debug("[Snowy] ".concat(b.length," message(s) in cache."));b.length;){var m=b.shift();h.postMessage(m)}w=!1,console.debug("[Snowy] All cached messages are flushed away.")}}else throw new Error("Tried to flush when the ports are not ready")},this.receiveMessage=function(m){m.c==s?m.i!=d&&h.dispatchEvent(f("message",m.d,{source:h})):console.debug("[Snowy] Channel ID mismatch. Instance ".concat(d," receives from ").concat(s,", not ").concat(m.c,"."))};var x={};this.dispatchEvent=function(m){var k,P;if(Object.defineProperty(m,"target",{value:h}),Object.defineProperty(m,"currentTarget",{value:h}),(k=x[m.type])!=null&&k.length)for(var F=x[m.type],te=0;te<F.length;te++)((P=F[te])==null?void 0:P.constructor)==Function&&F[te].call(h,m);h["on".concat(m.type)]&&h["on".concat(m.type)].constructor==Function&&h["on".concat(m.type)].call(h,m)},this.addEventListener=function(m,k){var P;(P=x[m])!=null&&P.constructor||(x[m]=[]);var F=x[m].indexOf(k);F==-1&&x[m].push(k)},this.removeEventListener=function(m,k){var P,F;if((P=x[m])!=null&&P.length){var te=x[m].indexOf(k);te>-1&&x[m].splice(te,1)}!((F=x[m])!=null&&F.length)&&x[m].constructor&&delete x[m]}},self.BroadcastChannel=t,a=function(){if(e){e.addEventListener("message",function(i){var h=i.data,d=!1;switch(h.t){case"k":{d=!1,e.postMessage({t:"k"});break}case"m":{var l=c[h.c];if(l!=null&&l.length)for(var u=0;u<l.length;u++)l[u].receiveMessage(h);break}case"c":{for(var b=[],w=0;w<o.length;w++){var S=o[w].name;b.indexOf(S)<0&&b.push(S)}e.postMessage({t:"k",c:b});break}default:d=!0}d&&console.info("ReceiveBroadcast",h)});for(var s=0;s<o.length;s++)o[s].flush()}else throw new Error("Message port isn't yet ready");console.info("[Snowy] Snowy is active.")},n=function(){if(!e){var s=new SharedWorker(self.SNOWY_PATH||"/snowy.js");s.port.start();var i=function(h){h.data.t=="swc"&&(s.port.removeEventListener("message",i),e=s.port,e.postMessage({t:"k"}),a())};s.port.addEventListener("message",i)}},n());var e,o,c,t,a,n})()});var O=mt(()=>{"use strict";kt();{let f=function(e,o){let c=new FileReader;return new Promise((t,a)=>{switch(c.addEventListener("abort",()=>{a(new Error("Blob read aborted"))}),c.addEventListener("error",n=>{a(c.error||n.data||new Error("Blob read error"))}),c.addEventListener("load",()=>{t(c.result)}),o.toLowerCase()){case"arraybuffer":case"buffer":{c.readAsArrayBuffer(e);break}case"string":case"text":{c.readAsText(e);break}default:a(new Error(`Unknown target ${o}`))}})};Blob.prototype.arrayBuffer=Blob.prototype.arrayBuffer||function(){return f(this,"buffer")},Blob.prototype.text=Blob.prototype.text||function(){return f(this,"text")}}String.prototype.replaceAll=String.prototype.replaceAll||function(f,e){let o=0,c=16,t=this,a=[];for(;o<c&&t.lastIndexOf(f)>-1;){let n=t.lastIndexOf(f);a.unshift(t.slice(n+f.length)),t=t.slice(0,n),n==0&&a.unshift(""),o++}return t.length&&a.unshift(t),a.join(e)||""}});var zt=ir((Wr,yt)=>{O();(function(){"use strict";let f={fatal:!0},e=[new TextDecoder("iso-8859-15",f),new TextDecoder("sjis",f),new TextDecoder("euc-jp",f),new TextDecoder("utf-8",f),new TextDecoder("utf-16",f),new TextDecoder("ascii")],o={debug:!1,parse:function(c,t){if(c instanceof Uint8Array)return o.Uint8(c);if(typeof c=="string")return o.Base64(c);if(c instanceof HTMLElement&&c.type==="file")return o.addListener(c,t);throw new Error("MidiParser.parse() : Invalid input provided")},addListener:function(c,t){if(!File||!FileReader)throw new Error("The File|FileReader APIs are not supported in this browser. Use instead MidiParser.Base64() or MidiParser.Uint8()");if(c===void 0||!(c instanceof HTMLElement)||c.tagName!=="INPUT"||c.type.toLowerCase()!=="file")return console.warn("MidiParser.addListener() : Provided element is not a valid FILE INPUT element"),!1;t=t||function(){},c.addEventListener("change",function(a){if(!a.target.files.length)return!1;console.log("MidiParser.addListener() : File detected in INPUT ELEMENT processing data..");let n=new FileReader;n.readAsArrayBuffer(a.target.files[0]),n.onload=function(s){t(o.Uint8(new Uint8Array(s.target.result)))}})},Base64:function(c){let t=function(s){var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(s=s.replace(/^.*?base64,/,""),s=String(s).replace(/[\t\n\f\r ]+/g,""),!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(s))throw new TypeError("Failed to execute _atob() : The string to be decoded is not correctly encoded.");s+="==".slice(2-(3&s.length));let h,d="",l,u,b=0;for(;b<s.length;)h=i.indexOf(s.charAt(b++))<<18|i.indexOf(s.charAt(b++))<<12|(l=i.indexOf(s.charAt(b++)))<<6|(u=i.indexOf(s.charAt(b++))),d+=l===64?String.fromCharCode(h>>16&255):u===64?String.fromCharCode(h>>16&255,h>>8&255):String.fromCharCode(h>>16&255,h>>8&255,255&h);return d}(c=String(c));var a=t.length;let n=new Uint8Array(new ArrayBuffer(a));for(let s=0;s<a;s++)n[s]=t.charCodeAt(s);return o.Uint8(n)},Uint8:function(n){let t={data:null,pointer:0,movePointer:function(l){return this.pointer+=l,this.pointer},readInt:function(l){if((l=Math.min(l,this.data.byteLength-this.pointer))<1)return-1;let u=0;if(1<l)for(let b=1;b<=l-1;b++)u+=this.data.getUint8(this.pointer)*Math.pow(256,l-b),this.pointer++;return u+=this.data.getUint8(this.pointer),this.pointer++,u},readStr:function(l){let u=new Uint8Array(l),b=!1,w;u.forEach((S,x)=>{u[x]=this.readInt(1)});for(let S=0;S<e.length;S++)if(!b)try{if(w=e[S].decode(u),S==0)for(let x=0;x<w.length;x++){let m=w.charCodeAt(x);if(m>191||m>127&&m<160)throw new RangeError(`Invalid code point: ${m}`)}b=!0,console.debug(`String byte sequence in ${e[S].encoding}`)}catch(x){console.debug(`SMF string ${x}`)}return w||"String byte sequence read failed."},backOne:function(){this.pointer--},readIntVLV:function(){let l=0;if(this.pointer>=this.data.byteLength)return-1;if(this.data.getUint8(this.pointer)<128)l=this.readInt(1);else{let b=[];for(;128<=this.data.getUint8(this.pointer);)b.push(this.readInt(1)-128);var u=this.readInt(1);for(let w=1;w<=b.length;w++)l+=b[b.length-w]*Math.pow(128,w);l+=u}return l}};if(t.data=new DataView(n.buffer,n.byteOffset,n.byteLength),t.readInt(4)!==1297377380)return console.warn("Header validation failed (not MIDI standard or file corrupt.)"),!1;t.readInt(4);let a={};a.formatType=t.readInt(2),a.tracks=t.readInt(2),a.track=[];var n=t.readInt(1),s=t.readInt(1);128<=n?(a.timeDivision=[],a.timeDivision[0]=n-128,a.timeDivision[1]=s):a.timeDivision=256*n+s;for(let l=1;l<=a.tracks;l++){a.track[l-1]={event:[]};var i,h=t.readInt(4);if(h===-1)break;if(h!==1297379947)return!1;t.readInt(4);let u=0,b=!1,w,S;for(;!b&&(u++,a.track[l-1].event[u-1]={},a.track[l-1].event[u-1].deltaTime=t.readIntVLV(),(w=t.readInt(1))!==-1);)if(128<=w?S=w:(w=S,t.movePointer(-1)),w===255){a.track[l-1].event[u-1].type=255,a.track[l-1].event[u-1].metaType=t.readInt(1);var d=t.readIntVLV();switch(a.track[l-1].event[u-1].metaType){case 47:case-1:b=!0;break;case 1:case 2:case 3:case 4:case 5:case 7:case 6:a.track[l-1].event[u-1].data=t.readStr(d);break;case 33:case 89:case 81:a.track[l-1].event[u-1].data=t.readInt(d);break;case 84:a.track[l-1].event[u-1].data=[],a.track[l-1].event[u-1].data[0]=t.readInt(1),a.track[l-1].event[u-1].data[1]=t.readInt(1),a.track[l-1].event[u-1].data[2]=t.readInt(1),a.track[l-1].event[u-1].data[3]=t.readInt(1),a.track[l-1].event[u-1].data[4]=t.readInt(1);break;case 88:a.track[l-1].event[u-1].data=[],a.track[l-1].event[u-1].data[0]=t.readInt(1),a.track[l-1].event[u-1].data[1]=t.readInt(1),a.track[l-1].event[u-1].data[2]=t.readInt(1),a.track[l-1].event[u-1].data[3]=t.readInt(1);break;default:this.customInterpreter!==null&&(a.track[l-1].event[u-1].data=this.customInterpreter(a.track[l-1].event[u-1].metaType,t,d)),this.customInterpreter!==null&&a.track[l-1].event[u-1].data!==!1||(t.readInt(d),a.track[l-1].event[u-1].data=t.readInt(d),this.debug&&console.info("Unimplemented 0xFF meta event! data block readed as Integer"))}}else switch((w=w.toString(16).split(""))[1]||w.unshift("0"),a.track[l-1].event[u-1].type=parseInt(w[0],16),a.track[l-1].event[u-1].channel=parseInt(w[1],16),a.track[l-1].event[u-1].type){case 15:this.customInterpreter!==null&&(a.track[l-1].event[u-1].data=this.customInterpreter(a.track[l-1].event[u-1].type,t,!1)),this.customInterpreter!==null&&a.track[l-1].event[u-1].data!==!1||(i=t.readIntVLV(),a.track[l-1].event[u-1].data=t.readInt(i),this.debug&&console.info("Unimplemented 0xF exclusive events! data block readed as Integer"));break;case 10:case 11:case 14:case 8:case 9:a.track[l-1].event[u-1].data=[],a.track[l-1].event[u-1].data[0]=t.readInt(1),a.track[l-1].event[u-1].data[1]=t.readInt(1);break;case 12:case 13:a.track[l-1].event[u-1].data=t.readInt(1);break;case-1:b=!0;break;default:if(this.customInterpreter!==null&&(a.track[l-1].event[u-1].data=this.customInterpreter(a.track[l-1].event[u-1].metaType,t,!1)),this.customInterpreter===null||a.track[l-1].event[u-1].data===!1)return console.log("Unknown EVENT detected... reading cancelled!"),!1}}return a},customInterpreter:null};if(typeof yt<"u")yt.exports=o;else{let c=typeof window=="object"&&window.self===window&&window||typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;c.MidiParser=o}})()});O();O();var V,St,at=(St=class{constructor(){v(this,V,{})}addEventListener(f,e){r(this,V)[f]||(r(this,V)[f]=[]),r(this,V)[f].unshift(e)}removeEventListener(f,e){if(r(this,V)[f]){let o=r(this,V)[f].indexOf(e);o>-1&&r(this,V)[f].splice(o,1),r(this,V)[f].length<1&&delete r(this,V)[f]}}dispatchEvent(f,e){var t;let o=new Event(f),c=this;o.data=e,((t=r(this,V)[f])==null?void 0:t.length)>0&&r(this,V)[f].forEach(function(a){try{a==null||a.call(c,o)}catch(n){console.error(n)}}),this[`on${f}`]&&this[`on${f}`](o)}},V=new WeakMap,St);O();O();var xt=function(f,e){let o=Math.min(f.length,e.length),c=f.slice(0,o),t=e.slice(0,o),a=0,n=0;for(;n<o&&a==0;)a=Math.sign(c[n]-t[n]),n++;return a},re=function(){this.pool=[],this.point=function(f,e=!1){if(this.pool.length>0){let o=this.pool.length,c=1<<Math.floor(Math.log2(o)),t=c,a=64;for(;c>=1&&a>=0;){if(a<=0)throw new Error("TTL reached.");if(t==o)t-=c;else{let s=xt(f,this.pool[t]);switch(s){case 0:{a=0;break}case 1:{t+c<=o&&(t+=c);break}case-1:{t!=0&&(t-=c);break}default:console.warn(`Unexpected result ${s}.`)}}c=c>>1,a--}let n=!0;if(t>=this.pool.length)n=!1;else{let s=this;this.pool[t].forEach(function(i,h,d){n&&i!=f[h]&&(n=!1)}),!n&&xt(f,this.pool[t])>0&&t++}return n||e?t:-1}else return e?0:-1},this.add=function(f,e){return f.data=e,this.pool.splice(this.point(f,!0),0,f),this},this.default=function(f){console.warn(`No match for "${f}". Default action not defined.`)},this.get=function(f){let e=this.point(f);if(e>-1)return this.pool[e].data;this.default(f)},this.run=function(f,...e){let o=this.point(f);o>-1?this.pool[o].data(f.slice(this.pool[o].length),...e):this.default(f,...e)}};O();var cr=["MSB","PRG","LSB"];var ct=function(f){let e=Math.floor(f/10),o=f%10;return`${e.toString(16)}${o}`},X,Mt,lt=(Mt=class{constructor(...f){v(this,X,void 0);M(this,"strictMode",!1);this.loadFiles(...f)}get(f=0,e=0,o=0,c){let t,a=Array.from(arguments);switch(c){case"xg":{f==32?a[2]+=4:f==33||f==35||f==36?a[2]+=5:f==79?a[0]=95:f==80?a[0]=96:f==81?a[0]=97:f==82?a[0]=98:f==83?a[0]=99:f==84&&(a[0]=100);break}case"gs":{f==0&&o<5?a[2]=0:f>125&&o<5&&o!=2&&(a[2]=f,a[0]=0);break}case"sg":{f==8&&o==0&&(a[2]=5);break}}let n=" ",s="M",i=!1,h=0;switch(a[0]){case 0:{a[2]==127?s="MT-a":a[2]==126?s="MT-b":a[2]==7?s="GM-k":a[2]==5?s="SG-a":a[2]==4?s="SP-l":a[2]==0||c=="gs"&&a[2]<5?s="GM-a":(s="y",i=!0);break}case 8:{c=="sg"?s="GM-s":s="r:";break}case 48:{s=`yM${(a[2]>>3).toString().padStart(2,"0")}`,i=!0;break}case 56:{s="GM-b";break}case 61:case 120:{s="rDrm";break}case 62:{s="kDrm";break}case 63:{let l=a[2];s=l<10?"kP:":"kC:",s+=l%10;break}case 64:{s="ySFX";break}case 67:{s="DX:S";break}case 80:case 81:case 82:case 83:{s=`Prg${"UABC"[a[0]-80]}`;break}case 88:case 89:case 90:case 91:{s=`Cmb${"UABC"[a[0]-88]}`;break}case 95:{s=`${["DR","PC"][a[2]]}-d`;break}case 96:{s=a[2]==106?"AP-a":"PF",a[2]>63&&(h=63),i=!0;break}case 97:{s="VL:",i=!0,h=112;break}case 98:{s="SG-a";break}case 99:{s="DX",a[2]>63&&(h=63),i=!0;break}case 100:{s="AN",a[2]>63&&(h=63),i=!0;break}case 121:{s=`GM-${a[2]?"":"a"}`,i=!0;break}case 122:{s="lDrm";break}case 126:{s="yDrS";break}case 127:{a[2]==127?s="rDrm":s="yDrm";break}default:a[0]<48?s="r:":s="M"}for(s.length<4&&(s+=`${(i?o:f)-h}`.padStart(4-s.length,"0")),c=="xg"&&f==16&&(t=`Voice${(o*128+e+1).toString().padStart(3,"0")}`,n=" ");!((t==null?void 0:t.length)>=0);)t=r(this,X)[a[1]||0][(a[0]<<7)+a[2]],t||(this.strictMode?(t="",n="?"):r(this,X)[a[1]||0][a[0]<<7]?a[0]==0?(a[2]=0,n="^"):a[2]<1?(a[0]=0,n="*"):(a[2]--,n="^"):f==48?(a[0]=0,a[2]=0,n="!"):f==62?(a[1]--,n=" ",a[1]<1&&!(t!=null&&t.length)&&(a[0]=0,n="!")):f<64?a[0]==0?(a[2]=0,n="^"):a[2]<1?(a[0]=0,n="*"):a[2]--:f==80?(t=`PrgU:${e.toString().padStart(3,"0")}`,n="!"):f==88?(t=`CmbU:${e.toString().padStart(3,"0")}`,n="!"):f==121?(t=`GM2Vox0${o}`,n="#"):f==122?(a[1]==32?a[1]==0:a[1]%=7,t=r(this,X)[a[1]||0][(a[0]<<7)+a[2]],t?n=" ":(t="",n="*")):a[1]==0?(t=`${f.toString().padStart(3,"0")} ${e.toString().padStart(3,"0")} ${o.toString().padStart(3,"0")}`,n="!"):a[0]==0?(a[2]=0,n="^"):a[2]>0?a[2]--:a[1]>0?(a[1]=0,n="!"):(a[0]=0,n="?"));(c=="gs"||c=="ns5r")&&n=="^"&&(n=" "),f==127&&n=="^"&&(n=" "),n!=" "&&self.debugMode&&(t="");let d="??";switch(a[0]){case 0:{a[2]==0?d="GM":a[2]==5||a[2]==7?d="KG":a[2]<120?d="XG":a[2]==127&&(d="MT");break}case 48:{d="MU";break}case 56:{d="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{d="AI";break}case 62:case 82:case 90:{d="XD";break}case 63:d="KR";case 64:case 126:{d="XG";break}case 67:case 99:{d="DX";break}case 81:{d="RW";break}case 95:{d=["DR","PC"][a[2]];break}case 96:{d=a[2]==106?"AP":"PF";break}case 97:{d="VL";break}case 98:{d="SG";break}case 100:{d="AN";break}case 120:{d="GS";break}case 121:{d=a[2]?"G2":"GM";break}case 122:{d="KG";break}case 127:{d=a[2]==127?"MT":e==0?"GM":"XG";break}default:a[0]<48&&(a[0]==16&&c=="xg"?d="XG":d="GS")}return{name:t||`${ct(f||0)} ${ct(e||0)} ${ct(o||0)}`,ending:n,sect:s,standard:d}}async load(f,e,o){let c=this,t=[],a=0,n=0;f.split(`
`).forEach(function(s,i){let h=s.split("	"),d=[];i==0?h.forEach(function(l,u){t[cr.indexOf(l)]=u}):h.forEach(async function(l,u){var b;u>2?(r(c,X)[d[t[1]]]=r(c,X)[d[t[1]]]||[],(!((b=r(c,X)[d[t[1]]][(d[t[0]]<<7)+d[t[2]]])!=null&&b.length)||e)&&(r(c,X)[d[t[1]]][(d[t[0]]<<7)+d[t[2]]]=h[3],a++),n++):d.push(parseInt(h[u]))})}),e||console.debug(`Map "${o||"(internal)"}": ${n} total, ${a} loaded.`)}clearRange(f){let e=f.prg!=null?f.prg.constructor==Array?f.prg:[f.prg,f.prg]:[0,127],o=f.msb!=null?f.msb.constructor==Array?f.msb:[f.msb,f.msb]:[0,127],c=f.lsb!=null?f.lsb.constructor==Array?f.lsb:[f.lsb,f.lsb]:[0,127];for(let t=o[0];t<=o[1];t++){let a=t<<7;for(let n=c[0];n<=c[1];n++){let s=a+n;for(let i=e[0];i<=e[1];i++)delete r(this,X)[i][s]}}}init(){$(this,X,[]);for(let f=0;f<128;f++)r(this,X).push([""])}async loadFiles(...f){this.init();let e=this;f.forEach(async function(o,c){try{await fetch(`./data/bank/${o}.tsv`).then(function(t){return t.text()}).then(t=>{e.load(t,!1,o)})}catch(t){console.error(`Failed loading "${o}.tsv".`)}})}},X=new WeakMap,Mt);O();var je=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),Qe=["melodic","drums","drum set 1","drum set 2","drum set 3","drum set 4","drum set 5","drum set 6","drum set 7","drum set 8"],lr=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],qe=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],Ct=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],Tt=function(f){let e=.1,o=-.3;return f>66?(e=5,o=315):f>56?(e=1,o=47):f>46&&(e=.5,o=18.5),e*f-o},Rt=function(f){return f>105?lr[f-106]:f>100?f*1.1-100:f/10},Ot=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),ht={};`hi*,
ka,か
ki,き
ku,く
ke,け
ko,こ
ky,き!
kw,くl
tsu,つ
ts,つl
sa,さ
si,すぃ
su,す
se,せ
so,そ
shi,し
sh,し!
ta,た
ti,てぃ
tu,とぅ
te,て
to,と
tchy,ち!
tchi,ち
na,な
ni,に
nu,ぬ
ne,ね
no,の
ny,に!
nn,ん
ha,は
hi,ひ
hu,ほぅ
he,へ
ho,ほ
hy,ひ!
fa,ふぁ
fi,ふぃ
fu,ふ
fe,ふぇ
fo,ふぉ
ma,ま
mi,み
mu,む
me,め
mo,も
my,み!
mm,
ra,ら
ri,り
ru,る
re,れ
ro,ろ
ry,り!
wa,わ
wi,うぃ
we,うぇ
wo,を
nga,ガ
ngi,ギ
ngu,グ
nge,ゲ
ngo,ゴ
ngy,ギ!
ng,
ga,が
gi,ぎ
gu,ぐ
ge,げ
go,ご
gy,ぎ!
gw,ぐl
za,ざ
zi,ずぃ
zu,ず
ze,ぜ
zo,ぞ
ja,じゃ
ji,じ
ju,じゅ
je,じぇ
jo,じょ
jy,じ!
da,だ
di,でぃ
du,どぅ
de,で
do,ど
dy,で!
ba,ば
bi,び
bu,ぶ
be,べ
bo,ぼ
by,び!
va,ゔぁ
vi,ゔぃ
vu,ゔ
ve,ゔぇ
vo,ゔぉ
pa,ぱ
pi,ぴ
pu,ぷ
pe,ペ
po,ぽ
py,ぴ!
!ya,ゃ
!yu,ゅ
!ye,ぇ
!yo,ょ
ya,や
yu,ゆ
ye,いぇ
yo,よ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
la,ぁ
li,ぃ
lu,ぅ
le,ぇ
lo,ぉ
a,あ
i,い
u,う
e,え
o,お
*,っ
~,
^,
_,`.split(`
`).forEach(f=>{let e=f.split(",");ht[e[0]]=e[1]});var At=function(f){let e=f;f[0]=="*"&&(e=e.slice(1)),["aa","ii","uu","ee","oo"].forEach(c=>{for(;e.indexOf(c)>-1;)e=e.replace(c,c[0])});for(let c in ht)e=e.replaceAll(c,ht[c]);e.indexOf("ん")==0&&e.length>1&&(e=e.slice(1));let o=e.indexOf("!");return o>-1&&e.length>1&&(e=e.slice(o+1)),e},It=function(f){return f?f<96?`cc${f}`:["aftertouch","velocity","pitch bend"][f-96]:"off"};O();var dt=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],Dt=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],Pt=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var hr={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},dr={66307:["drive"],66309:["vowel",f=>"aiueo"[f]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",f=>["off","LPF","HPF"][f]],94984:["noise type",f=>["white","pink"][f]],94987:["disc type",f=>["LP","SP","EP","RND"]],94990:["hum type",f=>`${f+5}0Hz`],94993:["M/S",f=>["mono","stereo"][f]]},ft=function(f){return hr[(f[0]-32<<8)+f[1]]||`0x${f[0].toString(16).padStart(2,"0")}${f[1].toString(16).padStart(2,"0")}`},Ut=function(f,e,o){let c=(f[0]-32<<16)+(f[1]<<8)+e,t=dr[c]||{},a=t[0];if(a!=null&&a.length)return a+=`: ${(t[1]||function(){})(o)||o}`,a},ut=[68,48,95,78,41,3,110,122,0];O();var K=function(f=64){return Math.round(2e3*Math.log10(f/64))/100},Lt=function(f,e,o){let c=[],t=o==!1?e.readIntVLV():o;f==0||f==127;for(let a=0;a<t;a++){let n=e.readInt(1);if(c.push(n),n!=247){if(n!=240){if(n>127)return console.debug(`Early termination: ${c}`),c.pop(),e.backOne(),e.backOne(),new Uint8Array(c)}}}return new Uint8Array(c)},Bt=function(f){let e=0;return f.forEach(o=>{e+=o,e=e&127}),~e+1&127},ae=function(f,e){let o=0,c=0;for(let t=0;t<f.length;t++){let a=t%8-1,n=(c>>a&1)<<7,s=f[t];s+=n,t%8!=0?(e(s,o,f),o++):c=f[t]}},Ye=function(f){let e=Math.floor(f*14.2);return e<128?e:0};var ye=["?","gm","gs","xg","g2","mt32","ns5r","ag10","x5d","05rw","krs","k11","sg"],Nt=[[0,0,0,0,121,0,0,56,82,81,63,0,0],[0,0,4,0,0,127,0,0,0,0,0,0,0]],Me=[120,127,120,127,120,127,61,62,62,62,120,122,122],fr=[0,3,81,84,88],Ht={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},pt={0:0,1:1,2:3,5:4},Gt=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],_t=[36,37],it=[20,21,22,23,24,25,26,28,29,30,31,36,37,64,65],We=[0,1,2,4,5,6,7,8,10,11,32,38,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,84,91,92,93,94,95,98,99,100,101,128,12,13,16,17,18,19],ur=[12,13,16,17,18,19],pr=[33,99,100,32,102,8,9,10],Ft=[0,16,25,40,32,64,26,48],C={};ye.forEach((f,e)=>{C[f]=e});var g={length:We.length};We.forEach((f,e)=>{g[f]=e});var bt={length:it.length};it.forEach((f,e)=>{bt[f]=e});var W=function(){return!!self.Bun||self.debugMode||!1},gr=function(f){let e=[],o=0;return f==null||f.forEach(function(c,t){c==247?e.push(f.subarray(o,t)):c==240&&(o=t+1)}),e.length||e.push(f.subarray(0)),W()&&console.debug(e),e},Vt=function(f,e="",o="",c=2){return f?`${e}${f.toString().padStart(c,"0")}${o}`:""},y={ch:128,cc:We.length,nn:128,pl:512,tr:256,cmt:14,rpn:6,ace:8,drm:8,dpn:it.length,dnc:128,efx:7},I,z,se,he,Y,le,Kt,j,H,R,p,de,A,U,ie,L,N,$e,ne,Ce,E,Ue,Ze,oe,ve,Z,Le,we,Q,me,J,q,fe,Be,Ne,ce,Ee,He,ee,D,Je,gt,T,ue,ke,G,Te,B,et,st,Ge,_e,pe,ge,Se,Fe,Ve,Xe,Xt,zr=(Xt=class extends at{constructor(){super();v(this,Y);M(this,"NOTE_IDLE",0);M(this,"NOTE_ATTACK",1);M(this,"NOTE_DECAY",2);M(this,"NOTE_SUSTAIN",3);M(this,"NOTE_HELD",4);M(this,"NOTE_RELEASE",5);M(this,"NOTE_SOSTENUTO_ATTACK",8);M(this,"NOTE_SOSTENUTO_DECAY",9);M(this,"NOTE_SOSTENUTO_SUSTAIN",10);M(this,"NOTE_SOSTENUTO_HELD",11);M(this,"CH_MELODIC",0);M(this,"CH_DRUMS",1);M(this,"CH_DRUM1",2);M(this,"CH_DRUM2",3);M(this,"CH_DRUM3",4);M(this,"CH_DRUM4",5);M(this,"CH_DRUM5",6);M(this,"CH_DRUM6",7);M(this,"CH_DRUM7",8);M(this,"CH_DRUM8",9);v(this,I,0);v(this,z,0);v(this,se,0);v(this,he,new Array(11));v(this,j,new Uint8Array(y.ch));v(this,H,new Uint8Array(y.ch));v(this,R,new Uint8Array(y.ch));v(this,p,new Uint8Array(y.ch*y.cc));v(this,de,new Uint8Array(y.ace));v(this,A,new Uint8Array(y.ch));v(this,U,new Uint8Array(y.ch*y.nn));v(this,ie,new Uint8Array(y.ch));v(this,L,new Uint16Array(y.pl));v(this,N,new Uint8Array(y.pl));v(this,$e,new Int16Array(y.ch));v(this,ne,new Uint8Array(y.ch));v(this,Ce,0);v(this,E,new Uint8Array(y.ch*y.rpn));v(this,Ue,new Int8Array(y.ch*_t.length));v(this,Ze,new Uint8Array(y.drm*y.dpn*y.dnc));v(this,oe,new Uint8Array(y.ch));v(this,ve,new Uint8Array(128));v(this,Z,new Uint8Array(y.cmt*8));v(this,Le,new Uint8Array(1024));v(this,we,new Uint8Array(y.cmt*64));v(this,Q,new Uint8Array(y.efx*3));v(this,me,0);v(this,J,0);v(this,q,100);v(this,fe,0);v(this,Be,500);v(this,Ne,0);v(this,ce,"");v(this,Ee,0);v(this,He,0);v(this,ee,!0);v(this,D,!1);v(this,Je,void 0);v(this,gt,new Uint8Array(2));v(this,T,[]);v(this,ue,new Uint8Array(y.ch));v(this,ke,new Uint8Array(y.tr));M(this,"baseBank",new lt("gm","gm2","xg","gs","ns5r","gmega","plg-150vl","plg-150pf","plg-150dx","plg-150an","plg-150dr","plg-100sg","kross"));M(this,"userBank",new lt("gm"));M(this,"initOnReset",!1);M(this,"aiEfxName","");v(this,G,[]);v(this,Te,void 0);v(this,B,{nOff:(e,o)=>{let c=e*128+o,t=r(this,L).lastIndexOf(c);t>-1&&(r(this,p)[y.cc*e+g[64]]>63?(r(this,N)[t]=this.NOTE_HELD,this.dispatchEvent("note",{part:e,note:o,velo:r(this,U)[c],state:this.NOTE_HELD})):r(this,p)[y.cc*e+g[66]]>63&&r(this,N)[t]==this.NOTE_SOSTENUTO_SUSTAIN?(r(this,N)[t]=this.NOTE_SOSTENUTO_HELD,this.dispatchEvent("note",{part:e,note:o,velo:r(this,U)[c],state:this.NOTE_SOSTENUTO_HELD})):(r(this,L)[t]=0,r(this,U)[c]=0,r(this,N)[t]=this.NOTE_IDLE,this.dispatchEvent("note",{part:e,note:o,velo:0,state:this.NOTE_IDLE})))},nOn:(e,o,c)=>{let t=e*128+o,a=0;for(r(this,ie)[e]&&r(this,B).ano(e);r(this,N)[a]>0&&r(this,L)[a]!=t;)a++;a<y.pl?(r(this,L)[a]=t,r(this,U)[t]=c,r(this,N)[a]=this.NOTE_SUSTAIN,r(this,ne)[e]<c&&(r(this,ne)[e]=c),this.dispatchEvent("note",{part:e,note:o,velo:c,state:this.NOTE_SUSTAIN})):console.error("Polyphony exceeded.")},nAt:(e,o,c)=>{},cAt:(e,o)=>{},hoOf:e=>{r(this,N).forEach((o,c)=>{if(o==this.NOTE_HELD){let t=r(this,L)[c],a=t>>7;e==a&&(r(this,N)[c]=this.NOTE_IDLE,r(this,L)[c]=0,r(this,U)[t]=0,this.dispatchEvent("note",{part:e,note:t&127,velo:0,state:this.NOTE_IDLE}))}})},soOn:e=>{r(this,N).forEach((o,c)=>{let t;switch(o){case this.NOTE_ATTACK:{t=this.NOTE_SOSTENUTO_ATTACK;break}case this.NOTE_DECAY:{t=this.NOTE_SOSTENUTO_DECAY;break}case this.NOTE_SUSTAIN:{t=this.NOTE_SOSTENUTO_SUSTAIN;break}}if(t){r(this,N)[c]=t;let a=r(this,L)[c];this.dispatchEvent("note",{part:e,note:a&127,velo:r(this,U)[a],state:t})}})},soOf:e=>{r(this,N).forEach((o,c)=>{if(o==this.NOTE_SOSTENUTO_HELD){let t=r(this,L)[c],a=t>>7;e==a&&(r(this,N)[c]=this.NOTE_IDLE,r(this,L)[c]=0,r(this,U)[t]=0,this.dispatchEvent("note",{part:e,note:t&127,velo:0,state:this.NOTE_IDLE}))}})},ano:e=>{r(this,L).forEach((o,c,t)=>{let a=o>>7,n=o&127;o==0&&r(this,U)[0]==0||a==e&&r(this,B).nOff(a,n)})}});v(this,et,{8:function(e){let o=e.channel,c=e.data[0];r(this,B).nOff(o,c)},9:function(e){let o=e.channel;r(this,j)[o]=1;let c=e.data[0],t=e.data[1];t>0?r(this,B).nOn(o,c,t):r(this,B).nOff(o,c)},10:function(e){let o=e.channel,c=o*128+e.data[0];r(this,L).indexOf(c)>-1&&(r(this,U)[c]=data[1],this.dispatchEvent("note",{part:o,note:e.data[0],velo:e.data[1],state:this.NOTE_SUSTAIN}))},11:function(e){let o=e.channel;r(this,j)[o]=1;let c=o*y.cc;switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{r(this,B).ano(o),r(this,$e)[o]=0;let t=o*y.cc;r(this,p)[t+g[1]]=0,r(this,p)[t+g[5]]=0,r(this,p)[t+g[64]]=0,r(this,p)[t+g[65]]=0,r(this,p)[t+g[66]]=0,r(this,p)[t+g[67]]=0,r(this,p)[t+g[11]]=127,r(this,p)[t+g[101]]=127,r(this,p)[t+g[100]]=127,r(this,p)[t+g[99]]=127,r(this,p)[t+g[98]]=127;return}case 123:{r(this,B).ano(o);return}case 124:{r(this,B).ano(o);return}case 125:{r(this,B).ano(o);return}case 126:{r(this,ie)[o]=1,r(this,B).ano(o);return}case 127:{r(this,ie)[o]=0,r(this,B).ano(o);return}}if(g[e.data[0]]==null)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(ur.indexOf(e.data[0])>-1&&this.allocateAce(e.data[0]),e.data[0]){case 0:{if(W()&&console.debug(`${ye[r(this,I)]}, CH${o+1}: ${e.data[1]}`),r(this,I)==0)e.data[1]<48?(r(this,R)[o]>0&&(e.data[1]=r(this,p)[c],e.data[1]=120,console.debug(`Forced channel ${o+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),this.switchMode("gs"))):e.data[1]==62?this.switchMode("x5d"):e.data[1]==63?this.switchMode("krs"):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg");else if(r(this,I)==C.gs)e.data[1]<56&&r(this,R)[o]>0&&(e.data[1]=r(this,p)[c],e.data[1]=120,console.debug(`Forced channel ${o+1} to stay drums.`));else if(r(this,I)==C.gm)e.data[1]<48?r(this,R)[o]>0&&(e.data[1]=120,this.switchMode("gs",!0),console.debug(`Forced channel ${o+1} to stay drums.`)):(e.data[1]==64||e.data[1]==127)&&this.switchMode("xg",!0);else if(r(this,I)==C.x5d){if(e.data[1]>0&&e.data[1]<8)this.switchMode("05rw",!0);else if(e.data[1]==56){let t=0;for(let a=0;a<16;a++){let n=r(this,p)[y.cc*a];(n==56||n==62)&&t++}t>14&&this.switchMode("ag10",!0)}}switch(r(this,I)){case C.xg:{[126,127].indexOf(e.data[1])>-1?r(this,R)[o]==0&&(this.setChType(o,this.CH_DRUM2),console.debug(`CH${o+1} set to drums by MSB.`)):r(this,R)[o]>0&&(this.setChType(o,this.CH_MELODIC),console.debug(`CH${o+1} set to melodic by MSB.`));break}case C["05rw"]:case C.x5d:case C.ns5r:{[61,62,126,127].indexOf(e.data[1])>-1?r(this,R)[o]==0&&(this.setChType(o,this.CH_DRUM2),console.debug(`CH${o+1} set to drums by MSB.`)):r(this,R)[o]>0&&(this.setChType(o,this.CH_MELODIC),console.debug(`CH${o+1} set to melodic by MSB.`));break}case C.g2:{e.data[1]==120?r(this,R)[o]==0&&(this.setChType(o,this.CH_DRUMS),console.debug(`CH${o+1} set to drums by MSB.`)):r(this,R)[o]>0&&(this.setChType(o,this.CH_MELODIC),console.debug(`CH${o+1} set to melodic by MSB.`));break}}this.dispatchEvent("voice",{part:o});break}case 6:{if(r(this,Ce)){[C.xg,C.gs,C.ns5r].indexOf(r(this,I))<0&&console.warn(`NRPN commits are not available under "${ye[r(this,I)]}" mode, even when they are supported in Octavia.`);let t=r(this,p)[c+g[99]],a=r(this,p)[c+g[98]];if(t==1){let n=pr.indexOf(a);if(n>-1)r(this,p)[c+g[71+n]]=e.data[1],W()&&console.debug(`Redirected NRPN 1 ${a} to cc${71+n}.`),this.dispatchEvent("cc",{part:o,cc:71+n,data:e.data[1]});else{let s=_t.indexOf(a);s>-1?r(this,Ue)[o*10+s]=e.data[1]-64:console.warn(`NRPN 0x01${a.toString(16).padStart(2,"0")} is not supported.`),W()&&console.debug(`CH${o+1} voice NRPN ${a} commit`)}}else{if(it.indexOf(t)<0){let s=`NRPN 0x${t.toString(16).padStart(2,"0")}${a.toString(16).padStart(2,"0")} `;t==127?console.warn(`${s}is not necessary. Consider removing it.`):console.warn(`${s}is not supported.`)}else{let s=r(this,R)[o]-2;s<0?console.warn(`CH${o+1} cannot accept drum NRPN as type ${Qe[r(this,R)[o]]}.`):r(this,Ze)[(s*y.dpn+bt[t])*y.dnc+a]=e.data[1]-64}W()&&console.debug(`CH${o+1} (${Qe[r(this,R)[o]]}) drum NRPN ${t} commit`)}}else{let t=pt[r(this,p)[c+g[100]]];r(this,p)[c+g[101]]==0&&t!=null&&(W()&&console.debug(`CH${o+1} RPN 0 ${r(this,p)[c+g[100]]} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],Gt[t][0]),Gt[t][1]),r(this,E)[o*y.rpn+t]=e.data[1])}break}case 32:{this.dispatchEvent("voice",{part:o});break}case 38:{r(this,Ce)||r(this,p)[c+101]==0&&pt[r(this,p)[c+100]]!=null&&(r(this,E)[o*y.rpn+pt[r(this,p)[c+100]]+1]=e.data[1]);break}case 64:{e.data[1]<64&&r(this,B).hoOf(o);break}case 66:{e.data[1]>>6?r(this,B).soOn(o):r(this,B).soOf(o);break}case 98:case 99:{$(this,Ce,1);break}case 100:case 101:{$(this,Ce,0);break}}r(this,p)[c+g[e.data[0]]]=e.data[1],this.dispatchEvent("cc",{part:o,cc:e.data[0],data:e.data[1]})}},12:function(e){let o=e.channel;r(this,j)[o]=1,r(this,A)[o]=e.data,r(this,oe)[o]=0,W()&&console.debug(`T:${e.track} C:${o} P:${e.data}`),this.dispatchEvent("voice",{part:o})},13:function(e){let o=this,c=e.channel;r(this,L).forEach(function(t){let a=t>>7;c==a&&(r(o,U)[t]=e.data,o.dispatchEvent("note",{part:c,note:t&127,velo:e.data,state:o.NOTE_SUSTAIN}))})},14:function(e){let o=e.channel;r(this,$e)[o]=e.data[1]*128+e.data[0]-8192,this.dispatchEvent("pitch",{part:o,pitch:this.getPitchShift(o)})},15:function(e){gr(e.data).forEach(o=>{let c=o[0],t=o[1];(r(this,st)[c]||function(){console.debug(`Unknown manufacturer ${c}.`)})(t,o.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){(r(this,G)[e.meta]||function(c,t,a){}).call(this,e.data,e.track,e.meta),e.meta!=32&&$(this,fe,0);let o=fr.indexOf(e.meta)>-1;if(W()&&console.debug(e),o)return e.reply="meta",e}});v(this,st,{64:(e,o,c)=>{r(this,Fe).run(o,c,e)},65:(e,o,c)=>{if(o[0]<16)r(this,ge).run(o,c,e),console.warn("Unknown device SysEx!");else{let t=o[o.length-1],a=Bt(o.subarray(2,o.length-1));t==a?r(this,ge).run(o.subarray(0,o.length-1),c,e):console.warn(`Bad GS checksum ${t}. Should be ${a}.`)}},66:(e,o,c)=>{r(this,Se).run(o,c,e)},67:(e,o,c)=>{r(this,pe).run(o,c,e)},68:(e,o,c)=>{r(this,Xe).run(o,c,e)},71:(e,o,c)=>{r(this,Ve).run(o,c,e)},126:(e,o,c)=>{r(this,Ge).run(o,c,e)},127:(e,o,c)=>{this.switchMode("gm"),r(this,_e).run(o,c,e)}});v(this,Ge,void 0);v(this,_e,void 0);v(this,pe,void 0);v(this,ge,void 0);v(this,Se,void 0);v(this,Fe,void 0);v(this,Ve,void 0);v(this,Xe,void 0);let e=this;$(this,Y,new Uint8Array(256),Kt),r(this,he)[10]=new Uint8Array(512),$(this,Te,new re),this.userBank.strictMode=!0,this.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),r(this,G)[1]=function(t){switch(t.slice(0,2)){case"@I":{$(this,D,!0),r(this,T).unshift(`Kar.Info: ${t.slice(2)}`);break}case"@K":{$(this,D,!0),r(this,T).unshift("Karaoke mode active."),console.debug(`Karaoke mode active: ${t.slice(2)}`);break}case"@L":{$(this,D,!0),r(this,T).unshift(`Language: ${t.slice(2)}`);break}case"@T":{$(this,D,!0),r(this,T).unshift(`Ka.Title: ${t.slice(2)}`);break}case"@V":{$(this,D,!0),r(this,T).unshift(`Kara.Ver: ${t.slice(2)}`);break}case"XF":{let a=t.slice(2).split(":");switch(a[0]){case"hd":{a.slice(1).forEach((n,s)=>{n.length&&r(this,T).unshift(`${["SongDate","SnRegion","SongCat.","SongBeat","SongInst","Sn.Vocal","SongCmp.","SongLrc.","SongArr.","SongPerf","SongPrg.","SongTags"][s]}: ${n}`)});break}case"ln":{a.slice(1).forEach((n,s)=>{n.length&&r(this,T).unshift(`${["Kar.Lang","Kar.Name","Kar.Cmp.","Kar.Lrc.","kar.Arr.","Kar.Perf","Kar.Prg."][s]}: ${n}`)});break}default:r(this,T).unshift(`XGF_Data: ${t}`)}break}default:r(this,D)?t[0]=="\\"?r(this,T).unshift(`@ ${t.slice(1)}`):t[0]=="/"?r(this,T).unshift(t.slice(1)):r(this,T)[0]+=t:(r(this,T)[0]=t,r(this,T).unshift(""))}},r(this,G)[2]=function(t){r(this,T).unshift(`Copyrite: ${t}`)},r(this,G)[3]=function(t,a){a<1&&r(this,fe)<1&&r(this,T).unshift(`TrkTitle: ${t}`)},r(this,G)[4]=function(t,a){r(this,T).unshift(`${Vt(r(this,fe),""," ")}Instrmnt: ${t}`)},r(this,G)[5]=function(t){t.trim()==""?r(this,T).unshift(""):r(this,T)[0]+=`${t}`},r(this,G)[6]=function(t){r(this,T).unshift(`${Vt(r(this,fe),""," ")}C.Marker: ${t}`)},r(this,G)[7]=function(t){r(this,T).unshift(`CuePoint: ${t}`)},r(this,G)[32]=function(t){$(this,fe,t[0]+1)},r(this,G)[33]=function(t,a){console.debug(`Track ${a} requests to get assigned to output ${t}.`),r(e,ke)[a]=t+1},r(this,G)[81]=function(t,a){$(e,Be,t/1e3)},r(this,G)[127]=function(t,a){r(e,Te).run(t,a)},r(this,Te).default=function(t){console.warn(`Unrecognized sequencer-specific byte sequence: ${t}`)},r(this,Te).add([67,0,1],function(t,a){r(e,ke)[a]=t[0]+1}),$(this,Ge,new re),$(this,_e,new re),$(this,pe,new re),$(this,ge,new re),$(this,Se,new re),$(this,Fe,new re),$(this,Ve,new re),$(this,Xe,new re),r(this,Ge).add([9],t=>{e.switchMode(["gm","?","g2"][t[0]-1],!0),$(e,D,r(e,D)||!1),console.info(`MIDI reset: ${["GM","Init","GM2"][t[0]-1]}`),t[0]==2&&e.init()}),r(this,_e).add([4,1],t=>{$(e,q,((t[1]<<7)+t[0])/16383*100)}).add([4,3],t=>((t[1]<<7)+t[0]-8192)/8192).add([4,4],t=>t[1]-64),r(this,pe).add([76,0,0],t=>{switch(t[0]){case 125:{console.info(`XG drum setup reset: ${t}`);break}case 126:{e.switchMode("xg",!0),$(e,D,!1),console.info("MIDI reset: XG");break}default:{let a=[0,0,0,0],n=(s,i)=>{a[i]=s};if(t.subarray(1).forEach((s,i)=>{let h=i+t[0];([n,n,n,n,d=>{$(this,q,d*129/16383*100)},d=>{},d=>{}][h]||(()=>{}))(s,i)}),t[0]<4){let s=0;a.forEach(i=>{s=s<<4,s+=i}),s-=1024}}}}).add([76,2,1],t=>{let a="XG ";t[0]<32?(a+="reverb ",t.subarray(1).forEach((n,s)=>{([i=>{e.setEffectTypeRaw(0,!1,i),console.info(`${a}main type: ${je[i]}`)},i=>{e.setEffectTypeRaw(0,!0,i),console.debug(`${a}sub type: ${i+1}`)},i=>{console.debug(`${a}time: ${Tt(i)}s`)},i=>{console.debug(`${a}diffusion: ${i}`)},i=>{console.debug(`${a}initial delay: ${i}`)},i=>{console.debug(`${a}HPF cutoff: ${qe[i]}Hz`)},i=>{console.debug(`${a}LPF cutoff: ${qe[i]}Hz`)},i=>{console.debug(`${a}width: ${i}`)},i=>{console.debug(`${a}height: ${i}`)},i=>{console.debug(`${a}depth: ${i}`)},i=>{console.debug(`${a}wall type: ${i}`)},i=>{console.debug(`${a}dry/wet: ${i}`)},i=>{console.debug(`${a}send: ${K(i)}dB`)},i=>{console.debug(`${a}pan: ${i-64}`)},!1,!1,i=>{console.debug(`${a}delay: ${i}`)},i=>{console.debug(`${a}density: ${i}`)},i=>{console.debug(`${a}balance: ${i}`)},i=>{},i=>{console.debug(`${a}feedback: ${i}`)},i=>{}][t[0]+s]||function(){console.warn(`Unknown XG reverb address: ${t[0]}.`)})(n)})):t[0]<64?(a+="chorus ",t.subarray(1).forEach((n,s)=>{([i=>{e.setEffectTypeRaw(1,!1,i),console.info(`${a}main type: ${je[i]}`)},i=>{e.setEffectTypeRaw(1,!0,i),console.debug(`${a}sub type: ${i+1}`)},i=>{console.debug(`${a}LFO: ${Ct[i]}Hz`)},i=>{},i=>{console.debug(`${a}feedback: ${i}`)},i=>{console.debug(`${a}delay offset: ${Rt(i)}ms`)},i=>{},i=>{console.debug(`${a}low: ${qe[i]}Hz`)},i=>{console.debug(`${a}low: ${i-64}dB`)},i=>{console.debug(`${a}high: ${qe[i]}Hz`)},i=>{console.debug(`${a}high: ${i-64}dB`)},i=>{console.debug(`${a}dry/wet: ${i}`)},i=>{console.debug(`${a}send: ${K(i)}dB`)},i=>{console.debug(`${a}pan: ${i-64}`)},i=>{console.debug(`${a}to reverb: ${K(i)}dB`)},!1,i=>{},i=>{},i=>{},i=>{console.debug(`${a}LFO phase diff: ${(i-64)*3}deg`)},i=>{console.debug(`${a}input mode: ${i?"stereo":"mono"}`)},i=>{}][t[0]-32+s]||function(){console.warn(`Unknown XG chorus address: ${t[0]}.`)})(n)})):t[0]<86?(a+="variation ",t.subarray(1).forEach((n,s)=>{([i=>{e.setEffectTypeRaw(2,!1,i),console.info(`${a}main type: ${je[i]}`)},i=>{e.setEffectTypeRaw(2,!0,i),console.debug(`${a}sub type: ${i+1}`)}][t[0]-64+s]||function(){})(n)})):t[0]<97?(a+="variation ",t.subarray(1).forEach((n,s)=>{[i=>{console.debug(`${a}send: ${K(i)}dB`)},i=>{console.debug(`${a}pan: ${i-64}`)},i=>{console.debug(`${a}to reverb: ${K(i)}dB`)},i=>{console.debug(`${a}to chorus: ${K(i)}dB`)},i=>{console.debug(`${a}connection: ${i?"system":"insertion"}`)},i=>{console.debug(`${a}channel: CH${i+1}`)},i=>{console.debug(`${a}mod wheel: ${i-64}`)},i=>{console.debug(`${a}bend wheel: ${i-64}`)},i=>{console.debug(`${a}channel after touch: ${i-64}`)},i=>{console.debug(`${a}AC1: ${i-64}`)},i=>{console.debug(`${a}AC2: ${i-64}`)}][t[0]-86+s](n)})):t[0]>111&&t[0]<118?a+="variation ":console.warn(`Unknown XG variation address: ${t[0]}`)}).add([76,2,64],t=>{t.subarray(1).forEach((a,n)=>{let s=n+t[0];if(s==0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][a]}`);else{let i=s-1>>2,h=s-1&3,d=`XG EQ ${i} ${["gain","freq","Q","shape"][h]}: `;[()=>{console.debug(`${d}${a-64}dB`)},()=>{console.debug(`${d}${a} (raw)`)},()=>{console.debug(`${d}${a/10}`)},()=>{console.debug(`${d}${["shelf","peak"][+!!a]}`)}][h]()}})}).add([76,3],t=>{let a=t[0],n=t[1],s=`XG Insertion ${t[0]+1} `;t.subarray(2).forEach((i,h)=>{([d=>{e.setEffectTypeRaw(3+a,!1,d),console.info(`${s}main type: ${je[d]}`)},d=>{e.setEffectTypeRaw(3+a,!0,d),console.debug(`${s}sub type: ${d+1}`)}][n+h]||function(){})(i)})}).add([76,6,0],t=>{let a=t[0];a<64?e.setLetterDisplay(t.subarray(1),"XG letter display",a):$(e,Ee,Date.now())}).add([76,7,0],t=>{let a=t[0];$(e,z,0),$(e,se,Date.now()+3200),r(e,Y,le).fill(0);let n=t.subarray(1);for(let s=0;s<a;s++)n.unshift(0);n.forEach(function(s,i){let h=Math.floor(i/16),d=i%16,l=(d*3+h)*7,u=7,b=0;for(l-=d*5,h==2&&(u=2);b<u;)r(e,Y,le)[l+b]=s>>6-b&1,b++})}).add([76,8],(t,a)=>{let n=e.chRedir(t[0],a,!0),s=t[1],i=y.cc*n,h=`XG CH${n+1} `,d=`Unknown XG part address ${s}.`;t.subarray(2).forEach((l,u)=>{s<1?console.debug(d):s<41?([()=>{r(e,p)[i+g[0]]=l},()=>{r(e,p)[i+g[32]]=l},()=>{r(e,A)[n]=l},()=>{let b=e.chRedir(l,a,!0);r(e,H)[n]=b,n!=b&&(e.buildRchTree(),console.info(`${h}receives from CH${b+1}`))},()=>{r(e,ie)[n]=+!l},()=>{},()=>{e.setChType(n,l,C.xg),console.debug(`${h}type: ${Qe[l]||l}`)},()=>{r(e,E)[y.rpn*n+3]=l},!1,!1,()=>{r(e,p)[i+g[7]]=l},!1,!1,()=>{r(e,p)[i+g[10]]=l||128},!1,!1,()=>{r(e,p)[i+g[128]]=l},()=>{r(e,p)[i+g[93]]=l},()=>{r(e,p)[i+g[91]]=l},()=>{r(e,p)[i+g[94]]=l},()=>{r(e,p)[i+g[76]]=l},()=>{r(e,p)[i+g[77]]=l},()=>{r(e,p)[i+g[78]]=l},()=>{r(e,p)[i+g[74]]=l},()=>{r(e,p)[i+g[71]]=l},()=>{r(e,p)[i+g[73]]=l},()=>{r(e,p)[i+g[75]]=l},()=>{r(e,p)[i+g[72]]=l}][s+u-1]||(()=>{}))():s<48?console.debug(d):s<111?s>102&&s<105&&(r(e,p)[i+g[[5,65][s&1]]]=l):s<114?console.debug(d):s<116?console.debug(`${h}EQ ${["bass","treble"][s&1]} gain: ${l-64}dB`):s<118?console.debug(d):s<120?console.debug(`${h}EQ ${["bass","treble"][s&1]} freq: ${l}`):console.debug(d)})}).add([76,9],(t,a)=>{let n=e.chRedir(t[0],a,!0),s=t[1],i=`PLG-150VL CH${n+1} `;t.subarray(2).forEach((h,d)=>{let l=d+s;switch(l){case 1:{console.info(`${i}breath mode: ${["system","breath","velocity","touch EG"][h]}`);break}case 0:case 27:case 28:break;default:if(l<27){let u=["pressure","embouchure","tonguing","scream","breath noise","growl","throat formant","harmonic enhancer","damping","absorption","amplification","brightness"][l-3>>1];l&1?l<23?(console.debug(`${i}${u} control source: ${It(h)}`),h&&h<96&&e.allocateAce(h)):console.debug(`${i}${u} scale break point: ${h}`):console.debug(`${i}${u} depth: ${h-64}`)}}})}).add([76,10],t=>{}).add([76,16],t=>{}).add([76,17,0,0],t=>{}).add([76,112],t=>{console.debug(`XG enable PLG-1${["50VL","00SG","50DX"][t[0]]} for CH${t[2]+1}.`)}).add([73,0,0],(t,a)=>{let n=t[0];t.subarray(1).forEach((s,i)=>{let h=n+i;h==8?console.debug(`MU1000 set LCD contrast to ${s}.`):h>9&&h<16&&[()=>{e.dispatchEvent("channelactive",s)},()=>{s<8?(e.dispatchEvent("channelmin",s<<4),console.info(`Octavia System: Minimum CH${(s<<4)+1}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{s<8?(e.dispatchEvent("channelmax",(s<<4)+15),console.info(`Octavia System: Maximum CH${(s<<4)+16}`)):(e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges"))},()=>{e.dispatchEvent("channelreset"),console.info("Octavia System: Clear channel ranges")},()=>{$(e,ee,!!s),console.info(`Octavia System: RS receiving ${["dis","en"][s]}abled.`)}][h-10]()})}).add([73,10,0],(t,a)=>{let n=t[0],s=`MU1000 RS${r(e,ee)?"":" (ignored)"}: `;if(n<16)switch(n){case 2:{let i=e.chRedir(0,a,!0);r(e,ee)&&(e.dispatchEvent("channelmin",i),e.dispatchEvent("channelmax",i+63)),console.info(`${s}Show CH1~64`);break}case 3:{let i=e.chRedir(t[1]<<5,a,!0);r(e,ee)&&e.dispatchEvent("channelmin",i),r(e,ee)&&e.dispatchEvent("channelmax",i+31),console.info(`${s}Show CH${i+1}~CH${i+32}`);break}default:console.debug(`${s}unknown switch ${n} invoked.`)}else if(n<32){if(r(e,ee)){let i=e.chRedir(n-16+(r(e,He)<<4),a,!0);e.dispatchEvent("channelactive",i)}}else if(n<36){let i=e.chRedir(n-32<<4,a,!0);r(e,ee)&&(e.dispatchEvent("channelmin",i),e.dispatchEvent("channelmax",i+15),$(e,He,n-32)),console.info(`${s}Show CH${i+1}~CH${i+16}`)}}).add([93,3],(t,a)=>{let n=e.chRedir(t[0],a,!0),s=`PLG-100SG CH${n+1} `,i=Date.now();if(t[1]==0){let h="",d=0;t.subarray(2).forEach((l,u)=>{u%2==0?h+=Ot[l]||l.toString().padStart("0"):d+=l*13}),i>=r(e,Ne)&&r(e,T).unshift("SG Lyric: "),r(e,T)[0]+=`${At(h)}`,$(e,Ne,i+Math.ceil(d/2)+r(e,Be)),W()&&console.debug(`${s}vocals: ${h}`)}else console.warn(`Unknown PLG-100SG data: ${t}`)}),r(this,pe).add([76,48],t=>{}).add([76,49],t=>{}).add([76,50],t=>{}).add([76,51],t=>{}),r(this,pe).add([89,0],(t,a,n)=>{if(e.eprom){let s=t[0],i=(t[1]<<14)+(t[2]<<7)+t[3]+(e.eprom.offset||0);W()&&console.debug(`MU1000 EPROM trail to 0x${i.toString(16).padStart(6,"0")}, ${s} bytes.`);let h=e.eprom.data;t.subarray(4).forEach((d,l)=>{let u=l>>3,b=l&7;if(b==7)for(let w=0;w<7;w++)h[i+7*u+w]+=(d>>6-w&1)<<7;else h[i+7*u+b]=d})}}).add([89,1],(t,a,n)=>{let s=(t[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3];W()&&console.debug(`MU1000 EPROM jump to 0x${s.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=s)}).add([89,2],(t,a,n)=>{if(e.eprom){let s=(t[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3]+(e.eprom.offset||0);W()&&console.debug(`MU1000 EPROM write to 0x${s.toString(16).padStart(6,"0")}.`);let i=e.eprom.data;t.subarray(4).forEach((h,d)=>{let l=d>>3,u=d&7;if(u==7)for(let b=0;b<7;b++)i[s+7*l+b]+=(h>>6-b&1)<<7;else i[s+7*l+u]=h})}}).add([89,3],(t,a,n)=>{}),r(this,pe).add([39,48],(t,a,n)=>{}).add([43,0,0],(t,a,n)=>{let s=[0,0,0,0],i=(h,d)=>{s[d]=h};if(t.subarray(1).forEach((h,d)=>{let l=d+t[0];[i,i,i,i,()=>{$(this,q,h*129/16383*100)},()=>h-64,()=>h||128,()=>h,()=>h,()=>{console.debug(`TG300 variation on cc${h}.`)}][l](h,l)}),t[0]<4){let h=0;s.forEach(d=>{h=h<<4,h+=d}),h-=1024}}).add([43,1,0],(t,a,n)=>{}).add([43,2],(t,a,n)=>{let s=e.chRedir(t[0],a,!0),i=t[1],h=y.cc*s,d=`TG300 CH${s+1} `;t.subarray(2).forEach((l,u)=>{u<5?([()=>{},()=>{r(e,p)[h+g[0]]=l},()=>{r(e,p)[h+g[32]]=l},()=>{r(e,A)[s]=l},()=>{let b=e.chRedir(l,a,!0);r(e,H)[s]=b,s!=b&&(e.buildRchTree(),console.info(`${d}receives from CH${b+1}`))}][u+i]||(()=>{}))(l,u+i):u<21||(u<47?([()=>{r(e,ie)[s]=+!l},()=>{},()=>{},()=>{r(e,E)[y.rpn*s+3]=l},()=>{},()=>{r(e,p)[h+g[7]]=l},!1,!1,()=>{r(e,p)[h+g[10]]=l||128},!1,!1,()=>{console.debug(`${d} AC1 at cc${l}`)},()=>{console.debug(`${d} AC2 at cc${l}`)},()=>{r(e,p)[h+g[128]]=l},()=>{r(e,p)[h+g[93]]=l},()=>{r(e,p)[h+g[91]]=l},()=>{r(e,p)[h+g[94]]=l},()=>{r(e,p)[h+g[76]]=l},()=>{r(e,p)[h+g[77]]=l},()=>{r(e,p)[h+g[74]]=l},()=>{r(e,p)[h+g[71]]=l},()=>{r(e,p)[h+g[73]]=l},()=>{r(e,p)[h+g[75]]=l},()=>{r(e,p)[h+g[72]]=l},()=>{r(e,p)[h+g[78]]=l}][u+i-21]||(()=>{}))(l,u+i):u<95||([()=>{r(e,p)[h+g[65]]=l},()=>{r(e,p)[h+g[5]]=l}][u+i-95]||(()=>{}))(l,u+i))})}).add([43,7,0],(t,a,n)=>{let s=t[0];e.setLetterDisplay(t.subarray(1),"TG300 letter display",s)}).add([43,7,1],(t,a,n)=>{$(e,z,0),$(e,se,Date.now()+3200),r(e,Y,le).fill(0),t.forEach(function(s,i){let h=Math.floor(i/16),d=i%16,l=(d*3+h)*7,u=7,b=0;for(l-=d*5,h==2&&(u=2);b<u;)r(e,Y,le)[l+b]=s>>6-b&1,b++})}),r(this,ge).add([66,18,0,0,127],(t,a,n)=>{e.switchMode("gs",!0),r(e,p)[y.cc*9]=120,r(e,p)[y.cc*25]=120,r(e,p)[y.cc*41]=120,r(e,p)[y.cc*57]=120,$(e,J,3),$(e,D,!1),r(e,ue).fill(0),console.info(`GS system to ${["single","dual"][t[0]]} mode.`)}).add([66,18,64,0],(t,a,n)=>{switch(t[0]){case 127:{e.switchMode("gs",!0),r(e,p)[y.cc*9]=120,r(e,p)[y.cc*25]=120,r(e,p)[y.cc*41]=120,r(e,p)[y.cc*57]=120,$(e,D,!1),r(e,ue).fill(0),console.info("MIDI reset: GS");break}default:{let s=[0,0,0,0],i=(h,d)=>{s[d]=h};if(t.subarray(1).forEach((h,d)=>{let l=d+t[0];[i,i,i,i,u=>{$(this,q,u*129/16383*100)},u=>{},u=>{}][l](h,d)}),t[0]<4){let h=0;s.forEach(d=>{h=h<<4,h+=d}),h-=1024}}}}).add([66,18,64,1],t=>{let a=t[0];if(a<16){let n="".padStart(a," ");t.subarray(1).forEach((s,i)=>{n+=String.fromCharCode(Math.max(32,s))}),n=n.padEnd(16," "),console.debug(`GS patch name: ${n}`)}else a<48||(a<65?t.subarray(1).forEach((n,s)=>{let i=`GS ${a+s>55?"chorus":"reverb"} `;([()=>{console.info(`${i}type: ${dt[n]}`),e.setEffectType(0,40,n)},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${i}predelay: ${n}ms`)},()=>{console.info(`${i}type: ${Dt[n]}`),e.setEffectType(1,40,16+n)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${i}to reverb: ${K(n)}`)},()=>{console.debug(`${i}to delay: ${K(n)}`)}][a+s-48]||(()=>{}))()}):a<80?console.debug(`Unknown GS patch address: ${a}`):a<91?t.subarray(1).forEach((n,s)=>{let i="GS delay ";([()=>{console.info(`${i}type: ${Pt[n]}`),e.setEffectType(2,40,32+n)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${i}to reverb: ${K(n)}`)}][a+s-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${a}`))}).add([66,18,64,2],t=>{let a="GS EQ ";t.subarray(1).forEach((n,s)=>{([()=>{console.debug(`${a}low freq: ${[200,400][n]}Hz`)},()=>{console.debug(`${a}low gain: ${n-64}dB`)},()=>{console.debug(`${a}high freq: ${[3e3,6e3][n]}Hz`)},()=>{console.debug(`${a}high gain: ${n-64}dB`)}][t[0]+s]||function(){console.warn(`Unknown GS EQ address: ${t[0]+s}`)})()})}).add([66,18,64,3],t=>{let a="GS EFX ",n=function(s,i){let h=Ut(r(e,Q).subarray(10,12),i,s);h&&console.debug(`${a}${ft(r(e,Q).subarray(10,12))} ${h}`)};t.subarray(1).forEach((s,i)=>{([()=>{e.setEffectTypeRaw(3,!1,32+s)},()=>{e.setEffectTypeRaw(3,!0,s),console.info(`${a}type: ${ft(r(e,Q).subarray(10,12))}`)},!1,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,()=>{console.debug(`${a}to reverb: ${K(s)}dB`)},()=>{console.debug(`${a}to chorus: ${K(s)}dB`)},()=>{console.debug(`${a}to delay: ${K(s)}dB`)},!1,()=>{console.debug(`${a}1 source: ${s}`),s&&s<96&&e.allocateAce(s)},()=>{console.debug(`${a}1 depth: ${s-64}`)},()=>{console.debug(`${a}2 source: ${s}`),s&&s<96&&e.allocateAce(s)},()=>{console.debug(`${a}2 depth: ${s-64}`)},()=>{console.debug(`${a}to EQ: ${s?"ON":"OFF"}`)}][t[0]+i]||function(h,d){console.warn(`Unknown GS EFX address: ${d}`)})(s,t[0]+i)})}).add([66,18,65],t=>{}).add([69,18,16],t=>{var a;switch(t[0]){case 0:{let n=t[1];e.setLetterDisplay(t.subarray(2),"GS display text",n);break}case 32:{$(e,se,Date.now()+3200),t[1]==0&&$(e,z,Math.max(Math.min(t[2]-1,9),0));break}default:if(t[0]<11){r(e,z)>9&&$(e,z,0),$(e,se,Date.now()+3200),(a=r(e,he)[t[0]-1])!=null&&a.length||(r(e,he)[t[0]-1]=new Uint8Array(256));let n=r(e,he)[t[0]-1],s=t[1];n.fill(0);let i=t.subarray(2);for(let h=0;h<s;h++)i.unshift(0);i.forEach(function(h,d){let l=Math.floor(d/16),u=d%16,b=(u*4+l)*5,w=5,S=0;for(b-=u*4,l==3&&(w=1);S<w;)n[b+S]=h>>4-S&1,S++})}else console.warn(`Unknown GS display section: ${t[0]}`)}});let o=function(t,a,n){let s=t[0],i=y.cc*a,h=y.rpn*a,d=`GS CH${a+1} `;s<3?t.subarray(1).forEach((l,u)=>{[()=>{r(e,p)[i+g[0]]=l},()=>{r(e,A)[a]=l},()=>{let b=e.chRedir(l,n,!0);r(e,H)[a]=b,a!=b&&(e.buildRchTree(),console.info(`${d}receives from CH${b+1}`))}][s+u]()}):s<19||(s<44?t.subarray(1).forEach((l,u)=>{([()=>{r(e,ie)[a]=+!l},!1,()=>{e.setChType(a,l<<1,C.gs),console.debug(`${d}type: ${l?"drum ":"melodic"}${l||""}`)},()=>{r(e,E)[h+3]=l},!1,()=>{r(e,p)[i+g[7]]=l},!1,!1,()=>{r(e,p)[i+g[10]]=l||128},!1,!1,()=>{console.debug(`${d}CC 1: cc${l}`)},()=>{console.debug(`${d}CC 2: cc${l}`)},()=>{r(e,p)[i+g[93]]=l},()=>{r(e,p)[i+g[91]]=l},!1,!1,()=>{r(e,E)[h+1]=l},()=>{r(e,E)[h+2]=l},()=>{r(e,p)[i+g[94]]=l}][s+u-19]||(()=>{}))()}):s<76||console.debug(`Unknown GS part address: ${s}`))},c=function(t,a){let n=t[0],s=`GS CH${a+1} `;n<2?t.subarray(1).forEach((i,h)=>{[()=>{r(e,p)[y.cc*a+g[32]]=i},()=>{}][n+h]()}):n<32?console.warn(`Unknown GS misc address: ${n}`):n<35?t.subarray(1).forEach((i,h)=>{[()=>{console.debug(`${s}EQ: o${["ff","n"][i]}`)},()=>{},()=>{console.debug(`${s}EFX: o${["ff","n"][i]}`)}][n+h-32]()}):console.warn(`Unknown GS misc address: ${n}`)};r(this,ge).add([66,18,64,16],(t,a)=>{o(t,e.chRedir(9,a,!0),a)}).add([66,18,64,17],(t,a)=>{o(t,e.chRedir(0,a,!0),a)}).add([66,18,64,18],(t,a)=>{o(t,e.chRedir(1,a,!0),a)}).add([66,18,64,19],(t,a)=>{o(t,e.chRedir(2,a,!0),a)}).add([66,18,64,20],(t,a)=>{o(t,e.chRedir(3,a,!0),a)}).add([66,18,64,21],(t,a)=>{o(t,e.chRedir(4,a,!0),a)}).add([66,18,64,22],(t,a)=>{o(t,e.chRedir(5,a,!0),a)}).add([66,18,64,23],(t,a)=>{o(t,e.chRedir(6,a,!0),a)}).add([66,18,64,24],(t,a)=>{o(t,e.chRedir(7,a,!0),a)}).add([66,18,64,25],(t,a)=>{o(t,e.chRedir(8,a,!0),a)}).add([66,18,64,26],(t,a)=>{o(t,e.chRedir(10,a,!0),a)}).add([66,18,64,27],(t,a)=>{o(t,e.chRedir(11,a,!0),a)}).add([66,18,64,28],(t,a)=>{o(t,e.chRedir(12,a,!0),a)}).add([66,18,64,29],(t,a)=>{o(t,e.chRedir(13,a,!0),a)}).add([66,18,64,30],(t,a)=>{o(t,e.chRedir(14,a,!0),a)}).add([66,18,64,31],(t,a)=>{o(t,e.chRedir(15,a,!0),a)}).add([66,18,64,64],(t,a)=>{c(t,e.chRedir(9,a,!0))}).add([66,18,64,65],(t,a)=>{c(t,e.chRedir(0,a,!0))}).add([66,18,64,66],(t,a)=>{c(t,e.chRedir(1,a,!0))}).add([66,18,64,67],(t,a)=>{c(t,e.chRedir(2,a,!0))}).add([66,18,64,68],(t,a)=>{c(t,e.chRedir(3,a,!0))}).add([66,18,64,69],(t,a)=>{c(t,e.chRedir(4,a,!0))}).add([66,18,64,70],(t,a)=>{c(t,e.chRedir(5,a,!0))}).add([66,18,64,71],(t,a)=>{c(t,e.chRedir(6,a,!0))}).add([66,18,64,72],(t,a)=>{c(t,e.chRedir(7,a,!0))}).add([66,18,64,73],(t,a)=>{c(t,e.chRedir(8,a,!0))}).add([66,18,64,74],(t,a)=>{c(t,e.chRedir(10,a,!0))}).add([66,18,64,75],(t,a)=>{c(t,e.chRedir(11,a,!0))}).add([66,18,64,76],(t,a)=>{c(t,e.chRedir(12,a,!0))}).add([66,18,64,77],(t,a)=>{c(t,e.chRedir(13,a,!0))}).add([66,18,64,78],(t,a)=>{c(t,e.chRedir(14,a,!0))}).add([66,18,64,79],(t,a)=>{c(t,e.chRedir(15,a,!0))}),r(this,Se).add([54,65],(t,a)=>{e.switchMode("x5d");let n=(t[1]<<7)+t[0],s=(t[3]<<7)+t[2],i=e.chRedir(n&15,a,!0),h=y.cc*i;[()=>{s<1||(s<101?(e.setChType(i,e.CH_MELODIC,C.x5d),r(e,A)[i]=s-1,r(e,p)[h+g[0]]=82):s<229?(e.setChType(i,e.CH_MELODIC,C.x5d),r(e,A)[i]=s-101,r(e,p)[h+g[0]]=56):(e.setChType(i,e.CH_DRUMS,C.x5d),r(e,A)[i]=Ft[s-229]||0,r(e,p)[h+g[0]]=62))},()=>{r(e,p)[h+g[7]]=s},()=>{s<31&&(r(e,p)[h+g[10]]=Math.round((s-15)*4.2+64))},()=>{r(e,p)[h+g[93]]=Ye(s)},()=>{r(e,p)[h+g[91]]=Ye(s)},()=>{r(e,E)[i*y.rpn+3]=s>8191?s-16320:64+s},()=>{r(e,E)[i*y.rpn+1]=s>8191?s-16320:64+s},()=>{s>0&&(r(e,E)[i*y.rpn]=s)},()=>{}][n>>4]()}).add([54,76,0],(t,a)=>{e.switchMode("x5d",!0);let n="",s=82,i=0,h=0,d="MSB	PRG	LSB	NME";ae(t,function(l,u){if(u<16400){let b=u%164;switch(!0){case b<10:{l>31&&(n+=String.fromCharCode(l));break}case b==11:{d+=`
${s}	${i}	${h}	${n.trim().replace("Init Voice","")}`,i++,n="";break}}i>99&&(s=90,i=0)}}),e.userBank.clearRange({msb:82,prg:[0,99],lsb:0}),e.userBank.load(d)}).add([54,77,0],(t,a)=>{e.switchMode("x5d",!0);let n="",s=90,i=0,h=0,d="MSB	PRG	LSB	NME";ae(t,function(l,u){if(u<13600){let b=u%136;switch(!0){case b<10:{l>31&&(n+=String.fromCharCode(l));break}case b==11:{d+=`
${s}	${i}	${h}	${n.trim().replace("Init Combi","")}`,i++,n="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(d)}).add([54,78],(t,a)=>{e.switchMode("x5d",!0),console.debug(`X5D mode switch requested: ${["combi","combi edit","prog","prog edit","multi","global"][t[0]]} mode.`)}).add([54,85],(t,a)=>{e.switchMode("x5d",!0),ae(t,(n,s)=>{s>0&&s<3&&e.setEffectType(s-1,44,n)})}).add([54,104],(t,a)=>{e.switchMode("x5d",!0),ae(t,function(n,s,i,h){if(s<192){let d=e.chRedir(Math.floor(s/12),a,!0),l=d*y.cc;switch(s%12){case 0:{n<128?(e.setChType(d,e.CH_MELODIC,C.x5d),r(e,p)[l+g[0]]=82,r(e,A)[d]=n):(e.setChType(d,e.CH_DRUMS,C.x5d),r(e,p)[l+g[0]]=62,r(e,A)[d]=Ft[n-128]),n>0&&(r(e,j)[d]=1);break}case 1:{r(e,p)[l+g[7]]=n;break}case 2:{r(e,E)[d*y.rpn+3]=n>127?n-192:64+n;break}case 3:{r(e,E)[d*y.rpn+1]=n>127?n-192:64+n;break}case 4:{n<31&&(r(e,p)[l+g[10]]=Math.round((n-15)*4.2+64));break}case 5:{let u=n>>4,b=n&15;r(e,p)[l+g[91]]=Ye(b),r(e,p)[l+g[93]]=Ye(u);break}case 10:break;case 11:{let u=e.chRedir(n&15,a,!0),b=n>>4;r(e,H)[d]=n,(u!=d||b)&&(console.info(`X5D Part CH${d+1} receives from CH${u+1}.`),e.buildRchTree())}}}else{let d=e.chRedir(s-192,a,!0)}})}),r(this,ge).add([22,18,127],t=>{e.switchMode("mt32",!0),$(e,D,!1),e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(t,a,n)=>{e.switchMode("mt32");let s=e.chRedir(n,a,!0),i=t[1];t.subarray(2).forEach((h,d)=>{let l=d+i;r(e,ve)[l+(s-1)*16]=h,([!1,()=>{let u=r(e,ve)[s-1<<4];if(u<3)if(r(e,oe)[s]=1,u==2)for(let b=0;b<name.length;b++)r(e,Z)[(s-1)*y.cmt+b]=r(e,we)[h*y.cmt+b];else{let b=e.baseBank.get(0,h+(u<<6),127,"mt32").name;for(let w=0;w<b.length;w++)r(e,Z)[(s-1)*y.cmt+w]=b.charCodeAt(w)}},()=>{r(e,E)[s*y.rpn+3]=h+40},()=>{r(e,E)[s*y.rpn+1]=h+14},()=>{r(e,E)[s*y.rpn]=h},!1,()=>{r(e,p)[y.cc*s+g[91]]=h?127:0},!1,()=>{r(e,p)[y.cc*s+g[7]]=h},()=>{r(e,p)[y.cc*s+g[10]]=Math.ceil(h*9.05)}][l]||(()=>{}))()})}).add([22,18,1],(t,a,n)=>{e.switchMode("mt32");let s=e.chRedir(n,a,!0)}).add([22,18,2],(t,a,n)=>{e.switchMode("mt32");let s=e.chRedir(n,a,!0),i=t[1]+(t[0]<<7);i<10&&(r(e,oe)[s]=1),t.subarray(2).forEach((h,d)=>{let l=d+i;l<14&&(r(e,Z)[(s-1)*y.cmt+l]=h)})}).add([22,18,3],(t,a,n)=>{if(e.switchMode("mt32"),t[0]){let s=t[1]-16}else{let s=t[1];t.subarray(2).forEach((i,h)=>{let d=h+s;r(e,ve)[d]=i;let l=e.chRedir(1+d>>4,a,!0),u=d&15;([!1,()=>{let b=r(e,ve)[l-1<<4];if(b<3)if(r(e,oe)[l]=1,b==2)for(let w=0;w<name.length;w++)r(e,Z)[(l-1)*y.cmt+w]=r(e,we)[i*y.cmt+w];else{let w=e.baseBank.get(0,i+(b<<6),127,"mt32").name;for(let S=0;S<w.length;S++)r(e,Z)[(l-1)*y.cmt+S]=w.charCodeAt(S)}},()=>{r(e,E)[l*y.rpn+3]=i+40},()=>{r(e,E)[l*y.rpn+1]=i+14},()=>{r(e,E)[l*y.rpn]=i},!1,()=>{r(e,p)[y.cc*l+g[91]]=i?127:0},!1,()=>{r(e,p)[y.cc*l+g[7]]=i},()=>{r(e,p)[y.cc*l+g[10]]=Math.ceil(i*9.05)}][u]||(()=>{}))()})}}).add([22,18,4],(t,a,n)=>{e.switchMode("mt32");let s=t[1]+(t[0]<<7);t.subarray(2).forEach((i,h)=>{let d=h+s,l=e.chRedir(Math.floor(d/246+1),a,!0),u=d%246;u<14&&(r(e,Z)[(l-1)*y.cmt+u]=i),u<10&&(r(e,oe)[l]=1)})}).add([22,18,5],(t,a,n)=>{e.switchMode("mt32");let s=(t[0]<<7)+t[1];t.subarray(2).forEach((i,h)=>{let d=s+h,l=Math.floor(d/8),u=d&7,b=l*8;r(e,Le)[d]=i,([!1,()=>{let w=r(e,Le)[b];if(w<3){let S="";if(w==2){let x=y.cmt*l;S=`MT-m:${i.toString().padStart(3,"0")}`}else S=e.baseBank.get(0,i+(w<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:l}),e.userBank.load(`MSB	LSB	PRG	NME
000	127	${l}	${S}`,!0)}}][u]||(()=>{}))()})}).add([22,18,8],(t,a,n)=>{e.switchMode("mt32");let s=((t[0]&1)<<7)+t[1];t.subarray(2).forEach((i,h)=>{let d=s+h;d<y.cmt&&(r(e,we)[(t[0]>>1)*y.cmt+d]=i)})}).add([22,18,16],(t,a,n)=>{e.switchMode("mt32");let s=t[1],i=!1,h=function(d,l){r(e,H)[l-12]=d,i=!0};t.subarray(2).forEach((d,l)=>{let u=l+s;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,h,h,h,h,h,h,h,h,h,()=>{$(e,q,d)}][u]||(()=>{}))(d,l)}),i&&e.buildRchTree()}).add([22,18,32],t=>{e.switchMode("mt32");let a=t[1],n=" ".repeat(a);t.subarray(2).forEach(s=>{s>31&&(n+=String.fromCharCode(s))}),$(e,ce,n.padStart(20," ")),$(e,Ee,Date.now()+3200)}).add([22,18,82],(t,a)=>{let n=e.chRedir(0,a,!0);for(let s=0;s<16;s++)r(e,B).ano(n+s),s&&s<10&&(r(e,A)[n+s]=ut[s-1]);console.info("MT-32 alt reset complete.")}),r(this,Se).add([66,0],(t,a)=>{e.switchMode("ns5r",!0),$(e,D,!1),console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][t[0]]} mode.`)}).add([66,1],(t,a)=>{e.switchMode(["ns5r","05rw"][t[0]],!0),$(e,D,!1)}).add([66,18,0,0],(t,a)=>{let n=t[0];switch(n){case 124:case 126:case 127:{e.switchMode("ns5r",!0),$(e,D,!1);break}case 125:{console.info(`NS5R drum setup reset: ${t}`);break}default:if(n<10){let s=[0,0,0,0],i=(h,d)=>{s[d]=h};if(t.subarray(1).forEach((h,d)=>{[i,i,i,i,()=>{$(e,q,h*129/16383*100)},()=>h-64,()=>h-64,()=>{},()=>{},()=>{}][n+d]()}),t[0]<4){let h=0;s.forEach(d=>{h=h<<4,h+=d}),h-=1024}}}}).add([66,18,0,1],(t,a)=>{}).add([66,18,0,2],(t,a)=>{}).add([66,18,1],(t,a)=>{let n=e.chRedir(t[0],a,!0),s=n*y.cc,i=t[1],h=`NS5R CH${n+1} `;t.subarray(2).forEach((d,l)=>{let u=i+l;u<3?[()=>{r(e,p)[s+g[0]]=d||121},()=>{r(e,p)[s+g[32]]=d},()=>{r(e,A)[n]=d}][u]():u<8||(u<14?[()=>{let b=e.chRedir(d,a,!0);r(e,H)[n]=b,n!=b&&(e.buildRchTree(),console.info(`${h}receives from CH${b+1}`))},()=>{r(e,ie)[n]=+!d},()=>{e.setChType(n,d,C.ns5r),console.debug(`${h}type: ${Qe[d]}`)},()=>{r(e,E)[y.rpn*n+3]=d},()=>{},()=>{}][u-8]():u<16||(u<33?[()=>{r(e,p)[s+g[7]]=d},()=>{r(e,p)[s+g[11]]=d},()=>{},()=>{},()=>{r(e,p)[s+g[10]]=d||128},()=>{},()=>{},()=>{r(e,p)[s+g[93]]=d},()=>{r(e,p)[s+g[91]]=d},()=>{r(e,p)[s+g[76]]=d},()=>{r(e,p)[s+g[77]]=d},()=>{r(e,p)[s+g[78]]=d},()=>{r(e,p)[s+g[74]]=d},()=>{r(e,p)[s+g[71]]=d},()=>{r(e,p)[s+g[73]]=d},()=>{r(e,p)[s+g[75]]=d},()=>{r(e,p)[s+g[72]]=d}][u-16]():u<112||u<114&&[()=>{r(e,p)[s+g[5]]=d},()=>{r(e,p)[s+g[65]]=d}][u-112]()))})}).add([66,18,8,0],(t,a)=>{let n=t[0];if(n<32)e.setLetterDisplay(t.subarray(1,33),"NS5R letter display");else{let s=n-32;$(e,se,Date.now()+3200),$(e,z,10),r(e,Y,le).fill(0);let i=t.subarray(1),h=4;i.forEach(function(d,l){let u=l+s,b=u>>4,w=u&15;if(u<80){let S=b<h?d:d>>3,x=0,m=b<h?6:3;for(;S>0;)r(e,Y,le)[w*32+b*7+(m-x)]=S&1,S=S>>1,x++}})}}).add([66,52],(t,a)=>{e.switchMode("ns5r",!0),$(e,D,!1);let n="";ae(t,(s,i)=>{i<8?(s>31&&(n+=String.fromCharCode(s)),i==7&&(e.aiEfxName=n)):i<10&&e.setEffectType(i-8,44,s)})}).add([66,53],(t,a)=>{e.switchMode("ns5r",!0),$(e,D,!1),ae(t,function(n,s){switch(!0){case s<2944:{let i=e.chRedir(Math.floor(s/92),a,!0),h=i*y.cc;switch(s%92){case 0:{r(e,p)[h+g[0]]=n||121;break}case 1:{r(e,p)[h+g[32]]=n;break}case 2:{r(e,A)[i]=n,n>0&&(r(e,j)[i]=1);break}case 3:{let d=e.chRedir(n,a,!0);r(e,H)[i]=d,i!=d&&(console.info(`NS5R CH${i+1} receives from CH${d+1}.`),e.buildRchTree())}case 7:break;case 8:{r(e,E)[i*y.rpn+3]=n<40||n>88?n+(n>63?-192:64):n;break}case 9:case 10:{r(e,p)[h+g[7]]=n;break}case 11:{r(e,p)[h+g[11]]=n;break}case 14:{r(e,p)[h+g[10]]=n||128;break}case 19:{r(e,p)[h+g[93]]=n;break}case 20:{r(e,p)[h+g[91]]=n;break}case 84:{r(e,p)[h+g[65]]=n;break}case 85:{r(e,p)[h+g[5]]=n;break}}break}case s<3096:break;case s<3134:break;case s<8566:break}})}).add([66,54],(t,a)=>{e.switchMode("ns5r",!0);let n="",s=80,i=0,h=0,d="MSB	PRG	LSB	NME";ae(t,function(l,u){let b=u%158;switch(!0){case b<10:{l>31&&(n+=String.fromCharCode(l));break}case b==11:{s=l&127;break}case b==12:{h=l&127;break}case b==13:{d+=`
${s}	${i}	${h}	${n.trim().replace("Init Voice","")}`,i++,n="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(d)}).add([66,55],(t,a)=>{e.switchMode("ns5r",!0);let n="",s=88,i=0,h=0,d="MSB	PRG	LSB	NME";ae(t,function(l,u){let b=u%126;switch(!0){case b<10:{l>31&&(n+=String.fromCharCode(l));break}case b==11:break;case b==12:break;case b==13:{d+=`
${s}	${i}	${h}	${n.trim().replace("Init Combi","")}`,i++,n="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(d)}).add([66,125],t=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][t[0]]||"white")}).add([66,127],t=>{let a=new Uint8Array(5760);ae(t,(n,s,i)=>{if(s<720)for(let h=0;h<8;h++)a[s*8+h]=n>>7-h&1}),e.dispatchEvent("screen",{type:"ns5r",data:a})}).add([76],(t,a,n)=>{r(e,Se).run([66,...t],a,n)}),r(this,Fe).add([16,0,8,0],(t,a,n)=>{let s=(t[2]<<4)+t[3],i="K11 ";([()=>{e.switchMode("k11",!0),$(e,D,!1),$(e,J,s?4:0),console.info("MIDI reset: GMega/K11")},()=>{console.debug(`${i}reverb type: ${s}`)},()=>{console.debug(`${i}reverb time: ${s}`)},()=>{console.debug(`${i}reverb time: ${s}`)},()=>{console.debug(`${i}reverb predelay: ${s}`)},()=>{console.debug(`${i}reverb predelay: ${s}`)},()=>{console.debug(`${i}depth high: ${s}`)},()=>{console.debug(`${i}depth high: ${s}`)},()=>{console.debug(`${i}depth low: ${s}`)},()=>{console.debug(`${i}depth low: ${s}`)}][t[0]]||(()=>{}))()}).add([16,0,8,1],(t,a,n)=>{let s=e.chRedir(t[1],a,!0),i=y.cc*s,h=y.rpn*s,d=(t[3]<<4)+t[4],l=`K11 CH${s+1} `;([()=>{d<128?(e.setChType(s,e.CH_MELODIC,C.k11),r(e,p)[i+g[0]]=0,r(e,A)[s]=d):(e.setChType(s,e.CH_DRUMS,C.k11),r(e,A)[s]=d-128)},()=>{let u=e.chRedir(d,a,!0);r(e,H)[s]=u,s!=u&&(e.buildRchTree(),console.info(`${l}receives from CH${u+1}`))},()=>{r(e,p)[i+g[7]]=d},()=>{r(e,j)[s]=d},()=>{r(e,p)[i+g[10]]=d},()=>{r(e,E)[h+3]=d+40},()=>{r(e,E)[h+1]=d>>1,r(e,E)[h+2]=d&1},()=>{r(e,p)[i+g[91]]=d?127:0},()=>{},()=>{r(e,p)[i+g[74]]=d},()=>{r(e,p)[i+g[73]]=d},()=>{r(e,p)[i+g[72]]=d}][t[0]]||(()=>{}))()}).add([16,0,9,0],(t,a,n)=>{let s=(t[2]<<4)+t[3],i="GMLX ";([()=>{console.debug(`${i}reverb type: ${s}`)},()=>{console.debug(`${i}reverb time: ${s}`)},()=>{console.debug(`${i}reverb predelay: ${s}`)},()=>{console.debug(`${i}depth high: ${s}`)},()=>{console.debug(`${i}depth low: ${s}`)}][t[0]]||(()=>{}))()}).add([16,0,9,3],(t,a,n)=>{let s=(t[2]<<4)+t[3],i=e.chRedir(t[1],a,!0),h=i*y.cc;[()=>{s<128?(e.setChType(i,e.CH_MELODIC,C.k11),r(e,p)[h+g[0]]=0,r(e,p)[h+g[32]]=0,r(e,A)[i]=s):s<160?(e.setChType(i,e.CH_MELODIC,C.k11),r(e,p)[h+g[0]]=0,r(e,p)[h+g[32]]=7,r(e,A)[i]=s-100):(e.setChType(i,e.CH_DRUMS,C.k11),r(e,p)[h+g[0]]=122,r(e,p)[h+g[32]]=0,r(e,A)[i]=s-160)},()=>{let d=e.chRedir(s,a,!0);r(e,H)[i]=d,i!=d&&(e.buildRchTree(),console.info(`GMLX CH${i+1} receives from CH${d+1}`))}][t[0]]()}).add([16,0,9,4],(t,a,n)=>{let s=(t[2]<<4)+t[3],i=e.chRedir(t[1],a,!0),h=i*y.cc,d=i*y.rpn,l=`GMLX CH${i+1} `;[()=>{r(e,j)[i]=s},()=>{r(e,p)[h+g[7]]=s},()=>{r(e,p)[h+g[10]]=s},()=>{r(e,p)[h+g[91]]=s?127:0},()=>{r(e,E)[d+3]=s+40},()=>{r(e,E)[d+1]=s},()=>{r(e,E)[d]=s},()=>{}][t[0]]()}),r(this,Ve).add([66,93,64],(t,a,n)=>{let s=t[2];switch(t[0]){case 0:{switch(t[1]){case 4:{$(e,q,s*129/16383*100);break}case 5:{s-64;break}case 6:{console.debug(`SG global reverb: ${s?"on":"off"}`);break}case 127:{e.switchMode("sg",!0);break}}break}case 1:{switch(t[1]){case 48:{console.debug(`SG reverb type: ${dt[s]}`);break}}break}default:if(t[0]>>4==1){let i=e.chRedir(t[0]&15,a,!0);if(t[1]==2){let h=e.chRedir(s,a,!0);r(e,H)[i]=h,i!=h&&(e.buildRchTree(),console.info(`SG CH${i+1} receives from CH${h+1}`))}else t[1]==19&&(r(e,p)[y.cc*i+g[7]]=s)}else console.warn(`Unknown AKAI SG SysEx: ${t}`)}}),r(this,Xe).add([9],(t,a,n)=>{console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremelo","phaser","rotary speaker","enhancer","flanger","EQ"][t[0]]||"off"}`)})}chRedir(e,o,c){if(r(this,ke)[o])return(r(this,ke)[o]-1)*16+e;if([2,3].indexOf(r(this,J))>-1){if(c==1)return e;let t=0,a=!0;for(;a;)r(this,ue)[e+t]==0?(r(this,ue)[e+t]=o,console.debug(`Assign track ${o} to channel ${e+t+1}.`),a=!1):r(this,ue)[e+t]==o?a=!1:(t+=16,t>=128&&(t=0,a=!1));return e+t}else return e}buildRchTree(){let e=[];r(this,H).forEach((o,c)=>{var t;(t=e[o])!=null&&t.constructor||(e[o]=[]),e[o].push(c)}),$(this,Je,e)}getActive(){let e=r(this,j).slice();return r(this,I)==C.mt32,e}getCc(e){let o=e*y.cc,c=r(this,p).subarray(o,o+y.cc);return c[g[0]]=c[g[0]]||r(this,me),c[g[32]]=c[g[32]]||r(this,J),c}getCcCh(e,o){if(We.indexOf(o)<0)throw new Error("CC number not accepted");return r(this,p)[y.cc*e+g[o]]}getCcAll(){let e=r(this,p).slice();for(let o=0;o<y.ch;o++){let c=o*y.cc;e[c+g[0]]=e[c+g[0]]||r(this,me),e[c+g[32]]=e[c+g[32]]||r(this,J)}return e}getChType(){return r(this,R)}setChType(e,o,c=r(this,I)){o&=15,r(this,R)[e]=o,o>0&&(r(this,p)[e*y.cc+g[0]]=Me[c])}getPitch(){return r(this,$e)}getProgram(){return r(this,A)}getTexts(){return r(this,T).slice()}getVel(e){let o=new Map,c=this;return r(c,L).forEach(function(t,a){let n=Math.floor(t/128),s=t%128;e==n&&r(c,U)[t]>0&&o.set(s,{v:r(c,U)[t],s:r(c,N)[a]})}),o}getBitmap(){return{bitmap:r(this,Y,le),expire:r(this,se)}}getLetter(){return{text:r(this,ce),expire:r(this,Ee)}}getMode(){return ye[r(this,I)]}getMaster(){return{volume:r(this,q)}}getRawStrength(){let e=this;return r(this,L).forEach(function(o){let c=Math.floor(o/128);r(e,U)[o]>r(e,ne)[c]&&(r(e,ne)[c]=r(e,U)[o])}),r(this,ne)}getStrength(){let e=[],o=this;return this.getRawStrength().forEach(function(c,t){e[t]=Math.floor(c*r(o,p)[t*y.cc+g[7]]*r(o,p)[t*y.cc+g[11]]*r(o,q)/803288)}),e}getRpn(){return r(this,E)}getNrpn(){return r(this,Ue)}getVoice(e,o,c,t){let a=e||r(this,me),n=o,s=c||r(this,J);ye[r(this,I)]=="ns5r"&&a>0&&a<56&&(s=3);let i=this.userBank.get(a,n,s,t);if(ye[r(this,I)]=="mt32"&&i.name.indexOf("MT-m:")==0){let h=parseInt(i.name.slice(5)),d=h*y.cmt,l="";r(this,we).subarray(d,d+10).forEach(u=>{u>31&&(l+=String.fromCharCode(u))}),this.userBank.load(`MSB	LSB	PRG
0	127	${n}	${l}`,!0),i.name=l,i.ending=" "}return(i.ending!=" "||!i.name.length)&&(i=this.baseBank.get(a,n,s,t)),i}getChVoice(e){let o=this.getVoice(r(this,p)[e*y.cc+g[0]],r(this,A)[e],r(this,p)[e*y.cc+g[32]],ye[r(this,I)]);if(r(this,oe)[e])switch(r(this,I)){case C.mt32:o.ending="~",o.name="",r(this,Z).subarray(14*(e-1),14*(e-1)+10).forEach(c=>{c>31&&(o.name+=String.fromCharCode(c))})}return o}getPitchShift(e){let o=e*y.rpn;return r(this,$e)[e]/8192*r(this,E)[o]+(r(this,E)[o+3]-64)+((r(this,E)[o+1]<<7)+r(this,E)[o+2]-8192)/8192}getEffectType(e=0){let o=3*e+1;return r(this,Q).subarray(o,o+2)}setEffectTypeRaw(e=0,o,c){let t=3*e;r(this,Q)[t]=1,r(this,Q)[t+1+ +o]=c}setEffectType(e=0,o,c){this.setEffectTypeRaw(e,!1,o),this.setEffectTypeRaw(e,!0,c)}setLetterDisplay(e,o,c=0,t=3200){let a=this,n;$(a,ce," ".repeat(c)),e.forEach(s=>{$(a,ce,r(a,ce)+String.fromCharCode(s>31?s:32)),s<32&&(n=n||new Set,n.add(s))}),$(a,Ee,Date.now()+3200),$(a,ce,r(a,ce).padEnd(32," ")),n&&(n=Array.from(n),n.forEach((s,i,h)=>{h[i]=s.toString(16).padStart(2,"0")}),console.warn(`${o}${o?" ":""}invalid code point${n.length>1?"s":""}: 0x${n.join(", 0x")}`))}allocateAce(e){if(!e||e>95){console.warn(`cc${e} cannot be allocated as an active custom effect.`);return}let o=!0,c=0;for(;o&&c<y.ace;)r(this,de)[c]==e?o=!1:r(this,de)[c]||(o=!1,r(this,de)[c]=e,console.info(`Allocated cc${e} to ACE slot ${c}.`)),c++;c>=y.ace&&console.warn("ACE slots are full.")}getAce(){return r(this,de)}getChAce(e,o){if(o<0||o>=y.ace)throw new RangeError("No such ACE slot");let c=r(this,de)[o];if(c){if(We.indexOf(c)>=0)return r(this,p)[e*y.cc+g[c]];throw new Error(`Invalid ACE source: ${c}`)}else return 0}init(e=0){this.dispatchEvent("mode","?"),$(this,I,0),$(this,me,0),$(this,J,0),$(this,fe,0),r(this,j).fill(0),r(this,p).fill(0),r(this,de).fill(0),r(this,A).fill(0),r(this,U).fill(0),r(this,L).fill(0),r(this,ne).fill(0),r(this,$e).fill(0),r(this,Ue).fill(0),r(this,Ze).fill(0),$(this,q,100),$(this,T,[]),$(this,Be,500),$(this,Ne,0),$(this,Ee,0),$(this,ce,""),$(this,se,0),$(this,z,0),r(this,Y,le).fill(0),$(this,D,!1),$(this,He,0),$(this,ee,!0),r(this,H).forEach(function(o,c,t){t[c]=c}),this.buildRchTree(),e==0&&(r(this,ue).fill(0),r(this,ke).fill(0)),r(this,p)[y.cc*9]=Me[0],r(this,p)[y.cc*25]=Me[0],r(this,p)[y.cc*41]=Me[0],r(this,p)[y.cc*57]=Me[0],r(this,R).fill(this.CH_MELODIC),r(this,R)[9]=this.CH_DRUM1,r(this,R)[25]=this.CH_DRUM3,r(this,R)[41]=this.CH_DRUMS,r(this,R)[57]=this.CH_DRUMS,r(this,R)[73]=this.CH_DRUM5,r(this,R)[89]=this.CH_DRUM7,r(this,R)[105]=this.CH_DRUMS,r(this,R)[121]=this.CH_DRUMS,r(this,Le).fill(0),r(this,we).fill(0),r(this,ve).fill(0),r(this,Z).fill(0),r(this,oe).fill(0),r(this,Q).fill(0),this.aiEfxName="",this.userBank.clearRange({msb:0,lsb:127,prg:[0,127]});for(let o=0;o<y.ch;o++){let c=o*y.cc;r(this,p)[c+g[7]]=100,r(this,p)[c+g[11]]=127,r(this,p)[c+g[10]]=64,r(this,p)[c+g[71]]=64,r(this,p)[c+g[72]]=64,r(this,p)[c+g[73]]=64,r(this,p)[c+g[74]]=64,r(this,p)[c+g[75]]=64,r(this,p)[c+g[76]]=64,r(this,p)[c+g[77]]=64,r(this,p)[c+g[78]]=64,r(this,p)[c+g[91]]=40,r(this,p)[c+g[101]]=127,r(this,p)[c+g[100]]=127,r(this,p)[c+g[99]]=127,r(this,p)[c+g[98]]=127;let t=o*y.rpn;r(this,E)[t]=2,r(this,E)[t+1]=64,r(this,E)[t+2]=0,r(this,E)[t+3]=64,r(this,E)[t+4]=0,r(this,E)[t+5]=0}}switchMode(e,o=!1){let c=ye.indexOf(e);if(c>-1){if(r(this,I)==0||o){let t=r(this,I);$(this,I,c),$(this,z,0),$(this,me,Nt[0][c]),$(this,J,Nt[1][c]);for(let n=0;n<y.ch;n++)r(this,R)[n]>0&&r(this,p)[n*y.cc+g[0]]==Me[t]&&(r(this,p)[n*y.cc]=Me[c]);switch(this.initOnReset,c){case C.mt32:{ut.forEach((n,s)=>{let i=s+1;r(this,j)[i]||(r(this,A)[i]=n,r(this,p)[i*y.cc+g[91]]=127)});break}}let a;switch(c){case C.gs:{a=[40,4,40,18,40,32,32,0,0,0,0,0,0,0];break}case C.x5d:case C.ns5r:{a=[44,1,44,19,44,0,44,0,0,0,0,0,0,0];break}default:a=[1,0,65,0,5,0,0,0,0,0,0,0,0,0]}for(let n=0;n<y.efx;n++)r(this,Q)[3*n]||(r(this,Q)[3*n+1]=a[2*n],r(this,Q)[3*n+2]=a[2*n+1]);this.dispatchEvent("mode",e)}}else throw new Error(`Unknown mode ${e}`)}newStrength(){r(this,ne).fill(0)}runJson(e){var o;if(e.type>14)return e.type==15&&e.data.constructor!=Uint8Array&&(e.data=Uint8Array.from(e.data)),r(this,et)[e.type].call(this,e);{let c=this.chRedir(e.part,e.track),t=!1;(o=r(this,Je)[c])==null||o.forEach(a=>{e.channel=a,t=!0,r(this,et)[e.type].call(this,e)}),t||console.warn(`${Ht[e.type]?Ht[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!=null?e.data[0]:e.data).toString():""} event sent to CH${c+1} without any recipient.`)}r(this,T).length>100&&r(this,T).splice(100,r(this,T).length-99)}runRaw(e){}},I=new WeakMap,z=new WeakMap,se=new WeakMap,he=new WeakMap,Y=new WeakSet,le=function(){return r(this,he)[r(this,z)]},Kt=function(e){r(this,he)[r(this,z)]=e},j=new WeakMap,H=new WeakMap,R=new WeakMap,p=new WeakMap,de=new WeakMap,A=new WeakMap,U=new WeakMap,ie=new WeakMap,L=new WeakMap,N=new WeakMap,$e=new WeakMap,ne=new WeakMap,Ce=new WeakMap,E=new WeakMap,Ue=new WeakMap,Ze=new WeakMap,oe=new WeakMap,ve=new WeakMap,Z=new WeakMap,Le=new WeakMap,we=new WeakMap,Q=new WeakMap,me=new WeakMap,J=new WeakMap,q=new WeakMap,fe=new WeakMap,Be=new WeakMap,Ne=new WeakMap,ce=new WeakMap,Ee=new WeakMap,He=new WeakMap,ee=new WeakMap,D=new WeakMap,Je=new WeakMap,gt=new WeakMap,T=new WeakMap,ue=new WeakMap,ke=new WeakMap,G=new WeakMap,Te=new WeakMap,B=new WeakMap,et=new WeakMap,st=new WeakMap,Ge=new WeakMap,_e=new WeakMap,pe=new WeakMap,ge=new WeakMap,Se=new WeakMap,Fe=new WeakMap,Ve=new WeakMap,Xe=new WeakMap,Xt);var wt=or(zt(),1);O();O();var tt,jt,qt=(jt=class{constructor(f,e,o,c){v(this,tt,!1);$(this,tt,f),this.start=e,this.end=o,this.data=c}get duration(){return this.ranged?this.end-this.start:0}get ranged(){return r(this,tt)}},tt=new WeakMap,jt),$t=class extends qt{constructor(f,e,o){super(!0,f,e,o)}},Yt=class extends qt{constructor(f,e){super(!1,f,f,e)}},Re,Qt,vt=(Qt=class extends Array{constructor(){super(...arguments);v(this,Re,-1)}resetIndex(e){$(this,Re,-1)}fresh(){this.sort(function(e,o){return e.start==o.start?0:(+(e.start>o.start)<<1)-1}),this.forEach(function(e,o){e.index=o})}step(e,o=!1){let c=[];if(o)for(let t=0;t<this.length&&!(this[t].start>e);t++){if(this[t].end<e)continue;c.push(this[t])}else{let t=this.getRange(r(this,Re)==-1?0:e-1,e),a=this;t.forEach(function(n){n.index>r(a,Re)&&(c.push(n),$(a,Re,n.index))})}return c}getRange(e,o){var s;e>o&&([e,o]=[o,e]);let c=[],t=-1,a=Math.ceil(Math.sqrt(this.length)),n=!0;for(let i=0;i<this.length;i+=a)this[i+a]?t<0&&this[i+a].start>=e&&(t=i):t=t<0?i:t;for(;n;)((s=this[t])==null?void 0:s.end)<o?this[t].start>=e&&c.push(this[t]):n=!1,t++;return c}},Re=new WeakMap,Qt);var br=0xffffffffffff,Wt=function(f){let e=new vt,o=this,c=f.timeDivision,t=120,a=new vt,n=0,s=0;a.push(new $t(0,br,[120,0])),f.track.forEach(function(l){n=0,l.event.forEach(function(u){n+=u.deltaTime,u.type==255&&(u==null?void 0:u.metaType)==81&&(t=6e7/u.data,a[a.length-1]&&a.push(new $t(n,0xffffffffffff,[t,0])))})}),a.fresh(),a.forEach(function(l,u,b){u>0&&(b[u-1].end=l.start)});let i=120;a.forEach(function(l,u,b){u>0&&(l.end==l.start?b.splice(b.indexOf(l),1):i==l.data[0]&&(b[u-1].end=l.end,b.splice(b.indexOf(l),1)),i=l.data[0])});let h=0,d=120;return a.forEach(function(l){let u=l.start,b=u/d/c*60+h;d=l.data[0],h=b-u/d/c*60,l.data[1]=h}),console.debug("All tempo changes: ",a),t=120,n=0,s=0,f.track.forEach(function(l,u){n=0,s=0;let b=u+1;l.event.forEach(function(w,S){n+=w.deltaTime;let x=a.step(n,!0)[0];x&&(t=x.data[0],s=x.data[1]);let m={type:w.type,data:w.data,track:b,part:0};w.type>14?m.meta=w.metaType:m.part=w.channel,e.push(new Yt(n/t/c*60+s,m))})}),e.fresh(),self.midiEvents=e,console.debug(`Parsed a type ${f.formatType} MIDI sequence.`),e};wt.default.customInterpreter=Lt;var Ke,Oe,Ae,Ie,rt,xe,ze,_,De,be,Pe,Zt,ua=(Zt=class extends at{constructor(e,o=.5,c=.5){super();M(this,"device");v(this,Ke,void 0);v(this,Oe,"");v(this,Ae,[]);v(this,Ie,new Uint8ClampedArray(128));v(this,rt,new Uint8ClampedArray(128));v(this,xe,.5);v(this,ze,120);v(this,_,4);v(this,De,4);v(this,be,0);v(this,Pe,0);M(this,"smoothingAtk",0);M(this,"smoothingDcy",0);let t=this;this.smoothingAtk=o,this.smoothingDcy=c,this.device=e,this.addEventListener("meta",function(a){var n;(n=a==null?void 0:a.data)==null||n.forEach(function(s){(r(t,Ae)[s.meta]||console.debug).call(t,s.meta,s.data)})}),this.device.addEventListener("mode",function(a){t.dispatchEvent("mode",a.data)}),this.device.addEventListener("channelactive",function(a){t.dispatchEvent("channelactive",a.data)}),this.device.addEventListener("channelmin",function(a){t.dispatchEvent("channelmin",a.data)}),this.device.addEventListener("channelmax",function(a){t.dispatchEvent("channelmax",a.data)}),this.device.addEventListener("channelreset",function(a){t.dispatchEvent("channelreset")}),this.device.addEventListener("screen",function(a){t.dispatchEvent("screen",a.data)}),r(this,Ae)[3]=function(a,n){var s;((s=r(t,Oe))==null?void 0:s.length)<1&&$(t,Oe,n)},r(this,Ae)[81]=function(a,n){let s=t.noteProgress,i=r(t,xe)||.5;$(t,ze,6e7/n),$(t,xe,n/1e6),$(t,be,r(t,be)+(s*(i/r(t,xe))-s))},r(this,Ae)[88]=function(a,n){let s=t.noteProgress,i=t.noteOverall,h=t.noteBar,d=t.noteBeat,l=r(t,_),u=r(t,De);$(t,_,n[0]),$(t,De,1<<n[1]);let b=24*(32/n[3])/n[2];if(l!=r(t,_)){let w=h;$(t,be,r(t,be)-w*(r(t,_)-l)),d+1>=l&&(l<r(t,_)?$(t,be,r(t,be)-Math.ceil(r(t,_)-d-1)):$(t,be,r(t,be)+r(t,_)))}}}reset(){var e;this.dispatchEvent("reset"),(e=r(this,Ke))==null||e.resetIndex(),this.device.init(),$(this,Oe,""),$(this,xe,.5),$(this,ze,120),$(this,_,4),$(this,De,4),$(this,be,0),$(this,Pe,0)}async loadFile(e){$(this,Ke,Wt(wt.default.parse(new Uint8Array(await e.arrayBuffer()))))}switchMode(e,o=!1){this.device.switchMode(e,o)}getMode(){return this.device.getMode()}getVoice(){return this.device.getVoice(...arguments)}getChVoice(e){return this.device.getChVoice(e)}get noteProgress(){return r(this,Pe)/r(this,xe)}get noteOverall(){return this.noteProgress-r(this,be)}get noteBar(){return Math.floor(this.noteOverall/r(this,_))}get noteBeat(){let e=this.noteOverall%r(this,_);return e<0&&(e+=r(this,_)),e}getTimeSig(){return[r(this,_),r(this,De)]}getTempo(){return r(this,ze)}sendCmd(e){this.device.runJson(e)}render(e){var x;e>r(this,Pe)&&$(this,Pe,e);let o=((x=r(this,Ke))==null?void 0:x.step(e))||[],c=0,t=new Set,a=this,n=[];this.device.getStrength().forEach((m,k)=>{r(this,rt)[k]=m}),a.device.newStrength(),o.forEach(function(m){let k=m.data;k.type==9&&(k.data[1]>0?t.add(k.part*128+k.data[0]):t.has(k.part*128+k.data[0])&&c++),m.data.type==8&&t.has(k.part*128+k.data[0])&&c++;let P=a.device.runJson(k);switch(P==null?void 0:P.reply){case"meta":{n.push(P);break}}P!=null&&P.reply&&delete P.reply}),(n==null?void 0:n.length)>0&&this.dispatchEvent("meta",n);let s=this.device.getActive(),i=[],h=a.device.getPitch(),d=a.device.getCcAll(),l=a.device.getProgram(),u=a.device.getChType(),b=this.device.getStrength();b.forEach(function(m,k,P){P[k]=Math.max(r(a,rt)[k],m);let F=P[k]-r(a,Ie)[k],te=g.length*k;if(F>=0){let nt=4*.25**(d[te+g[73]]/64);r(a,Ie)[k]+=Math.ceil(F-F*a.smoothingAtk**nt)}else{let nt=4*.25**(d[te+g[72]]/64);r(a,Ie)[k]+=Math.floor(F-F*a.smoothingDcy**nt)}});let w=0;return s.forEach(function(m,k){m&&(i[k]=a.device.getVel(k),w+=i[k].size)}),{extraPoly:c,curPoly:w,chInUse:s,chKeyPr:i,chPitch:h,chProgr:l,chContr:d,chType:u,eventCount:o.length,title:r(this,Oe),bitmap:this.device.getBitmap(),letter:this.device.getLetter(),texts:this.device.getTexts(),master:this.device.getMaster(),mode:this.device.getMode(),strength:r(this,Ie).slice(),velo:b,rpn:this.device.getRpn(),tSig:this.getTimeSig(),tempo:this.getTempo(),noteBar:this.noteBar,noteBeat:this.noteBeat,ace:this.device.getAce()}}},Ke=new WeakMap,Oe=new WeakMap,Ae=new WeakMap,Ie=new WeakMap,rt=new WeakMap,xe=new WeakMap,ze=new WeakMap,_=new WeakMap,De=new WeakMap,be=new WeakMap,Pe=new WeakMap,Zt);export{ua as RootDisplay,g as ccToPos,bt as dnToPos};
