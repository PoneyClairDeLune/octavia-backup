var __create=Object.create;var __defProp=Object.defineProperty;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropNames=Object.getOwnPropertyNames;var __getProtoOf=Object.getPrototypeOf,__hasOwnProp=Object.prototype.hasOwnProperty;var __esm=(fn,res)=>function(){return fn&&(res=(0,fn[__getOwnPropNames(fn)[0]])(fn=0)),res};var __commonJS=(cb,mod)=>function(){return mod||(0,cb[__getOwnPropNames(cb)[0]])((mod={exports:{}}).exports,mod),mod.exports};var __copyProps=(to,from,except,desc)=>{if(from&&typeof from=="object"||typeof from=="function")for(let key of __getOwnPropNames(from))!__hasOwnProp.call(to,key)&&key!==except&&__defProp(to,key,{get:()=>from[key],enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable});return to};var __toESM=(mod,isNodeMode,target)=>(target=mod!=null?__create(__getProtoOf(mod)):{},__copyProps(isNodeMode||!mod||!mod.__esModule?__defProp(target,"default",{value:mod,enumerable:!0}):target,mod));var init_prefix=__esm({"src/midi/prefix.js"(){"use strict"}});var require_main_min=__commonJS({"libs/midi-parser@colxi/main.min.js"(exports,module){init_prefix();(function(){"use strict";let n={debug:!1,parse:function(e,t){if(e instanceof Uint8Array)return n.Uint8(e);if(typeof e=="string")return n.Base64(e);if(e instanceof HTMLElement&&e.type==="file")return n.addListener(e,t);throw new Error("MidiParser.parse() : Invalid input provided")},addListener:function(e,r){if(!File||!FileReader)throw new Error("The File|FileReader APIs are not supported in this browser. Use instead MidiParser.Base64() or MidiParser.Uint8()");if(e===void 0||!(e instanceof HTMLElement)||e.tagName!=="INPUT"||e.type.toLowerCase()!=="file")return console.warn("MidiParser.addListener() : Provided element is not a valid FILE INPUT element"),!1;r=r||function(){},e.addEventListener("change",function(e2){if(!e2.target.files.length)return!1;console.log("MidiParser.addListener() : File detected in INPUT ELEMENT processing data..");let t=new FileReader;t.readAsArrayBuffer(e2.target.files[0]),t.onload=function(e3){r(n.Uint8(new Uint8Array(e3.target.result)))}})},Base64:function(e){let t=function(e2){var t2="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(e2=e2.replace(/^.*?base64,/,""),e2=String(e2).replace(/[\t\n\f\r ]+/g,""),!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(e2))throw new TypeError("Failed to execute _atob() : The string to be decoded is not correctly encoded.");e2+="==".slice(2-(3&e2.length));let r2,a2="",n2,i,d=0;for(;d<e2.length;)r2=t2.indexOf(e2.charAt(d++))<<18|t2.indexOf(e2.charAt(d++))<<12|(n2=t2.indexOf(e2.charAt(d++)))<<6|(i=t2.indexOf(e2.charAt(d++))),a2+=n2===64?String.fromCharCode(r2>>16&255):i===64?String.fromCharCode(r2>>16&255,r2>>8&255):String.fromCharCode(r2>>16&255,r2>>8&255,255&r2);return a2}(e=String(e));var r=t.length;let a=new Uint8Array(new ArrayBuffer(r));for(let e2=0;e2<r;e2++)a[e2]=t.charCodeAt(e2);return n.Uint8(a)},Uint8:function(e){let i={data:null,pointer:0,movePointer:function(e2){return this.pointer+=e2,this.pointer},readInt:function(t2){if((t2=Math.min(t2,this.data.byteLength-this.pointer))<1)return-1;let r=0;if(1<t2)for(let e2=1;e2<=t2-1;e2++)r+=this.data.getUint8(this.pointer)*Math.pow(256,t2-e2),this.pointer++;return r+=this.data.getUint8(this.pointer),this.pointer++,r},readStr:function(t2){let r="";for(let e2=1;e2<=t2;e2++)r+=String.fromCharCode(this.readInt(1));return r},backOne:function(){this.pointer--},readIntVLV:function(){let r=0;if(this.pointer>=this.data.byteLength)return-1;if(this.data.getUint8(this.pointer)<128)r=this.readInt(1);else{let t2=[];for(;128<=this.data.getUint8(this.pointer);)t2.push(this.readInt(1)-128);var e2=this.readInt(1);for(let e3=1;e3<=t2.length;e3++)r+=t2[t2.length-e3]*Math.pow(128,e3);r+=e2}return r}};if(i.data=new DataView(e.buffer,e.byteOffset,e.byteLength),i.readInt(4)!==1297377380)return console.warn("Header validation failed (not MIDI standard or file corrupt.)"),!1;i.readInt(4);let d={};d.formatType=i.readInt(2),d.tracks=i.readInt(2),d.track=[];var e=i.readInt(1),t=i.readInt(1);128<=e?(d.timeDivision=[],d.timeDivision[0]=e-128,d.timeDivision[1]=t):d.timeDivision=256*e+t;for(let n2=1;n2<=d.tracks;n2++){d.track[n2-1]={event:[]};var s,o=i.readInt(4);if(o===-1)break;if(o!==1297379947)return!1;i.readInt(4);let e2=0,t2=!1,r,a;for(;!t2&&(e2++,d.track[n2-1].event[e2-1]={},d.track[n2-1].event[e2-1].deltaTime=i.readIntVLV(),(r=i.readInt(1))!==-1);)if(128<=r?a=r:(r=a,i.movePointer(-1)),r===255){d.track[n2-1].event[e2-1].type=255,d.track[n2-1].event[e2-1].metaType=i.readInt(1);var c=i.readIntVLV();switch(d.track[n2-1].event[e2-1].metaType){case 47:case-1:t2=!0;break;case 1:case 2:case 3:case 4:case 5:case 7:case 6:d.track[n2-1].event[e2-1].data=i.readStr(c);break;case 33:case 89:case 81:d.track[n2-1].event[e2-1].data=i.readInt(c);break;case 84:d.track[n2-1].event[e2-1].data=[],d.track[n2-1].event[e2-1].data[0]=i.readInt(1),d.track[n2-1].event[e2-1].data[1]=i.readInt(1),d.track[n2-1].event[e2-1].data[2]=i.readInt(1),d.track[n2-1].event[e2-1].data[3]=i.readInt(1),d.track[n2-1].event[e2-1].data[4]=i.readInt(1);break;case 88:d.track[n2-1].event[e2-1].data=[],d.track[n2-1].event[e2-1].data[0]=i.readInt(1),d.track[n2-1].event[e2-1].data[1]=i.readInt(1),d.track[n2-1].event[e2-1].data[2]=i.readInt(1),d.track[n2-1].event[e2-1].data[3]=i.readInt(1);break;default:this.customInterpreter!==null&&(d.track[n2-1].event[e2-1].data=this.customInterpreter(d.track[n2-1].event[e2-1].metaType,i,c)),this.customInterpreter!==null&&d.track[n2-1].event[e2-1].data!==!1||(i.readInt(c),d.track[n2-1].event[e2-1].data=i.readInt(c),this.debug&&console.info("Unimplemented 0xFF meta event! data block readed as Integer"))}}else switch((r=r.toString(16).split(""))[1]||r.unshift("0"),d.track[n2-1].event[e2-1].type=parseInt(r[0],16),d.track[n2-1].event[e2-1].channel=parseInt(r[1],16),d.track[n2-1].event[e2-1].type){case 15:this.customInterpreter!==null&&(d.track[n2-1].event[e2-1].data=this.customInterpreter(d.track[n2-1].event[e2-1].type,i,!1)),this.customInterpreter!==null&&d.track[n2-1].event[e2-1].data!==!1||(s=i.readIntVLV(),d.track[n2-1].event[e2-1].data=i.readInt(s),this.debug&&console.info("Unimplemented 0xF exclusive events! data block readed as Integer"));break;case 10:case 11:case 14:case 8:case 9:d.track[n2-1].event[e2-1].data=[],d.track[n2-1].event[e2-1].data[0]=i.readInt(1),d.track[n2-1].event[e2-1].data[1]=i.readInt(1);break;case 12:case 13:d.track[n2-1].event[e2-1].data=i.readInt(1);break;case-1:t2=!0;break;default:if(this.customInterpreter!==null&&(d.track[n2-1].event[e2-1].data=this.customInterpreter(d.track[n2-1].event[e2-1].metaType,i,!1)),this.customInterpreter===null||d.track[n2-1].event[e2-1].data===!1)return console.log("Unknown EVENT detected... reading cancelled!"),!1}}return d},customInterpreter:null};if(typeof module<"u")module.exports=n;else{let e=typeof window=="object"&&window.self===window&&window||typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;e.MidiParser=n}})()}});init_prefix();var import_main_min=__toESM(require_main_min(),1);
//# sourceMappingURL=midi.mjs.map
