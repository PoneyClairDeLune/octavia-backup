"use strict";(()=>{var bt=Object.create;var Te=Object.defineProperty;var yt=Object.getOwnPropertyDescriptor;var wt=Object.getOwnPropertyNames;var $t=Object.getPrototypeOf,vt=Object.prototype.hasOwnProperty;var Mt=(e,i)=>()=>(i||e((i={exports:{}}).exports,i),i.exports);var St=(e,i,l,t)=>{if(i&&typeof i=="object"||typeof i=="function")for(let r of wt(i))!vt.call(e,r)&&r!==l&&Te(e,r,{get:()=>i[r],enumerable:!(t=yt(i,r))||t.enumerable});return e};var xe=(e,i,l)=>(l=e!=null?bt($t(e)):{},St(i||!e||!e.__esModule?Te(l,"default",{value:e,enumerable:!0}):l,e));var ue=Mt((gr,de)=>{(function(){"use strict";let e={fatal:!0},i=[new TextDecoder("sjis",e),new TextDecoder("euc-jp",e),new TextDecoder("utf-8")],l={debug:!1,parse:function(t,r){if(t instanceof Uint8Array)return l.Uint8(t);if(typeof t=="string")return l.Base64(t);if(t instanceof HTMLElement&&t.type==="file")return l.addListener(t,r);throw new Error("MidiParser.parse() : Invalid input provided")},addListener:function(t,r){if(!File||!FileReader)throw new Error("The File|FileReader APIs are not supported in this browser. Use instead MidiParser.Base64() or MidiParser.Uint8()");if(t===void 0||!(t instanceof HTMLElement)||t.tagName!=="INPUT"||t.type.toLowerCase()!=="file")return console.warn("MidiParser.addListener() : Provided element is not a valid FILE INPUT element"),!1;r=r||function(){},t.addEventListener("change",function(s){if(!s.target.files.length)return!1;console.log("MidiParser.addListener() : File detected in INPUT ELEMENT processing data..");let n=new FileReader;n.readAsArrayBuffer(s.target.files[0]),n.onload=function(a){r(l.Uint8(new Uint8Array(a.target.result)))}})},Base64:function(t){let r=function(a){var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(a=a.replace(/^.*?base64,/,""),a=String(a).replace(/[\t\n\f\r ]+/g,""),!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(a))throw new TypeError("Failed to execute _atob() : The string to be decoded is not correctly encoded.");a+="==".slice(2-(3&a.length));let h,c="",f,d,g=0;for(;g<a.length;)h=o.indexOf(a.charAt(g++))<<18|o.indexOf(a.charAt(g++))<<12|(f=o.indexOf(a.charAt(g++)))<<6|(d=o.indexOf(a.charAt(g++))),c+=f===64?String.fromCharCode(h>>16&255):d===64?String.fromCharCode(h>>16&255,h>>8&255):String.fromCharCode(h>>16&255,h>>8&255,255&h);return c}(t=String(t));var s=r.length;let n=new Uint8Array(new ArrayBuffer(s));for(let a=0;a<s;a++)n[a]=r.charCodeAt(a);return l.Uint8(n)},Uint8:function(n){let r={data:null,pointer:0,movePointer:function(f){return this.pointer+=f,this.pointer},readInt:function(f){if((f=Math.min(f,this.data.byteLength-this.pointer))<1)return-1;let d=0;if(1<f)for(let g=1;g<=f-1;g++)d+=this.data.getUint8(this.pointer)*Math.pow(256,f-g),this.pointer++;return d+=this.data.getUint8(this.pointer),this.pointer++,d},readStr:function(f){let d=new Uint8Array(f),g=!1,y;d.forEach((w,v)=>{d[v]=this.readInt(1)});for(let w=0;w<i.length;w++)if(!g)try{y=i[w].decode(d),g=!0}catch{}return y||"Byte read failed."},backOne:function(){this.pointer--},readIntVLV:function(){let f=0;if(this.pointer>=this.data.byteLength)return-1;if(this.data.getUint8(this.pointer)<128)f=this.readInt(1);else{let g=[];for(;128<=this.data.getUint8(this.pointer);)g.push(this.readInt(1)-128);var d=this.readInt(1);for(let y=1;y<=g.length;y++)f+=g[g.length-y]*Math.pow(128,y);f+=d}return f}};if(r.data=new DataView(n.buffer,n.byteOffset,n.byteLength),r.readInt(4)!==1297377380)return console.warn("Header validation failed (not MIDI standard or file corrupt.)"),!1;r.readInt(4);let s={};s.formatType=r.readInt(2),s.tracks=r.readInt(2),s.track=[];var n=r.readInt(1),a=r.readInt(1);128<=n?(s.timeDivision=[],s.timeDivision[0]=n-128,s.timeDivision[1]=a):s.timeDivision=256*n+a;for(let f=1;f<=s.tracks;f++){s.track[f-1]={event:[]};var o,h=r.readInt(4);if(h===-1)break;if(h!==1297379947)return!1;r.readInt(4);let d=0,g=!1,y,w;for(;!g&&(d++,s.track[f-1].event[d-1]={},s.track[f-1].event[d-1].deltaTime=r.readIntVLV(),(y=r.readInt(1))!==-1);)if(128<=y?w=y:(y=w,r.movePointer(-1)),y===255){s.track[f-1].event[d-1].type=255,s.track[f-1].event[d-1].metaType=r.readInt(1);var c=r.readIntVLV();switch(s.track[f-1].event[d-1].metaType){case 47:case-1:g=!0;break;case 1:case 2:case 3:case 4:case 5:case 7:case 6:s.track[f-1].event[d-1].data=r.readStr(c);break;case 33:case 89:case 81:s.track[f-1].event[d-1].data=r.readInt(c);break;case 84:s.track[f-1].event[d-1].data=[],s.track[f-1].event[d-1].data[0]=r.readInt(1),s.track[f-1].event[d-1].data[1]=r.readInt(1),s.track[f-1].event[d-1].data[2]=r.readInt(1),s.track[f-1].event[d-1].data[3]=r.readInt(1),s.track[f-1].event[d-1].data[4]=r.readInt(1);break;case 88:s.track[f-1].event[d-1].data=[],s.track[f-1].event[d-1].data[0]=r.readInt(1),s.track[f-1].event[d-1].data[1]=r.readInt(1),s.track[f-1].event[d-1].data[2]=r.readInt(1),s.track[f-1].event[d-1].data[3]=r.readInt(1);break;default:this.customInterpreter!==null&&(s.track[f-1].event[d-1].data=this.customInterpreter(s.track[f-1].event[d-1].metaType,r,c)),this.customInterpreter!==null&&s.track[f-1].event[d-1].data!==!1||(r.readInt(c),s.track[f-1].event[d-1].data=r.readInt(c),this.debug&&console.info("Unimplemented 0xFF meta event! data block readed as Integer"))}}else switch((y=y.toString(16).split(""))[1]||y.unshift("0"),s.track[f-1].event[d-1].type=parseInt(y[0],16),s.track[f-1].event[d-1].channel=parseInt(y[1],16),s.track[f-1].event[d-1].type){case 15:this.customInterpreter!==null&&(s.track[f-1].event[d-1].data=this.customInterpreter(s.track[f-1].event[d-1].type,r,!1)),this.customInterpreter!==null&&s.track[f-1].event[d-1].data!==!1||(o=r.readIntVLV(),s.track[f-1].event[d-1].data=r.readInt(o),this.debug&&console.info("Unimplemented 0xF exclusive events! data block readed as Integer"));break;case 10:case 11:case 14:case 8:case 9:s.track[f-1].event[d-1].data=[],s.track[f-1].event[d-1].data[0]=r.readInt(1),s.track[f-1].event[d-1].data[1]=r.readInt(1);break;case 12:case 13:s.track[f-1].event[d-1].data=r.readInt(1);break;case-1:g=!0;break;default:if(this.customInterpreter!==null&&(s.track[f-1].event[d-1].data=this.customInterpreter(s.track[f-1].event[d-1].metaType,r,!1)),this.customInterpreter===null||s.track[f-1].event[d-1].data===!1)return console.log("Unknown EVENT detected... reading cancelled!"),!1}}return s},customInterpreter:null};if(typeof de<"u")de.exports=l;else{let t=typeof window=="object"&&window.self===window&&window||typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;t.MidiParser=l}})()});DOMTokenList.prototype.on=function(e){!this.contains(e)&&this.toggle(e)};DOMTokenList.prototype.off=function(e){this.contains(e)&&this.toggle(e)};var F=function(e,i=document){return i?.querySelector(e)},H=function(e,i=document){return Array.from(i?.querySelectorAll(e))};var q=class{#t={};addEventListener(e,i){this.#t[e]||(this.#t[e]=[]),this.#t[e].unshift(i)}removeEventListener(e,i){if(this.#t[e]){let l=this.#t[e].indexOf(i);l>-1&&this.#t[e].splice(l,1),this.#t[e].length<1&&delete this.#t[e]}}dispatchEvent(e,i){let l=new Event(e),t=this;l.data=i,this.#t[e]?.length>0&&this.#t[e].forEach(function(r){r?.call(t,l)}),this[`on${e}`]&&this[`on${e}`](l)}};var Pe=function(e,i){let l=Math.min(e.length,i.length),t=e.slice(0,l),r=i.slice(0,l),s=0,n=0;for(;n<l&&s==0;)s=Math.sign(t[n]-r[n]),n++;return s},x=function(){this.pool=[],this.point=function(e,i=!1){if(this.pool.length>0){let l=this.pool.length,t=1<<Math.floor(Math.log2(l)),r=t,s=64;for(;t>=1&&s>=0;){if(s<=0)throw new Error("TTL reached.");if(r==l)r-=t;else{let a=Pe(e,this.pool[r]);switch(a){case 0:{s=0;break}case 1:{r+t<=l&&(r+=t);break}case-1:{r!=0&&(r-=t);break}default:console.warn(`Unexpected result ${a}.`)}}t=t>>1,s--}let n=!0;if(r>=this.pool.length)n=!1;else{let a=this;this.pool[r].forEach(function(o,h,c){n&&o!=e[h]&&(n=!1)}),!n&&Pe(e,this.pool[r])>0&&r++}return n||i?r:-1}else return i?0:-1},this.add=function(e,i){return e.data=i,this.pool.splice(this.point(e,!0),0,e),this},this.default=function(e){console.warn(`No match for "${e}". Default action not defined.`)},this.get=function(e){let i=this.point(e);if(i>-1)return this.pool[i].data;this.default(e)},this.run=function(e,...i){let l=this.point(e);l>-1?this.pool[l].data(e.slice(this.pool[l].length),...i):this.default(e,...i)}};var kt=["MSB","PRG","LSB"];var re=function(e){let i=Math.floor(e/10),l=e%10;return`${i.toString(16)}${l}`},ie=class{#t;strictMode=!1;get(e=0,i=0,l=0,t){let r,s=Array.from(arguments);switch(t){case"xg":e==32?s[2]+=4:e==33||e==35||e==36?s[2]+=5:e==79?s[0]=95:e==80?s[0]=96:e==81?s[0]=97:e==82?s[0]=98:e==83?s[0]=99:e==84&&(s[0]=100);case"gs":{e==0&&l<5&&(s[2]=0);break}case"sg":{e==8&&l==0&&(s[2]=5);break}}let n=" ",a="M",o=!1,h=0;switch(s[0]){case 0:{s[2]==127?a="MT-a":s[2]==126?a="MT-b":s[2]==7?a="GM-k":s[2]==5?a="SG-a":s[2]==4?a="SP-l":s[2]==0||t=="gs"&&s[2]<5?a="GM-a":(a="y",o=!0);break}case 8:{t=="sg"?a="GM-s":a="r:";break}case 48:{a=`yM${(s[2]>>3).toString().padStart(2,"0")}`,o=!0;break}case 56:{a="GM-b";break}case 61:case 120:{a="rDrm";break}case 62:{a="kDrm";break}case 63:{let f=s[2];a=f<10?"kP:":"kC:",a+=f%10;break}case 64:{a="ySFX";break}case 67:{a="DX:S";break}case 80:case 81:case 82:case 83:{a=`Prg${"UABC"[s[0]-80]}`;break}case 88:case 89:case 90:case 91:{a=`Cmb${"UABC"[s[0]-88]}`;break}case 95:{a=`${["DR","PC"][s[2]]}-d`;break}case 96:{a=s[2]==106?"AP-a":"PF",s[2]>63&&(h=63),o=!0;break}case 97:{a="VL:",o=!0,h=112;break}case 98:{a="SG-a";break}case 99:{a="DX",s[2]>63&&(h=63),o=!0;break}case 100:{a="AN",s[2]>63&&(h=63),o=!0;break}case 121:{a="GM-",o=!0;break}case 122:{a="lDrm";break}case 126:{a="yDrS";break}case 127:{s[2]==127?a="rDrm":a="yDrm";break}default:s[0]<48?a="r:":a="M"}for(a.length<4&&(a+=`${(o?l:e)-h}`.padStart(4-a.length,"0"));!(r?.length>=0);)r=this.#t[s[1]||0][(s[0]<<7)+s[2]],r||(this.strictMode?(r="",n="?"):this.#t[s[1]||0][s[0]<<7]?s[0]==0?(s[2]=0,n="^"):s[2]<1?(s[0]=0,n="*"):(s[2]--,n="^"):e==48?(s[0]=0,s[2]=0,n="!"):e==62?(s[1]--,n=" ",s[1]<1&&!r?.length&&(s[0]=0,n="!")):e<64?t=="xg"&&e==16?(r=`Voice${(l*128+i+1).toString().padStart(3,"0")}`,n=" "):s[0]==0?(s[2]=0,n="^"):s[2]<1?(s[0]=0,n="*"):s[2]--:e==80?(r=`PrgU:${i.toString().padStart(3,"0")}`,n="!"):e==88?(r=`CmbU:${i.toString().padStart(3,"0")}`,n="!"):e==121?(r=`GM2Vox0${l}`,n="#"):e==122?(s[1]==32?s[1]==0:s[1]%=7,r=this.#t[s[1]||0][(s[0]<<7)+s[2]],r?n=" ":(r="",n="*")):s[1]==0?(r=`${e.toString().padStart(3,"0")} ${i.toString().padStart(3,"0")} ${l.toString().padStart(3,"0")}`,n="!"):s[0]==0?(s[2]=0,n="^"):s[2]>0?s[2]--:s[1]>0?(s[1]=0,n="!"):(s[0]=0,n="?"));(t=="gs"||t=="ns5r")&&n=="^"&&(n=" "),e==127&&n=="^"&&(n=" "),n!=" "&&self.debugMode&&(r="");let c="??";switch(s[0]){case 0:{s[2]==0?c="GM":s[2]==5||s[2]==7?c="KG":s[2]<120?c="XG":s[2]==127&&(c="MT");break}case 48:{c="MU";break}case 56:{c="AG";break}case 61:case 80:case 83:case 88:case 89:case 91:{c="AI";break}case 62:case 82:case 90:{c="XD";break}case 63:c="KR";case 64:case 126:{c="XG";break}case 67:case 99:{c="DX";break}case 81:{c="RW";break}case 95:{c=["DR","PC"][s[2]];break}case 96:{c=s[2]==106?"AP":"PF";break}case 97:{c="VL";break}case 98:{c="SG";break}case 100:{c="AN";break}case 120:{c="GS";break}case 121:{c="G2";break}case 122:{c="KG";break}case 127:{c=s[2]==127?"MT":i==0?"GM":"XG";break}default:s[0]<48&&(s[0]==16&&t=="xg"?c="XG":c="GS")}return{name:r||`${re(e||0)} ${re(i||0)} ${re(l||0)}`,ending:n,sect:a,standard:c}}async load(e,i,l){let t=this,r=[],s=0,n=0;e.split(`
`).forEach(function(a,o){let h=a.split("	"),c=[];o==0?h.forEach(function(f,d){r[kt.indexOf(f)]=d}):h.forEach(async function(f,d){d>2?(t.#t[c[r[1]]]=t.#t[c[r[1]]]||[],(!t.#t[c[r[1]]][(c[r[0]]<<7)+c[r[2]]]?.length||i)&&(t.#t[c[r[1]]][(c[r[0]]<<7)+c[r[2]]]=h[3],s++),n++):c.push(parseInt(h[d]))})}),i||console.debug(`Map "${l||"(internal)"}": ${n} total, ${s} loaded.`)}clearRange(e){let i=e.prg!=null?e.prg.constructor==Array?e.prg:[e.prg,e.prg]:[0,127],l=e.msb!=null?e.msb.constructor==Array?e.msb:[e.msb,e.msb]:[0,127],t=e.lsb!=null?e.lsb.constructor==Array?e.lsb:[e.lsb,e.lsb]:[0,127];for(let r=l[0];r<=l[1];r++){let s=r<<7;for(let n=t[0];n<=t[1];n++){let a=s+n;for(let o=i[0];o<=i[1];o++)delete this.#t[o][a]}}}init(){this.#t=[];for(let e=0;e<128;e++)this.#t.push([""])}async loadFiles(...e){this.init();let i=this;e.forEach(async function(l,t){try{await fetch(`./data/bank/${l}.tsv`).then(function(r){return r.text()}).then(r=>{i.load(r,!1,l)})}catch{console.error(`Failed loading "${l}.tsv".`)}})}constructor(...e){this.loadFiles(...e)}};var J=["off","hall","room","stage","plate","delay LCR","delay LR","echo","cross delay","early reflections","gate reverb","reverse gate"].concat(new Array(4),["white room","tunnel","canyon","basement","karaoke"],new Array(43),["pass through","chorus","celeste","flanger","symphonic","rotary speaker","tremelo","auto pan","phaser","distortion","overdrive","amplifier","3-band EQ","2-band EQ","auto wah"],new Array(1),["pitch change","harmonic","touch wah","compressor","noise gate","voice channel","2-way rotary speaker","ensemble detune","ambience"],new Array(4),["talking mod","Lo-Fi","dist + delay","comp + dist + delay","wah + dist + delay","V dist","dual rotor speaker"]),se=["melodic","drum","drum set 1","drum set 2","drum set 3","drum set 4"],Et=[17.1,18.6,20.2,21.8,23.3,24.9,26.5,28,29.6,31.2,32.8,34.3,35.9,37.5,39,40.6,42.2,43.7,45.3,46.9,48.4,50],Y=[20,22,25,28,32,36,40,45,50,56,63,70,80,90,100,110,125,140,160,180,200,225,250,280,315,355,400,450,500,560,630,700,800,900,1e3,1100,1200,1400,1600,1800,2e3,2200,2500,2800,3200,3600,4e3,4500,5e3,5600,6300,7e3,8e3,9e3,1e4,11e3,12e3,14e3,16e3,18e3,2e4],Ae=[0,.04,.08,.13,.17,.21,.25,.29,.34,.38,.42,.46,.51,.55,.59,.63,.67,.72,.76,.8,.84,.88,.93,.97,1.01,1.05,1.09,1.14,1.18,1.22,1.26,1.3,1.35,1.39,1.43,1.47,1.51,1.56,1.6,1.64,1.68,1.72,1.77,1.81,1.85,1.89,1.94,1.98,2.02,2.06,2.1,2.15,2.19,2.23,2.27,2.31,2.36,2.4,2.44,2.48,2.52,2.57,2.61,2.65,2.69,2.78,2.86,2.94,3.03,3.11,3.2,3.28,3.37,3.45,3.53,3.62,3.7,3.87,4.04,4.21,4,37,4.54,4.71,4.88,5.05,5.22,5.38,5.55,5.72,6.06,6.39,6.73,7.07,7.4,7.74,8.08,8.41,8.75,9.08,9.42,9.76,10.1,10.8,11.4,12.1,12.8,13.5,14.1,14.8,15.5,16.2,16.8,17.5,18.2,19.5,20.9,22.2,23.6,24.9,26.2,27.6,28.9,30.3,31.6,33,34.3,37,39.7],Be=function(e){let i=.1,l=-.3;return e>66?(i=5,l=315):e>56?(i=1,l=47):e>46&&(i=.5,l=18.5),i*e-l},Ie=function(e){return e>105?Et[e-106]:e>100?e*1.1-100:e/10},De=",a,i,u,e,o,ka,ki,ku,ke,ko,ky,kw,sa,si,su,se,so,sh,ta,ti,tu,te,to,t,ch,t,s,na,ni,nu,ne,no,ny,nn,ha,hi,hu,he,ho,hy,fa,fi,fu,fe,fo,ma,mi,mu,me,mo,my,mm,ya,yu,ye,yo,ra,ri,ru,re,ro,ry,wa,wi,we,wo,ga,gi,gu,ge,go,gy,gw,za,zi,zu,ze,zo,ja,ji,ju,je,jo,jy,da,di,du,de,do,dy,ba,bi,bu,be,bo,by,va,vi,vu,ve,vo,pa,pi,pu,pe,po,py,nga,ngi,ngu,nge,ngo,ngy,ng,hha,hhi,hhu,hhe,hho,hhy,hhw,*,_,,,~,.".split(","),ae={};`hi*,
ka,か
ki,き
ku,く
ke,け
ko,こ
ky,き!
kw,くl
tsu,つ
ts,つl
sa,さ
si,すぃ
su,す
se,せ
so,そ
shi,し
sh,し!
ta,た
ti,てぃ
tu,とぅ
te,て
to,と
tchy,ち!
tchi,ち
na,な
ni,に
nu,ぬ
ne,ね
no,の
ny,に!
nn,ん
ha,は
hi,ひ
hu,ほぅ
he,へ
ho,ほ
hy,ひ!
fa,ふぁ
fi,ふぃ
fu,ふ
fe,ふぇ
fo,ふぉ
ma,ま
mi,み
mu,む
me,め
mo,も
my,み!
mm,
ra,ら
ri,り
ru,る
re,れ
ro,ろ
ry,り!
wa,わ
wi,うぃ
we,うぇ
wo,を
nga,ガ
ngi,ギ
ngu,グ
nge,ゲ
ngo,ゴ
ngy,ギ!
ng,
ga,が
gi,ぎ
gu,ぐ
ge,げ
go,ご
gy,ぎ!
gw,ぐl
za,ざ
zi,ずぃ
zu,ず
ze,ぜ
zo,ぞ
ja,じゃ
ji,じ
ju,じゅ
je,じぇ
jo,じょ
jy,じ!
da,だ
di,でぃ
du,どぅ
de,で
do,ど
dy,で!
ba,ば
bi,び
bu,ぶ
be,べ
bo,ぼ
by,び!
va,ゔぁ
vi,ゔぃ
vu,ゔ
ve,ゔぇ
vo,ゔぉ
pa,ぱ
pi,ぴ
pu,ぷ
pe,ペ
po,ぽ
py,ぴ!
!ya,ゃ
!yu,ゅ
!ye,ぇ
!yo,ょ
ya,や
yu,ゆ
ye,いぇ
yo,よ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
!a,ゃ
!u,ゅ
!e,ぇ
!o,ょ
la,ぁ
li,ぃ
lu,ぅ
le,ぇ
lo,ぉ
a,あ
i,い
u,う
e,え
o,お
*,っ
~,
^,
_,`.split(`
`).forEach(e=>{let i=e.split(",");ae[i[0]]=i[1]});var Ue=function(e){let i=e;e[0]=="*"&&(i=i.slice(1)),["aa","ii","uu","ee","oo"].forEach(t=>{for(;i.indexOf(t)>-1;)i=i.replace(t,t[0])});for(let t in ae)i=i.replaceAll(t,ae[t]);i.indexOf("ん")==0&&i.length>1&&(i=i.slice(1));let l=i.indexOf("!");return l>-1&&i.length>1&&(i=i.slice(l+1)),i};var ne=["room 1","room 2","room 3","hall 1","hall 2","plate","delay","panning delay"],Oe=["chorus 1","chorus 2","chorus 3","chorus 4","feedback","flanger","short delay","short delay feedback"],Fe=["delay 1","delay 2","delay 3","delay 4","pan delay 1","pan delay 2","pan delay 3","pan delay 4","delay to reverb","pan repeat"];var Lt={0:"thru",256:"stereo EQ",257:"spectrum",258:"enhancer",259:"humanizer",272:"overdrive",273:"distortion",288:"phaser",289:"auto wah",290:"rotary",291:"stereo flanger",292:"step flanger",293:"tremelo",294:"auto pan",304:"compressor",305:"limiter",320:"hexa chorus",321:"tremelo chorus",322:"stereo chorus",323:"space D",324:"3D chorus",336:"stereo delay",337:"modulated delay",338:"3-tap delay",339:"4-tap delay",340:"tremelo control delay",341:"reverb",342:"gate reverb",343:"3D delay",352:"2-pitch shifter",353:"feedback pitch shifter",368:"3D auto",369:"3D manual",370:"Lo-Fi 1",371:"Lo-Fi 2",512:"overdrive - chorus",513:"overdrive - flanger",514:"overdrive - delay",515:"distortion - chorus",516:"distortion - flanger",517:"distortion - delay",518:"enhancer - chorus",519:"enhancer - flanger",520:"enhancer - delay",521:"chorus - delay",522:"flanger - delay",523:"chorus - flanger",524:"rotary multi",1024:"guitar multi 1",1025:"guitar multi 2",1026:"guitar multi 3",1027:"clean guitar multi 1",1028:"clean guitar multi 2",1029:"bass multi",1030:"rhodes multi",1280:"keyboard multi",4352:"chorus / delay",4353:"flanger / delay",4354:"chorus / flanger",4355:"overdrive / distortion",4356:"overdrive / rotary",4357:"overdrive / phaser",4358:"overdrive / auto wah",4359:"phaser / rotary",4360:"phaser / auto wah"},Ct={66307:["drive"],66309:["vowel",e=>"aiueo"[e]],94723:["pre-filter"],94724:["Lo-Fi type"],94725:["post-filter"],94979:["Lo-Fi type"],94980:["fill type",e=>["off","LPF","HPF"][e]],94984:["noise type",e=>["white","pink"][e]],94987:["disc type",e=>["LP","SP","EP","RND"]],94990:["hum type",e=>`${e+5}0Hz`],94993:["M/S",e=>["mono","stereo"][e]]},le=function(e){return Lt[(e[0]<<8)+e[1]]||`0x${e[0].toString(16).padStart(2,"0")}${e[1].toString(16).padStart(2,"0")}`},Ge=function(e,i,l){let t=(e[0]<<16)+(e[1]<<8)+i,r=Ct[t]||{},s=r[0];if(s?.length)return s+=`: ${(r[1]||function(){})(l)||l}`,s},oe=[68,48,95,78,41,3,110,122,0];var L=function(e=64){return Math.round(2e3*Math.log10(e/64))/100},ee=function(e,i,l){let t=[],r=l==!1?i.readIntVLV():l;e==0||e==127;for(let s=0;s<r;s++){let n=i.readInt(1);if(t.push(n),n!=247){if(n!=240){if(n>127)return console.debug(`Early termination: ${t}`),t.pop(),i.backOne(),i.backOne(),new Uint8Array(t)}}}return new Uint8Array(t)},Ne=function(e){let i=0;return e.forEach(l=>{i+=l,i=i&127}),~i+1&127},I=function(e,i){let l=0;for(let t=0;t<e.length;t++)t%8!=0&&(i(e[t],l,e),l++)},he=function(e){return Math.floor(e*14.2)};var D=["?","gm","gs","xg","g2","mt32","ns5r","ag10","x5d","05rw","krs","k11","sg"],Xe=[[0,0,0,0,121,0,0,56,82,81,63,0,0],[0,0,4,0,0,127,0,0,0,0,0,0,0]],G=[120,127,120,127,120,127,61,62,62,62,120,122,122],Rt=[0,3,81,84,88],ze={8:"Off",9:"On",10:"Note aftertouch",11:"cc",12:"pc",13:"Channel aftertouch",14:"Pitch"},ce={0:0,1:1,2:3,5:4},Ve=[[0,24],[0,127],[0,127],[40,88],[0,127],[0,127]],He=[36,37];var fe=[0,1,2,4,5,6,7,8,10,11,32,38,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,84,91,92,93,94,95,98,99,100,101,12,13,16,17,18,19],Tt=[33,99,100,32,102,8,9,10],A={};D.forEach((e,i)=>{A[e]=i});var u={length:fe.length};fe.forEach((e,i)=>{u[e]=i});var xt=function(e){let i=[],l=0;return e?.forEach(function(t,r){t==247?i.push(e.subarray(l,r)):t==240&&(l=r+1)}),i.length||i.push(e.subarray(0)),self.debugMode,i},qe=function(e,i="",l="",t=2){return e?`${i}${e.toString().padStart(t,"0")}${l}`:""};var p={ch:128,cc:fe.length,nn:128,pl:512,tr:256,cmt:14,rpn:6},Ye=class extends q{#t=0;#u=0;#l=0;#h=new Array(11);get#p(){return this.#h[this.#u]}set#p(e){this.#h[this.#u]=e}#o=new Uint8Array(p.ch);#c=new Uint8Array(p.ch);#e=new Uint8ClampedArray(p.ch*p.cc);#a=new Uint8ClampedArray(p.ch);#s=new Uint8ClampedArray(p.ch*p.nn);#g=new Uint8Array(p.ch);#f=new Uint16Array(p.pl);#I=new Int16Array(p.ch);#w=new Uint8Array(p.ch);#D=0;#r=new Uint8Array(p.ch*p.rpn);#U=new Int8Array(p.ch*He.length);#$=new Uint8Array(p.ch);#R=new Uint8Array(128);#y=new Uint8Array(p.cmt*8);#O=new Uint8Array(1024);#T=new Uint8Array(p.cmt*64);#x=0;#v=0;#m=100;#S=0;#F=500;#G=0;#b="";#k=0;#n=!1;#Y;#E=new Uint8Array(2);#i=[];#L=new Uint8Array(p.ch);#P=new Uint8Array(p.tr);baseBank=new ie("gm","gm2","xg","gs","ns5r","gmega","plg-150vl","plg-150pf","plg-150dx","plg-150an","plg-150dr","plg-100sg","kross");userBank=new ie("gm");chRedir(e,i,l){if(this.#P[i])return(this.#P[i]-1)*16+e;if([A.gs,A.ns5r].indexOf(this.#t)>-1){if(l==1)return e;let t=0,r=!0;for(;r;)this.#L[e+t]==0?(this.#L[e+t]=i,console.debug(`Assign track ${i} to channel ${e+t+1}.`),r=!1):this.#L[e+t]==i?r=!1:(t+=16,t>=128&&(t=0,r=!1));return e+t}else return e}#d=[];#N;#M={ano:e=>{this.#f.forEach((i,l,t)=>{let r=i>>7;i==0&&this.#s[0]==0||r==e&&(this.#s[i]=0,t[l]=0)})}};#K={8:function(e){let l=e.channel*128+e.data[0],t=this.#f.indexOf(l);t>-1&&(this.#f[t]=0,this.#s[l]=0)},9:function(e){let i=e.channel;this.#o[i]=1;let l=i*128+e.data[0];if(e.data[1]>0){let t=0;for(;this.#f[t]>0;)t++;t<this.#f.length?(this.#f[t]=l,this.#s[l]=e.data[1],this.#w[i]<e.data[1]&&(this.#w[i]=e.data[1])):console.error("Polyphony exceeded.")}else{let t=this.#f.indexOf(l);t>-1&&(this.#f[t]=0,this.#s[l]=0)}},10:function(e){let l=e.channel*128+e.data[0];this.#f.indexOf(l)>-1&&(this.#s[l]=data[1])},11:function(e){let i=e.channel;this.#o[i]=1;let l=i*p.cc;switch(e.data[0]){case 96:return;case 97:return;case 120:return;case 121:{this.#M.ano(i),this.#I[i]=0;let t=i*p.cc;this.#e[t+u[1]]=0,this.#e[t+u[5]]=0,this.#e[t+u[64]]=0,this.#e[t+u[65]]=0,this.#e[t+u[66]]=0,this.#e[t+u[67]]=0,this.#e[t+u[11]]=127,this.#e[t+u[101]]=127,this.#e[t+u[100]]=127,this.#e[t+u[99]]=127,this.#e[t+u[98]]=127;return}case 123:{this.#M.ano(i);return}case 124:{this.#M.ano(i);return}case 125:{this.#M.ano(i);return}case 126:{this.#g[i]=1,this.#M.ano(i);return}case 127:{this.#g[i]=0,this.#M.ano(i);return}}if(u[e.data[0]]==null)console.warn(`cc${e.data[0]} is not accepted.`);else{switch(e.data[0]){case 0:{if(self.debugMode&&console.debug(`${D[this.#t]}, CH${i+1}: ${e.data[1]}`),this.#t==0)e.data[1]<48?(this.#e[l]>119&&(e.data[1]=this.#e[l],e.data[1]=120,console.debug(`Forced channel ${i+1} to stay drums.`)),e.data[1]>0&&(console.debug(`Roland GS detected with MSB: ${e.data[1]}`),this.switchMode("gs"))):e.data[1]==62?this.switchMode("x5d"):e.data[1]==63&&this.switchMode("krs");else if(this.#t==A.gs)e.data[1]<56&&this.#e[l]>119&&(e.data[1]=this.#e[l],e.data[1]=120,console.debug(`Forced channel ${i+1} to stay drums.`));else if(this.#t==A.gm)e.data[1]<48&&this.#e[l]>119&&(e.data[1]=120,this.switchMode("gs",!0),console.debug(`Forced channel ${i+1} to stay drums.`));else if(this.#t==A.x5d){if(e.data[1]>0&&e.data[1]<8)this.switchMode("05rw",!0);else if(e.data[1]==56){let t=0;for(let r=0;r<16;r++){let s=this.#e[p.cc*r];(s==56||s==62)&&t++}t>14&&this.switchMode("ag10",!0)}}break}case 6:{if(this.#D){let t=this.#e[l+u[99]],r=this.#e[l+u[98]];if(t==1){let s=Tt.indexOf(r);if(s>-1)this.#e[l+u[71+s]]=e.data[1],self.debugMode&&console.debug(`Redirected NRPN 1 ${r} to cc${71+s}.`);else{let n=He.indexOf(r);n>-1&&(this.#U[i*10+n]=e.data[1]-64),self.debugMode&&console.debug(`CH${i+1} voice NRPN ${r} commit`)}}}else{let t=ce[this.#e[l+u[100]]];this.#e[l+u[101]]==0&&t!=null&&(self.debugMode&&console.debug(`CH${i+1} RPN 0 ${this.#e[l+u[100]]} commit: ${e.data[1]}`),e.data[1]=Math.min(Math.max(e.data[1],Ve[t][0]),Ve[t][1]),this.#r[i*p.rpn+t]=e.data[1])}break}case 38:{this.#D||this.#e[l+101]==0&&ce[this.#e[l+100]]!=null&&(this.#r[i*p.rpn+ce[this.#e[l+100]]+1]=e.data[1]);break}case 98:case 99:{this.#D=1;break}case 100:case 101:{this.#D=0;break}}this.#e[l+u[e.data[0]]]=e.data[1]}},12:function(e){let i=e.channel;this.#o[i]=1,this.#a[i]=e.data,this.#$[i]=0,self.debugMode&&console.debug(`T:${e.track} C:${i} P:${e.data}`)},13:function(e){let i=this,l=e.channel;this.#f.forEach(function(t){let r=t>>7;l==r&&(i.#s[t]=e.data)})},14:function(e){let i=e.channel;this.#I[i]=e.data[1]*128+e.data[0]-8192},15:function(e){xt(e.data).forEach(i=>{let l=i[0],t=i[1];(this.#W[l]||function(){console.debug(`Unknown manufacturer ${l}.`)})(t,i.subarray(2),e.track)})},248:function(e){},250:function(e){},251:function(e){},252:function(e){},254:function(e){},255:function(e){if((this.#d[e.meta]||function(l,t,r){}).call(this,e.data,e.track,e.meta),e.meta!=32&&(this.#S=0),Rt.indexOf(e.meta)>-1)return e.reply="meta",e;self.debugMode&&console.debug(e)}};#W={64:(e,i,l)=>{this.#V.run(i,l,e)},65:(e,i,l)=>{if(i[0]<16)this.#C.run(i,l,e),console.warn("Unknown device SysEx!");else{let t=i[i.length-1],r=Ne(i.subarray(2,i.length-1));t==r?this.#C.run(i.subarray(0,i.length-1),l,e):console.warn(`Bad GS checksum ${t}. Should be ${r}.`)}},66:(e,i,l)=>{this.#B.run(i,l,e)},67:(e,i,l)=>{this.#A.run(i,l,e)},68:(e,i,l)=>{this.#q.run(i,l,e)},71:(e,i,l)=>{this.#H.run(i,l,e)},126:(e,i,l)=>{this.#X.run(i,l,e)},127:(e,i,l)=>{this.switchMode("gm"),this.#z.run(i,l,e)}};#X;#z;#A;#C;#B;#V;#H;#q;buildRchTree(){let e=[];this.#c.forEach((i,l)=>{e[i]?.constructor||(e[i]=[]),e[i].push(l)}),this.#Y=e}getActive(){let e=this.#o.slice();return this.#t==A.mt32,e}getCc(e){let i=e*p.cc,l=this.#e.slice(i,i+p.cc);return l[u[0]]=l[u[0]]||this.#x,l[u[32]]=l[u[32]]||this.#v,l}getCcAll(){let e=this.#e.slice();for(let i=0;i<p.ch;i++){let l=i*p.cc;e[l+u[0]]=e[l+u[0]]||this.#x,e[l+u[32]]=e[l+u[32]]||this.#v}return e}getPitch(){return this.#I}getProgram(){return this.#a}getTexts(){return this.#i.slice()}getVel(e){let i=new Map,l=this;return this.#f.forEach(function(t){let r=Math.floor(t/128),s=t%128;e==r&&l.#s[t]>0&&i.set(s,l.#s[t])}),i}getBitmap(){return{bitmap:this.#p,expire:this.#l}}getLetter(){return{text:this.#b,expire:this.#k}}getMode(){return D[this.#t]}getMaster(){return{volume:this.#m}}getRawStrength(){let e=this;return this.#f.forEach(function(i){let l=Math.floor(i/128);e.#s[i]>e.#w[l]&&(e.#w[l]=e.#s[i])}),this.#w}getStrength(){let e=[],i=this;return this.getRawStrength().forEach(function(l,t){e[t]=Math.floor(l*i.#e[t*p.cc+u[7]]*i.#e[t*p.cc+u[11]]*i.#m/803288)}),e}getRpn(){return this.#r}getNrpn(){return this.#U}getVoice(e,i,l,t){let r=e||this.#x,s=i,n=l||this.#v;D[this.#t]=="ns5r"&&r>0&&r<56&&(n=3);let a=this.userBank.get(r,s,n,t);if(D[this.#t]=="mt32"&&a.name.indexOf("MT-m:")==0){let o=parseInt(a.name.slice(5)),h=o*p.cmt,c="";this.#T.subarray(h,h+10).forEach(f=>{f>31&&(c+=String.fromCharCode(f))}),this.userBank.load(`MSB	LSB	PRG
0	127	${s}	${c}`,!0),a.name=c,a.ending=" "}return(a.ending!=" "||!a.name.length)&&(a=this.baseBank.get(r,s,n,t)),a}getChVoice(e){let i=this.getVoice(this.#e[e*p.cc+u[0]],this.#a[e],this.#e[e*p.cc+u[32]],D[this.#t]);if(this.#$[e])switch(this.#t){case A.mt32:i.ending="~",i.name="",this.#y.subarray(14*(e-1),14*(e-1)+10).forEach(l=>{l>31&&(i.name+=String.fromCharCode(l))})}return i}init(e=0){this.dispatchEvent("mode","?"),this.#t=0,this.#x=0,this.#v=0,this.#S=0,this.#o.fill(0),this.#e.fill(0),this.#a.fill(0),this.#s.fill(0),this.#f.fill(0),this.#w.fill(0),this.#I.fill(0),this.#U.fill(0),this.#m=100,this.#i=[],this.#F=500,this.#G=0,this.#k=0,this.#b="",this.#l=0,this.#u=0,this.#p.fill(0),this.#n=!1,this.#c.forEach(function(i,l,t){t[l]=l}),this.buildRchTree(),this.#L.fill(0),this.#P.fill(0),this.#e[p.cc*9]=G[0],this.#e[p.cc*25]=G[0],this.#e[p.cc*41]=G[0],this.#e[p.cc*57]=G[0],this.#E.fill(0),this.#O.fill(0),this.#T.fill(0),this.#R.fill(0),this.#y.fill(0),this.#$.fill(0),this.userBank.clearRange({msb:0,lsb:127,prg:[0,127]});for(let i=0;i<p.ch;i++){let l=i*p.cc;this.#e[l+u[7]]=100,this.#e[l+u[11]]=127,this.#e[l+u[10]]=64,this.#e[l+u[71]]=64,this.#e[l+u[72]]=64,this.#e[l+u[73]]=64,this.#e[l+u[74]]=64,this.#e[l+u[75]]=64,this.#e[l+u[76]]=64,this.#e[l+u[77]]=64,this.#e[l+u[78]]=64,this.#e[l+u[91]]=40,this.#e[l+u[101]]=127,this.#e[l+u[100]]=127,this.#e[l+u[99]]=127,this.#e[l+u[98]]=127;let t=i*p.rpn;this.#r[t]=2,this.#r[t+1]=64,this.#r[t+2]=0,this.#r[t+3]=64,this.#r[t+4]=0,this.#r[t+5]=0}}switchMode(e,i=!1){let l=D.indexOf(e);if(l>-1){if(this.#t==0||i){this.#t=l,this.#u=0,this.#x=Xe[0][l],this.#v=Xe[1][l];for(let t=0;t<p.ch;t++)G.indexOf(this.#e[t*p.cc])>-1&&(this.#e[t*p.cc]=G[l]);switch(l){case A.mt32:{oe.forEach((t,r)=>{let s=r+1;this.#o[s]||(this.#a[s]=t,this.#e[s*p.cc+u[91]]=127)});break}}this.dispatchEvent("mode",e)}}else throw new Error(`Unknown mode ${e}`)}newStrength(){this.#w.fill(0)}runJson(e){if(e.type>14)return e.type==15&&e.data.constructor!=Uint8Array&&(e.data=Uint8Array.from(e.data)),this.#K[e.type].call(this,e);{let i=this.chRedir(e.part,e.track),l=!1;this.#Y[i]?.forEach(t=>{e.channel=t,l=!0,this.#K[e.type].call(this,e)}),l||console.warn(`${ze[e.type]?ze[e.type]:e.type}${[11,12].includes(e.type)?(e.data[0]!=null?e.data[0]:e.data).toString():""} event sent to CH${i+1} without any recipient.`)}this.#i.length>100&&this.#i.splice(100,this.#i.length-99)}runRaw(e){}constructor(){super();let e=this;this.#p=new Uint8Array(256),this.#h[10]=new Uint8Array(512),this.#N=new x,this.userBank.strictMode=!0,this.userBank.load(`MSB	PRG	LSB	NME
062	000	000	
122	000	000	
122	001	000	
122	002	000	
122	003	000	
122	004	000	
122	005	000	
122	006	000	`),this.#d[1]=function(t){switch(t.slice(0,2)){case"@I":{this.#n=!0,this.#i.unshift(`Kar.Info: ${t.slice(2)}`);break}case"@K":{this.#n=!0,this.#i.unshift("Karaoke mode active."),console.debug(`Karaoke mode active: ${t.slice(2)}`);break}case"@L":{this.#n=!0,this.#i.unshift(`Language: ${t.slice(2)}`);break}case"@T":{this.#n=!0,this.#i.unshift(`Ka.Title: ${t.slice(2)}`);break}case"@V":{this.#n=!0,this.#i.unshift(`Kara.Ver: ${t.slice(2)}`);break}default:this.#n?t[0]=="\\"?this.#i.unshift(`@ ${t.slice(1)}`):t[0]=="/"?this.#i.unshift(t.slice(1)):this.#i[0]+=t:(this.#i[0]=t,this.#i.unshift(""))}},this.#d[2]=function(t){this.#i.unshift(`Copyrite: ${t}`)},this.#d[3]=function(t,r){r<1&&this.#S<1&&this.#i.unshift(`TrkTitle: ${t}`)},this.#d[4]=function(t,r){this.#i.unshift(`${qe(this.#S,""," ")}Instrmnt: ${t}`)},this.#d[5]=function(t){t.trim()==""?this.#i.unshift(""):this.#i[0]+=`${t}`},this.#d[6]=function(t){this.#i.unshift(`${qe(this.#S,""," ")}C.Marker: ${t}`)},this.#d[7]=function(t){this.#i.unshift(`CuePoint: ${t}`)},this.#d[32]=function(t){this.#S=t[0]+1},this.#d[33]=function(t,r){console.debug(`Track ${r} requests to get assigned to output ${t}.`),e.#P[r]=t+1},this.#d[81]=function(t,r){e.#F=t/1e3},this.#d[127]=function(t,r){e.#N.run(t,r)},this.#N.add([67,0,1],function(t,r){e.#P[r]=t[0]+1}),this.#X=new x,this.#z=new x,this.#A=new x,this.#C=new x,this.#B=new x,this.#V=new x,this.#H=new x,this.#q=new x,this.#X.add([9],t=>{e.switchMode(["gm","?","g2"][t[0]-1],!0),e.#n=e.#n||!1,console.info(`MIDI reset: ${["GM","Init","GM2"][t[0]-1]}`),t[0]==2&&e.init()}),this.#z.add([4,1],t=>{e.#m=((t[1]<<7)+t[0])/16383*100}).add([4,3],t=>((t[1]<<7)+t[0]-8192)/8192).add([4,4],t=>t[1]-64),this.#A.add([76,0,0],t=>{switch(t[0]){case 126:{e.switchMode("xg",!0),e.#n=!1,console.info("MIDI reset: XG");break}default:{let r=[0,0,0,0],s=(n,a)=>{r[a]=n};if(t.subarray(1).forEach((n,a)=>{let o=a+t[0];[s,s,s,s,h=>{this.#m=h*129/16383*100},h=>{},h=>{}][o](n,a)}),t[0]<4){let n=0;r.forEach(a=>{n=n<<4,n+=a}),n-=1024}}}}).add([76,2,1],t=>{let r="XG ";t[0]<32?(r+="reverb ",t.subarray(1).forEach((s,n)=>{([a=>{console.info(`${r}main type: ${J[a]}`)},a=>{console.debug(`${r}sub type: ${a+1}`)},a=>{console.debug(`${r}time: ${Be(a)}s`)},a=>{console.debug(`${r}diffusion: ${a}`)},a=>{console.debug(`${r}initial delay: ${a}`)},a=>{console.debug(`${r}HPF cutoff: ${Y[a]}Hz`)},a=>{console.debug(`${r}LPF cutoff: ${Y[a]}Hz`)},a=>{console.debug(`${r}width: ${a}`)},a=>{console.debug(`${r}height: ${a}`)},a=>{console.debug(`${r}depth: ${a}`)},a=>{console.debug(`${r}wall type: ${a}`)},a=>{console.debug(`${r}dry/wet: ${a}`)},a=>{console.debug(`${r}send: ${L(a)}dB`)},a=>{console.debug(`${r}pan: ${a-64}`)},!1,!1,a=>{console.debug(`${r}delay: ${a}`)},a=>{console.debug(`${r}density: ${a}`)},a=>{console.debug(`${r}balance: ${a}`)},a=>{},a=>{console.debug(`${r}feedback: ${a}`)},a=>{}][t[0]+n]||function(){console.warn(`Unknown XG reverb address: ${t[0]}.`)})(s)})):t[0]<64?(r+="chorus ",t.subarray(1).forEach((s,n)=>{([a=>{console.info(`${r}main type: ${J[a]}`)},a=>{console.debug(`${r}sub type: ${a+1}`)},a=>{console.debug(`${r}LFO: ${Ae[a]}Hz`)},a=>{},a=>{console.debug(`${r}feedback: ${a}`)},a=>{console.debug(`${r}delay offset: ${Ie(a)}ms`)},a=>{},a=>{console.debug(`${r}low: ${Y[a]}Hz`)},a=>{console.debug(`${r}low: ${a-64}dB`)},a=>{console.debug(`${r}high: ${Y[a]}Hz`)},a=>{console.debug(`${r}high: ${a-64}dB`)},a=>{console.debug(`${r}dry/wet: ${a}`)},a=>{console.debug(`${r}send: ${L(a)}dB`)},a=>{console.debug(`${r}pan: ${a-64}`)},a=>{console.debug(`${r}to reverb: ${L(a)}dB`)},!1,a=>{},a=>{},a=>{},a=>{console.debug(`${r}LFO phase diff: ${(a-64)*3}deg`)},a=>{console.debug(`${r}input mode: ${a?"stereo":"mono"}`)},a=>{}][t[0]-32+n]||function(){console.warn(`Unknown XG chorus address: ${t[0]}.`)})(s)})):t[0]<86?(r+="variation ",t[0]==64&&console.info(`${r}type: ${J[t[1]]}${t[2]>0?" "+(t[2]+1):""}`)):t[0]<97?(r+="variation ",t.subarray(1).forEach((s,n)=>{[a=>{console.debug(`${r}send: ${L(a)}dB`)},a=>{console.debug(`${r}pan: ${a-64}`)},a=>{console.debug(`${r}to reverb: ${L(a)}dB`)},a=>{console.debug(`${r}to chorus: ${L(a)}dB`)},a=>{console.debug(`${r}connection: ${a?"system":"insertion"}`)},a=>{console.debug(`${r}channel: CH${a+1}`)},a=>{console.debug(`${r}mod wheel: ${a-64}`)},a=>{console.debug(`${r}bend wheel: ${a-64}`)},a=>{console.debug(`${r}channel after touch: ${a-64}`)},a=>{console.debug(`${r}AC1: ${a-64}`)},a=>{console.debug(`${r}AC2: ${a-64}`)}][t[0]-86+n](s)})):t[0]>111&&t[0]<118?r+="variation ":console.warn(`Unknown XG variation address: ${t[0]}`)}).add([76,2,64],t=>{t.subarray(1).forEach((r,s)=>{let n=s+t[0];if(n==0)console.debug(`XG EQ preset: ${["flat","jazz","pop","rock","classic"][r]}`);else{let a=n-1>>2,o=n-1&3,h=`XG EQ ${a} ${["gain","freq","Q","shape"][o]}: `;[()=>{console.debug(`${h}${r-64}dB`)},()=>{console.debug(`${h}${r} (raw)`)},()=>{console.debug(`${h}${r/10}`)},()=>{console.debug(`${h}${["shelf","peak"][+!!r]}`)}][o]()}})}).add([76,3],t=>{}).add([76,6,0],t=>{let r=t[0];r<64?(e.#b=" ".repeat(r),e.#k=Date.now()+3200,t.subarray(1).forEach(function(s){e.#b+=String.fromCharCode(s)}),e.#b=e.#b.padEnd(32," ")):e.#k=Date.now()}).add([76,7,0],t=>{let r=t[0];e.#l=Date.now()+3200,e.#p.fill(0);let s=t.subarray(1);for(let n=0;n<r;n++)s.unshift(0);s.forEach(function(n,a){let o=Math.floor(a/16),h=a%16,c=(h*3+o)*7,f=7,d=0;for(c-=h*5,o==2&&(f=2);d<f;)e.#p[c+d]=n>>6-d&1,d++})}).add([76,8],(t,r)=>{let s=e.chRedir(t[0],r,!0),n=t[1],a=p.cc*s,o=`XG CH${s+1} `,h=`Unknown XG part address ${n}.`;t.subarray(2).forEach((c,f)=>{n<1?console.debug(h):n<41?([()=>{e.#e[a+u[0]]=c},()=>{e.#e[a+u[32]]=c},()=>{e.#a[s]=c},()=>{let d=e.chRedir(c,r,!0);e.#c[s]=d,s!=d&&(e.buildRchTree(),console.info(`${o}receives from CH${d+1}`))},()=>{e.#g[s]=+!c},()=>{},()=>{e.#e[a+u[0]]=c>1?127:0,console.debug(`${o}type: ${se[c]}`)},()=>{e.#r[p.rpn*s+3]=c},!1,!1,()=>{e.#e[a+u[7]]=c},!1,!1,()=>{e.#e[a+u[10]]=c||128},!1,!1,()=>{e.#e[a+u[11]]=c},()=>{e.#e[a+u[93]]=c},()=>{e.#e[a+u[91]]=c},()=>{e.#e[a+u[94]]=c},()=>{e.#e[a+u[76]]=c},()=>{e.#e[a+u[77]]=c},()=>{e.#e[a+u[78]]=c},()=>{e.#e[a+u[74]]=c},()=>{e.#e[a+u[71]]=c},()=>{e.#e[a+u[73]]=c},()=>{e.#e[a+u[75]]=c},()=>{e.#e[a+u[72]]=c}][n+f-1]||(()=>{}))():n<48?console.debug(h):n<111?n>102&&n<105&&(e.#e[a+u[[5,65][n&1]]]=c):n<114?console.debug(h):n<116?console.debug(`${o}EQ ${["bass","treble"][n&1]} gain: ${c-64}dB`):n<118?console.debug(h):n<120?console.debug(`${o}EQ ${["bass","treble"][n&1]} freq: ${c}`):console.debug(h)})}).add([76,10],t=>{}).add([76,16],t=>{}).add([76,17,0,0],t=>{}).add([73,0,0],(t,r)=>{let s=t[0];t.subarray(1).forEach((n,a)=>{let o=s+a;o==8?console.debug(`MU1000 set LCD contrast to ${n}.`):o>9&&o<15&&[()=>{e.dispatchEvent("channelactive",n)},()=>{n<8?e.dispatchEvent("channelmin",n<<4):e.dispatchEvent("channelreset")},()=>{n<8?e.dispatchEvent("channelmax",(n<<4)+15):e.dispatchEvent("channelreset")},()=>{e.dispatchEvent("channelreset")}][o-10]()})}).add([93,3],(t,r)=>{let s=e.chRedir(t[0],r,!0),n=`PLG-100SG CH${s+1} `,a=Date.now();if(t[1]==0){let o="",h=0;t.subarray(2).forEach((c,f)=>{f%2==0?o+=De[c]||c.toString().padStart("0"):h+=c*13}),a>=e.#G&&e.#i.unshift("SG Lyric: "),e.#i[0]+=`${Ue(o)}`,e.#G=a+Math.ceil(h/2)+e.#F,self.debugMode&&console.debug(`${n}vocals: ${o}`)}else console.warn(`Unknown PLG-100SG data: ${t}`)}).add([112],t=>{console.debug(`XG plugin PLG1-${["00VL","00SG","00DX"][t[0]]} enabled for channel ${t[2]+1}.`)}),this.#A.add([76,48],t=>{}).add([76,49],t=>{}).add([76,50],t=>{}).add([76,51],t=>{}),this.#A.add([89,0],(t,r,s)=>{if(e.eprom){let n=t[0],a=(t[1]<<14)+(t[2]<<7)+t[3]+(e.eprom.offset||0);self.debugMode&&console.debug(`MU1000 EPROM trail to 0x${a.toString(16).padStart(6,"0")}, ${n} bytes.`);let o=e.eprom.data;t.subarray(4).forEach((h,c)=>{let f=c>>3,d=c&7;if(d==7)for(let g=0;g<7;g++)o[a+7*f+g]+=(h>>6-g&1)<<7;else o[a+7*f+d]=h})}}).add([89,1],(t,r,s)=>{let n=(t[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3];self.debugMode&&console.debug(`MU1000 EPROM jump to 0x${n.toString(16).padStart(6,"0")}.`),e.eprom&&(e.eprom.offset=n)}).add([89,2],(t,r,s)=>{if(e.eprom){let n=(t[0]<<21)+(t[1]<<14)+(t[2]<<7)+t[3]+(e.eprom.offset||0);self.debugMode&&console.debug(`MU1000 EPROM write to 0x${n.toString(16).padStart(6,"0")}.`);let a=e.eprom.data;t.subarray(4).forEach((o,h)=>{let c=h>>3,f=h&7;if(f==7)for(let d=0;d<7;d++)a[n+7*c+d]+=(o>>6-d&1)<<7;else a[n+7*c+f]=o})}}).add([89,3],(t,r,s)=>{}),this.#C.add([66,18,0,0,127],t=>{e.switchMode("gs",!0),e.#e[p.cc*9]=120,e.#e[p.cc*25]=120,e.#e[p.cc*41]=120,e.#e[p.cc*57]=120,e.#v=3,e.#n=!1,e.#L.fill(0),console.info(`GS system to ${["single","dual"][t[0]]} mode.`)}).add([66,18,64,0],t=>{switch(t[0]){case 127:{e.switchMode("gs",!0),e.#e[p.cc*9]=120,e.#e[p.cc*25]=120,e.#e[p.cc*41]=120,e.#e[p.cc*57]=120,e.#n=!1,e.#L.fill(0),console.info("MIDI reset: GS");break}default:{let r=[0,0,0,0],s=(n,a)=>{r[a]=n};if(t.subarray(1).forEach((n,a)=>{let o=a+t[0];[s,s,s,s,h=>{this.#m=h*129/16383*100},h=>{},h=>{}][o](n,a)}),t[0]<4){let n=0;r.forEach(a=>{n=n<<4,n+=a}),n-=1024}}}}).add([66,18,64,1],t=>{let r=t[0];if(r<16){let s="".padStart(r," ");t.subarray(1).forEach((n,a)=>{s+=String.fromCharCode(Math.max(32,n))}),s=s.padEnd(16," "),console.debug(`GS patch name: ${s}`)}else r<48||(r<65?t.subarray(1).forEach((s,n)=>{let a=`GS ${r+n>55?"chorus":"reverb"} `;([()=>{console.info(`${a}type: ${ne[s]}`)},()=>{},()=>{},()=>{},()=>{},()=>{},!1,()=>{console.debug(`${a}predelay: ${s}ms`)},()=>{console.info(`${a}type: ${Oe[s]}`)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${a}to reverb: ${L(s)}`)},()=>{console.debug(`${a}to delay: ${L(s)}`)}][r+n-48]||(()=>{}))()}):r<80?console.debug(`Unknown GS patch address: ${r}`):r<91?t.subarray(1).forEach((s,n)=>{let a="GS delay ";([()=>{console.info(`${a}type: ${Fe[s]}`)},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{},()=>{console.debug(`${a}to reverb: ${L(s)}`)}][r+n-80]||(()=>{}))()}):console.debug(`Unknown GS patch address: ${r}`))}).add([66,18,64,2],t=>{let r="GS EQ ";t.subarray(1).forEach((s,n)=>{([()=>{console.debug(`${r}low freq: ${[200,400][s]}Hz`)},()=>{console.debug(`${r}low gain: ${s-64}dB`)},()=>{console.debug(`${r}high freq: ${[3e3,6e3][s]}Hz`)},()=>{console.debug(`${r}high gain: ${s-64}dB`)}][t[0]+n]||function(){console.warn(`Unknown GS EQ address: ${t[0]+n}`)})()})}).add([66,18,64,3],t=>{let r="GS EFX ",s=function(n,a){let o=Ge(e.#E,a,n);o&&console.debug(`${r}${le(e.#E)} ${o}`)};t.subarray(1).forEach((n,a)=>{([()=>{e.#E[0]=n},()=>{e.#E[1]=n,console.info(`${r}type: ${le(e.#E)}`)},!1,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,()=>{console.debug(`${r}to reverb: ${L(n)}dB`)},()=>{console.debug(`${r}to chorus: ${L(n)}dB`)},()=>{console.debug(`${r}to delay: ${L(n)}dB`)},!1,()=>{console.debug(`${r}1 source: ${n}`)},()=>{console.debug(`${r}1 depth: ${n-64}`)},()=>{console.debug(`${r}2 source: ${n}`)},()=>{console.debug(`${r}2 depth: ${n-64}`)},()=>{console.debug(`${r}to EQ: ${n?"ON":"OFF"}`)}][t[0]+a]||function(o,h){console.warn(`Unknown GS EFX address: ${h}`)})(n,t[0]+a)})}).add([66,18,65],t=>{}).add([69,18,16],t=>{switch(t[0]){case 0:{e.#k=Date.now()+3200;let r=t[1];e.#b=" ".repeat(r),t.subarray(2).forEach(function(s){s<128&&(e.#b+=String.fromCharCode(s))});break}case 32:{e.#l=Date.now()+3200,t[1]==0&&(e.#u=Math.max(Math.min(t[2]-1,9),0));break}default:if(t[0]<11){e.#l=Date.now()+3200,e.#h[t[0]-1]?.length||(e.#h[t[0]-1]=new Uint8Array(256));let r=e.#h[t[0]-1],s=t[1];r.fill(0);let n=t.subarray(2);for(let a=0;a<s;a++)n.unshift(0);n.forEach(function(a,o){let h=Math.floor(o/16),c=o%16,f=(c*4+h)*5,d=5,g=0;for(f-=c*4,h==3&&(d=1);g<d;)r[f+g]=a>>4-g&1,g++})}else console.warn(`Unknown GS display section: ${t[0]}`)}});let i=function(t,r,s){let n=t[0],a=p.cc*r,o=p.rpn*r,h=`GS CH${r+1} `;n<3?t.subarray(1).forEach((c,f)=>{[()=>{e.#e[a+u[0]]=c},()=>{e.#a[r]=c},()=>{let d=e.chRedir(c,s,!0);e.#c[r]=d,r!=d&&(e.buildRchTree(),console.info(`${h}receives from CH${d+1}`))}][n+f]()}):n<19||(n<44?t.subarray(1).forEach((c,f)=>{([()=>{e.#g[r]=+!c},!1,()=>{e.#e[a+u[0]]=c?120:0,console.debug(`${h}type: ${c?"drum ":"melodic"}${c||""}`)},()=>{e.#r[o+3]=c},!1,()=>{e.#e[a+u[7]]=c},!1,!1,()=>{e.#e[a+u[10]]=c||128},!1,!1,()=>{console.debug(`${h}CC 1: cc${c}`)},()=>{console.debug(`${h}CC 2: cc${c}`)},()=>{e.#e[a+u[93]]=c},()=>{e.#e[a+u[91]]=c},!1,!1,()=>{e.#r[o+1]=c},()=>{e.#r[o+2]=c},()=>{e.#e[a+u[94]]=c}][n+f-19]||(()=>{}))()}):n<76||console.debug(`Unknown GS part address: ${n}`))},l=function(t,r){let s=t[0],n=`GS CH${r+1} `;s<2?t.subarray(1).forEach((a,o)=>{[()=>{e.#e[p.cc*r+u[32]]=a},()=>{}][s+o]()}):s<32?console.warn(`Unknown GS misc address: ${s}`):s<35?t.subarray(1).forEach((a,o)=>{[()=>{console.debug(`${n}EQ: o${["ff","n"][a]}`)},()=>{},()=>{console.debug(`${n}EFX: o${["ff","n"][a]}`)}][s+o-32]()}):console.warn(`Unknown GS misc address: ${s}`)};this.#C.add([66,18,64,16],(t,r)=>{i(t,e.chRedir(9,r,!0),r)}).add([66,18,64,17],(t,r)=>{i(t,e.chRedir(0,r,!0),r)}).add([66,18,64,18],(t,r)=>{i(t,e.chRedir(1,r,!0),r)}).add([66,18,64,19],(t,r)=>{i(t,e.chRedir(2,r,!0),r)}).add([66,18,64,20],(t,r)=>{i(t,e.chRedir(3,r,!0),r)}).add([66,18,64,21],(t,r)=>{i(t,e.chRedir(4,r,!0),r)}).add([66,18,64,22],(t,r)=>{i(t,e.chRedir(5,r,!0),r)}).add([66,18,64,23],(t,r)=>{i(t,e.chRedir(6,r,!0),r)}).add([66,18,64,24],(t,r)=>{i(t,e.chRedir(7,r,!0),r)}).add([66,18,64,25],(t,r)=>{i(t,e.chRedir(8,r,!0),r)}).add([66,18,64,26],(t,r)=>{i(t,e.chRedir(10,r,!0),r)}).add([66,18,64,27],(t,r)=>{i(t,e.chRedir(11,r,!0),r)}).add([66,18,64,28],(t,r)=>{i(t,e.chRedir(12,r,!0),r)}).add([66,18,64,29],(t,r)=>{i(t,e.chRedir(13,r,!0),r)}).add([66,18,64,30],(t,r)=>{i(t,e.chRedir(14,r,!0),r)}).add([66,18,64,31],(t,r)=>{i(t,e.chRedir(15,r,!0),r)}).add([66,18,64,64],(t,r)=>{l(t,e.chRedir(9,r,!0))}).add([66,18,64,65],(t,r)=>{l(t,e.chRedir(0,r,!0))}).add([66,18,64,66],(t,r)=>{l(t,e.chRedir(1,r,!0))}).add([66,18,64,67],(t,r)=>{l(t,e.chRedir(2,r,!0))}).add([66,18,64,68],(t,r)=>{l(t,e.chRedir(3,r,!0))}).add([66,18,64,69],(t,r)=>{l(t,e.chRedir(4,r,!0))}).add([66,18,64,70],(t,r)=>{l(t,e.chRedir(5,r,!0))}).add([66,18,64,71],(t,r)=>{l(t,e.chRedir(6,r,!0))}).add([66,18,64,72],(t,r)=>{l(t,e.chRedir(7,r,!0))}).add([66,18,64,73],(t,r)=>{l(t,e.chRedir(8,r,!0))}).add([66,18,64,74],(t,r)=>{l(t,e.chRedir(10,r,!0))}).add([66,18,64,75],(t,r)=>{l(t,e.chRedir(11,r,!0))}).add([66,18,64,76],(t,r)=>{l(t,e.chRedir(12,r,!0))}).add([66,18,64,77],(t,r)=>{l(t,e.chRedir(13,r,!0))}).add([66,18,64,78],(t,r)=>{l(t,e.chRedir(14,r,!0))}).add([66,18,64,79],(t,r)=>{l(t,e.chRedir(15,r,!0))}),this.#B.add([54,76,0],(t,r)=>{e.switchMode("x5d",!0);let s="",n=82,a=0,o=0,h="MSB	PRG	LSB	NME";I(t,function(c,f){if(f<16400){let d=f%164;switch(!0){case d<10:{c>31&&(s+=String.fromCharCode(c));break}case d==11:{h+=`
${n}	${a}	${o}	${s.trim().replace("Init Voice","")}`,a++,s="";break}}a>99&&(n=90,a=0)}}),e.userBank.clearRange({msb:82,prg:[0,99],lsb:0}),e.userBank.load(h)}).add([54,77,0],(t,r)=>{e.switchMode("x5d",!0);let s="",n=90,a=0,o=0,h="MSB	PRG	LSB	NME";I(t,function(c,f){if(f<13600){let d=f%136;switch(!0){case d<10:{c>31&&(s+=String.fromCharCode(c));break}case d==11:{h+=`
${n}	${a}	${o}	${s.trim().replace("Init Combi","")}`,a++,s="";break}}}}),e.userBank.clearRange({msb:90,prg:[0,99],lsb:0}),e.userBank.load(h)}).add([54,104],(t,r)=>{e.switchMode("x5d",!0),I(t,function(s,n){if(n<192){let a=e.chRedir(Math.floor(n/12),r,!0),o=a*p.cc;switch(n%12){case 0:{e.#a[a]=s,s>0&&(e.#o[a]=1);break}case 1:{e.#e[o+u[7]]=s;break}case 2:{e.#r[a*p.rpn+3]=s>127?256-s:64+s;break}case 3:{e.#r[a*p.rpn+1]=s>127?256-s:64+s;break}case 4:{s<31&&(e.#e[o+u[10]]=Math.round((s-15)*4.2+64));break}case 5:{let h=s>>4,c=s&15;e.#e[o+u[91]]=he(c),e.#e[o+u[93]]=he(h);break}case 10:{e.#e[o]=s&3?82:56;break}case 11:{let h=e.chRedir(s&15,r,!0),c=s>>4;e.#c[a]=s,(h!=a||c)&&(console.info(`X5D Part CH${a+1} receives from CH${h+1}.`),e.buildRchTree())}}}else{let a=e.chRedir(n-192,r,!0)}})}),this.#C.add([22,18,127],t=>{e.switchMode("mt32",!0),e.#n=!1,e.userBank.clearRange({msb:0,lsb:127,prg:[0,127]}),console.info("MIDI reset: MT-32")}).add([22,18,0],(t,r,s)=>{e.switchMode("mt32");let n=e.chRedir(s,r,!0),a=t[1];t.subarray(2).forEach((o,h)=>{let c=h+a;e.#R[c+(n-1)*16]=o,([!1,()=>{let f=e.#R[n-1<<4];if(f<3)if(e.#$[n]=1,f==2)for(let d=0;d<name.length;d++)e.#y[(n-1)*p.cmt+d]=e.#T[o*p.cmt+d];else{let d=e.baseBank.get(0,o+(f<<6),127,"mt32").name;for(let g=0;g<d.length;g++)e.#y[(n-1)*p.cmt+g]=d.charCodeAt(g)}},()=>{e.#r[n*p.rpn+3]=o+40},()=>{e.#r[n*p.rpn+1]=o+14},()=>{e.#r[n*p.rpn]=o},!1,()=>{e.#e[p.cc*n+u[91]]=o?127:0},!1,()=>{e.#e[p.cc*n+u[7]]=o},()=>{e.#e[p.cc*n+u[10]]=Math.ceil(o*9.05)}][c]||(()=>{}))()})}).add([22,18,1],(t,r,s)=>{e.switchMode("mt32");let n=e.chRedir(s,r,!0)}).add([22,18,2],(t,r,s)=>{e.switchMode("mt32");let n=e.chRedir(s,r,!0),a=t[1]+(t[0]<<7);a<10&&(e.#$[n]=1),t.subarray(2).forEach((o,h)=>{let c=h+a;c<14&&(e.#y[(n-1)*p.cmt+c]=o)})}).add([22,18,3],(t,r,s)=>{if(e.switchMode("mt32"),t[0]){let n=t[1]-16}else{let n=t[1];t.subarray(2).forEach((a,o)=>{let h=o+n;e.#R[h]=a;let c=e.chRedir(1+h>>4,r,!0),f=h&15;([!1,()=>{let d=e.#R[c-1<<4];if(d<3)if(e.#$[c]=1,d==2)for(let g=0;g<name.length;g++)e.#y[(c-1)*p.cmt+g]=e.#T[a*p.cmt+g];else{let g=e.baseBank.get(0,a+(d<<6),127,"mt32").name;for(let y=0;y<g.length;y++)e.#y[(c-1)*p.cmt+y]=g.charCodeAt(y)}},()=>{e.#r[c*p.rpn+3]=a+40},()=>{e.#r[c*p.rpn+1]=a+14},()=>{e.#r[c*p.rpn]=a},!1,()=>{e.#e[p.cc*c+u[91]]=a?127:0},!1,()=>{e.#e[p.cc*c+u[7]]=a},()=>{e.#e[p.cc*c+u[10]]=Math.ceil(a*9.05)}][f]||(()=>{}))()})}}).add([22,18,4],(t,r,s)=>{e.switchMode("mt32");let n=t[1]+(t[0]<<7);t.subarray(2).forEach((a,o)=>{let h=o+n,c=e.chRedir(Math.floor(h/246+1),r,!0),f=h%246;f<14&&(e.#y[(c-1)*p.cmt+f]=a),f<10&&(e.#$[c]=1)})}).add([22,18,5],(t,r,s)=>{e.switchMode("mt32");let n=(t[0]<<7)+t[1];t.subarray(2).forEach((a,o)=>{let h=n+o,c=Math.floor(h/8),f=h&7,d=c*8;e.#O[h]=a,([!1,()=>{let g=e.#O[d];if(g<3){let y="";if(g==2){let w=p.cmt*c;y=`MT-m:${a.toString().padStart(3,"0")}`}else y=e.baseBank.get(0,a+(g<<6),127,"mt32").name;e.userBank.clearRange({msb:0,lsb:127,prg:c}),e.userBank.load(`MSB	LSB	PRG	NME
000	127	${c}	${y}`,!0)}}][f]||(()=>{}))()})}).add([22,18,8],(t,r,s)=>{e.switchMode("mt32");let n=((t[0]&1)<<7)+t[1];t.subarray(2).forEach((a,o)=>{let h=n+o;h<p.cmt&&(e.#T[(t[0]>>1)*p.cmt+h]=a)})}).add([22,18,16],(t,r,s)=>{e.switchMode("mt32");let n=t[1],a=!1,o=function(h,c){e.#c[c-12]=h,a=!0};t.subarray(2).forEach((h,c)=>{let f=c+n;([!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,o,o,o,o,o,o,o,o,o,()=>{e.#m=h}][f]||(()=>{}))(h,c)}),a&&e.buildRchTree()}).add([22,18,32],t=>{e.switchMode("mt32");let r=t[1],s=" ".repeat(r);t.subarray(2).forEach(n=>{n>31&&(s+=String.fromCharCode(n))}),e.#b=s.padStart(20," "),e.#k=Date.now()+3200}).add([22,18,82],(t,r)=>{let s=e.chRedir(0,r,!0);for(let n=0;n<16;n++)e.#M.ano(s+n),n&&n<10&&(e.#a[s+n]=oe[n-1]);console.info("MT-32 alt reset complete.")}),this.#B.add([66,0],(t,r)=>{e.switchMode("ns5r",!0),e.#n=!1,console.debug(`NS5R mode switch requested: ${["global","multi","prog edit","comb edit","drum edit","effect edit"][t[0]]} mode.`)}).add([66,1],(t,r)=>{e.switchMode(["ns5r","05rw"][t[0]],!0),e.#n=!1}).add([66,18,0,0],(t,r)=>{let s=t[0];switch(s){case 124:case 126:case 127:{e.switchMode("ns5r",!0),e.#n=!1;break}case 125:break;default:if(s<10){let n=[0,0,0,0],a=(o,h)=>{n[h]=o};if(t.subarray(1).forEach((o,h)=>{[a,a,a,a,()=>{e.#m=o*129/16383*100},()=>o-64,()=>o-64,()=>{},()=>{},()=>{}][s+h]()}),t[0]<4){let o=0;n.forEach(h=>{o=o<<4,o+=h}),o-=1024}}}}).add([66,18,0,1],(t,r)=>{}).add([66,18,0,2],(t,r)=>{}).add([66,18,1],(t,r)=>{let s=e.chRedir(t[0],r,!0),n=s*p.cc,a=t[1],o=`NS5R CH${s+1}`;t.subarray(2).forEach((h,c)=>{let f=a+c;f<3?[()=>{e.#e[n+u[0]]=h},()=>{e.#e[n+u[32]]=h},()=>{e.#a[s]=h}][f]():f<8||(f<14?[()=>{let d=e.chRedir(h,r,!0);e.#c[s]=d,s!=d&&(e.buildRchTree(),console.info(`${o}receives from CH${d+1}`))},()=>{e.#g[s]=+!h},()=>{console.debug(`${o}type: ${se[h]}`)},()=>{e.#r[p.rpn*s+3]=h},()=>{},()=>{}][f-8]():f<16||(f<33?[()=>{e.#e[n+u[7]]=h},()=>{e.#e[n+u[11]]=h},()=>{},()=>{},()=>{e.#e[n+u[10]]=h||128},()=>{},()=>{},()=>{e.#e[n+u[93]]=h},()=>{e.#e[n+u[91]]=h},()=>{e.#e[n+u[76]]=h},()=>{e.#e[n+u[77]]=h},()=>{e.#e[n+u[78]]=h},()=>{e.#e[n+u[74]]=h},()=>{e.#e[n+u[71]]=h},()=>{e.#e[n+u[73]]=h},()=>{e.#e[n+u[75]]=h},()=>{e.#e[n+u[72]]=h}][f-16]():f<112||f<114&&[()=>{e.#e[n+u[5]]=h},()=>{e.#e[n+u[65]]=h}][f-112]()))})}).add([66,18,8,0],(t,r)=>{}).add([66,52],(t,r)=>{e.switchMode("ns5r",!0),e.#n=!1}).add([66,53],(t,r)=>{e.switchMode("ns5r",!0),e.#n=!1,I(t,function(s,n){switch(!0){case n<2944:{let a=e.chRedir(Math.floor(n/92),r,!0),o=a*p.cc;switch(n%92){case 0:{e.#e[o+u[0]]=s;break}case 1:{e.#e[o+u[32]]=s;break}case 2:{e.#a[a]=s,s>0&&(e.#o[a]=1);break}case 3:{let h=e.chRedir(s,r,!0);e.#c[a]=h,a!=h&&(console.info(`NS5R CH${a+1} receives from CH${h+1}.`),e.buildRchTree())}case 7:break;case 8:{e.#r[a*p.rpn+3]=s<40||s>88?s+(s>63?-192:64):s;break}case 9:case 10:{e.#e[o+u[7]]=s;break}case 11:{e.#e[o+u[11]]=s;break}case 14:{e.#e[o+u[10]]=s||128;break}case 19:{e.#e[o+u[93]]=s;break}case 20:{e.#e[o+u[91]]=s;break}case 84:{e.#e[o+u[65]]=s;break}case 85:{e.#e[o+u[5]]=s;break}}break}case n<3096:break;case n<3134:break;case n<8566:break}})}).add([66,54],(t,r)=>{e.switchMode("ns5r",!0);let s="",n=80,a=0,o=0,h="MSB	PRG	LSB	NME";I(t,function(c,f){let d=f%158;switch(!0){case d<10:{c>31&&(s+=String.fromCharCode(c));break}case d==11:{n=c;break}case d==12:{o=c;break}case d==13:{h+=`
${n}	${a}	${o}	${s.trim().replace("Init Voice","")}`,a++,s="";break}}}),e.userBank.clearRange({msb:80,lsb:0}),e.userBank.load(h)}).add([66,55],(t,r)=>{e.switchMode("ns5r",!0);let s="",n=88,a=0,o=0,h="MSB	PRG	LSB	NME";I(t,function(c,f){let d=f%126;switch(!0){case d<10:{c>31&&(s+=String.fromCharCode(c));break}case d==11:break;case d==12:break;case d==13:{h+=`
${n}	${a}	${o}	${s.trim().replace("Init Combi","")}`,a++,s="";break}}}),e.userBank.clearRange({msb:88,lsb:0}),e.userBank.load(h)}).add([66,125],t=>{e.dispatchEvent("backlight",["green","orange","red",!1,"yellow","blue","purple"][t[0]]||"white")}).add([76],(t,r,s)=>{e.#B.run([66,...t],r,s)}),this.#V.add([16,0,8,0],(t,r,s)=>{let n=(t[2]<<4)+t[3],a="K11 ";([()=>{e.switchMode("k11",!0),e.#n=!1,e.#v=n?4:0,console.info("MIDI reset: GMega/K11")},()=>{console.debug(`${a}reverb type: ${n}`)},()=>{console.debug(`${a}reverb time: ${n}`)},()=>{console.debug(`${a}reverb time: ${n}`)},()=>{console.debug(`${a}reverb predelay: ${n}`)},()=>{console.debug(`${a}reverb predelay: ${n}`)},()=>{console.debug(`${a}depth high: ${n}`)},()=>{console.debug(`${a}depth high: ${n}`)},()=>{console.debug(`${a}depth low: ${n}`)},()=>{console.debug(`${a}depth low: ${n}`)}][t[0]]||(()=>{}))()}).add([16,0,8,1],(t,r,s)=>{let n=e.chRedir(t[1],r,!0),a=p.cc*n,o=p.rpn*n,h=(t[3]<<4)+t[4],c=`K11 CH${n+1} `;([()=>{h<128?(e.#e[a+u[0]]=0,e.#a[n]=h):(e.#e[a+u[0]]=122,e.#a[n]=h-128)},()=>{let f=e.chRedir(h,r,!0);e.#c[n]=f,n!=f&&(e.buildRchTree(),console.info(`${c}receives from CH${f+1}`))},()=>{e.#e[a+u[7]]=h},()=>{e.#o[n]=h},()=>{e.#e[a+u[10]]=h},()=>{e.#r[o+3]=h+40},()=>{e.#r[o+1]=h>>1,e.#r[o+2]=h&1},()=>{e.#e[a+u[91]]=h?127:0},()=>{},()=>{e.#e[a+u[74]]=h},()=>{e.#e[a+u[73]]=h},()=>{e.#e[a+u[72]]=h}][t[0]]||(()=>{}))()}).add([16,0,9,0],(t,r,s)=>{let n=(t[2]<<4)+t[3],a="GMLX ";([()=>{console.debug(`${a}reverb type: ${n}`)},()=>{console.debug(`${a}reverb time: ${n}`)},()=>{console.debug(`${a}reverb predelay: ${n}`)},()=>{console.debug(`${a}depth high: ${n}`)},()=>{console.debug(`${a}depth low: ${n}`)}][t[0]]||(()=>{}))()}).add([16,0,9,3],(t,r,s)=>{let n=(t[2]<<4)+t[3],a=e.chRedir(t[1],r,!0),o=a*p.cc;[()=>{n<128?(e.#e[o+u[0]]=0,e.#e[o+u[32]]=0,e.#a[a]=n):n<160?(e.#e[o+u[0]]=0,e.#e[o+u[32]]=7,e.#a[a]=n-100):(e.#e[o+u[0]]=122,e.#e[o+u[32]]=0,e.#a[a]=n-160)},()=>{let h=e.chRedir(n,r,!0);e.#c[a]=h,a!=h&&(e.buildRchTree(),console.info(`GMLX CH${a+1} receives from CH${h+1}`))}][t[0]]()}).add([16,0,9,4],(t,r,s)=>{let n=(t[2]<<4)+t[3],a=e.chRedir(t[1],r,!0),o=a*p.cc,h=a*p.rpn,c=`GMLX CH${a+1} `;[()=>{e.#o[a]=n},()=>{e.#e[o+u[7]]=n},()=>{e.#e[o+u[10]]=n},()=>{e.#e[o+u[91]]=n?127:0},()=>{e.#r[h+3]=n+40},()=>{e.#r[h+1]=n},()=>{e.#r[h]=n},()=>{}][t[0]]()}),this.#H.add([66,93,64],(t,r,s)=>{let n=t[2];switch(t[0]){case 0:{switch(t[1]){case 4:{e.#m=n*129/16383*100;break}case 5:{n-64;break}case 6:{console.debug(`SG global reverb: ${n?"on":"off"}`);break}case 127:{e.switchMode("sg",!0);break}}break}case 1:{switch(t[1]){case 48:{console.debug(`SG reverb type: ${ne[n]}`);break}}break}default:if(t[0]>>4==1){let a=e.chRedir(t[0]&15,r,!0);if(t[1]==2){let o=e.chRedir(n,r,!0);e.#c[a]=o,a!=o&&(e.buildRchTree(),console.info(`SG CH${a+1} receives from CH${o+1}`))}else t[1]==19&&(e.#e[p.cc*a+u[7]]=n)}else console.warn(`Unknown AKAI SG SysEx: ${t}`)}}),this.#q.add([9],(t,r,s)=>{console.debug(`GZ set effect: ${["stage reverb","hall reverb","room reverb","chorus","tremelo","phaser","rotary speaker","enhancer","flanger","EQ"][t[0]]||"off"}`)})}};var me=xe(ue(),1);var Ke=class{#t=!1;constructor(e,i,l,t){this.#t=e,this.start=i,this.end=l,this.data=t}get duration(){return this.ranged?this.end-this.start:0}get ranged(){return this.#t}},pe=class extends Ke{constructor(e,i,l){super(!0,e,i,l)}},m=class extends Ke{constructor(e,i){super(!1,e,e,i)}},k=class extends Array{#t=-1;constructor(){super(...arguments)}resetIndex(e){this.#t=-1}fresh(){this.sort(function(e,i){return e.start==i.start?0:(+(e.start>i.start)<<1)-1}),this.forEach(function(e,i){e.index=i})}step(e,i=!1){let l=[];if(i)for(let t=0;t<this.length&&!(this[t].start>e);t++){if(this[t].end<e)continue;l.push(this[t])}else{let t=this.getRange(this.#t==-1?0:e-1,e),r=this;t.forEach(function(s){s.index>r.#t&&(l.push(s),r.#t=s.index)})}return l}getRange(e,i){e>i&&([e,i]=[i,e]);let l=[],t=-1,r=Math.ceil(Math.sqrt(this.length)),s=!0;for(let n=0;n<this.length;n+=r)this[n+r]?t<0&&this[n+r].start>=e&&(t=n):t=t<0?n:t;for(;s;)this[t]?.end<i?this[t].start>=e&&l.push(this[t]):s=!1,t++;return l}};var Pt=0xffffffffffff,ge=function(e){let i=new k,l=this,t=e.timeDivision,r=120,s=new k,n=0,a=0;s.push(new pe(0,Pt,[120,0])),e.track.forEach(function(f){n=0,f.event.forEach(function(d){n+=d.deltaTime,d.type==255&&d?.metaType==81&&(r=6e7/d.data,s[s.length-1]&&s.push(new pe(n,0xffffffffffff,[r,0])))})}),s.fresh(),s.forEach(function(f,d,g){d>0&&(g[d-1].end=f.start)});let o=120;s.forEach(function(f,d,g){d>0&&(f.end==f.start?g.splice(g.indexOf(f),1):o==f.data[0]&&(g[d-1].end=f.end,g.splice(g.indexOf(f),1)),o=f.data[0])});let h=0,c=120;return s.forEach(function(f){let d=f.start,g=d/c/t*60+h;c=f.data[0],h=g-d/c/t*60,f.data[1]=h}),console.debug("All tempo changes: ",s),r=120,n=0,a=0,e.track.forEach(function(f,d){n=0,a=0;let g=d+1;f.event.forEach(function(y,w){n+=y.deltaTime;let v=s.step(n,!0)[0];v&&(r=v.data[0],a=v.data[1]);let E={type:y.type,data:y.data,track:g,part:0};y.type>14?E.meta=y.metaType:E.part=y.channel,i.push(new m(n/r/t*60+a,E))})}),i.fresh(),self.midiEvents=i,console.debug(`Parsed a type ${e.formatType} MIDI sequence.`),i};me.default.customInterpreter=ee;var We=class extends q{#t=new Ye;#u;#l="";#h=[];#p=new Uint8ClampedArray(64);#o=.5;#c=120;#e=4;#a=4;#s=0;#g=0;smoothingAtk=0;smoothingDcy=0;reset(){this.dispatchEvent("reset"),this.#u?.resetIndex(),this.#t.init(),this.#l="",this.#o=.5,this.#c=120,this.#e=4,this.#a=4,this.#s=0,this.#g=0}async loadFile(e){this.#u=ge(me.default.parse(new Uint8Array(await e.arrayBuffer())))}switchMode(e,i=!1){this.#t.switchMode(e,i)}getMode(){return this.#t.getMode()}getVoice(){return this.#t.getVoice(...arguments)}getChVoice(e){return this.#t.getChVoice(e)}get noteProgress(){return this.#g/this.#o}get noteOverall(){return this.noteProgress-this.#s}get noteBar(){return Math.floor(this.noteOverall/this.#e)}get noteBeat(){let e=this.noteOverall%this.#e;return e<0&&(e+=this.#e),e}getTimeSig(){return[this.#e,this.#a]}getTempo(){return this.#c}sendCmd(e){this.#t.runJson(e)}render(e){e>this.#g&&(this.#g=e);let i=this.#u?.step(e)||[],l=0,t=new Set,r=this,s=[];r.#t.newStrength(),i.forEach(function(y){let w=y.data;w.type==9&&(w.data[1]>0?t.add(w.part*128+w.data[0]):t.has(w.part*128+w.data[0])&&l++),y.data.type==8&&t.has(w.part*128+w.data[0])&&l++;let v=r.#t.runJson(w);switch(v?.reply){case"meta":{s.push(v);break}}v?.reply&&delete v.reply});let n=this.#t.getStrength();n.forEach(function(y,w){let v=y-r.#p[w];v>=0?r.#p[w]+=Math.ceil(v-v*r.smoothingAtk):r.#p[w]+=Math.ceil(v-v*r.smoothingDcy)}),s?.length>0&&this.dispatchEvent("meta",s);let a=this.#t.getActive(),o=[],h=r.#t.getPitch(),c=r.#t.getCcAll(),f=r.#t.getProgram(),d=0;return a.forEach(function(y,w){y&&(o[w]=r.#t.getVel(w),d+=o[w].size)}),{extraPoly:l,curPoly:d,chInUse:a,chKeyPr:o,chPitch:h,chProgr:f,chContr:c,eventCount:i.length,title:this.#l,bitmap:this.#t.getBitmap(),letter:this.#t.getLetter(),texts:this.#t.getTexts(),master:this.#t.getMaster(),mode:this.#t.getMode(),strength:this.#p.slice(),velo:n,rpn:this.#t.getRpn(),tSig:this.getTimeSig(),tempo:this.getTempo(),noteBar:this.noteBar,noteBeat:this.noteBeat}}constructor(e=.5,i=.5){super();let l=this;this.smoothingAtk=e,this.smoothingDcy=i,this.addEventListener("meta",function(t){t?.data?.forEach(function(r){(l.#h[r.meta]||console.debug).call(l,r.meta,r.data)})}),this.#t.addEventListener("mode",function(t){l.dispatchEvent("mode",t.data)}),this.#t.addEventListener("channelactive",function(t){l.dispatchEvent("channelactive",t.data)}),this.#t.addEventListener("channelmin",function(t){l.dispatchEvent("channelmin",t.data)}),this.#t.addEventListener("channelmax",function(t){l.dispatchEvent("channelmax",t.data)}),this.#t.addEventListener("channelreset",function(t){l.dispatchEvent("channelreset")}),this.#h[3]=function(t,r){l.#l?.length<1&&(l.#l=r)},this.#h[81]=function(t,r){let s=l.noteProgress,n=l.#o||.5;l.#c=6e7/r,l.#o=r/1e6,l.#s+=s*(n/l.#o)-s},this.#h[88]=function(t,r){let s=l.noteProgress,n=l.noteOverall,a=l.noteBar,o=l.noteBeat,h=l.#e,c=l.#a;l.#e=r[0],l.#a=1<<r[1];let f=24*(32/r[3])/r[2];if(h!=l.#e){let d=a;l.#s-=d*(l.#e-h),o+1>=h&&(h<l.#e?l.#s-=Math.ceil(l.#e-o-1):l.#s+=l.#e)}}}};var be=new Uint8Array(40),K=0,ye,Tr=setInterval(()=>{ye&&(be[K]=!be[K],K++,K>34&&(K=0))},1e3/50);Uint8Array.prototype.render=function(e){let i=0,l=0,t=this.width||5,r=this.height||8;for(let s=0;s<this.length;s++)e(this[s],i,l,this),i++,i>=t&&(i=0,l++)};var je=class{#t=[];async loadFile(e){let i=this;console.debug(`Requested font file from "${e}".`),(await(await fetch(e)).text()).split(`
`).forEach(async function(l,t){if(t>0&&l?.length>0){let r=l.split("	"),s=new Uint8Array(40);Array.from(r[1]).forEach(function(n,a){let o=a%2?4:0,h=Math.floor(a/2),c=parseInt(n,16),f=3;for(;c>0||f>=0;){let d=(o+f)*5+h;s[d]=c&1,c=c>>1,f--}}),i.#t[parseInt(r[0],16)]=s}}),ye=!1}constructor(e){ye=!0,this.loadFile(e)}getCP(e){return this.#t[e]}getStr(e){let i=[],l=this;return Array.from(e).forEach(function(t){i.push(l.#t[t.charCodeAt(0)]||l.#t[32]||be)}),i}};var T="#0000000b",S="#00000068";var Gr=Math.PI*255/180,Nr=Math.PI*285/180;CanvasRenderingContext2D.prototype.radial=function(e,i,l,t,r){let s=l-1.5707963267948966,n=Math.sin(s),a=Math.cos(s);this.beginPath(),this.moveTo(e+n*t,i+a*t),this.lineTo(e+n*r,i+a*r),this.stroke()};var Ze=7;var Xr=Ze*(17+2),zr=Ze*(7+3)+1;var _e=class extends We{#t=0;#u="#b7bfaf64";xgFont=new je("./data/bitmaps/korg/font.tsv");clefs=new Path2D("M110 163.5c0 -3.9 3.2 -7.1 7.1 -7.1s7.1 3.2 7.1 7.1s-3.2 7.1 -7.1 7.1s-7.1 -3.2 -7.1 -7.1zM110 128.5c0 -3.9 3.2 -7.1 7.1 -7.1s7.1 3.2 7.1 7.1s-3.2 7.1 -7.1 7.1s-7.1 -3.2 -7.1 -7.1zM64.5 109.2c24.1 0 41 12.3 41 35.1c0 36.8 -36.8 58 -72.2 72.9c-0.4 0.4 -0.8 0.6 -1.3 0.6c-1 0 -1.8 -0.8 -1.8 -1.8c0 -0.4 0.1 -0.8 0.6 -1.3c28.3 -16.5 57.7 -37.1 57.7 -69c0 -16.8 -8.8 -32.9 -23.9 -32.9c-10.4 0 -18.1 7.6 -21.6 17.6c1.5 -0.7 3.1 -1.1 4.8 -1.1c7.7 0 14 6.3 14 14c0 8.1 -6.2 14.8 -14 14.8c-8.4 0 -15.7 -6.6 -15.7 -14.8c0 -18.6 14.3 -34.2 32.5 -34.2z M408.6 181.3c0.6 0 1.3 -0.1 1.8 -0.1c21.7 0 35.8 17.9 35.8 36.5c0 10.6 -4.6 21.6 -15 29.4c-3.1 2.4 -6.6 3.9 -10.2 5c0.4 4.9 0.7 9.8 0.7 14.7c0 2.7 -0.1 5.5 -0.3 8.1c-1 16.8 -12.6 31.9 -29.1 31.9c-15.1 0 -27.3 -12.3 -27.3 -27.6c0 -8.1 7.4 -14.4 15.7 -14.4c7.6 0 13.3 6.6 13.3 14.4c0 7.3 -6 13.3 -13.3 13.3 c-1.5 0 -2.9 -0.3 -4.3 -0.8c3.6 5.5 9.5 9.1 16.4 9.1c13.4 0 22 -12.9 22.8 -26.7c0.1 -2.5 0.3 -5.2 0.3 -7.7c0 -4.3 -0.1 -8.5 -0.6 -12.9c-4.1 0.7 -8.1 1.1 -12.5 1.1c-26.3 0 -46.6 -24.1 -46.6 -52.4c0 -24.8 18.3 -42.8 34.7 -61.7c-2.7 -8.7 -5.2 -17.5 -6.3 -26.6c-0.8 -7.3 -1 -14.6 -1 -21.8c0 -16.1 7.7 -31.4 20.9 -40.9c0.4 -0.3 1 -0.4 1.4 -0.4c0.6 0 1 0 1.4 0.4 c9.9 11.8 18.6 34.3 18.6 50.1c0 20 -12 35.7 -25.2 51c2.9 9.5 5.5 19.3 7.8 29zM420.5 246.4c9.5 -3.4 15.8 -13.3 15.8 -23c0 -12.6 -9.2 -25.1 -24.2 -26.6c3.4 16.2 6.4 32.3 8.4 49.6zM366.4 214.1c0 18.9 18.1 34.6 37 34.6c3.9 0 7.7 -0.3 11.5 -0.8c-2 -17.8 -5.2 -34.3 -8.8 -51c-11.1 1.1 -17.4 8.5 -17.4 16.7 c0 6.2 3.5 12.7 11.3 17.2c0.7 0.7 1 1.4 1 2.1c0 1.5 -1.4 3.1 -3.1 3.1c-0.4 0 -0.8 -0.1 -1.3 -0.3c-11.2 -6 -16.4 -16.1 -16.4 -25.9c0 -12.3 8.1 -24.4 22.4 -27.6c-2 -8.1 -4.1 -16.4 -6.4 -24.5c-15 16.9 -29.8 34 -29.8 56.4zM413.1 71.7c-13.9 6.7 -22.7 20.9 -22.7 36.3c0 10.4 2.5 18.6 5 27.2 c11.2 -13.6 20.4 -27.7 20.4 -45.4c0 -7.7 -0.6 -11.1 -2.8 -18.1z");keyboard=new Path2D("M224 318 L380 318 L380 380 L224 380 Z M246 350 L246 380 M268 350 L268 380 M291 318 L291 380 M313 350 L313 380 M335 350 L335 380 M358 350 L358 380 M235 318 L235 350 L254 350 L254 318 M260 318 L260 350 L279 350 L279 318 M301 318 L301 350 L320 350 L320 318 M326 318 L326 350 L345 350 L345 318 M350 318 L350 350 L370 350 L370 318 M387 318 L543 318 L543 380 L387 380 Z M409 350 L409 380 M431 350 L431 380 M454 318 L454 380 M476 350 L476 380 M498 350 L498 380 M521 350 L521 380 M398 318 L398 350 L417 350 L417 318 M423 318 L423 350 L442 350 L442 318 M464 318 L464 350 L483 350 L483 318 M489 318 L489 350 L508 350 L508 318 M513 318 L513 350 L533 350 L533 318 M550 318 L706 318 L706 380 L550 380 Z M572 350 L572 380 M594 350 L594 380 M617 318 L617 380 M639 350 L639 380 M661 350 L661 380 M684 350 L684 380 M561 318 L561 350 L580 350 L580 318 M586 318 L586 350 L605 350 L605 318 M627 318 L627 350 L646 350 L646 318 M652 318 L652 350 L671 350 L671 318 M676 318 L676 350 L696 350 L696 318 M713 318 L869 318 L869 380 L713 380 Z M735 350 L735 380 M757 350 L757 380 M780 318 L780 380 M802 350 L802 380 M824 350 L824 380 M847 350 L847 380 M724 318 L724 350 L743 350 L743 318 M749 318 L749 350 L768 350 L768 318 M790 318 L790 350 L809 350 L809 318 M815 318 L815 350 L834 350 L834 318 M839 318 L839 350 L859 350 L859 318 M876 318 L1032 318 L1032 380 L876 380 Z M898 350 L898 380 M920 350 L920 380 M943 318 L943 380 M965 350 L965 380 M987 350 L987 380 M1010 350 L1010 380 M887 318 L887 350 L906 350 L906 318 M912 318 L912 350 L931 350 L931 318 M953 318 L953 350 L972 350 L972 318 M978 318 L978 350 L997 350 L997 318 M1002 318 L1002 350 L1022 350 L1022 318 M1032 318 L1055 318 L1055 380 L1032 380");bracket=new Path2D("M83 23 L49 23 L49 86 L83 86 M264 23 L297 23 L297 86 L264 86");staffLines=new Path2D("M30 110 L344 110 M356 110 L1074 110 M30 146 L344 146 M356 146 L1074 146 M30 182 L344 182 M356 182 L1074 182 M30 218 L344 218 M356 218 L1074 218 M30 254 L344 254 M356 254 L775 254 M894 254 L1074 254");constructor(){super(),this.addEventListener("channelactive",e=>{this.#t=e.data})}setCh(e){this.#t=e}getCh(){return this.#t}#l(e,i,l,t,r=1,s=1,n=-.15){let a=[new Path2D,new Path2D("M36 160 L48 148 L144 148 L156 160 L144 172 L48 172 Z"),new Path2D("M32 156 L20 144 L20 48 L32 36 L44 48 L44 144 Z"),new Path2D("M32 284 L20 272 L20 176 L32 164 L44 176 L44 272 Z"),new Path2D("M156 288 L144 300 L48 300 L36 288 L48 276 L144 276 Z"),new Path2D("M160 164 L172 176 L172 272 L160 284 L148 272 L148 176 Z"),new Path2D("M160 36 L172 48 L172 144 L160 156 L148 144 L148 48 Z"),new Path2D("M36 32 L48 20 L144 20 L156 32 L144 44 L48 44 Z")],o={0:new Uint8Array([0,0,1,1,1,1,1,1]),1:new Uint8Array([0,0,0,0,0,1,1,0]),2:new Uint8Array([0,1,0,1,1,0,1,1]),3:new Uint8Array([0,1,0,0,1,1,1,1]),4:new Uint8Array([0,1,1,0,0,1,1,0]),5:new Uint8Array([0,1,1,0,1,1,0,1]),6:new Uint8Array([0,1,1,1,1,1,0,1]),7:new Uint8Array([0,0,1,0,0,1,1,1]),8:new Uint8Array([0,1,1,1,1,1,1,1]),9:new Uint8Array([0,1,1,0,1,1,1,1])," ":new Uint8Array(8),A:new Uint8Array([0,1,1,1,0,1,1,1]),B:new Uint8Array([0,1,1,1,1,1,0,0]),C:new Uint8Array([0,0,1,1,1,0,0,1]),D:new Uint8Array([0,1,0,1,1,1,1,0]),"-":new Uint8Array([0,1,0,0,0,0,0,0])};Array.from(e).forEach((h,c)=>{i.setTransform(r,0,n*s,s,190*r*c+l,t);for(let f=0;f<8;f++)i.fillStyle=o[h][f]?S:T,i.fill(a[f])}),i.resetTransform()}#h(e,i,l,t,r=8,s=8,n=-.15){let a=this;e=e.slice(0,8),e=e.padEnd(8," "),i.setTransform(1,0,n,1,0,0),a.xgFont.getStr(e).forEach((o,h)=>{o.render((c,f,d)=>{i.fillStyle=c?S:T,i.fillRect(l+(f+6*h)*r,t+d*s,r-1,s-1)})}),i.resetTransform()}render(e,i,l="white",t,r,s=0){let n=super.render(e),a=this,o=Date.now(),h=!1,c=0,f=0;n.chInUse.forEach(function($,Re){$&&(h||(h=!0,c=Re),f=Re)}),c=c>>4<<4,f=(f>>4<<4)+15,this.#t>f&&(this.#t=c+this.#t&15),this.#t<c&&(this.#t=f-15+(this.#t&15));let g=this.#t*u.length;i.fillStyle=this.#u,i.fillRect(0,0,i.canvas.width,i.canvas.height),i.fillStyle="#000c",i.textAlign="left",i.font='22px "Arial Web"',i.fillText("C4",548,399),i.strokeStyle="#000c",i.stroke(a.bracket),i.stroke(a.staffLines),i.fill(a.clefs),i.stroke(a.keyboard);let y=new Path2D("m 160.263,824.43605 c 0.939,1.039 1.482,2.434 1.482,3.833 0,1.402 -0.543,2.796 -1.482,3.834 1.038,-0.944 2.43,-1.483 3.837,-1.483 1.398,0 2.791,0.539 3.828,1.483 -0.948,-1.038 -1.482,-2.432 -1.482,-3.834 0,-1.399 0.534,-2.794 1.482,-3.833 -1.037,0.945 -2.43,1.483 -3.828,1.483 -1.407,0 -2.799,-0.538 -3.837,-1.483"),w=new Path2D("m 166.418,820.55105 c 0.13,0 0.253,-0.054 0.351,-0.143 0.089,-0.094 0.143,-0.223 0.143,-0.351 v -1.969 l 1.847,-6.897 c 0.706,-2.627 0.966,-5.371 0.78,-8.09 l -0.184,-2.644 1.188,-2.055 h -5.175 l -1.268,3.499 -1.278,-3.499 h -5.171 l 1.185,2.055 -0.185,2.644 c -0.185,2.719 0.076,5.463 0.782,8.09 l 1.847,6.897 v 1.969 c 0,0.128 0.054,0.257 0.145,0.351 0.089,0.089 0.218,0.143 0.348,0.143 h 0.214 c 0.423,0 0.841,-0.11 1.213,-0.321 0.364,-0.204 0.68,-0.509 0.9,-0.871 0.213,0.362 0.527,0.667 0.89,0.871 0.373,0.211 0.79,0.321 1.208,0.321 h 0.22 m -0.22,-1.304 c 0,0.111 -0.034,0.217 -0.095,0.303 -0.069,0.085 -0.164,0.147 -0.268,0.178 -0.103,0.024 -0.22,0.016 -0.317,-0.027 -0.315,-0.132 -0.588,-0.357 -0.78,-0.645 -0.185,-0.283 -0.289,-0.626 -0.289,-0.968 v -6.306 c 0.262,0.159 0.562,0.23 0.865,0.213 0.308,-0.023 0.595,-0.138 0.836,-0.329 0.233,-0.192 0.406,-0.454 0.488,-0.748 l 0.007,-0.017 c 0.379,-1.35 0.631,-2.734 0.747,-4.134 0.496,-0.497 0.797,-1.176 0.839,-1.876 0.046,-0.701 -0.172,-1.411 -0.591,-1.967 l -0.625,0.356 c 0.371,0.453 0.556,1.058 0.501,1.64 -0.054,0.584 -0.349,1.143 -0.801,1.517 -0.112,1.448 -0.365,2.889 -0.756,4.288 -0.055,0.178 -0.165,0.336 -0.323,0.436 -0.15,0.099 -0.343,0.145 -0.522,0.119 -0.184,-0.026 -0.356,-0.115 -0.472,-0.257 -0.124,-0.136 -0.193,-0.319 -0.193,-0.503 v -7.524 l 1.413,-3.887 h 3.453 l -0.687,1.18 0.199,2.865 c 0.186,2.636 -0.068,5.301 -0.756,7.853 l -1.873,6.989 z m -4.143,-1.251 -1.873,-6.989 c -0.681,-2.552 -0.94,-5.217 -0.755,-7.853 l 0.198,-2.865 -0.68,-1.18 h 3.446 l 1.412,3.887 v 7.524 c 0,0.184 -0.066,0.367 -0.185,0.503 -0.124,0.142 -0.295,0.231 -0.472,0.257 -0.185,0.026 -0.372,-0.02 -0.529,-0.119 -0.151,-0.1 -0.267,-0.258 -0.315,-0.436 -0.4,-1.399 -0.652,-2.84 -0.756,-4.288 -0.453,-0.374 -0.747,-0.933 -0.803,-1.517 -0.059,-0.582 0.125,-1.187 0.495,-1.64 l -0.618,-0.356 c -0.424,0.556 -0.637,1.266 -0.597,1.967 0.049,0.7 0.349,1.379 0.838,1.876 0.122,1.4 0.371,2.784 0.753,4.134 v 0.017 c 0.084,0.294 0.262,0.556 0.497,0.748 0.233,0.191 0.527,0.306 0.83,0.329 0.299,0.017 0.608,-0.054 0.862,-0.213 v 6.306 c 0,0.342 -0.095,0.685 -0.288,0.968 -0.184,0.288 -0.459,0.513 -0.774,0.645 -0.103,0.043 -0.212,0.051 -0.316,0.027 -0.104,-0.031 -0.199,-0.093 -0.268,-0.178 -0.069,-0.086 -0.102,-0.192 -0.102,-0.303 v -1.251"),v=new Path2D("m 143.496,764.85205 -1.915,5.26 c -0.152,0.404 -0.158,0.856 -0.029,1.267 0.13,0.408 0.406,0.767 0.756,1.01 0.356,0.244 0.795,0.362 1.221,0.338 l -1.483,4.067 c -0.15,0.417 -0.136,0.885 0.035,1.291 0.163,0.409 0.494,0.744 0.893,0.926 0.403,0.186 0.87,0.209 1.288,0.075 -0.06,0.409 0.02,0.841 0.234,1.199 0.213,0.357 0.557,0.63 0.949,0.765 0.397,0.133 0.835,0.123 1.219,-0.032 0.384,-0.155 0.714,-0.445 0.913,-0.813 0.22,0.315 0.563,0.543 0.941,0.628 0.369,0.084 0.781,0.03 1.118,-0.151 0.336,-0.183 0.603,-0.496 0.733,-0.858 l 0.885,-2.412 c 0.222,0.306 0.565,0.529 0.94,0.611 0.371,0.083 0.776,0.029 1.112,-0.158 0.338,-0.186 0.596,-0.494 0.726,-0.851 l 2.074,-5.687 c 0.988,-2.715 0.803,-5.834 -0.493,-8.414 v -0.005 l -7.014,-2.549 c -1.152,0.262 -2.237,0.812 -3.128,1.595 -0.886,0.779 -1.577,1.784 -1.975,2.898 m 9.357,8.148 -0.665,-0.24 -2.484,6.824 c -0.076,0.217 -0.247,0.402 -0.453,0.497 -0.212,0.099 -0.459,0.11 -0.679,0.031 -0.218,-0.079 -0.406,-0.246 -0.501,-0.455 -0.096,-0.213 -0.109,-0.46 -0.026,-0.68 l 2.482,-6.823 -0.666,-0.241 -2.845,7.822 c -0.098,0.261 -0.303,0.48 -0.551,0.6 -0.253,0.118 -0.556,0.13 -0.815,0.036 -0.261,-0.097 -0.482,-0.3 -0.597,-0.55 -0.118,-0.253 -0.13,-0.551 -0.041,-0.813 l 2.846,-7.826 -0.666,-0.24 -2.483,6.823 c -0.095,0.262 -0.294,0.482 -0.548,0.602 -0.256,0.117 -0.549,0.129 -0.809,0.033 -0.262,-0.095 -0.488,-0.298 -0.606,-0.548 -0.115,-0.253 -0.13,-0.552 -0.035,-0.814 l 1.662,-4.569 c 0.398,-0.227 0.706,-0.597 0.865,-1.023 l 1.091,-3.001 c 0.83,-0.093 1.625,-0.392 2.304,-0.868 0.674,-0.477 1.236,-1.124 1.6,-1.866 l -0.672,-0.248 c -0.351,0.683 -0.893,1.269 -1.545,1.671 -0.658,0.404 -1.421,0.625 -2.196,0.631 l -1.25,3.438 c -0.108,0.306 -0.341,0.563 -0.635,0.7 -0.295,0.136 -0.647,0.151 -0.955,0.04 -0.303,-0.11 -0.557,-0.345 -0.693,-0.637 -0.137,-0.294 -0.158,-0.646 -0.049,-0.955 l 1.923,-5.259 c 0.35,-0.967 0.94,-1.847 1.702,-2.542 0.767,-0.687 1.7,-1.193 2.695,-1.452 l 6.539,2.38 c 1.103,2.359 1.236,5.158 0.343,7.605 l -2.073,5.685 c -0.076,0.22 -0.246,0.404 -0.459,0.499 -0.205,0.101 -0.453,0.109 -0.671,0.033 -0.22,-0.08 -0.406,-0.248 -0.503,-0.457 -0.094,-0.212 -0.109,-0.461 -0.026,-0.68 l 1.145,-3.163 M 184.684,764.85205 c -0.405,-1.114 -1.093,-2.119 -1.985,-2.898 -0.883,-0.783 -1.974,-1.333 -3.128,-1.595 l -7.004,2.549 v 0.005 c -1.303,2.58 -1.49,5.699 -0.501,8.414 l 2.072,5.687 c 0.13,0.357 0.397,0.665 0.732,0.851 0.332,0.187 0.736,0.241 1.113,0.158 0.37,-0.082 0.712,-0.305 0.94,-0.611 l 0.88,2.412 c 0.13,0.362 0.397,0.675 0.739,0.858 0.336,0.181 0.741,0.235 1.12,0.151 0.368,-0.085 0.712,-0.313 0.94,-0.628 0.19,0.368 0.52,0.658 0.905,0.813 0.383,0.155 0.83,0.165 1.219,0.032 0.393,-0.135 0.735,-0.408 0.955,-0.765 0.213,-0.358 0.296,-0.79 0.227,-1.199 0.418,0.134 0.891,0.111 1.289,-0.075 0.398,-0.182 0.729,-0.517 0.9,-0.926 0.173,-0.406 0.179,-0.874 0.028,-1.291 l -1.481,-4.067 c 0.429,0.024 0.862,-0.094 1.219,-0.338 0.358,-0.243 0.625,-0.602 0.755,-1.01 0.138,-0.411 0.123,-0.863 -0.02,-1.267 l -1.914,-5.26 m -8.213,11.311 c 0.074,0.219 0.068,0.468 -0.035,0.68 -0.095,0.209 -0.282,0.377 -0.501,0.457 -0.211,0.076 -0.467,0.068 -0.673,-0.033 -0.212,-0.095 -0.377,-0.279 -0.459,-0.499 l -2.071,-5.685 c -0.886,-2.447 -0.762,-5.246 0.342,-7.605 l 6.539,-2.38 c 1,0.259 1.935,0.765 2.695,1.452 0.762,0.695 1.352,1.575 1.71,2.542 l 1.914,5.259 c 0.109,0.309 0.094,0.661 -0.041,0.955 -0.138,0.292 -0.398,0.527 -0.7,0.637 -0.309,0.111 -0.66,0.096 -0.948,-0.04 -0.294,-0.137 -0.534,-0.394 -0.643,-0.7 l -1.248,-3.438 c -0.771,-0.006 -1.539,-0.227 -2.192,-0.631 -0.657,-0.402 -1.192,-0.988 -1.55,-1.671 l -0.671,0.248 c 0.371,0.742 0.926,1.389 1.605,1.866 0.68,0.476 1.476,0.775 2.298,0.868 l 1.092,3.001 c 0.159,0.426 0.467,0.796 0.865,1.023 l 1.66,4.569 c 0.096,0.262 0.081,0.561 -0.035,0.814 -0.118,0.25 -0.336,0.453 -0.596,0.548 -0.261,0.096 -0.563,0.084 -0.816,-0.033 -0.248,-0.12 -0.454,-0.34 -0.551,-0.602 l -2.482,-6.823 -0.666,0.24 2.845,7.826 c 0.099,0.262 0.084,0.56 -0.032,0.813 -0.124,0.25 -0.343,0.453 -0.604,0.55 -0.261,0.094 -0.556,0.082 -0.811,-0.036 -0.253,-0.12 -0.451,-0.339 -0.548,-0.6 l -2.847,-7.822 -0.666,0.241 2.484,6.823 c 0.076,0.22 0.069,0.467 -0.033,0.68 -0.097,0.209 -0.282,0.376 -0.494,0.455 -0.221,0.079 -0.467,0.068 -0.68,-0.031 -0.214,-0.095 -0.379,-0.28 -0.459,-0.497 l -2.485,-6.824 -0.665,0.24 1.153,3.163");n.noteBeat&1?(i.fillStyle=S,i.setTransform(3.2,0,0,-3.2,455,2733),i.fill(v),i.fillStyle=T,i.setTransform(3.2,0,0,-3.2,455,2855),i.fill(w)):(i.fillStyle=T,i.setTransform(3.2,0,0,-3.2,455,2733),i.fill(v),i.fillStyle=S,i.setTransform(3.2,0,0,-3.2,455,2855),i.fill(w)),i.fillStyle=n.noteBeat<1?S:T,i.setTransform(3.2,0,0,-3.2,455,2855),i.fill(y),i.resetTransform();let E=[[228,0],[238.5,1],[250.3,0],[263.5,1],[272.6,0],[295,0],[304.5,1],[317.3,0],[330,1],[339.5,0],[354,1],[361.8,0]],gt=new Path2D("M199 349 L214 329 L214 369 Z"),mt=new Path2D("M1080 349 L1065 369 L1065 329 Z"),Ce=!1,Q=!1;i.fillStyle=T,i.fillRect(1036,355,14,21);let V,C;for(let $=36;$<96;$++)V=Math.floor($/12),C=$%12,i.fillStyle=n.chKeyPr[this.#t]?.has($)?S:T,E[C][1]?i.fillRect(E[C][0]+163*(V-3),321,12,26):i.fillRect(E[C][0]+163*(V-3),355,14,21);for(let $=0;$<36;$++)V=Math.floor($/12),C=$%12,n.chKeyPr[this.#t]?.has($)&&(i.fillStyle=S,E[C][1]?i.fillRect(E[C][0],321,12,26):i.fillRect(E[C][0],355,14,21),Ce=!0);for(let $=97;$<128;$++)$==108||$==120||(V=Math.floor($/12),C=$%12,n.chKeyPr[this.#t]?.has($)&&(i.fillStyle=S,E[C][1]?i.fillRect(E[C][0]+163*4,321,12,26):i.fillRect(E[C][0]+163*4,355,14,21),Q=!0));if(n.chKeyPr[this.#t]?.has(96)&&(i.fillStyle=S,i.fillRect(1036,355,14,21)),n.chKeyPr[this.#t]?.has(108)&&(i.fillStyle=S,i.fillRect(1036,355,14,21),Q=!0),n.chKeyPr[this.#t]?.has(120)&&(i.fillStyle=S,i.fillRect(1036,355,14,21),Q=!0),i.fillStyle=Ce?S:T,i.fill(gt),i.fillStyle=Q?S:T,i.fill(mt),this.#l(`${"ABCD"[this.#t>>4]}${((this.#t&15)+1).toString().padStart(2,"0")}`,i,32,315,.24,.24),i.font='23px "Arial Web"',i.fillStyle=r?T:S,i.fillText("MEASURE",664,296),i.fillStyle=r?S:T,i.fillText("TEMPO",795,242),r?this.#l(Math.round(n.tempo).toString().padStart(3,"0"),i,791,245,.17,.17):this.#l((n.noteBar+1).toString().padStart(3,"0"),i,791,245,.17,.17),o<=n.letter.expire){let $=n.letter.text.trim().padEnd(8," ");this.#h($.slice(0,8),i,454,32),t?this.#l(`${n.chProgr[this.#t]+1}`.padStart(3,"0"),i,112,15,.24,.24):this.#l(`${s+1}`.padStart(3,"0"),i,112,15,.24,.24)}else t?(this.#l(`${n.chProgr[this.#t]+1}`.padStart(3,"0"),i,112,15,.24,.24),this.#h(a.getChVoice(this.#t).name,i,454,32)):(this.#l(`${s+1}`.padStart(3,"0"),i,112,15,.24,.24),this.#h(a.songTitle||"Unknown",i,454,32))}};var At=Object.defineProperty,N=(e,i)=>()=>(e&&(i=e(e=0)),i),X=(e,i)=>{for(var l in i)At(e,l,{get:i[l],enumerable:!0})},Je={};X(Je,{default:()=>et});var et,Bt=N(()=>{et=async(e=[{}])=>(Array.isArray(e)||(e=[e]),new Promise((i,l)=>{let t=document.createElement("input");t.type="file";let r=[...e.map(o=>o.mimeTypes||[]).join(),e.map(o=>o.extensions||[]).join()].join();t.multiple=e[0].multiple||!1,t.accept=r||"";let s=()=>a(l),n=o=>{typeof a=="function"&&a(),i(o)},a=e[0].legacySetup&&e[0].legacySetup(n,s,t);t.addEventListener("change",()=>{n(t.multiple?Array.from(t.files):t.files[0])}),t.click()}))}),tt={};X(tt,{default:()=>rt});var Qe,rt,It=N(()=>{Qe=async e=>{let i=await e.getFile();return i.handle=e,i},rt=async(e=[{}])=>{Array.isArray(e)||(e=[e]);let i=[];e.forEach((r,s)=>{i[s]={description:r.description||"",accept:{}},r.mimeTypes?r.mimeTypes.map(n=>{i[s].accept[n]=r.extensions||[]}):i[s].accept["*/*"]=r.extensions||[]});let l=await window.showOpenFilePicker({id:e[0].id,startIn:e[0].startIn,types:i,multiple:e[0].multiple||!1,excludeAcceptAllOption:e[0].excludeAcceptAllOption||!1}),t=await Promise.all(l.map(Qe));return e[0].multiple?t:t[0]}}),it={};X(it,{default:()=>at});var at,Dt=N(()=>{at=async(e=[{}])=>(Array.isArray(e)||(e=[e]),e[0].recursive=e[0].recursive||!1,new Promise((i,l)=>{let t=document.createElement("input");t.type="file",t.webkitdirectory=!0;let r=()=>n(l),s=a=>{typeof n=="function"&&n(),i(a)},n=e[0].legacySetup&&e[0].legacySetup(s,r,t);t.addEventListener("change",()=>{let a=Array.from(t.files);e[0].recursive?e[0].recursive&&e[0].skipDirectory&&(a=a.filter(o=>o.webkitRelativePath.split("/").every(h=>!e[0].skipDirectory({name:h,kind:"directory"})))):a=a.filter(o=>o.webkitRelativePath.split("/").length===2),s(a)}),t.click()}))}),st={};X(st,{default:()=>nt});var we,nt,Ut=N(()=>{we=async(e,i,l=e.name,t)=>{let r=[],s=[];for await(let n of e.values()){let a=`${l}/${n.name}`;n.kind==="file"?s.push(n.getFile().then(o=>(o.directoryHandle=e,o.handle=n,Object.defineProperty(o,"webkitRelativePath",{configurable:!0,enumerable:!0,get:()=>a})))):n.kind==="directory"&&i&&(!t||!t(n))&&r.push(we(n,i,a,t))}return[...(await Promise.all(r)).flat(),...await Promise.all(s)]},nt=async(e={})=>{e.recursive=e.recursive||!1;let i=await window.showDirectoryPicker({id:e.id,startIn:e.startIn});return we(i,e.recursive,void 0,e.skipDirectory)}}),lt={};X(lt,{default:()=>ot});async function Ot(e,i){let l=e.getReader(),t=new ReadableStream({start(s){return n();async function n(){return l.read().then(({done:a,value:o})=>{if(a){s.close();return}return s.enqueue(o),n()})}}}),r=new Response(t);return l.releaseLock(),new Blob([await r.blob()],{type:i})}var ot,Ft=N(()=>{ot=async(e,i={})=>{Array.isArray(i)&&(i=i[0]);let l=document.createElement("a"),t=e;"body"in e&&(t=await Ot(e.body,e.headers.get("content-type"))),l.download=i.fileName||"Untitled",l.href=URL.createObjectURL(t);let r=()=>n(reject),s=()=>{typeof n=="function"&&n()},n=i.legacySetup&&i.legacySetup(s,r,l);return l.addEventListener("click",()=>{setTimeout(()=>URL.revokeObjectURL(l.href),30*1e3),s(null)}),l.click(),null}}),ht={};X(ht,{default:()=>ct});var ct,Gt=N(()=>{ct=async(e,i=[{}],l=null,t=!1)=>{Array.isArray(i)||(i=[i]),i[0].fileName=i[0].fileName||"Untitled";let r=[];if(i.forEach((a,o)=>{r[o]={description:a.description||"",accept:{}},a.mimeTypes?(o===0&&(e.type?a.mimeTypes.push(e.type):e.headers&&e.headers.get("content-type")&&a.mimeTypes.push(e.headers.get("content-type"))),a.mimeTypes.map(h=>{r[o].accept[h]=a.extensions||[]})):e.type&&(r[o].accept[e.type]=a.extensions||[])}),l)try{await l.getFile()}catch(a){if(l=null,t)throw a}let s=l||await window.showSaveFilePicker({suggestedName:i[0].fileName,id:i[0].id,startIn:i[0].startIn,types:r,excludeAcceptAllOption:i[0].excludeAcceptAllOption||!1}),n=await s.createWritable();return"stream"in e?(await e.stream().pipeTo(n),s):"body"in e?(await e.body.pipeTo(n),s):(await n.write(blob),await n.close(),s)}}),Nt=(()=>{if(typeof self>"u")return!1;if("top"in self&&self!==top)try{top.location+""}catch{return!1}else if("showOpenFilePicker"in self)return"showOpenFilePicker";return!1})(),$e=Nt,Xt=$e?Promise.resolve().then(()=>(It(),tt)):Promise.resolve().then(()=>(Bt(),Je));async function ve(...e){return(await Xt).default(...e)}var qr=$e?Promise.resolve().then(()=>(Ut(),st)):Promise.resolve().then(()=>(Dt(),it));var Yr=$e?Promise.resolve().then(()=>(Gt(),ht)):Promise.resolve().then(()=>(Ft(),lt));var ft=xe(ue(),1);ft.default.customInterpreter=ee;var dt=function(){return new BroadcastChannel("cc.ltgc.octavia:MainInput")};var B={},R={},Me=[];Me[9]="gm";var O,_=!1,Ee=0,b=function(e=0,i,l){let t=[67,16,73,0,0,10,e];return i?.constructor==Number&&(t.push(i),l.constructor==Number&&t.push(l)),{type:15,track:0,data:t}},z=H("b.mode"),pt=[];z.to=function(e){z.forEach(function(i){i.classList.off("active")}),e>-1&&z[e].classList.on("active")};z.forEach(function(e,i,l){pt[i]=e.title,e.addEventListener("click",function(){visualizer.switchMode(e.title,!0),z.to(i)})});var U=H("b.demo");U.to=function(e){U.forEach(function(i){i.classList.off("active")}),e>-1&&U[e].classList.on("active")};U.forEach(function(e,i,l){e.addEventListener("click",async function(){P.pause(),B[e.title]?.midi||(B[e.title]={},P.src="about:blank",B[e.title].midi=await(await fetch(`./demo/${e.title}.mid`)).blob(),B[e.title].wave=await(await fetch(`./demo/${e.title}.opus`)).blob()),O=R[e.title],O?.resetIndex(),P.currentTime=0,visualizer.reset(),visualizer.loadFile(B[e.title].midi),M&&URL.revokeObjectURL(M),M=B[e.title].wave,P.src=URL.createObjectURL(M),Me[i]?.length>0&&visualizer.switchMode(Me[i]),U.to(i),Ee=i})});var zt="white",W=H("b.backlight");W.to=function(e){W.forEach(function(i){i.classList.off("active")}),e>-1&&W[e].classList.on("active")};W.forEach(function(e,i){e.addEventListener("click",function(){W.to(i)})});var j=!0,Z=H("b.channelSwitching");Z.to=function(e){Z.forEach(function(i){i.classList.off("active")}),j&&Z[e].classList.on("active")};Z.forEach(function(e,i){e.addEventListener("click",function(){j=!j,this.innerText=j?"ON":"OFF",Z.to(i)})});self.visualizer=new _e;visualizer.addEventListener("reset",function(e){visualizer.songTitle="",console.info("Processor reset.")});visualizer.addEventListener("mode",function(e){z.to(pt.indexOf(e.data));let i=[67,16,76,6,0,0,77,79,68,69,58,32],l={gm:[71,77],gs:[71,83],xg:[88,71],g2:[71,77,50],mt32:[77,84,45,51,50],ns5r:[78,83,53,82],ag10:[65,71,45,49,48],"05rw":[48,53,82,47,87],x5d:[88,53,68],k11:[71,77,101,103,97],sg:[83,71],krs:[75,82,79,83,83]};visualizer.sendCmd({type:15,track:0,data:i.concat(l[visualizer.getMode()])})});var te=F("#openMidw"),M,Vt=JSON.parse('{"extensions":[".mid",".MID",".kar",".KAR",".syx",".SYX"],"startIn":"music","id":"midiOpener","description":"Open a MIDI file"}'),Ht=JSON.parse('{"mimeTypes":["audio/*"],"startIn":"music","id":"audioOpener","description":"Open an audio file"}');F("#openMidi").addEventListener("click",async function(){_=!1,te.classList.off("active");let e=await ve(Vt),i=e.name.lastIndexOf("."),l="";i>-1&&(l=e.name.slice(i+1).toLowerCase()),l=="syx"?visualizer.sendCmd({type:15,track:0,data:new Uint8Array(await e.arrayBuffer())}):(U.to(-1),visualizer.reset(),visualizer.loadFile(e),Ee=0)});F("#openAudio").addEventListener("click",async function(){_=!1,te.classList.off("active"),M&&URL.revokeObjectURL(M),M=await ve(Ht),P.src=URL.createObjectURL(M)});te.addEventListener("click",function(){U.to(-1),M&&URL.revokeObjectURL(M),M=null,P.src="",visualizer.reset(),_=!0,te.classList.on("active")});visualizer.addEventListener("meta",function(e){visualizer.songTitle||e.data.forEach(function(i){!visualizer.songTitle&&i.meta==3&&(visualizer.songTitle=i.data)})});var Le=F("#ymhPsr"),qt=Le.getContext("2d"),Se=!1,ke=!1;Le.addEventListener("wheel",function(e){let i=visualizer.getCh();e.deltaY>0?visualizer.setCh(i+1):visualizer.setCh(i-1),e.preventDefault(),e.stopImmediatePropagation()});Le.addEventListener("mousedown",function(e){let i=visualizer.getCh();e.button==0&&(e.offsetX<64?visualizer.setCh(i-1):e.offsetX>=1046?visualizer.setCh(i+1):e.offsetY<110?Se=!Se:e.offsetY>218&&(ke=!ke))});self.toCh=function(e){visualizer.setCh(e)};var P=F("#audioPlayer");P.onended=function(){visualizer.reset(),O?.resetIndex(),P.currentTime=0};(async function(){visualizer.reset();let e=await(await fetch("./demo/KANDI8.mid")).blob();B.KANDI8={},B.KANDI8.midi=e,visualizer.loadFile(e),M&&URL.revokeObjectURL(M),M=await(await fetch("./demo/KANDI8.opus")).blob(),B.KANDI8.wave=M,P.src=URL.createObjectURL(M),O=R.KANDI8})();var ut=0,si=setInterval(function(){{let e=P.currentTime-(self.audioDelay||0);e<ut,j&&O&&O.step(e)?.forEach(i=>{visualizer.sendCmd(i.data)}),visualizer.render(e,qt,zt,Se,ke,_?0:Ee),ut=e}},20);dt().addEventListener("message",function(e){_&&visualizer.sendCmd(e.data)});self.visualizer=visualizer;self.performance=O;{let e=new k;e.push(new m(4,b(15))),e.push(new m(5.7,b(12))),e.push(new m(20,b(1))),e.push(new m(89,b(0))),e.push(new m(117,b(6))),e.fresh(),R.KANDI8=e}{let e=new k;e.push(new m(7,b(6))),e.push(new m(22,b(5))),e.push(new m(80,b(1))),e.fresh(),R.HORIZON=e}{let e=new k;e.push(new m(3,b(2))),e.push(new m(6,b(5))),e.push(new m(28,b(1))),e.push(new m(51,b(6))),e.push(new m(73.5,b(5))),e.push(new m(96,b(4))),e.push(new m(118,b(6))),e.push(new m(141,b(5))),e.push(new m(163,b(5))),e.push(new m(186,b(5))),e.fresh(),R["Sam Sketty - Low Down"]=e}{let e=new k;e.push(new m(0,b(3))),e.push(new m(8.6,b(2))),e.fresh(),R.StarGame=e}{let e=new k;e.push(new m(2,b(8))),e.push(new m(7.5,b(9))),e.fresh(),R["25Japan"]=e}{let e=new k;e.push(new m(7.5,b(2))),e.push(new m(21.5,b(0))),e.push(new m(28.5,b(2))),e.push(new m(53.5,b(0))),e.push(new m(57.5,b(2))),e.push(new m(93,b(5))),e.push(new m(132,b(2))),e.push(new m(160,b(0))),e.push(new m(182.5,b(2))),e.fresh(),R.AGDEMO3=e}{let e=new k;e.push(new m(12,b(3))),e.fresh(),R["01KIMIGA"]=e}{let e=new k;e.push(new m(15,b(0))),e.push(new m(22,b(1))),e.push(new m(30.5,b(3))),e.push(new m(32.5,b(2))),e.push(new m(38,b(1))),e.push(new m(40,b(3))),e.push(new m(42,b(0))),e.push(new m(46,b(7))),e.push(new m(47,b(4))),e.push(new m(62.5,b(11))),e.push(new m(77.5,b(2))),e.push(new m(90,b(11))),e.push(new m(104,b(0))),e.push(new m(107.5,b(1))),e.push(new m(121,b(6))),e.push(new m(128,b(1))),e.push(new m(141,b(5))),e.push(new m(154.5,b(12))),e.push(new m(168,b(11))),e.push(new m(188,b(3))),e.push(new m(201,b(11))),e.push(new m(237,b(1))),e.push(new m(244,b(3))),e.fresh(),R["10DOREMI"]=e}{let e=new k;e.push(new m(5,b(3))),e.push(new m(27.5,b(0))),e.fresh(),R.haruyoko=e}{let e=new k;e.push(new m(0,b(0))),e.fresh(),R["02THEATR"]=e}})();
